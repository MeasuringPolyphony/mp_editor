{"version":3,"sources":["webpack:///src/app/utils/definitions.ts","webpack:///src/app/score-editor/score-editor.module.ts","webpack:///src/app/utils/MusicItem.ts","webpack:///src/app/input/input.service.ts","webpack:///src/app/score-editor/doc.service.ts","webpack:///src/environments/environment.ts","webpack:///src/app/score-editor/score-verovio-view/score-verovio-view.component.ts","webpack:///src/app/score-editor/score-verovio-view/score-verovio-view.component.html","webpack:///src/app/input/input.module.ts","webpack:///src/app/utils/system.ts","webpack:///src/app/utils/mei.ts","webpack:///src/app/input/general-help/general-help.component.ts","webpack:///src/app/input/general-help/general-help.component.html","webpack:///src/app/score-editor/score-editor.component.ts","webpack:///src/app/score-editor/score-editor.component.html","webpack:///src/app/state-service.service.ts","webpack:///src/app/app.component.ts","webpack:///src/app/app.component.html","webpack:///src/app/tools.ts","webpack:///src/app/app.module.ts","webpack:///src/app/utils/part.ts","webpack:///src/app/score-editor/score-diva-view/score-diva-view.component.ts","webpack:///src/app/score-editor/score-diva-view/score-diva-view.component.html","webpack:///src/app/select-document/select-document.component.ts","webpack:///src/app/select-document/select-document.component.html","webpack:///src/app/input/staff-select/staff-select.component.ts","webpack:///src/app/input/staff-select/staff-select.component.html","webpack:///src/app/score-editor/selected-staff.service.ts","webpack:///src/app/input/music-input-help/music-input-help.component.ts","webpack:///src/app/input/music-input-help/music-input-help.component.html","webpack:///src/app/score-editor/score-editor-help/score-editor-help.component.ts","webpack:///src/app/score-editor/score-editor-help/score-editor-help.component.html","webpack:///src/app/input/toolbar/toolbar.component.ts","webpack:///src/app/input/toolbar/toolbar.component.html","webpack:///src/app/utils/verovio.ts","webpack:///src/app/input/diva-view/diva-view.component.ts","webpack:///src/app/input/diva-view/diva-view.component.html","webpack:///src/app/score-editor/score-toolbar/score-toolbar.component.ts","webpack:///src/app/score-editor/score-toolbar/score-toolbar.component.html","webpack:///src/app/input/input.component.ts","webpack:///src/app/input/input.component.html","webpack:///src/main.ts","webpack:///$_lazy_route_resource lazy namespace object"],"names":["Voice","voiceToOrdinal","v","altus","cantus","contratenor","contratenor1","contratenor2","discantus","duplum","lowervoice1","lowervoice2","motetus","quadruplum","quintus","superius","uppervoice1","uppervoice2","tenor","triplum","bassus","Mensuration","Staff","ulx","uly","lrx","lry","canvas","index","voice","id","musicList","bbox","rect","document","createElementNS","setAttribute","toString","classList","add","staffA","staffB","indexDiff","ScoreEditorModule","declarations","imports","exports","parseRhythm","rhythm","val","PitchClass","Accid","LigStatus","PlicaStatus","ClefItem","m_type","m_line","m_pname","C","m_clefLine","m_keySig","Map","output","G","F","size","pitch","accid","element","clef","hasAttribute","m_id","getAttribute","line","parseInt","e","RestItem","m_dot","undefined","m_rhythm","options","rest","MensurItem","m_modus","NA","m_tempus","m_prolatio","Two","Three","mensur","NoteItem","m_accid","NONE","m_oct","m_text","m_lig","m_plica","amount","START","pname","D","E","A","B","i","toUpperCase","DOWN","UP","END","note","querySelector","plica","nextElementSibling","tagName","SHARP","FLAT","NATURAL","syl","textContent","parentElement","firstElementChild","lastElementChild","MusicList","m_list","m_index","m_notationCallback","dpc","item","push","runNotationCallback","length","addClef","ln","getLastNote","oct","candidate","best","Math","abs","newnote","pop","open","score","getHumdrumScore","text","lowerPitch","raisePitch","substring","opts","lines","noteCounter","restCounter","hyphen","getHumdrumLine","match","output2","lineNumber","first","console","debug","has","get","set","InputService","_selected","system","next","providedIn","DocService","_parts","_score","_partsSubject","_scoreSubject","doc","environment","production","pnameOrder","recurseXmlId","children","ScoreVerovioViewComponent","stateService","staffService","selectedId","corrToSicMap","barOptions","Object","entries","parts","mei","generateXML","subscribe","container","nativeElement","innerHTML","svg","meiToSVG","appendChild","setSelected","confirm","editorialMode","Array","from","getElementsByClassName","forEach","elem","remove","getElementById","_e","partsId","resolver","createNSResolver","ownerDocument","documentElement","meiRes","ref","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","result","ORDERED_NODE_SNAPSHOT_TYPE","pb","snapshotItem","snapshotLength","sb","pbFacsId","sbFacsId","pbGraphic","getElementsByTagName","filter","el","sbZone","iri","staffLocation","runScoringUp","event","target","nodeName","contains","ensureCorrElement","key","sibling","nextSibling","dot","insertAdjacentElement","currentPname","idx","indexOf","removeAttribute","clone","cloneNode","cloneDot","preventDefault","meiDoc","staffDef","quasiDoc","lining_up","warn","replace_ligatures_by_brackets","refine_score","scoreOptions","modernClefs","barlines","error","alert","closest","choice","corr","sic","corrTarget","sibCorr","handleClick","onRefinementChange","selector","templateUrl","styleUrls","handleKeyPress","InputModule","Pb","canvasIRI","Sb","zone","System","contents","whiteMensural","parent","notationType","rawMei","humdrumToMEI","white","parser","DOMParser","elements","humdrumMei","parseFromString","_recurseId","layer","child","found","test","regexpInfo","newPart","getOrCreatePart","systems","splice","addSystem","a","b","diff","aZone","bZone","threshold","diff1","diff2","overlap","min","avHeight","NAMESPACE","MEIDocument","manuscriptIRI","metadata","Metadata","sourceIRI","_createSkeletonMEI","sort","compare","_meiDoc","part","partElement","generatePartXML","implementation","createDocument","head","_generateHeader","music","facsimile","body","mdiv","meiHead","fileDesc","titleStmt","title","shortTitle","respStmt","contributors","contributor","persName","name","type","pubStmt","workList","work","title2","composer","composerName","classification","termList","term","genre","manifestList","manifestation","titleStmt2","title3","identifier","siglum","itemList","allSystems","unshift","getSystems","systemList","partlist","some","getPart","pbs","Set","values","notationSubtype","source","iiif","manifestations","querySelectorAll","s","toLowerCase","c","terms","surfaces","zones","assert","partObj","modus","tempus","prolatio","dir","tenorObj","repetitions","Number","matchResults","endingId","layerChildren","activePb","activeSystem","setIndex","fetch","then","response","json","manifest","canvases","findIndex","facs","split","surface","find","graphic","parseXML","GeneralHelpComponent","ScoreEditorComponent","router","route","snapshot","paramMap","decodeURIComponent","iiifManifest","navigate","Barline","StateService","AppComponent","setup","formIIIFManifest","gallicaRegexp","RegExp","gallicaIIIFRegexp","ecodicesRegexp","ecodicesIIIFRegexp","genericIIIFRegexp","routes","path","component","pathMatch","AppModule","forRoot","useHash","providers","bootstrap","Part","matches","removed","scoreDef","_generateScoreDef","section","staff","currentPage","getContents","temp","zoneId","round","staffGrp","Tenor","firstNoteId","endItem","insertAdjacentHTML","ScoreDivaViewComponent","pageToCanvasMap","diva","objectData","Events","parseCanvases","bind","settings","ID","handleZoom","getStaffLocation","redraw","Promise","resolve","style","display","setTimeout","zoomDuration","getCurrentPageIndices","includes","gotoPageByIndex","inner","innerElement","dimensions","getPageDimensionsAtCurrentZoomLevel","offset","viewHandler","_viewerCore","getPageRegion","includePadding","incorporateViewport","marginLeft","getComputedStyle","getPropertyValue","createElement","svgParent","maxZoom","getPageDimensionsAtZoomLevel","MAX_SAFE_INTEGER","width","height","position","top","left","firstChild","sequences","sequence","deactivate","destroy","SelectDocumentComponent","file","invalid","selectionForm","required","resourceURL","url","loadMEIForm","fileInput","controls","value","encodeURIComponent","reader","FileReader","addEventListener","rawText","fromXML","window","readAsText","evt","submit","meiSubmit","onFileChange","StaffSelectComponent","selectedSystem","voices","keySigMode","pitchSig","accidSig","selected","staffForm","mensurForm","modus2","tempus2","prolatio2","humdrumToSVG","endNote","selectItemByLine","updateSVG","parentNode","handleKeySigPress","metaKey","processDigit","state","addTextToCurrentItem","shiftKey","clearTextOnCurrentItem","deleteCharacterOnCurrentItem","removeLastItem","addPitchFar","addPitchNear","hasOpenLigature","addMensur","processPlica","addRest","processDotKey","selectBackward","selectForward","goToEndOfList","processLig","processAccidental","digit","_event","ending","isStart","processKeySig","SelectedStaffService","_staffLoc","loc","MusicInputHelpComponent","ScoreEditorHelpComponent","ToolbarComponent","dialog","currentStaff","serializer","XMLSerializer","serializeToString","content","blob","Blob","URL","createObjectURL","removeSystem","saveClick","VrvObj","vrvToolkit","humType","scale","spacingNonLinear","lyricSize","breaks","choiceXPathQuery","verovio","toolkit","setOptions","data","loadData","getMEI","pageNo","scoreBased","humdrumData","renderToSVG","serializedMei","svgRaw","DivaViewComponent","creatingStaff","firstPoint","refreshOverlay","getActivePageIndex","disableDragScrollable","enableDragScrollable","getSystem","activeContainer","clientPoint","createSVGPoint","x","clientX","y","clientY","transformMatrix","getScreenCTM","matrixTransform","inverse","drawingRect","viewportElement","currentPoint","transformedPoint","pageIndex","secondPoint","getPb","getCurrentCanvas","max","newSystem","pageContainer","systemsOnPage","mousedownHandler","mousemoveHandler","clickHandler","mouseupHandler","encapsulation","None","handleKeydown","handleKeyup","ScoreToolbarComponent","currentDoc","navigator","clipboard","writeText","err","goToInputEditor","savePartsClick","copyToClipboard","InputComponent","metadataForm","inputStep","InputStep","METADATA","setValue","entry","map","INPUT","removeAt","init","bootstrapModule","verovioReady","r","webpackEmptyAsyncContext","req","Error","code","keys","module"],"mappings":"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","file":"main-es5.js","sourcesContent":["import { v4 as uuidv4 } from 'uuid';\n\nimport { MusicList } from './MusicItem';\n\n// The voice a staff belongs to\nexport enum Voice {\n  altus='altus',\n  cantus='cantus',\n  contratenor='contratenor',\n  contratenor1='contratenor I',\n  contratenor2='contratenor II',\n  discantus='discantus',\n  duplum='duplum',\n  lowervoice1='lower voice I',\n  lowervoice2='lower voice II',\n  motetus='motetus',\n  quadruplum='quadruplum',\n  quintus='quintus',\n  superius='superius',\n  uppervoice1='upper voice I',\n  uppervoice2='uppervoice II',\n  tenor='tenor',\n  triplum='triplum',\n  bassus='bassus'\n}\n\n// comparator for voices\nexport function voiceToOrdinal(v: Voice): number {\n  switch (v) {\n    case Voice.altus:\n      return 8;\n    case Voice.cantus:\n      return 5;\n    case Voice.contratenor:\n      return 10;\n    case Voice.contratenor1:\n      return 10.1;\n    case Voice.contratenor2:\n      return 10.2;\n    case Voice.discantus:\n      return 5;\n    case Voice.duplum:\n      return 3;\n    case Voice.lowervoice1:\n      return 100;\n    case Voice.lowervoice2:\n      return 100.1;\n    case Voice.motetus:\n      return 3;\n    case Voice.quadruplum:\n      return 1;\n    case Voice.quintus:\n      return 8;\n    case Voice.superius:\n      return 5;\n    case Voice.uppervoice1:\n      return -1.1;\n    case Voice.uppervoice2:\n      return -1;\n    case Voice.tenor:\n      return 9;\n    case Voice.triplum:\n      return 2;\n    case Voice.bassus:\n      return 20;\n    default:\n      return 0;\n  }\n}\n\nexport type Contributor = {\n  type: string,\n  name: string\n};\n\n// Values for modus, tempus, and prolatio\nexport enum Mensuration {\n  Three='3',\n  Two='2',\n  NA='N/A'\n}\n\nexport type BoundingBox = {\n  ulx: number;\n  uly: number;\n  lrx: number;\n  lry: number;\n}\n\nexport type PartMensuration = {\n  modus: Mensuration,\n  tempus: Mensuration,\n  prolatio: Mensuration\n};\n\nexport type VoicePair = {\n  voice: Voice,\n  mensurations: PartMensuration\n};\n\n/** Typedef to show when something is a IIIF manifest IRI */\nexport type IRI = string;\n\n/**\n * Class representing a staff that is selected on a canvas.\n * Should contain all the information about a staff that is available.\n */\nexport class Staff {\n  constructor(\n    ulx: number,\n    uly: number,\n    lrx: number,\n    lry: number,\n    canvas: string,\n    index: number,\n    voice?: Voice,\n    id?: string,\n    musicList?: MusicList\n  ) {\n    if (id) {\n      this.id = id;\n    }\n    else {\n      this.id = uuidv4();\n    }\n    this.bbox = { ulx: ulx, uly: uly, lrx: lrx, lry: lry };\n    this.canvas = canvas;\n    this.index = index;\n    if (voice) {\n      this.voice = voice;\n    }\n    else {\n      this.voice = Voice.triplum;\n    }\n\n    if (musicList) {\n      this.musicList = musicList;\n    }\n    else {\n      this.musicList = new MusicList();\n    }\n  }\n\n  get svg() {\n    let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n    rect.setAttribute('x', this.bbox.ulx.toString());\n    rect.setAttribute('y', this.bbox.uly.toString());\n    rect.id = this.id;\n    rect.setAttribute('width', (this.bbox.lrx - this.bbox.ulx).toString());\n    rect.setAttribute('height', (this.bbox.lry - this.bbox.uly).toString());\n    rect.classList.add(\"zoneRect\");\n    return rect;\n  }\n\n  static compare(staffA: Staff, staffB: Staff): number {\n    let indexDiff = staffA.index - staffB.index;\n    if (indexDiff !== 0) {\n      return indexDiff;\n    }\n    else {\n      return staffA.bbox.uly - staffB.bbox.uly;\n    }\n  }\n\n  id: string;\n\n  // Information about the contents of the staff\n  voice: Voice;\n  modus: Mensuration;\n  tempus: Mensuration;\n  prolatio: Mensuration;\n\n  bbox: BoundingBox;  // Relative to the canvas\n  canvas: string;     // IIIF canvas @id for the page containing this staff.\n  index: number;      // 0-based page index\n\n  musicList: MusicList;\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { ScoreEditorComponent } from './score-editor.component';\nimport { ScoreDivaViewComponent } from './score-diva-view/score-diva-view.component';\nimport { ScoreVerovioViewComponent } from './score-verovio-view/score-verovio-view.component';\nimport { ScoreToolbarComponent } from './score-toolbar/score-toolbar.component';\nimport { ScoreEditorHelpComponent } from './score-editor-help/score-editor-help.component';\n\n@NgModule({\n  declarations: [\n    ScoreDivaViewComponent,\n    ScoreVerovioViewComponent,\n    ScoreEditorComponent,\n    ScoreToolbarComponent,\n    ScoreEditorHelpComponent\n  ],\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatTabsModule,\n  ],\n  exports: [\n    ScoreEditorComponent\n  ]\n})\nexport class ScoreEditorModule { }\n","/**\n * Based on musiclist.js by Craig Sapp\n * From: https://github.com/craigsapp/mensural-input/blob/master/scripts/musiclist.js\n */\n\nimport { v4 } from \"uuid\";\nimport { Mensuration } from './definitions';\n\nfunction parseRhythm(rhythm: string): number {\n  let val: number;\n  switch (rhythm) {\n    case \"semibrevis\": val = 1; break;\n    case \"brevis\": val = 0; break;\n    case \"maxima\": val = 7; break;\n    case \"longa\": val = 9; break;\n    case \"minima\": val = 2; break;\n    case \"semiminima\": val = 4; break;\n    case \"fusa\": val = 8; break;\n    case \"semifusa\": val = 6; break;\n  }\n  return val;\n}\n\nexport enum PitchClass {\n  C = 0,\n  D = 1,\n  E = 2,\n  F = 3,\n  G = 4,\n  A = 5,\n  B = 6,\n}\n\nexport enum Accid {\n  NONE,\n  SHARP = \"#\",\n  FLAT = \"-\",\n  NATURAL = \"n\",\n}\n\nexport enum LigStatus {\n  NONE,\n  START,\n  END,\n}\n\nexport enum PlicaStatus {\n  NONE,\n  UP,\n  DOWN,\n}\n\nexport interface MusicItem {\n  m_type: string;\n  m_id: string;\n  m_line: number;\n  getHumdrumLine(options: object): string;\n}\n\nexport class ClefItem implements MusicItem {\n  readonly m_type = \"clef\";\n  m_line = -1;\n  m_id: string;\n  m_pname: PitchClass;\n  m_clefLine: number;\n  m_keySig: Map<string,string>;\n\n  constructor () {\n    this.m_pname = PitchClass.C;\n    this.m_clefLine = 3;\n    this.m_keySig = new Map();\n  }\n\n  raisePitch () {\n    this.m_clefLine += 1;\n    if (this.m_clefLine > 5) {\n      this.m_clefLine = 5;\n    }\n  }\n\n  lowerPitch () {\n    this.m_clefLine -= 1;\n    if (this.m_clefLine < 1) {\n      this.m_clefLine = 1;\n    }\n  }\n\n  getHumdrumLine(): string {\n    let output = \"*clef\";\n    switch (this.m_pname) {\n      case PitchClass.G: output += \"G\"; break;\n      case PitchClass.F: output += \"F\"; break;\n      default: output += \"C\"; break;\n    }\n    output += this.m_clefLine;\n    output += \"\\t\";\n    output += \"*\";\n    if (this.m_keySig.size > 0) {\n      output += \"\\n\";\n      output += \"*k[\";\n      for (let [pitch, accid] of this.m_keySig) {\n        output += pitch;\n        output += accid;\n      }\n      output += \"]\\t*\";\n    }\n    return output;\n  }\n\n  static parseXML(element: Element): ClefItem {\n    let clef = new ClefItem();\n    if (element.hasAttribute(\"xml:id\")) {\n      clef.m_id = element.getAttribute(\"xml:id\");\n    }\n    switch (element.getAttribute(\"shape\")) {\n      case \"F\": clef.m_pname = PitchClass.F; break;\n      case \"G\": clef.m_pname = PitchClass.G; break;\n      case \"C\":\n      default: break;\n    }\n    try {\n      let line: number = parseInt(element.getAttribute(\"line\"));\n      clef.m_clefLine = line;\n    } catch (e) {}\n    return clef;\n  }\n}\n\nexport class RestItem implements MusicItem {\n  readonly m_type = \"rest\";\n  m_line = -1;\n  m_id: string;\n  m_rhythm: number;\n  m_dot: boolean;\n\n  constructor (rhythm?: number) {\n    this.m_dot = false;\n    if (rhythm !== undefined) {\n      this.m_rhythm = rhythm;\n    } else {\n      this.m_rhythm = 1;\n    }\n  }\n\n  getHumdrumLine (options: object): string {\n    let output = \"\";\n    switch (this.m_rhythm) {\n      case 7: output += \"X\"; break;\n\t\t\tcase 9: output += \"L\"; break;\n\t\t\tcase 0: output += \"S\"; break;\n\t\t\tcase 1: output += \"s\"; break;\n\t\t\tcase 2: output += \"M\"; break;\n\t\t\tcase 4: output += \"m\"; break;\n\t\t\tcase 6: output += \"u\"; break;\n\t\t\tcase 8: output += \"U\"; break;\n    }\n    if (this.m_dot) {\n      output += \":\";\n    }\n    output += \"r\";\n    if (options[\"mark\"]) {\n      output += \"@\";\n    }\n    output += \"\\t.\";\n    return output;\n  }\n\n  static parseXML(element: Element): RestItem {\n    let rest = new RestItem();\n    if (element.hasAttribute(\"xml:id\")) {\n      rest.m_id = element.getAttribute(\"xml:id\");\n    }\n    if (element.hasAttribute(\"dur\")) {\n      rest.m_rhythm = parseRhythm(element.getAttribute(\"dur\"));\n    }\n    return rest;\n  }\n}\n\nexport class MensurItem implements MusicItem {\n  readonly m_type = \"mensur\";\n  m_line = -1;\n  m_modus: Mensuration;\n  m_tempus: Mensuration;\n  m_prolatio: Mensuration;\n  m_id: string;\n\n  constructor() {\n    this.m_modus = Mensuration.NA;\n    this.m_tempus = Mensuration.NA;\n    this.m_prolatio = Mensuration.NA;\n  }\n\n  getHumdrumLine(): string {\n    if (this.m_tempus === Mensuration.Two && this.m_prolatio === Mensuration.Two)\n      return \"*met(C)\\t*\";\n    if (this.m_tempus === Mensuration.Three && this.m_prolatio === Mensuration.Two)\n      return \"*met(O)\\t*\";\n    if (this.m_tempus === Mensuration.Two && this.m_prolatio === Mensuration.Three)\n      return \"*met(C.)\\t*\";\n    if (this.m_tempus === Mensuration.Three && this.m_prolatio === Mensuration.Three)\n      return \"*met(O.)\\t*\";\n    else\n      return \"*met(C)\\t*\";\n  }\n\n  static parseXML(element: Element): MensurItem {\n    let mensur = new MensurItem();\n    if (element.hasAttribute(\"xml:id\")) {\n      mensur.m_id = element.getAttribute(\"xml:id\");\n    }\n    if (element.hasAttribute(\"modusminor\")) {\n      mensur.m_modus = element.getAttribute(\"modus\") as Mensuration;\n    }\n    if (element.hasAttribute(\"tempus\")) {\n      mensur.m_tempus = element.getAttribute(\"tempus\") as Mensuration;\n    }\n    if (element.hasAttribute(\"prolatio\")) {\n      mensur.m_prolatio = element.getAttribute(\"prolatio\") as Mensuration;\n    }\n    return mensur;\n  }\n}\n\nexport class NoteItem implements MusicItem {\n  readonly m_type = \"note\";\n  m_line = -1;\n  m_pname: PitchClass;\n  m_accid: Accid;\n  m_oct: number;\n  m_rhythm: number;\n  m_dot: boolean;\n  m_text: string;\n  m_lig: LigStatus;\n  m_id: string;\n  m_plica: PlicaStatus;\n\n  constructor() {\n    this.m_pname = PitchClass.C;\n    this.m_accid = Accid.NONE;\n    this.m_oct = 4;\n    this.m_rhythm = 1;\n    this.m_dot = false;\n    this.m_text = \"\";\n    this.m_lig = LigStatus.NONE;\n    this.m_plica = PlicaStatus.NONE;\n  }\n\n  raisePitch (amount?: number) {\n    if (amount === undefined) {\n      amount = 1;\n    }\n    if (amount >= 7) {\n      this.m_oct += amount % 7;\n      amount -= 7 * (amount % 7);\n    }\n\n    this.m_pname += amount;\n    if (this.m_pname > 6) {\n      this.m_pname -= 7;\n      this.m_oct += 1;\n    }\n  }\n\n  lowerPitch (amount?: number) {\n    if (amount === undefined) {\n      amount = 1;\n    }\n    if (amount >= 7) {\n      this.m_oct -= amount % 7;\n      amount -= 7 * (amount % 7);\n    }\n    this.m_pname -= amount;\n    if (this.m_pname < 0) {\n      this.m_pname += 7;\n      this.m_oct -= 1;\n    }\n  }\n\n  getHumdrumLine(options: object): string {\n    let output = \"\";\n    if (this.m_lig === LigStatus.START) {\n      output += \"[\";\n    }\n    switch (this.m_rhythm) {\n      case 7: output += \"X\"; break;\n  \t\tcase 9: output += \"L\"; break;\n  \t\tcase 0: output += \"S\"; break;\n  \t\tcase 1: output += \"s\"; break;\n  \t\tcase 2: output += \"M\"; break;\n  \t\tcase 4: output += \"m\"; break;\n  \t\tcase 6: output += \"u\"; break;\n  \t\tcase 8: output += \"U\"; break;\n    }\n    if (this.m_dot) {\n      output += \":\";\n    }\n\n    let pname: string;\n    switch(this.m_pname) {\n      case PitchClass.C: pname = \"c\"; break;\n      case PitchClass.D: pname = \"d\"; break;\n      case PitchClass.E: pname = \"e\"; break;\n      case PitchClass.F: pname = \"f\"; break;\n      case PitchClass.G: pname = \"g\"; break;\n      case PitchClass.A: pname = \"a\"; break;\n      case PitchClass.B: pname = \"b\"; break;\n    }\n    if (this.m_oct >= 4) {\n      for (let i = 4; i <= this.m_oct; i++) {\n        output += pname;\n      }\n    } else {\n      pname = pname.toUpperCase();\n      for (let i = 3; i >= this.m_oct; i--) {\n        output += pname;\n      }\n    }\n\n    if (this.m_plica === PlicaStatus.DOWN) {\n      output += \"k\";\n    } else if (this.m_plica === PlicaStatus.UP) {\n      output += \"K\";\n    }\n\n    if (this.m_accid !== Accid.NONE) {\n      output += this.m_accid.toString();\n    }\n\n    if (this.m_lig === LigStatus.END) {\n      output += \"]\";\n    }\n\n    if (options[\"mark\"]) {\n      output += \"@\";\n    }\n\n    output += \"\\t\";\n    if (this.m_text) {\n      if (options[\"hyphen\"]) {\n        output += \"-\";\n      }\n      output += this.m_text;\n    } else {\n      output += \".\";\n    }\n\n    return output;\n  }\n\n  static parseXML(element: Element): NoteItem {\n    let note = new NoteItem();\n    // Set info from element attributes\n    if (element.hasAttribute(\"xml:id\")) {\n      note.m_id = element.getAttribute(\"xml:id\");\n    }\n    if (element.hasAttribute(\"oct\")) {\n      note.m_oct = parseInt(element.getAttribute(\"oct\"));\n    }\n    if (element.hasAttribute(\"dur\")) {\n      note.m_rhythm = parseRhythm(element.getAttribute(\"dur\"));\n    }\n    if (element.hasAttribute(\"pname\")) {\n      note.m_pname = PitchClass[element.getAttribute(\"pname\").toUpperCase()];\n    }\n\n    // Check children for a plica\n    if (element.querySelector(\"plica\")) {\n      const plica = element.querySelector(\"plica\");\n      if (element.hasAttribute(\"dir\") && element.getAttribute(\"dir\") == \"up\") {\n        note.m_plica = PlicaStatus.UP;\n      } else {\n        note.m_plica = PlicaStatus.DOWN;\n      }\n    }\n\n    // Check next sibling for dot\n    if (element.nextElementSibling && element.nextElementSibling.tagName === \"dot\") {\n      note.m_dot = true;\n    }\n\n    // Check children for accid, text\n    if (element.querySelector(\"accid\")) {\n      const accid = element.querySelector(\"accid\");\n      switch (accid.getAttribute(\"accid\")) {\n        case \"s\": note.m_accid = Accid.SHARP; break;\n        case \"f\": note.m_accid = Accid.FLAT; break;\n        case \"n\": note.m_accid = Accid.NATURAL; break;\n        default: break;\n      }\n    }\n    if (element.querySelector(\"syl\")) {\n      const syl = element.querySelector(\"syl\");\n      note.m_text = syl.textContent;\n    }\n\n    // Check parent for ligature\n    if (element.parentElement.tagName === \"ligature\") {\n      if (element === element.parentElement.firstElementChild) {\n        note.m_lig = LigStatus.START;\n      } else if (element === element.parentElement.lastElementChild) {\n        note.m_lig = LigStatus.END;\n      }\n    }\n\n    return note;\n  }\n}\n\nexport class MusicList {\n  m_list: Array<MusicItem> = [];\n  m_index = -1;\n  m_rhythm = 1;\n  m_notationCallback = null;\n\n  addClef (dpc: PitchClass) {\n    let item = new ClefItem();\n    if (dpc === PitchClass.G) {\n      item.m_pname = PitchClass.G;\n      item.m_clefLine = 2;\n    } else if (dpc === PitchClass.F) {\n      item.m_pname = PitchClass.F;\n      item.m_clefLine = 4;\n    } else {\n      item.m_pname = PitchClass.C;\n      item.m_clefLine = 3;\n    }\n    this.m_list.push(item);\n    this.runNotationCallback();\n  }\n\n  addRest () {\n    if (this.m_list.length === 0) return;\n    this.m_list.push(new RestItem(this.m_rhythm));\n    this.runNotationCallback();\n  }\n\n  addMensur () {\n    this.m_list.push(new MensurItem());\n    this.runNotationCallback();\n  }\n\n  addPitchFar (dpc: PitchClass) {\n    if (this.m_list.length === 0) {\n      this.addClef(dpc);\n      return;\n    }\n    dpc = (dpc + 7000) % 7;\n    let ln = this.getLastNote();\n    if (!ln) {\n      ln = new NoteItem();\n      ln.m_pname = PitchClass.C;\n      ln.m_oct = 4;\n      ln.m_rhythm = 1;\n    }\n    let oct = ln.m_oct;\n    let pitch = ln.m_pname + 7 * oct;\n    let candidate = [];\n    candidate[0] = (oct - 1) * 7 + dpc;\n    candidate[1] = (oct + 0) * 7 + dpc;\n    candidate[2] = (oct + 1) * 7 + dpc;\n    let best = -1;\n    for (let i = 0; i < candidate.length; i++) {\n      if ((Math.abs(pitch - candidate[i]) > 3) &&\n          (Math.abs(pitch - candidate[i]) < 8)) {\n        best = i;\n        break;\n      }\n    }\n    let newnote = new NoteItem();\n    newnote.m_rhythm = this.m_rhythm;\n    newnote.m_pname = dpc;\n    switch (best) {\n      case 0: newnote.m_oct = oct - 1; break;\n      case 1: newnote.m_oct = oct;     break;\n      case 2: newnote.m_oct = oct + 1; break;\n    }\n    this.m_list.push(newnote);\n    this.runNotationCallback();\n  }\n\n  addPitchNear (dpc: PitchClass) {\n    if (this.m_list.length == 0) {\n  \t\tthis.addClef(dpc);\n  \t\treturn;\n  \t}\n\n  \tdpc = (dpc + 7000) % 7;\n  \tlet ln = this.getLastNote();\n    if (!ln) {\n      ln = new NoteItem();\n      ln.m_pname = 0;\n      ln.m_oct = 4;\n      ln.m_rhythm = 1;\n    }\n    let oct = ln.m_oct;\n    let pitch = ln.m_pname + 7 * oct;\n    let candidate = [];\n    candidate[0] = (oct - 1) * 7 + dpc;\n  \tcandidate[1] = (oct + 0) * 7 + dpc;\n  \tcandidate[2] = (oct + 1) * 7 + dpc;\n    let best = -1;\n    for (let i = 0; i < candidate.length; i++) {\n      if (Math.abs(pitch - candidate[i]) < 4) {\n        best = i;\n        break;\n      }\n    }\n    let newnote = new NoteItem();\n    newnote.m_rhythm = this.m_rhythm;\n    newnote.m_pname = dpc;\n    switch (best) {\n      case 0: newnote.m_oct = oct - 1; break;\n      case 1: newnote.m_oct = oct;     break;\n      case 2: newnote.m_oct = oct + 1; break;\n    }\n    this.m_list.push(newnote);\n    this.runNotationCallback();\n  }\n\n  getLastNote(): NoteItem | null {\n    for (let i = this.m_list.length - 1; i >= 0; i--) {\n      if (this.m_list[i].m_type === \"note\") {\n        return this.m_list[i] as NoteItem;\n      }\n    }\n    return null;\n  }\n\n  removeLastItem() {\n    this.m_list.pop();\n    this.runNotationCallback();\n  }\n\n  hasOpenLigature(): boolean {\n    let open = false;\n    for (let item of this.m_list) {\n      if (item.m_type === \"note\") {\n        let note = item as NoteItem;\n        if (note.m_lig === LigStatus.START) {\n          open = true;\n        } else if (note.m_lig === LigStatus.END) {\n          open = false;\n        }\n      }\n    }\n    return open;\n  }\n\n  selectBackward() {\n    if (this.m_index > 0) {\n      this.m_index--;\n    } else if (this.m_index === 0) {\n      this.m_index = -1;\n    } else if (this.m_index < 0) {\n      this.m_index = this.m_list.length - 1;\n    }\n    this.runNotationCallback();\n  }\n\n  selectForward() {\n    if (this.m_index < this.m_list.length - 1) {\n  \t\tthis.m_index++;\n  \t} else if (this.m_index == this.m_list.length - 1) {\n  \t\tthis.m_index = -1;\n  \t} else if (this.m_index < 0) {\n  \t\tthis.m_index = 0;\n  \t}\n  \tthis.runNotationCallback();\n  }\n\n  runNotationCallback() {\n    if (this.m_notationCallback) {\n      let score = this.getHumdrumScore({});\n      this.m_notationCallback(score);\n    }\n  }\n\n  addTextToCurrentItem (text: string): boolean {\n    if (this.m_list.length === 0) {\n      return false;\n    }\n    let index = this.m_index;\n    if (index < 0) {\n      index = this.m_list.length - 1;\n    }\n    if (index < 0) {\n      return false;\n    }\n    let item = this.m_list[index];\n    if (item.m_type === \"note\") {\n      (item as NoteItem).m_text += text;\n      if (text === \"-\") {\n        this.m_index += 1;\n        if (this.m_index >= this.m_list.length) {\n          this.m_index = -1;\n        }\n      }\n    }\n    this.runNotationCallback();\n    return true;\n  }\n\n  goToEndOfList() {\n    this.m_index = -1;\n    this.runNotationCallback();\n  }\n\n  lowerPitch (amount: number) {\n    if (this.m_list.length === 0) return;\n    let index = this.m_index;\n    if (index < 0) index = this.m_list.length - 1;\n    if (this.m_list[index].m_type === \"note\") {\n      (this.m_list[index] as NoteItem).lowerPitch(amount);\n    }\n    else if (this.m_list[index].m_type === \"clef\") {\n      (this.m_list[index] as ClefItem).lowerPitch();\n    }\n    this.runNotationCallback();\n  }\n\n  raisePitch (amount: number) {\n    if (this.m_list.length === 0) return;\n    let index = this.m_index;\n    if (index < 0) index = this.m_list.length - 1;\n    if (this.m_list[index].m_type === \"note\") {\n      (this.m_list[index] as NoteItem).raisePitch(amount);\n    }\n    else if (this.m_list[index].m_type === \"clef\") {\n      (this.m_list[index] as ClefItem).raisePitch();\n    }\n    this.runNotationCallback();\n  }\n\n  deleteCharacterOnCurrentItem () {\n    let index = this.m_index;\n    if (index < 0) index = this.m_list.length - 1;\n    try {\n      let item = this.m_list[index] as NoteItem;\n      if (item.m_text.length === 0) return;\n      item.m_text = item.m_text.substring(0, item.m_text.length - 1);\n      this.runNotationCallback();\n    }\n    catch (e) {}\n  }\n\n  clearTextOnCurrentItem () {\n    let index = this.m_index;\n    if (index < 0 || index >= this.m_list.length) {\n      return;\n    }\n    let item = this.m_list[index];\n    if (!item) return;\n    try {\n      let note = item as NoteItem;\n      note.m_text = \"\";\n      this.runNotationCallback();\n    } catch (e) {}\n  }\n\n  clear () {\n    this.m_list = [];\n    this.m_index = -1;\n    this.runNotationCallback();\n  }\n\n  getHumdrumScore (opts?: object) {\n    if (!opts) {\n      opts = {};\n    }\n    let output = [];\n    output.push(\"**mens\\t**text\");\n    if (opts['white'] !== true) {\n  \t   output.push(\"*black\\t*\");\n    }\n  \tvar i: number;\n  \tvar lines: string;\n  \tvar noteCounter = 0;\n  \tvar restCounter = 0;\n  \tvar hyphen = false;\n  \tvar options = opts;\n  \tfor (i=0; i<this.m_list.length; i++) {\n  \t\tvar item = this.m_list[i];\n  \t\tif (item.m_type == \"note\") {\n  \t\t\tnoteCounter += 1;\n  \t\t} else if (item.m_type == \"rest\") {\n  \t\t\trestCounter += 1;\n  \t\t}\n  \t\toptions[\"mark\"] = false;\n  \t\toptions[\"hyphen\"] = hyphen;\n  \t\tif (i == this.m_index) {\n  \t\t\toptions[\"mark\"] = true;\n  \t\t}\n  \t\tif (options[\"export\"]) {\n  \t\t\toptions[\"mark\"] = false;\n  \t\t}\n      if (item.m_id === undefined) {\n        item.m_id = 'm-' + v4();\n      }\n  \t\tlines = item.getHumdrumLine(options);\n  \t\tif (item.m_type === \"note\") {\n  \t\t\tif ((item as NoteItem).m_text.match(/-$/)) {\n  \t\t\t\thyphen = true;\n  \t\t\t} else {\n  \t\t\t\thyphen = false;\n  \t\t\t}\n  \t  \t}\n  \t\tthis.m_list[i].m_line = output.length + 1;\n  \t\toutput.push(lines);\n  \t}\n  \tif (noteCounter + restCounter == 0) {\n  \t\t// need to add a dummy rest to force display of clef\n  \t\toutput.push(\"4ryy\\t.\");\n  \t}\n\n  \toutput.push(\"=-\\t=-\");\n  \toutput.push(\"*-\\t*-\");\n  \tif (!options[\"export\"]) {\n  \t\toutput.push(\"!!!RDF**kern: @ = marked note\");\n      // output.push(\"!!!RDF**kern: & = marked note, color=green\")\n  \t\t//output.push(\"!!!RDF**kern: i = marked note, color=blue\");\n  \t\t//output.push(\"!!!RDF**mens: @ = marked note\");\n  \t}\n\n  \tvar output2 = \"\";\n  \tfor (i=0; i<output.length; i++) {\n  \t\toutput2 += output[i] + \"\\n\";\n  \t}\n  \treturn output2;\n  }\n\n  selectItemByLine (lineNumber: number) {\n    for (let i = 0; i < this.m_list.length; i++) {\n      if (this.m_list[i].m_line === lineNumber) {\n        this.m_index = i;\n        this.runNotationCallback();\n        return;\n      }\n    }\n  }\n\n  processKeySig (pitch: string, accid: string): boolean {\n    if (this.m_list.length > 0) {\n      let first = this.m_list[0] as ClefItem;\n      if (first.m_type !== \"clef\") {\n        console.debug(\"First was not a clef!!!\");\n        return false;\n      }\n      if (first.m_keySig.has(pitch)) {\n        if (first.m_keySig.get(pitch) === accid) {\n          first.m_keySig.delete(pitch);\n        } else {\n          first.m_keySig.set(pitch, accid);\n        }\n      }\n      else {\n        first.m_keySig.set(pitch, accid);\n      }\n      this.runNotationCallback();\n      return true;\n    }\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs'\n\nimport { System } from '../utils/system';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InputService extends Subject<System> {\n\n  _selected: System;\n\n  constructor() {\n    super();\n    this._selected = null;\n  }\n\n  get selected(): System {\n    return this._selected;\n  }\n\n  set selected(system: System) {\n    this._selected = system;\n    this.next(this._selected);\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DocService {\n  _partsSubject: Subject<XMLDocument>;\n  _scoreSubject: Subject<XMLDocument>;\n  _parts: XMLDocument;\n  _score: XMLDocument;\n\n  constructor() {\n    this._parts = null;\n    this._score = null;\n    this._partsSubject = new Subject<XMLDocument>();\n    this._scoreSubject = new Subject<XMLDocument>();\n  }\n\n  get parts(): XMLDocument {\n    return this._parts;\n  }\n\n  set parts(doc: XMLDocument) {\n    this._parts = doc;\n    this._partsSubject.next(this._parts);\n  }\n\n  get score(): XMLDocument {\n    return this._score;\n  }\n\n  set score(doc: XMLDocument) {\n    this._score = doc;\n    this._scoreSubject.next(this._score);\n  }\n}\n","// This file can be replaced during build by using the `fileReplacements` array.\n// `ng build --prod` replaces `environment.ts` with `environment.prod.ts`.\n// The list of file replacements can be found in `angular.json`.\n\nexport const environment = {\n  production: false\n};\n\n/*\n * For easier debugging in development mode, you can import the following file\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\n *\n * This import should be commented out in production mode because it will have a negative impact\n * on performance if an error is thrown.\n */\n// import 'zone.js/dist/zone-error';  // Included with Angular CLI.\n","import { Component, OnInit, AfterViewInit, HostListener, ViewChild, ElementRef } from '@angular/core';\n\nimport { v4 as uuid } from 'uuid';\n\nimport * as ScoringUp from 'scoring-up';\nimport { vrvToolkit } from '../../utils/verovio';\nimport { StateService, Barline } from '../../state-service.service';\nimport { SelectedStaffService } from '../selected-staff.service';\nimport { DocService } from '../doc.service';\nimport { NAMESPACE } from '../../utils/mei';\n\nconst pnameOrder = [ 'c', 'd', 'e', 'f', 'g', 'a', 'b'];\n\nfunction recurseXmlId(element: Element) {\n  if (element.hasAttribute('xml:id')) {\n    element.setAttribute('xml:id', 'm-' + uuid());\n  }\n  for (let i = 0; i < element.children.length; i++) {\n    recurseXmlId(element.children[i]);\n  }\n}\n\n@Component({\n  selector: 'app-score-verovio-view',\n  templateUrl: './score-verovio-view.component.html',\n  styleUrls: ['./score-verovio-view.component.css']\n})\nexport class ScoreVerovioViewComponent implements OnInit, AfterViewInit {\n\n  @ViewChild('verovio') container: ElementRef;\n\n  selectedId: string = null;\n  corrToSicMap: Map<string, string> = new Map();\n  barOptions = Object.entries(Barline);\n\n  constructor(\n    public stateService: StateService,\n    private staffService: SelectedStaffService,\n    private doc: DocService\n  ) {  }\n\n  ngOnInit() {\n    this.doc.parts = this.stateService.mei.generateXML();\n    this.doc._scoreSubject.subscribe((doc) => {\n      this.container.nativeElement.innerHTML = '';\n      const svg = vrvToolkit.meiToSVG(doc);\n      this.container.nativeElement.appendChild(svg);\n      this.setSelected();\n    });\n  }\n\n  setEditorialMode() {\n    if (confirm(\"Edits in editorial mode reflect cases where there is a problem with the manuscript. You cannot exit editorial mode. Do you want to continue?\")) {\n      this.stateService.editorialMode = true;\n    }\n  }\n\n  setSelected() {\n    if (this.selectedId !== null) {\n      Array.from(document.getElementsByClassName(\"selected\"))\n        .forEach(elem => {\n          elem.classList.remove(\"selected\");\n          elem.setAttribute(\"fill\", \"\");\n        });\n      try {\n        document.getElementById(this.selectedId).classList.add(\"selected\");\n        document.getElementById(this.selectedId).setAttribute(\"fill\", \"#d00\");\n      }\n      catch (_e) {\n        console.debug(_e);\n        this.selectedId = null;\n        return;\n      }\n      try {\n        // Convert ID to sic ID if applicable\n        let partsId = this.selectedId;\n        if (this.corrToSicMap.has(partsId)) {\n          partsId = this.corrToSicMap.get(partsId);\n        }\n        // Get nearest pb  and sb\n        const resolver = this.doc.parts.createNSResolver(this.doc.parts.ownerDocument == null ? this.doc.parts.documentElement : (this.doc.parts.ownerDocument as Document).documentElement);\n        const meiRes = () => { return 'http://www.music-encoding.org/ns/mei'; };\n        const ref = this.doc.parts.evaluate(\"//*[@xml:id='\" + partsId + \"']\", this.doc.parts, resolver, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n        let result = this.doc.parts.evaluate(\"./preceding::mei:pb\", ref, meiRes, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n        const pb = result.snapshotItem(result.snapshotLength - 1) as Element;\n        result = this.doc.parts.evaluate(\"./preceding::mei:sb\", ref, meiRes, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n        const sb = result.snapshotItem(result.snapshotLength - 1) as Element;\n        // Get corresponding zones (strip away fragment symbol)\n        const pbFacsId = pb.getAttribute(\"facs\")[0] === \"#\" ?\n          pb.getAttribute(\"facs\").substring(1) :\n          pb.getAttribute(\"facs\");\n        const sbFacsId = sb.getAttribute(\"facs\")[0] === \"#\" ?\n          sb.getAttribute(\"facs\").substring(1) :\n          sb.getAttribute(\"facs\");\n        console.debug(sbFacsId);\n\n        // The following SHOULD use XPath but I haven't been able to get it to work\n        const pbGraphic = Array.from(\n          this.doc.parts.getElementsByTagName(\"surface\")\n        ).filter(el => { return el.getAttribute(\"xml:id\") === pbFacsId; }).pop()\n          .querySelector(\"graphic\");\n        const sbZone = Array.from(\n          pbGraphic.children\n        ).filter(el => { return el.getAttribute(\"xml:id\") === sbFacsId; }).pop()\n        const iri = pbGraphic.getAttribute(\"target\");\n        const bbox = {\n          ulx: sbZone.getAttribute(\"ulx\"),\n          uly: sbZone.getAttribute(\"uly\"),\n          lrx: sbZone.getAttribute(\"lrx\"),\n          lry: sbZone.getAttribute(\"lry\")\n        };\n        console.debug(iri);\n        this.staffService.staffLocation = [iri, bbox];\n      }\n      catch (_e) {\n        console.debug(_e);\n      }\n    }\n  }\n\n  ngAfterViewInit() {\n    this.doc.score = this.runScoringUp(this.doc.parts);\n  }\n\n  handleClick(event: MouseEvent) {\n    let target = event.target as Element;\n    while (target) {\n      if (target.nodeName === 'g') {\n        if (target.classList.contains('note') || target.classList.contains('rest')) {\n          this.selectedId = target.id;\n          this.setSelected();\n          break;\n        }\n      }\n      target = target.parentElement;\n    }\n  }\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyPress(event: KeyboardEvent) {\n    if (this.selectedId !== null) {\n      let doc: XMLDocument;\n      const resolver = this.doc.parts.createNSResolver(this.doc.parts.ownerDocument == null ? this.doc.parts.documentElement : (this.doc.parts.ownerDocument as Document).documentElement!);\n      const result = this.doc.parts.evaluate(\"//*[@xml:id='\" + this.selectedId + \"']\", this.doc.parts, resolver, XPathResult.FIRST_ORDERED_NODE_TYPE, null);\n      if (!result.singleNodeValue) return;\n      let target = result.singleNodeValue as Element;\n      // Ensure corrected element in MEI\n      if (this.stateService.editorialMode) {\n        target = this.ensureCorrElement(target, this.doc.parts);\n      }\n      if (target.tagName === \"note\") {\n        switch (event.key) {\n          case '.':\n            let sibling = target.nextElementSibling;\n            if (sibling !== null && sibling.tagName === 'dot') {\n              target.nextSibling.remove();\n              if (target.hasAttribute(\"dots\")) {\n                target.setAttribute(\"dots\", \"0\");\n              }\n            }\n            else {\n              let dot = this.doc.parts.createElementNS(\"http://www.music-encoding.org/ns/mei\", \"dot\");\n              dot.setAttribute(\"xml:id\", \"m-\" + uuid());\n              target.insertAdjacentElement(\"afterend\", dot);\n            }\n            break;\n          case 'ArrowUp':\n            if (target.hasAttribute('pname')) {\n              let currentPname = target.getAttribute('pname');\n              let idx = pnameOrder.indexOf(currentPname);\n              if (idx + 1 < pnameOrder.length) {\n                target.setAttribute('pname', pnameOrder[idx + 1]);\n              }\n              else {\n                target.setAttribute('pname', pnameOrder[0]);\n                target.setAttribute('oct', (parseInt(target.getAttribute('oct')) + 1).toString());\n              }\n            }\n            break;\n          case 'ArrowDown':\n            if (target.hasAttribute('pname')) {\n              let currentPname = target.getAttribute('pname');\n              let idx = pnameOrder.indexOf(currentPname);\n              if (idx - 1 > 0) {\n                target.setAttribute('pname', pnameOrder[idx - 1]);\n              }\n              else {\n                target.setAttribute('pname', pnameOrder[pnameOrder.length - 1]);\n                target.setAttribute('oct', (parseInt(target.getAttribute('oct')) - 1).toString());\n              }\n            }\n            break;\n          case '1': target.setAttribute('dur', 'semibrevis'); break;\n          case '2': target.setAttribute('dur', 'minima'); break;\n          case '4': target.setAttribute('dur', 'semiminima'); break;\n          case '8': target.setAttribute('dur', 'fusa'); break;\n          case '6': target.setAttribute('dur', 'semifusa'); break;\n          case '7': target.setAttribute('dur', 'maxima'); break;\n          case '9': target.setAttribute('dur', 'longa'); break;\n          case '0': target.setAttribute('dur', 'brevis'); break;\n\n          case '#': target.setAttribute('accid', 's'); break;\n          case '-': target.setAttribute('accid', 'f'); break;\n          case 'n': target.setAttribute('accid', 'n'); break;\n          case 'N': target.removeAttribute('accid'); break;\n\n          case 'I':\n            const clone = target.cloneNode(true) as Element;\n            recurseXmlId(clone);\n            if (target.nextElementSibling && target.nextElementSibling.tagName === 'dot') {\n              const cloneDot = target.nextElementSibling.cloneNode(true) as Element;\n              recurseXmlId(cloneDot);\n              target.nextElementSibling.insertAdjacentElement('afterend', clone);\n              clone.insertAdjacentElement('afterend', cloneDot);\n            }\n            else {\n              target.insertAdjacentElement('beforebegin', clone);\n            }\n            break;\n          case 'p':\n          case 'P':\n            let plica;\n            if (target.querySelector('plica')) {\n              plica = target.querySelector('plica');\n            } else {\n              plica = this.doc.parts.createElementNS(NAMESPACE, 'plica');\n              target.appendChild(plica);\n            }\n            if (event.key === 'P') {\n              if (plica.getAttribute('dir') === 'down') {\n                plica.remove();\n              } else {\n                plica.setAttribute('dir', 'down');\n              }\n            } else {\n              if (plica.getAttribute('dir') === 'up') {\n                plica.remove();\n              } else {\n                plica.setAttribute('dir', 'up');\n              }\n            }\n            break;\n          case 'Backspace':\n            if (target.nextElementSibling && target.nextElementSibling.tagName === 'dot') {\n              target.nextElementSibling.remove();\n            }\n            target.remove();\n\n            break;\n          default:\n            return;\n        }\n      } else if (target.tagName === \"rest\") {\n        switch (event.key) {\n          case '1': target.setAttribute('dur', 'semibrevis'); break;\n          case '2': target.setAttribute('dur', 'minima'); break;\n          case '4': target.setAttribute('dur', 'semiminima'); break;\n          case '8': target.setAttribute('dur', 'fusa'); break;\n          case '6': target.setAttribute('dur', 'semifusa'); break;\n          case '7': target.setAttribute('dur', 'maxima'); break;\n          case '9': target.setAttribute('dur', 'longa'); break;\n          case '0': target.setAttribute('dur', 'brevis'); break;\n\n          case 'I':\n            const clone = target.cloneNode(true) as Element;\n            recurseXmlId(clone);\n            target.insertAdjacentElement('beforebegin', clone);\n            break;\n\n          case 'Backspace':\n            target.remove();\n            break;\n\n          default:\n            return;\n        }\n      }\n\n      event.preventDefault();\n      this.doc.score = this.runScoringUp(this.doc.parts);\n    }\n  }\n\n  runScoringUp(meiDoc: XMLDocument): XMLDocument {\n    let output = null;\n    try {\n      const staffDef = meiDoc.getElementsByTagName(\"staffDef\")[0];\n      let quasiDoc: XMLDocument;\n      quasiDoc = ScoringUp.merge(meiDoc.cloneNode(true));\n      switch (staffDef.getAttribute(\"notationtype\")) {\n        case \"mensural.white\":\n          output = ScoringUp.ArsNova.lining_up(quasiDoc);\n          break;\n        case \"mensural.black\":\n          switch(staffDef.getAttribute(\"notationsubtype\")) {\n            case \"Ars_antiqua\":\n              output = ScoringUp.ArsAntiqua.lining_up(quasiDoc);\n              break;\n            case \"Ars_nova\":\n              output = ScoringUp.ArsNova.lining_up(quasiDoc);\n              break;\n            default:\n              console.warn(\"Only 'Ars antiqua' and 'Ars nova' are supported!\");\n          }\n          break;\n        default:\n          console.warn(\"Only mensural notation types are supported.\");\n          break;\n      }\n      if (output !== null) {\n        ScoringUp.PostProcessing.replace_ligatures_by_brackets(output);\n        ScoringUp.PostProcessing.refine_score(\n          output,\n          this.stateService.scoreOptions.modernClefs,\n          this.stateService.scoreOptions.barlines\n        );\n        // ScoringUp.PostProcessing.remove_num_and_numbase(output);\n      }\n    }\n    catch(e) {\n      console.error(e);\n      alert(\"Error in scoring up tool! \" + e);\n      output = null;\n    }\n    finally {\n      return output;\n    }\n  }\n\n\n  ensureCorrElement(target: Element, meiDoc: XMLDocument): Element {\n    if (target.closest('corr')) {\n      return target;\n    }\n    const choice = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'choice');\n    const corr = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'corr');\n    const sic = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'sic');\n    const sibling = target.nextElementSibling;\n    target.insertAdjacentElement('beforebegin', choice);\n    choice.appendChild(corr);\n    choice.appendChild(sic);\n    sic.appendChild(target);\n    const corrTarget = target.cloneNode(true) as Element;\n    recurseXmlId(corrTarget);\n    corr.appendChild(corrTarget);\n    this.corrToSicMap.set(corrTarget.getAttribute(\"xml:id\"), target.getAttribute(\"xml:id\"));\n    if (sibling !== null && sibling.tagName === 'dot') {\n      sic.appendChild(sibling);\n      const sibCorr = sibling.cloneNode(true) as Element;\n      recurseXmlId(sibCorr);\n      corr.appendChild(sibCorr);\n    }\n    return corrTarget;\n  }\n\n  onRefinementChange() {\n    this.doc.score = this.runScoringUp(this.doc.parts);\n  }\n}\n","<div id=\"verovio\" #verovio (click)=\"handleClick($event)\"></div>\n<div>\n    <label>\n        Bar by:&nbsp;\n        <select (change)=\"onRefinementChange()\" [(ngModel)]=\"stateService.scoreOptions.barlines\">\n          <option *ngFor=\"let opt of barOptions\" value=\"{{opt[1]}}\">{{opt[0].toLowerCase()}}</option>\n        </select>\n    </label>\n    &nbsp;\n    <label>\n        Switch to Modern Clefs\n        <input (change)=\"onRefinementChange()\" type=\"checkbox\" [(ngModel)]=\"stateService.scoreOptions.modernClefs\">\n    </label>\n</div>\n<div>\n    <button color=primary class=\"primary-button\" mat-stroked-button *ngIf=\"!stateService.editorialMode\" (click)=\"setEditorialMode()\">\n        Continue in Editorial Mode\n    </button>\n</div>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { DivaViewComponent } from './diva-view/diva-view.component';\nimport { StaffSelectComponent } from './staff-select/staff-select.component';\nimport { ToolbarComponent } from './toolbar/toolbar.component';\nimport { InputComponent } from './input.component';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\nimport { GeneralHelpComponent } from './general-help/general-help.component';\nimport { MusicInputHelpComponent } from './music-input-help/music-input-help.component';\n\n@NgModule({\n  declarations: [\n    DivaViewComponent,\n    StaffSelectComponent,\n    StaffSelectComponent,\n    ToolbarComponent,\n    InputComponent,\n    GeneralHelpComponent,\n    MusicInputHelpComponent,\n  ],\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    BrowserAnimationsModule,\n    MatTabsModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatDialogModule,\n    MatFormFieldModule,\n    MatSelectModule\n  ],\n  exports: [\n    InputComponent\n  ]\n})\nexport class InputModule { }\n","import { IRI, BoundingBox, Voice, Mensuration } from './definitions';\nimport { MusicList, NoteItem, MensurItem, PlicaStatus } from './MusicItem';\nimport { Part } from './part';\nimport { v4 as uuid } from 'uuid';\nimport { vrvToolkit } from './verovio';\nimport { NAMESPACE } from './mei';\n\nexport class Pb {\n  canvasIRI: IRI;\n  index: number;\n  id: string;\n\n  constructor(iri: IRI, id?: string) {\n    this.canvasIRI = iri;\n    if (id) {\n      this.id = id;\n    } else {\n      this.id = 'm-' + uuid();\n    }\n  }\n}\n\nexport class Sb {\n  zone: BoundingBox;\n  id: string;\n\n  constructor(zone: BoundingBox, id?: string) {\n    if (id) {\n      this.id = id;\n    } else {\n      this.id = 'm-' + uuid();\n    }\n\n    this.zone = zone;\n  }\n\n  get svg() {\n    let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n    rect.setAttribute('x', this.zone.ulx.toString());\n    rect.setAttribute('y', this.zone.uly.toString());\n    rect.id = this.id;\n    rect.setAttribute('width', (this.zone.lrx - this.zone.ulx).toString());\n    rect.setAttribute('height', (this.zone.lry - this.zone.uly).toString());\n    rect.classList.add('zoneRect');\n    return rect;\n  }\n}\n\nexport class System {\n  pb: Pb;\n  sb: Sb;\n  parent: Part;\n  contents: MusicList;\n\n  constructor (contents?: MusicList) {\n    if (contents) {\n      this.contents = contents;\n    } else {\n      this.contents = new MusicList();\n    }\n  }\n\n  static compare(a: System, b: System): number {\n    let diff = a.pb.index - b.pb.index;\n    if (diff !== 0) return diff;\n    // Check for intersection on y-axis. If so, left-most. Else highest.\n    const aZone = a.sb.zone;\n    const bZone = b.sb.zone;\n    const threshold = 0.25;\n\n    const diff1 = aZone.lry - bZone.uly;\n    const diff2 = bZone.lry - aZone.uly;\n    if (diff1 > 0 && diff2 > 0) {\n      const overlap = Math.min(diff1, diff2);\n      const avHeight = (aZone.lry - aZone.uly + bZone.lry - bZone.uly) / 2;\n      if (overlap > threshold * avHeight) {\n        return aZone.ulx - bZone.ulx;\n      }\n    }\n    return a.sb.zone.uly - b.sb.zone.uly;\n  }\n\n  get id(): string {\n    return this.sb.id;\n  }\n\n  get voice(): Voice {\n    return this.parent.voice;\n  }\n\n  set voice(voice: Voice) {\n    if (voice !== this.parent.voice) {\n      let newPart = this.parent.parent.getOrCreatePart(voice);\n      let idx = this.parent.systems.indexOf(this);\n      this.parent.systems.splice(idx, 1);\n      newPart.addSystem(this);\n    }\n  }\n\n  getContents(): Element[] {\n    let whiteMensural = this.parent.parent.notationType === \"mensural.white\";\n    console.debug(this.parent.parent.notationType);\n    let rawMei = vrvToolkit.humdrumToMEI(this.contents.getHumdrumScore({white: whiteMensural}));\n    let parser = new DOMParser();\n    let elements: Element[] = [];\n    let humdrumMei = parser.parseFromString(rawMei, 'application/xml');\n    let clef = humdrumMei.querySelector('clef');\n    if (clef !== null) {\n      this._recurseId(clef);\n      elements.push(clef);\n    }\n    let mensur = humdrumMei.querySelector('mensur');\n    if (mensur !== null && mensur.closest('layer') === null) {\n      this._recurseId(mensur);\n      elements.push(mensur);\n    }\n    let layer = humdrumMei.querySelector('layer');\n    console.debug(layer);\n    if (layer !== null) {\n      for (let child of Array.from(layer.children)) {\n        this._recurseId(child);\n        if (child.tagName === \"note\" && child.hasAttribute(\"dots\")) {\n          child.removeAttribute(\"dots\");\n        }\n        elements.push(child);\n      }\n    }\n    return elements;\n  }\n\n  _recurseId(element: Element) {\n    let id = element.getAttribute('xml:id');\n    let found = false;\n    if (id && /(note|rest|clef|pb|sb|mensur)/.test(element.tagName)) {\n      let regexpInfo = id.match(/L(\\d+)[\\w\\d]+$/);\n      if (regexpInfo) {\n        let line = parseInt(regexpInfo[1]);\n        let match = this.contents.m_list.filter(el => {\n          return el.m_line === line;\n        });\n        if (match.length > 0) {\n          found = true;\n          element.setAttribute('xml:id', match[0].m_id);\n          if (match[0].m_type === \"mensur\") {\n            let mensur = match[0] as MensurItem;\n            if (mensur.m_modus !== Mensuration.NA) {\n              element.setAttribute(\"modusminor\", mensur.m_modus.toString());\n            }\n            if (mensur.m_tempus !== Mensuration.NA) {\n              element.setAttribute(\"tempus\", mensur.m_tempus.toString());\n            }\n            if (mensur.m_prolatio !== Mensuration.NA) {\n              element.setAttribute(\"prolatio\", mensur.m_prolatio.toString());\n            }\n            if (element.hasAttribute('sign')) {\n              element.removeAttribute('sign');\n            }\n            if (element.hasAttribute('dot')) {\n              element.removeAttribute('dot');\n            }\n          }\n          else if (match[0].m_type === 'note') {\n            let note = match[0] as NoteItem;\n            // Ensure child is followed by a dot. If not, ad one.\n            if (element.hasAttribute('dots') &&\n              (!element.nextElementSibling || element.nextElementSibling.tagName !== 'dot')) {\n              const dot = element.ownerDocument.createElementNS(NAMESPACE, 'dot');\n              element.insertAdjacentElement('afterend', dot);\n              element.removeAttribute('dots');\n            }\n          }\n        }\n      }\n    }\n    if (!found) {\n      element.setAttribute('xml:id', 'm-' + uuid());\n    }\n    for (let child of Array.from(element.children)) {\n      this._recurseId(child);\n    }\n  }\n}\n","import { Part, Tenor } from './part';\nimport { System, Pb, Sb } from './system';\nimport { ClefItem, NoteItem, RestItem, MensurItem } from './MusicItem';\nimport { Voice, Mensuration, Contributor } from './definitions';\nimport { IRI } from './definitions';\n\n\nexport const NAMESPACE = 'http://www.music-encoding.org/ns/mei';\n\nexport class MEIDocument {\n  parts: Part[];\n  metadata: Metadata;  // Should this be broken up better?\n  notationSubtype: string;\n\n  _meiDoc: Document;\n\n  get notationType(): string {\n    if (/Ars[_ ](antiqua|nova)/.test(this.notationSubtype)) {\n      return \"mensural.black\";\n    } else {\n      return \"mensural.white\";\n    }\n  }\n\n  constructor (manuscriptIRI: IRI) {  // This is for creating a new document\n    this.metadata = new Metadata();\n    this.metadata.sourceIRI = manuscriptIRI;\n    this.parts = [];\n    this._createSkeletonMEI();\n  }\n\n  static fromXML(source: XMLDocument): MEIDocument {\n    let doc = source.documentElement;\n    let iiif = \"\";\n    try {\n      let manifestations = doc.querySelectorAll(\"manifestation\");\n      for (let s of Array.from(manifestations)) {\n        for (let item of Array.from(s.querySelectorAll(\"item\"))) {\n          if (iiif !== \"\") break;\n          if (item.getAttribute(\"targettype\") === \"IIIF\") {\n            iiif = item.getAttribute(\"target\");\n            break;\n          }\n        }\n      }\n    } catch (e) {\n      console.debug(e);\n    }\n    let mei = new MEIDocument(iiif);\n\n    // Try to get metadata\n    for (let s of Array.from(doc.querySelectorAll(\"manifestation\"))) {\n      if (s.querySelector(\"titleStmt\")) {\n        let identifier = s.querySelector(\"titleStmt\")?.querySelector(\"title\")?.querySelector(\"identifier\");\n        if (identifier) {\n          mei.metadata.siglum = identifier.textContent;\n          break;\n        }\n      }\n    }\n    let titleStmt = doc.querySelector(\"fileDesc\")?.querySelector(\"titleStmt\");\n    if (titleStmt) {\n      if (titleStmt.querySelector(\"title\")) {\n        mei.metadata.shortTitle = titleStmt.querySelector(\"title\").textContent;\n      }\n      for (let contributor of Array.from(titleStmt.querySelector(\"respStmt\")?.querySelectorAll(\"persName\"))) {\n        switch (contributor.getAttribute(\"role\").toLowerCase()) {\n          case \"encoder\":\n          case \"proofreader\":\n          case \"editor\":\n          let c: Contributor = {\n            name: contributor.textContent,\n            type: contributor.getAttribute(\"role\").toLowerCase(),\n          };\n          mei.metadata.contributors.push(c);\n        }\n      }\n    }\n    let workList = doc.querySelector(\"workList\");\n    if (workList) {\n      let work = doc.querySelector(\"work\");\n      if (work) {\n        if (work.querySelector(\"title\")) {\n          mei.metadata.shortTitle = work.querySelector(\"title\").textContent;\n        }\n        if (work.querySelector(\"composer\")) {\n          mei.metadata.composerName = work.querySelector(\"composer\").textContent;\n        }\n        if (work.querySelector(\"classification\")) {\n          let terms = work.querySelector(\"classification\").querySelector(\"termList\");\n          if (terms) {\n            for (let term of Array.from(terms.querySelectorAll(\"term\"))) {\n              switch (term.textContent) {\n                case \"Motet\":\n                case \"Song\":\n                case \"Conductus\":\n                case \"Mass Movement\":\n                case \"Plainchant\":\n                mei.metadata.genre = term.textContent;\n              }\n              if (mei.metadata.genre !== \"\") break;\n            }\n          }\n        }\n      }\n    }\n\n    let facsimile = doc.querySelector(\"facsimile\");\n    let surfaces = Array.from(facsimile.querySelectorAll(\"surface\"));\n    let zones = Array.from(facsimile.querySelectorAll(\"zone\"));\n\n    // Start processing parts\n    const parts = Array.from(doc.querySelectorAll(\"part\"));\n    for (const part of parts) {\n      let staffDef = part.querySelector(\"staffDef\");\n      console.assert(staffDef.hasAttribute(\"label\"));\n      let voice = staffDef.getAttribute(\"label\");\n      let partObj: Part | Tenor = /^[tT]enor/.test(voice) ? new Tenor(mei, part.getAttribute(\"xml:id\")) : new Part(mei, part.getAttribute(\"xml:id\"));\n      partObj.voice = Voice[voice];\n      mei.parts.push(partObj);\n      let mensur = staffDef.querySelector(\"mensur\");\n\n      if (staffDef.hasAttribute(\"notationsubtype\")) {\n        mei.notationSubtype = staffDef.getAttribute(\"notationsubtype\");\n      } else {\n        mei.notationSubtype = \"\";\n      }\n      if (staffDef.hasAttribute(\"modusminor\")) {\n        partObj.modus = staffDef.getAttribute(\"modusminor\") as Mensuration;\n      } else if (mensur && mensur.hasAttribute(\"modusminor\")) {\n        partObj.modus = mensur.getAttribute(\"modusminor\") as Mensuration;\n      }\n      if (staffDef.hasAttribute(\"tempus\")) {\n        partObj.tempus = staffDef.getAttribute(\"tempus\") as Mensuration;\n      } else if (mensur && mensur.hasAttribute(\"tempus\")) {\n        partObj.tempus = mensur.getAttribute(\"tempus\") as Mensuration;\n      }\n      if (staffDef.hasAttribute(\"prolatio\")) {\n        partObj.prolatio = staffDef.getAttribute(\"prolatio\") as Mensuration;\n      } else if (mensur && mensur.hasAttribute(\"prolatio\")) {\n        partObj.prolatio = mensur.getAttribute(\"prolatio\") as Mensuration;\n      }\n\n      const layer = part.querySelector(\"layer\");\n      // Handle repeating tenor if tenor\n      if (/^[tT]enor/.test(partObj.voice)) {\n        const dir = part.querySelector(\"dir\");\n        if (dir) {\n          const tenorObj = partObj as Tenor;\n          tenorObj.repetitions = Number(dir.getAttribute(\"n\")) + 1\n          const matchResults = dir.getAttribute(\"plist\").match(/^#[-\\w\\d]+ #([-\\w\\d]+)$/);\n          if (matchResults.length > 1) {\n            tenorObj.endingId = matchResults[1];\n          }\n        }\n      }\n      // Handle regular children\n      const layerChildren = Array.from(layer.querySelectorAll(\"pb,sb,clef,note,rest,mensur\"));\n      let activePb: Pb = null;\n      let activeSystem: System = null;\n      for (const child of layerChildren) {\n        if (child.tagName === \"pb\") {\n          let facs = child.getAttribute(\"facs\").split(\"#\")[1];\n          console.assert(surfaces.some(el => { return el.getAttribute(\"xml:id\") === facs; }));\n          let surface = surfaces.find(el => { return el.getAttribute(\"xml:id\") === facs; });\n          let graphic = surface.querySelector(\"graphic\");\n          activePb = new Pb(graphic.getAttribute(\"target\"), child.getAttribute(\"xml:id\"));\n\n          // Determine Pb index\n          function setIndex(pb: Pb) {\n            fetch(iiif).then(response => {\n              return response.json();\n            }).then((manifest: object) => {\n              let canvases: object[] = manifest[\"sequences\"][0][\"canvases\"];\n              pb.index = canvases.findIndex(canvas => { return canvas[\"@id\"] === pb.canvasIRI; });\n            });\n          }\n\n          setIndex(activePb);\n        } else if (child.tagName === \"sb\") {\n          let sb: Sb;\n          if (child.hasAttribute(\"facs\")) {\n            let facs = child.getAttribute(\"facs\").split(\"#\")[1];\n            console.assert(zones.some(el => { return el.getAttribute(\"xml:id\") === facs; }));\n            let zone = zones.find(el => { return el.getAttribute(\"xml:id\") === facs; });\n            sb = new Sb(\n              {\n                ulx: Number(zone.getAttribute(\"ulx\")),\n                uly: Number(zone.getAttribute(\"uly\")),\n                lrx: Number(zone.getAttribute(\"lrx\")),\n                lry: Number(zone.getAttribute(\"lry\"))\n              },\n              child.getAttribute(\"xml:id\")\n            );\n          } else {\n            sb = new Sb({ulx: 0, uly: 0, lrx: 0, lry: 0}, child.getAttribute(\"xml:id\"));\n          }\n          activeSystem = new System();\n          activeSystem.sb = sb;\n          activeSystem.pb = activePb;\n          partObj.addSystem(activeSystem);\n        } else if (child.tagName === \"clef\") {\n          let clef = ClefItem.parseXML(child);\n          activeSystem.contents.m_list.push(clef);\n        } else if (child.tagName === \"rest\") {\n          let rest = RestItem.parseXML(child);\n          activeSystem.contents.m_list.push(rest);\n        } else if (child.tagName === \"note\") {\n          let note = NoteItem.parseXML(child);\n          activeSystem.contents.m_list.push(note);\n        } else if (child.tagName === \"mensur\") {\n          let mensur = MensurItem.parseXML(child);\n          activeSystem.contents.m_list.push(mensur);\n        }\n      }\n    }\n\n    return mei;\n  }\n\n  generateXML(): Document {\n    this.parts.sort(Part.compare);\n    this._createSkeletonMEI();\n    let parts = this._meiDoc.querySelector('parts');\n    for (let part of this.parts) {\n      if (part.systems.length === 0) {\n        continue;\n      }\n      let partElement = /^[tT]enor/.test(part.voice) ?\n        (part as Tenor).generatePartXML() : part.generatePartXML();\n      if (partElement.querySelector('layer').children.length === 0) continue;\n      parts.appendChild(partElement);\n    }\n    return this._meiDoc;\n  }\n\n  _createSkeletonMEI() {\n    this._meiDoc = document.implementation.createDocument(NAMESPACE, 'mei', null);\n    let mei = this._meiDoc.documentElement;\n    mei.setAttribute('meiversion', '5.0.0-dev');\n    // Create Header\n    let head = this._generateHeader();\n    // TODO Add more to header\n    mei.appendChild(head);\n\n    // Create music skeleton\n    let music = this._meiDoc.createElementNS(NAMESPACE, 'music');\n    let facsimile = this._meiDoc.createElementNS(NAMESPACE, 'facsimile');\n    let body = this._meiDoc.createElementNS(NAMESPACE, 'body');\n    let mdiv = this._meiDoc.createElementNS(NAMESPACE, 'mdiv');\n    let parts = this._meiDoc.createElementNS(NAMESPACE, 'parts');\n    mei.appendChild(music);\n    music.appendChild(facsimile);\n    music.appendChild(body);\n    body.appendChild(mdiv);\n    mdiv.appendChild(parts);\n  }\n\n  _generateHeader(): Element {\n    let meiHead = this._meiDoc.createElementNS(NAMESPACE, \"meiHead\");\n    let fileDesc = this._meiDoc.createElementNS(NAMESPACE, \"fileDesc\");\n    meiHead.appendChild(fileDesc);\n    let titleStmt = this._meiDoc.createElementNS(NAMESPACE, \"titleStmt\");\n    fileDesc.appendChild(titleStmt);\n    let title = this._meiDoc.createElementNS(NAMESPACE, \"title\");\n    title.textContent = this.metadata.shortTitle;\n    titleStmt.appendChild(title);\n    let respStmt = this._meiDoc.createElementNS(NAMESPACE, \"respStmt\");\n    titleStmt.appendChild(respStmt);\n    for (let contributor of this.metadata.contributors) {\n      let persName = this._meiDoc.createElementNS(NAMESPACE, \"persName\");\n      persName.textContent = contributor.name;\n      persName.setAttribute(\"role\", contributor.type);\n      respStmt.appendChild(persName);\n    }\n    let pubStmt = this._meiDoc.createElementNS(NAMESPACE, \"pubStmt\");\n    fileDesc.appendChild(pubStmt);\n\n    let workList = this._meiDoc.createElementNS(NAMESPACE, \"workList\");\n    meiHead.appendChild(workList);\n    let work = this._meiDoc.createElementNS(NAMESPACE, \"work\");\n    workList.appendChild(work);\n    let title2 = this._meiDoc.createElementNS(NAMESPACE, \"title\");\n    title2.textContent = this.metadata.shortTitle;\n    work.appendChild(title2);\n    let composer = this._meiDoc.createElementNS(NAMESPACE, \"composer\");\n    composer.textContent = this.metadata.composerName;\n    work.appendChild(composer);\n    let classification = this._meiDoc.createElementNS(NAMESPACE, \"classification\");\n    work.appendChild(classification);\n    let termList = this._meiDoc.createElementNS(NAMESPACE, \"termList\");\n    classification.appendChild(termList);\n    let term = this._meiDoc.createElementNS(NAMESPACE, \"term\");\n    term.textContent = this.metadata.genre;\n    termList.appendChild(term);\n\n\n    let manifestList = this._meiDoc.createElementNS(NAMESPACE, \"manifestationList\");\n    meiHead.appendChild(manifestList);\n    let manifestation = this._meiDoc.createElementNS(NAMESPACE, \"manifestation\");\n    manifestList.appendChild(manifestation);\n    let titleStmt2 = this._meiDoc.createElementNS(NAMESPACE, \"titleStmt\");\n    manifestation.appendChild(titleStmt2);\n    let title3 = this._meiDoc.createElementNS(NAMESPACE, \"title\");\n    titleStmt2.appendChild(title3);\n    let identifier = this._meiDoc.createElementNS(NAMESPACE, \"identifier\");\n    identifier.textContent = this.metadata.siglum;\n    title3.appendChild(identifier);\n\n    let itemList = this._meiDoc.createElementNS(NAMESPACE, \"itemList\");\n    manifestation.appendChild(itemList);\n    let item = this._meiDoc.createElementNS(NAMESPACE, \"item\");\n    itemList.appendChild(item);\n    item.setAttribute(\"target\", this.metadata.sourceIRI);\n    item.setAttribute(\"targettype\", \"IIIF\");\n\n    return meiHead;\n  }\n\n  getSystems(): System[] {\n    let allSystems: System[] = [];\n    for (let part of this.parts) {\n      allSystems.unshift(...part.systems);\n    }\n    return allSystems;\n  }\n\n  getSystem(id: string): System {\n    let allSystems = this.getSystems();\n    let systemList = allSystems.filter(system => { return system.id === id; });\n    return systemList.length > 0 ? systemList[0] : null;\n  }\n\n  getPart(voice: Voice): Part {\n    let partlist = this.parts.filter(part => { return part.voice === voice; });\n    return partlist.length > 0 ? partlist[0] : null;\n  }\n\n  getOrCreatePart(voice: Voice): Part {\n    if (this.parts.some(part => { return part.voice === voice; })) {\n      return this.getPart(voice);\n    }\n    let part = /^[tT]enor/.test(voice) ? new Tenor(this) : new Part(this);\n    part.voice = voice;\n    this.parts.push(part);\n    this.parts.sort(Part.compare);\n    return part;\n  }\n\n  getPb(index: number): Pb {\n    let pbs = new Set<Pb>();\n    for (let part of this.parts) {\n      part.systems.forEach(system => {\n        pbs.add(system.pb);\n      });\n    }\n    for (let pb of pbs.values()) {\n      if (pb.index === index) return pb;\n    }\n    return null;\n  }\n}\n\nclass Metadata {\n  shortTitle: string;\n  sourceIRI: IRI;\n  composerName: string;\n  contributors: Contributor[] = [];\n  siglum: string;\n  genre: string;\n}\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'app-general-help',\n  templateUrl: './general-help.component.html',\n  styleUrls: ['./general-help.component.css']\n})\nexport class GeneralHelpComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n  }\n\n}\n","<h2>Manuscript Navigation</h2>\n<ul>\n    <li>\n        To select the page of the manuscript you want to work on,\n        either use the scrollbar to the right of the manuscript\n        or type the folio number in the box and click the <code>Go</code>\n        button.\n    </li>\n    <li>\n        Click the magnifying boxes for the appropriate zoom level\n        and move around the manuscript using your mouse or the\n        trackpad.\n    </li>\n</ul>\n<mat-divider></mat-divider>\n<h2>Metadata Entry</h2>\n<p>\n    First enter basic metadata about the document.\n    This includes the name of the work, composer name,\n    and your name. If there is something you don't know,\n    you can leave it as is and continue.\n    <br>\n    Metadata must be entered before staff input can fully begin.\n</p>\n<mat-divider></mat-divider>\n<h2>Staff Entry</h2>\n<ul>\n    <li>\n        To select an area for a new staff, hold <code>Shift</code>\n        and click-and-drag an area for the staff on the Diva.js\n        viewer. When you release the mouse, a staff is added.\n    </li>\n    <li>\n        To select a staff, click on the bounding box on the viewer.\n    </li>\n    <li>\n        When a staff is selected, the voice it belongs to and\n        mensuration of that voice can be set on the right.\n        This information is saved automatically.\n    </li>\n    <li>\n        To add musical components, begin typing. This will add\n        musical elements to the staff below the voice and mensuration\n        options. Information on this is available under the \"Music\n        Input Help\" Tab.\n    </li>\n    <li>\n        To delete a staff, first select it and then click the\n        \"Delete Staff\" button under the \"Staff Input\" tab.\n    </li>\n</ul>\n<mat-divider></mat-divider>\n<h2>Saving Work for Later</h2>\n<p>\n    Work can be saved for later using the <em>Download MEI File</em>\n    button. This will download the file as a parts-based MEI file that\n    can be reloaded at a later point from the home screen.\n</p>\n","import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { IRI } from '../utils/definitions';\nimport { StateService } from '../state-service.service';\nimport { MEIDocument } from '../utils/mei';\nimport { formIIIFManifest } from '../tools';\n\n@Component({\n  selector: 'app-score-editor',\n  templateUrl: './score-editor.component.html',\n  styleUrls: ['./score-editor.component.css']\n})\nexport class ScoreEditorComponent implements OnInit {\n\n  source: string;\n  identifier: string;\n  iiifManifest: IRI;\n  meiDoc: MEIDocument;\n\n  constructor(\n    private router: Router,\n    private route: ActivatedRoute,\n    private stateService: StateService\n  ) {\n    this.source = this.route.snapshot.paramMap.get('source');\n    this.identifier = decodeURIComponent(\n      this.route.snapshot.paramMap.get('identifier')\n    );\n    this.iiifManifest = formIIIFManifest(this.source, this.identifier);\n    this.meiDoc = this.stateService.mei;\n    if (this.meiDoc === null) {\n      this.router.navigate(['/input', this.source, this.identifier])\n    }\n  }\n\n  ngOnInit() {\n  }\n}\n","<div id=\"score-container\">\n    <app-score-diva-view [iiifManifest]=\"iiifManifest\"></app-score-diva-view>\n    <div id=\"right\">\n        <mat-tab-group>\n            <mat-tab label=\"Score Editor\">\n                <app-score-toolbar></app-score-toolbar>\n                <mat-divider></mat-divider>\n                <app-score-verovio-view></app-score-verovio-view>\n            </mat-tab>\n            <mat-tab label=\"Score Editor Help\">\n                <app-score-editor-help></app-score-editor-help>\n            </mat-tab>\n        </mat-tab-group>\n    </div>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MEIDocument } from './utils/mei';\n\nexport enum Barline {\n  NONE=\"None\",\n  SEMIBREVE=\"semibrevis\",\n  BREVE=\"brevis\",\n  LONG=\"longa\",\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StateService {\n\n  private meiDoc: MEIDocument;\n  public editorialMode: boolean;\n  public scoreOptions: {\n    barlines: Barline,\n    modernClefs: boolean\n  };\n\n  constructor() {\n    this.meiDoc = null;\n    this.editorialMode = false;\n    this.scoreOptions = {\n      barlines: Barline.NONE,\n      modernClefs: false\n    };\n  }\n\n  get mei(): MEIDocument {\n    return this.meiDoc;\n  }\n\n  set mei(document: MEIDocument) {\n    this.meiDoc = document;\n  }\n}\n","import { Component } from '@angular/core';\nimport { vrvToolkit } from './utils/verovio';\n\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\nexport class AppComponent {\n  constructor() {\n    vrvToolkit.setup();\n  }\n}\n","<!-- Navigation -->\n<nav class=\"navbar navbar-expand-lg navbar-light\" id=\"mainNav\">\n    <a class=\"navbar-brand\" href=\"https://measuringpolyphony.org\">\n       <img src=\"assets/img/thumbnail.png\" id=\"thumbnail\">\n       <div id=\"navTitle\">Measuring Polyphony</div>\n       <div id=\"navDescription\">Digital encodings of late medieval music</div>\n       <div class=\"clearfix\"></div>\n    </a>\n    <div id=\"additionalButtons\">\n        <a class=\"additionalButtons\" href=\"https://measuringpolyphony.org/transcriptions.html\">\n          Browse\n        </a>\n        <a class=\"additionalButtons\" href=\"./\">\n            Transcribe\n        </a>\n        <a class=\"additionalButtons\" href=\"https://measuringpolyphony.org\">About</a>\n    </div>\n</nav>\n\n<router-outlet></router-outlet>\n","import { IRI } from './utils/definitions';\n\nexport function formIIIFManifest(source: string, identifier: string): IRI {\n  switch (source) {\n    case 'gallica':\n      return 'https://gallica.bnf.fr/iiif/ark:/' +\n        identifier +\n        '/manifest.json';\n    case 'ecodices':\n      return 'https://www.e-codices.unifr.ch/metadata/iiif/' +\n        identifier +\n        '/manifest.json';\n    case 'iiif':\n      return decodeURIComponent(identifier);\n    default:\n      return '';\n  }\n}\n\n//https://gallica.bnf.fr/ark:/12148/btv1b8454675g\nexport const gallicaRegexp = new RegExp(\"https?:\\/\\/gallica\\.bnf\\.fr\\/ark:\\/([a-z0-9]+\\/[a-z0-9]+)\");\nexport const gallicaIIIFRegexp = new RegExp(\"https?:\\/\\/gallica\\.bnf\\.fr\\/iiif\\/ark:\\/([a-z0-9]+\\/[a-z0-9]+)\\/manifest.json\");\n//https://www.e-codices.unifr.ch/en/list/one/bbb/0218\nexport const ecodicesRegexp = new RegExp(\"https?:\\/\\/www\\.e-codices\\.unifr\\.ch\\/[a-z]{2}\\/list\\/one\\/([a-z]+)\\/([-a-zA-Z0-9]+)\");\n//https://www.e-codices.unifr.ch/metadata/iiif/bbb-0218/manifest.json\nexport const ecodicesIIIFRegexp = new RegExp(\"https?:\\/\\/www\\.e-codices\\.unifr\\.ch\\/metadata\\/iiif\\/([-a-zA-Z0-9]+)\\/manifest\\.json\");\nexport const genericIIIFRegexp = new RegExp(\"https?:\\/\\/.*\\/manifest\\.json\");\n","import { BrowserModule } from '@angular/platform-browser';\nimport { NgModule } from '@angular/core';\nimport { ReactiveFormsModule, FormsModule } from '@angular/forms';\nimport { RouterModule, Routes } from '@angular/router';\n\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { InputModule } from './input/input.module';\nimport { InputComponent } from './input/input.component';\n\nimport { AppComponent } from './app.component';\nimport { SelectDocumentComponent } from './select-document/select-document.component';\nimport { ScoreEditorModule } from './score-editor/score-editor.module';\nimport { ScoreEditorComponent } from './score-editor/score-editor.component';\n\nconst routes: Routes = [\n  {\n    path: 'input/:source/:identifier',\n    component: InputComponent\n  },\n  {\n    path: 'score/:source/:identifier',\n    component: ScoreEditorComponent\n  },\n  {\n    path: '',\n    // redirectTo: '/input/gallica/12148%2Fbtv1b8454675g',\n    component: SelectDocumentComponent,\n    pathMatch: 'full'\n  }\n]\n\n@NgModule({\n  declarations: [\n    AppComponent,\n    SelectDocumentComponent\n  ],\n  imports: [\n    RouterModule.forRoot(\n      routes,\n      { useHash: true }\n      //{ enableTracing: true }\n    ),\n    BrowserModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatTabsModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    InputModule,\n    ScoreEditorModule\n  ],\n  providers: [],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n","import { v4 as uuid } from 'uuid';\n\nimport { Voice, Mensuration, IRI, voiceToOrdinal } from './definitions';\nimport { System } from './system';\nimport { MEIDocument, NAMESPACE } from './mei';\n\nexport class Part {\n  voice: Voice;\n  modus: Mensuration;\n  tempus: Mensuration;\n  prolatio: Mensuration;\n  id: string;\n  parent: MEIDocument;\n\n  systems: System[];\n\n  constructor(doc: MEIDocument, id?: string) {\n    this.parent = doc;\n    if (id) {\n      this.id = id;\n    } else {\n      id = 'm-' + uuid();\n    }\n\n    this.systems = [];\n    this.modus = Mensuration.NA;\n    this.tempus = Mensuration.NA;\n    this.prolatio = Mensuration.NA;\n  }\n\n  static compare(a: Part, b: Part): number {\n    return voiceToOrdinal(a.voice) - voiceToOrdinal(b.voice);\n  }\n\n  addSystem(system: System) {\n    system.parent = this;\n    this.systems.push(system);\n  }\n\n  removeSystem(id: string): System {\n    let matches = this.systems.filter(system => { return system.id === id; });\n    if (matches.length > 0) {\n      let index = this.systems.indexOf(matches[0]);\n      let removed = this.systems.splice(index, 1);\n      return removed[0];\n    }\n    return null;\n  }\n\n  generatePartXML(): Element {\n    this.systems.sort(System.compare);\n    let part = this.parent._meiDoc.createElementNS(NAMESPACE, 'part');\n    let scoreDef = this._generateScoreDef();\n    part.appendChild(scoreDef);\n\n    let staffDef = scoreDef.querySelector('staffDef');\n    staffDef.setAttribute('label', this.voice.toString());\n    let mensur = this.parent._meiDoc.createElementNS(NAMESPACE, 'mensur');\n    staffDef.appendChild(mensur);\n    if (this.modus !== Mensuration.NA) {\n      mensur.setAttribute('modusminor', this.modus.toString());\n    }\n    if (this.tempus !== Mensuration.NA) {\n      mensur.setAttribute('tempus', this.tempus.toString());\n    }\n    if (this.prolatio !== Mensuration.NA) {\n      mensur.setAttribute('prolatio', this.prolatio.toString());\n    }\n\n    let section = this.parent._meiDoc.createElementNS(NAMESPACE, 'section');\n    part.appendChild(section);\n    let staff = this.parent._meiDoc.createElementNS(NAMESPACE, 'staff');\n    staff.setAttribute('n', '1');\n    section.appendChild(staff);\n    let layer = this.parent._meiDoc.createElementNS(NAMESPACE, 'layer');\n    layer.setAttribute('n', '1');\n    staff.appendChild(layer);\n\n    let currentPage: IRI = null\n    let graphic: Element = null;\n    let facsimile: Element = this.parent._meiDoc.querySelector('facsimile');\n    for (let system of this.systems) {\n      let contents = system.getContents();\n      console.debug(contents);\n      if (contents.filter(el => { return el.tagName !== 'clef' && el.tagName !== 'rest'; }).length === 0) {\n        continue;\n      }\n      // Handle paging\n      if (system.pb.canvasIRI !== currentPage) {\n        let pb = this.parent._meiDoc.createElementNS(NAMESPACE, 'pb');\n        let temp = Array.from(facsimile.querySelectorAll('graphic'))\n          .filter(graphic => graphic.getAttribute('target') === system.pb.canvasIRI);\n        if (temp.length > 0) {\n          // Use existing page in mei\n          graphic = temp[0];\n        } else {\n          // Create new page\n          let surface = this.parent._meiDoc.createElementNS(NAMESPACE, 'surface');\n          surface.setAttribute('xml:id', 'm-' + uuid());\n          graphic = this.parent._meiDoc.createElementNS(NAMESPACE, 'graphic');\n          graphic.setAttribute('xml:id', 'm-' + uuid());\n          graphic.setAttribute('target', system.pb.canvasIRI);\n          surface.appendChild(graphic);\n          facsimile.appendChild(surface);\n        }\n        let surface = graphic.closest(\"surface\");\n        pb.setAttribute('facs', '#' + surface.getAttribute('xml:id'));\n        pb.setAttribute('xml:id', system.pb.id);\n        currentPage = system.pb.canvasIRI;\n        layer.appendChild(pb);\n      }\n\n      // Handle sb\n      let zone = this.parent._meiDoc.createElementNS(NAMESPACE, 'zone');\n      let zoneId = 'm' + uuid();\n      zone.setAttribute('xml:id', zoneId);\n      zone.setAttribute('ulx', Math.round(system.sb.zone.ulx).toString());\n      zone.setAttribute('uly', Math.round(system.sb.zone.uly).toString());\n      zone.setAttribute('lrx', Math.round(system.sb.zone.lrx).toString());\n      zone.setAttribute('lry', Math.round(system.sb.zone.lry).toString());\n      graphic.appendChild(zone);\n\n      let sb = this.parent._meiDoc.createElementNS(NAMESPACE, 'sb');\n      sb.setAttribute('facs', '#' + zone.getAttribute('xml:id'));\n      sb.setAttribute('xml:id', system.sb.id);\n      layer.appendChild(sb);\n\n      // Add contents. Child here should have correct xml:id including children\n      contents.forEach(child => {\n        // Remove @color and @marked\n        if (child.hasAttribute('color')) child.removeAttribute('color');\n        if (child.hasAttribute('type')) child.removeAttribute('type');\n\n        if (child.tagName === 'ligature') {\n          child.removeAttribute('form');\n        }\n\n        layer.appendChild(child);\n      });\n    }\n    return part;\n  }\n\n  _generateScoreDef(): Element {\n    let scoreDef = this.parent._meiDoc.createElementNS(NAMESPACE, 'scoreDef');\n    let staffGrp = this.parent._meiDoc.createElementNS(NAMESPACE, 'staffGrp');\n    scoreDef.appendChild(staffGrp);\n    let staffDef = this.parent._meiDoc.createElementNS(NAMESPACE, 'staffDef');\n    staffDef.setAttribute('n', '1');\n    staffDef.setAttribute('lines', '5');\n    staffDef.setAttribute('notationtype', this.parent.notationType);\n    staffDef.setAttribute('notationsubtype', this.parent.notationSubtype);\n    staffGrp.appendChild(staffDef);\n    return scoreDef;\n  }\n}\n\nexport class Tenor extends Part {\n  repetitions: number;\n  endingId: string;\n\n  constructor(doc: MEIDocument, id?: string) {\n    super(doc, id);\n    this.voice = Voice.tenor;\n    this.repetitions = 1;   // default\n  }\n\n  generatePartXML(): Element {\n    let part = super.generatePartXML();\n    // Set repeating tenor if necessary\n    if (this.repetitions > 1) {\n      /* IMPORTANT NOTE */\n      /* The \"n\" attribute here is used to represent the number of repetitions */\n      /* It does NOT mean this is the nth directive of the piece */\n      /* This should be replaced with a correct MEI attribute when possible */\n      let dir = this.parent._meiDoc.createElementNS(NAMESPACE, 'dir');\n      dir.setAttribute('n', (this.repetitions - 1).toString());\n      dir.setAttribute('layer', '1');\n      console.debug(part);\n      console.debug(part.querySelector('note,ligature,rest'));\n      let firstNoteId = part.querySelector('note,ligature,rest').getAttribute('xml:id');\n      // let endingId = (this.endingId !== undefined) ? this.endingId : part.querySelector('layer').lastElementChild.getAttribute('xml:id');\n      // Get ending ligature if it's in one\n      console.debug(part);\n      console.debug(this.endingId);\n      let endItem = (this.endingId !== undefined) ? Array.from(part.querySelectorAll('note')).find(el => { return el.getAttribute('xml:id') === this.endingId; }) : part.querySelector('layer').lastElementChild;\n      let endingId = (endItem.closest('ligature') === null) ? endItem.getAttribute('xml:id') : endItem.closest('ligature').getAttribute('xml:id');\n      dir.setAttribute('plist', '#' + firstNoteId + ' #' + endingId);\n      dir.setAttribute('follows', '#' + endingId);\n      let staff = part.querySelector('staff');\n      staff.appendChild(dir);\n      dir.insertAdjacentHTML(\n        'beforebegin',\n        '<!-- The @n attribute on <dir> is used to represent the number of repetitions in a machine readable format. -->'\n      );\n    }\n    return part;\n  }\n}\n","import { Component, OnInit, OnDestroy, Input } from '@angular/core';\n\nimport { IRI } from '../../utils/definitions';\n\nimport { SelectedStaffService } from '../selected-staff.service';\n\nimport Diva from 'diva.js';\n\n@Component({\n  selector: 'app-score-diva-view',\n  templateUrl: './score-diva-view.component.html',\n  styleUrls: ['./score-diva-view.component.css']\n})\nexport class ScoreDivaViewComponent implements OnInit, OnDestroy {\n\n  diva: Diva;\n  pageToCanvasMap: Map<string, number> = new Map();\n  iri: IRI;\n  bbox: {ulx: string, uly: string, lrx: string, lry: string};\n\n  @Input() iiifManifest: IRI;\n\n  constructor(private staffService: SelectedStaffService) { }\n\n  ngOnInit() {\n    this.diva = new Diva('diva-score-wrapper', {\n      objectData: this.iiifManifest\n    });\n\n    Diva.Events.subscribe('ManifestDidLoad', this.parseCanvases.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.handleZoom.bind(this), this.diva.settings.ID);\n\n    this.staffService.getStaffLocation().subscribe(([iri, bbox]) =>  {\n      this.iri = iri;\n      this.bbox = bbox;\n      console.debug(iri);\n      console.debug(bbox);\n      this.redraw();\n    });\n  }\n\n  handleZoom() {\n    (new Promise(resolve => {\n      document.getElementById(\"score-editor-container\").style.display = \"none\";\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.redraw();\n      document.getElementById(\"score-editor-container\").style.display = \"\";\n    });\n  }\n\n  redraw() {\n    const index = this.pageToCanvasMap.get(this.iri);\n    if (index === undefined) {\n      return;\n    }\n    // Change to correct folio if necessary\n    if (!this.diva.getCurrentPageIndices().includes(index)) {\n      this.diva.gotoPageByIndex(index);\n    }\n    // Get the inner element and dimensions\n    const inner =this.diva.settings.innerElement;\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(index);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(\n      index,\n      {\n        includePadding: true,\n        incorporateViewport: true\n      }\n    );\n    const marginLeft = getComputedStyle(inner, null).getPropertyValue('margin-left');\n    // Check for the container div or create one\n    let container = document.getElementById(\"score-editor-container\");\n    if (container === null) {\n      container = document.createElement(\"div\");\n      container.id = \"score-editor-container\";\n      inner.appendChild(container);\n    }\n\n    // Create SVG container\n    const svgParent = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    const maxZoom = this.diva.getPageDimensionsAtZoomLevel(index, Number.MAX_SAFE_INTEGER)\n    svgParent.setAttribute('width', dimensions.width.toString());\n    svgParent.setAttribute('height', dimensions.height.toString());\n    svgParent.setAttribute('viewBox', '0 0 ' + maxZoom.width + ' ' + maxZoom.height);\n\n    container.style.position = 'absolute';\n    container.style.top = `${offset.top}px`;\n    container.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    while (container.firstChild !== null) {\n      container.firstChild.remove();\n    }\n\n    let rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n    rect.setAttribute(\"x\", this.bbox.ulx);\n    rect.setAttribute(\"y\", this.bbox.uly);\n    rect.setAttribute(\"width\", (Number(this.bbox.lrx) - Number(this.bbox.ulx)).toString());\n    rect.setAttribute(\"height\", (Number(this.bbox.lry) - Number(this.bbox.uly)).toString());\n    rect.classList.add(\"zoneRect\");\n    svgParent.appendChild(rect);\n\n    container.appendChild(svgParent);\n  }\n\n  parseCanvases(manifest: { sequences: { canvases: object[] }[]}) {\n    for (const sequence of manifest.sequences) {\n      for (const canvas of sequence.canvases) {\n        this.pageToCanvasMap.set(canvas['@id'], sequence.canvases.indexOf(canvas));\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    try {\n      this.diva.deactivate();\n      this.diva.destroy();\n    }\n    catch (e) {\n      console.warn(e);\n    }\n  }\n\n}\n","<div id=\"diva-score-wrapper\"></div>\n","import { Component, OnInit } from '@angular/core';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { RxwebValidators } from '@rxweb/reactive-form-validators';\nimport { Router } from '@angular/router';\n\nimport { MEIDocument } from '../utils/mei';\nimport { StateService } from '../state-service.service';\nimport * as Tools from '../tools';\n\n@Component({\n  selector: 'app-select-document',\n  templateUrl: './select-document.component.html',\n  styleUrls: ['./select-document.component.css']\n})\nexport class SelectDocumentComponent implements OnInit {\n\n  type: string = 'gallica';\n  identifier: string = '12148/btv1b8454675g';\n  file: File = null;\n\n  invalid = false;\n\n  selectionForm = new FormGroup({\n    source: new FormControl('gallica', Validators.required),\n    resourceURL: new FormControl('', [Validators.required, RxwebValidators.url()])\n  });\n\n  loadMEIForm = new FormGroup({\n    fileInput: new FormControl('', Validators.required)\n  });\n\n  constructor(private router: Router, private stateService: StateService) { }\n\n  ngOnInit() {\n  }\n\n  submit() {\n    console.debug(\"Submit\");\n    let source = this.selectionForm.controls['source'].value;\n    let resourceURL = this.selectionForm.controls['resourceURL'].value;\n    this.invalid = false;\n    let identifier: string;\n    switch (source) {\n      case 'gallica':\n        console.debug(\"gallica\");\n        if (Tools.gallicaRegexp.test(resourceURL)) {\n          console.debug(\"true\");\n          identifier = resourceURL.match(Tools.gallicaRegexp)[1];\n        }\n        else {\n          console.debug(\"false\");\n          this.invalid = true;\n          return;\n        }\n        break;\n      case 'ecodices':\n        if (Tools.ecodicesRegexp.test(resourceURL)) {\n          console.debug(\"Regular ecodices\");\n          let matches = resourceURL.match(Tools.ecodicesRegexp);\n          identifier = matches[1] + '-' + matches[2];\n        }\n        else if (Tools.ecodicesIIIFRegexp.test(resourceURL)) {\n          console.debug(\"IIIF ecodices\");\n          identifier = resourceURL.match(Tools.ecodicesIIIFRegexp)[1];\n        }\n        else {\n          this.invalid = true;\n          return;\n        }\n        break;\n      case 'iiif':\n        console.debug('iiif case')\n        if (Tools.genericIIIFRegexp.test(resourceURL)) {\n          console.debug(\"generic iiif\");\n          identifier = encodeURIComponent(resourceURL);\n        }\n        break;\n      default:\n        console.debug(source);\n        this.invalid = true;\n        return;\n    }\n    console.debug(identifier);\n    this.router.navigate(['/input', source, encodeURIComponent(identifier)]);\n  }\n\n  meiSubmit() {\n    console.debug(\"MEI Submit\");\n    console.debug(this.file);\n    if (this.file === null) { return; }\n    let reader = new FileReader();\n    reader.addEventListener(\"load\", () => {\n      let rawText = reader.result as string;\n      let parser = new DOMParser();\n      let doc = parser.parseFromString(rawText, \"application/xml\");\n      let mei = MEIDocument.fromXML(doc)\n      console.debug(mei);\n\n      // Try to determine IIIF\n      let iiif = mei.metadata.sourceIRI;\n      let source: string, identifier: string;\n      if (Tools.gallicaIIIFRegexp.test(iiif)) {\n        source = \"gallica\";\n        identifier = iiif.match(Tools.gallicaIIIFRegexp)[1];\n      }\n      else if (Tools.ecodicesIIIFRegexp.test(iiif)) {\n        source = \"ecodices\";\n        identifier = iiif.match(Tools.ecodicesIIIFRegexp)[1];\n      }\n      else if (Tools.genericIIIFRegexp.test(iiif)) {\n        source = \"iiif\";\n        identifier = encodeURIComponent(iiif);\n      }\n      else {\n        window.alert(\"Sorry! This seems to be a valid file, but this IIIF manifest cannot be loaded.\");\n        return;\n      }\n      this.stateService.mei = mei;\n      this.router.navigate(['/input', source, encodeURIComponent(identifier)]);\n    });\n    reader.readAsText(this.file);\n  }\n\n  onFileChange(evt) {\n    this.file = evt.target['files'][0];\n  }\n\n  get encodedIdSample(): string {\n    return encodeURIComponent(this.identifier);\n  }\n\n}\n","<div id=\"document-select\">\n    <div id=\"load-manuscript\">\n        <h1>Load a manuscript</h1>\n        <form [formGroup]=\"selectionForm\" (submit)=\"submit()\">\n            <div style=\"display:block;\">\n                <label class=\"label\">Manuscript Repository:&nbsp;\n                    <select formControlName=\"source\">\n                        <option value=\"gallica\" selected>Gallica</option>\n                        <option value=\"ecodices\">eCodices</option>\n                        <option value=\"diamm\" disabled>DIAMM</option>\n                        <option value=\"iiif\">Generic IIIF</option>\n                    </select>\n                </label>\n                &nbsp;\n                <label class=\"label\">URL:&nbsp;\n                    <input type=\"url\" formControlName=\"resourceURL\">\n                </label>\n                <small *ngIf=\"invalid\">URL is unexpected for this source!</small>\n            </div>\n            <div>\n                <button type=\"submit\" [disabled]=\"!selectionForm.valid\" mat-stroked-button>Submit</button>\n            </div>\n        </form>\n        <br/>\n        <p>\n          For example, to transcribe a piece from the famous Roman de Fauvel manuscript,\n          choose <em>Gallica</em> in the dropdown and paste this URL:\n          <br/>\n          <code>https://gallica.bnf.fr/ark:/12148/btv1b8454675g</code>\n        </p>\n    </div>\n    <div id=\"load-mei\">\n        <h1>Load an .mei file</h1>\n        <form [formGroup]=\"loadMEIForm\" (submit)=\"meiSubmit()\">\n            <div style=\"display:block;\">\n                <label class=\"label\">Compatible Parts-MEI File:&nbsp;\n                    <input type=\"file\" (change)=\"onFileChange($event)\" formControlName=\"fileInput\" accept=\"application/mei+xml, application/xml, .mei, .xml\">\n                </label>\n            </div>\n            <div>\n                <button type=\"submit\" [disabled]=\"!loadMEIForm.valid\" mat-stroked-button>Load File</button>\n            </div>\n        </form>\n    </div>\n</div>\n<div id=\"prototype-message\">\n  <p>\n    This prototype for an online mensural music editor, funded by\n    <a href=\"https://www.brandeis.edu\">Brandeis University</a>\n    and the\n    <a href=\"https://www.neh.gov\">National Endowment for the Humanities</a>,\n    allows students and experts alike to encode transcriptions of polyphony\n    directly into mensural notation, and links the music transcriptions\n    to zones of the digital images of the medieval manuscripts. For more information\n    about this project, click <a href=\"https://measuringpolyphony.org\">here</a>.\n  </p>\n  <br/>\n  <div id=\"funder-logos\">\n    <a href=\"https://www.neh.gov\">\n      <img src=\"assets/img/NEH-Preferred-Seal820.jpg\" alt=\"National Endowment for the Humanities Logo\" class=\"funder-logo\">\n    </a>\n    <a href=\"https://www.brandeis.edu\">\n      <img src=\"assets/img/brandeis-logo-stacked-seal-blue-digital.png\" alt=\"Brandeis University Logo\" class=\"funder-logo\">\n    </a>\n  </div>\n</div>\n","import { Component, OnInit, HostListener, ViewChild, ElementRef } from '@angular/core';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { PitchClass, NoteItem, RestItem, Accid, LigStatus, PlicaStatus } from '../../utils/MusicItem';\nimport { StateService } from '../../state-service.service';\nimport { InputService } from '../input.service';\nimport { vrvToolkit } from '../../utils/verovio';\nimport { Tenor } from '../../utils/part';\nimport { Voice } from '../../utils/definitions';\n\n@Component({\n  selector: 'app-staff-select',\n  templateUrl: './staff-select.component.html',\n  styleUrls: ['./staff-select.component.css']\n})\nexport class StaffSelectComponent implements OnInit {\n  @ViewChild('example') container: ElementRef;\n  voices = Object.entries(Voice);\n  keySigMode = false;\n  pitchSig: string = null;\n  accidSig: string = null;\n  selected = null;\n  constructor(\n    private selectedSystem: InputService,\n    private stateService: StateService,\n    private route: ActivatedRoute,\n    private router: Router\n  ) { }\n\n  ngOnInit() {\n    this.selectedSystem.subscribe({\n      next: (staff) => {\n        this.selected = staff;\n        this.container.nativeElement.innerHTML = '';\n        if (staff === null) return;\n        let element = vrvToolkit.humdrumToSVG(staff.contents.getHumdrumScore());\n        this.container.nativeElement.appendChild(element);\n      }\n    });\n  }\n\n  updateSVG() {\n    let white = this.selectedSystem.selected.parent.parent.notationType === \"mensural.white\";\n    let element = vrvToolkit.humdrumToSVG(this.selectedSystem.selected.contents.getHumdrumScore({white: white}));\n    this.container.nativeElement.innerHTML = '';\n    this.container.nativeElement.appendChild(element);\n\n    if (/^[tT]enor/.test(this.selectedSystem.selected.parent.voice)) {\n      const tenor = this.selectedSystem.selected.parent as Tenor;\n      if (tenor.endingId !== undefined) {\n        let endNote = element.getElementById(tenor.endingId);\n        if (endNote !== null) {\n          endNote.setAttribute('fill', '#00f');\n        }\n      }\n    }\n  }\n\n  staffForm = new FormGroup({\n    voice: new FormControl(''),\n    modus: new FormControl(''),\n    tempus: new FormControl(''),\n    prolatio: new FormControl(''),\n  });\n\n  mensurForm = new FormGroup({\n    modus2: new FormControl(''),\n    tempus2: new FormControl(''),\n    prolatio2: new FormControl(''),\n  });\n\n  handleClick(event: MouseEvent) {\n    let target = event.target as Element;\n    while (target) {\n      if (target.nodeName === 'g') {\n        let matches: Array<string>;\n        if (matches = target.id.match(/-.*L(\\d+)/)) {\n          this.selectedSystem.selected.contents.selectItemByLine(parseInt(matches[1]))\n          this.updateSVG();\n          break;\n        }\n      }\n      target = target.parentNode as Element;\n    }\n  }\n\n  finishStep() {\n    // const mei = this.meiService.generateFullMEI();\n    const type = this.route.snapshot.paramMap.get('source');\n    const identifier = this.route.snapshot.paramMap.get('identifier');\n    // this.stateService.mei = mei;\n    this.router.navigate(['/score', type, identifier]);\n  }\n\n  repTenorButton() {\n    const tenor = this.stateService.mei.getPart(Voice.tenor) as Tenor;\n    try {\n        let layer = this.container.nativeElement.querySelector('.layer');\n        let id = layer.lastElementChild.id;\n        let regexpInfo = id.match(/L(\\d+)[\\w\\d]+$/);\n        let line = parseInt(regexpInfo[1]);\n        let match = this.selectedSystem.selected.contents.m_list.filter(el => {\n          return el.m_line === line;\n        });\n        tenor.endingId = match[0].m_id;\n    } catch (e) {\n      console.debug(e);\n      tenor.endingId = undefined;\n    }\n    this.updateSVG();\n  }\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyPress(event: KeyboardEvent) {\n    if (this.selectedSystem.selected == null) return;\n\n    if (this.keySigMode) {\n      this.handleKeySigPress(event);\n      event.preventDefault();\n      this.updateSVG();\n      return;\n    }\n\n    // Based on processKeypress function in mensural-input\n    if (event.metaKey) return;\n    let musicList = this.selectedSystem.selected.contents;\n    if ((musicList.m_index >=0) && (event.key.length === 1)) {\n      if ((event.key >= '0') && (event.key <= '9')) {\n        this.processDigit(Number(event.key), event);\n        event.preventDefault();\n        this.updateSVG();\n        return;\n      }\n      if (event.key !== ' ') {\n        let state = musicList.addTextToCurrentItem(event.key);\n        if (state) {\n          event.preventDefault();\n          this.updateSVG();\n          return;\n        }\n      }\n    }\n    if ((musicList.m_index >= 0) && (event.key === 'Backspace')) {\n      if (event.shiftKey) {\n        musicList.clearTextOnCurrentItem();\n      }\n      else {\n        musicList.deleteCharacterOnCurrentItem();\n      }\n      event.preventDefault();\n    }\n    else if ((musicList.m_index < 0) && (event.key === 'Backspace')) {\n      musicList.removeLastItem();\n      event.preventDefault();\n    }\n    else {\n      switch (event.key) {\n        case 'k':\n          this.keySigMode = true;\n          console.debug(\"Set keySigMode\");\n          event.preventDefault();\n          break;\n        case 'C':\n          musicList.addPitchFar(PitchClass.C);\n          event.preventDefault();\n          break;\n        case 'c':\n          musicList.addPitchNear(PitchClass.C);\n          event.preventDefault();\n          break;\n        case 'D':\n          musicList.addPitchFar(PitchClass.D);\n          event.preventDefault();\n          break;\n        case 'd':\n          musicList.addPitchNear(PitchClass.D);\n          event.preventDefault();\n          break;\n        case 'E':\n          musicList.addPitchFar(PitchClass.E);\n          event.preventDefault();\n          break;\n        case 'e':\n          musicList.addPitchNear(PitchClass.E);\n          event.preventDefault();\n          break;\n        case 'F':\n          musicList.addPitchFar(PitchClass.F);\n          event.preventDefault();\n          break;\n        case 'f':\n          musicList.addPitchNear(PitchClass.F);\n          event.preventDefault();\n          break;\n        case 'G':\n          musicList.addPitchFar(PitchClass.G);\n          event.preventDefault();\n          break;\n        case 'g':\n          musicList.addPitchNear(PitchClass.G);\n          event.preventDefault();\n          break;\n        case 'A':\n          musicList.addPitchFar(PitchClass.A);\n          event.preventDefault();\n          break;\n        case 'a':\n          musicList.addPitchNear(PitchClass.A);\n          event.preventDefault();\n          break;\n        case 'B':\n          musicList.addPitchFar(PitchClass.B);\n          event.preventDefault();\n          break;\n        case 'b':\n          musicList.addPitchNear(PitchClass.B);\n          event.preventDefault();\n          break;\n        case 'm':\n        case 'M':\n          if (!musicList.hasOpenLigature()) {\n            musicList.addMensur();\n          }\n          event.preventDefault();\n          break;\n        case 'p':\n        case 'P':\n          this.processPlica(event.key);\n          event.preventDefault();\n          break;\n        case 'r':\n        case 'R':\n          if (!musicList.hasOpenLigature()) {\n            musicList.addRest();\n          } else {\n            alert(\"Can't enter a rest in an open ligature! Please close first.\")\n          }\n          event.preventDefault();\n          break;\n        case '.':\n          this.processDotKey();\n          event.preventDefault();\n          break;\n        case '0':\n        case '1':\n        case '2':\n        case '3':\n        case '4':\n        case '5':\n        case '6':\n        case '7':\n        case '8':\n        case '9':\n          this.processDigit(Number(event.key), event);\n          event.preventDefault();\n          break;\n        case 'Tab':\n          if (event.shiftKey) {\n            musicList.selectBackward();\n          } else {\n            musicList.selectForward();\n          }\n          event.preventDefault();\n          break;\n        case ' ':\n        case 'ArrowRight':\n          musicList.selectForward();\n          event.preventDefault();\n          break;\n        case 'ArrowLeft':\n          musicList.selectBackward();\n          event.preventDefault();\n          break;\n        case 'ArrowUp':\n          musicList.raisePitch(event.shiftKey ? 7 : 1);\n          event.preventDefault();\n          break;\n        case 'ArrowDown':\n          musicList.lowerPitch(event.shiftKey ? 7 : 1);\n          event.preventDefault();\n          break;\n        case 'End':\n          musicList.goToEndOfList();\n          event.preventDefault();\n          break;\n        case '[':\n          if (!musicList.hasOpenLigature()) {\n            this.processLig(true);\n          } else {\n            alert(\"A ligature is already open!\");\n          }\n          event.preventDefault();\n          break;\n        case ']':\n          if (musicList.hasOpenLigature()) {\n            this.processLig(false);\n          } else {\n            alert(\"No open ligature to close!\");\n          }\n          event.preventDefault();\n          break;\n        case '#':\n        case '-':\n        case 'N':\n        case 'n':\n          this.processAccidental(event.key);\n          event.preventDefault();\n          break;\n        }\n    }\n    this.updateSVG();\n  }\n\n  processDigit(digit: number, _event: KeyboardEvent) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      if (digit !== 3) {\n        musicList.m_rhythm = digit;\n      }\n      return;\n    }\n    var index = musicList.m_index;\n    var ending = false;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n      ending = true;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'clef') {\n      if (digit !== 3) {\n        musicList.m_rhythm = digit;\n      }\n      musicList.runNotationCallback();\n      return;\n    }\n    else if (ending) {\n      musicList.m_rhythm = digit;\n    }\n    else if ((item.m_type === 'note') || (item.m_type === 'rest')) {\n      if (!ending) {\n        if (digit !== 3) {\n          if (item.m_type === \"note\") {\n            (item as NoteItem).m_rhythm = digit;\n          }\n          else {\n            (item as RestItem).m_rhythm = digit;\n          }\n          musicList.m_index += 1;\n          musicList.m_rhythm = digit;\n          musicList.runNotationCallback();\n        }\n        if (musicList.m_index >= musicList.m_list.length) {\n          musicList.m_index = -1;\n        }\n      }\n    }\n  }\n\n  processDotKey() {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      note.m_dot = !note.m_dot;\n      musicList.runNotationCallback();\n      return;\n    }\n  }\n\n  processLig(isStart: boolean) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      if (isStart) {\n        note.m_lig = note.m_lig === LigStatus.START ? LigStatus.NONE : LigStatus.START;\n      } else {\n        note.m_lig = note.m_lig === LigStatus.END ? LigStatus.NONE : LigStatus.END;\n      }\n      musicList.runNotationCallback();\n      return;\n    }\n  }\n\n  processPlica(key: string) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      if (key === 'p') {\n        note.m_plica = note.m_plica === PlicaStatus.DOWN ? PlicaStatus.NONE : PlicaStatus.DOWN;\n      }\n      else {\n        note.m_plica = note.m_plica === PlicaStatus.UP ? PlicaStatus.NONE : PlicaStatus.UP;\n      }\n      musicList.runNotationCallback();\n      return;\n    }\n  }\n\n  handleKeySigPress(event: KeyboardEvent) {\n    switch (event.key) {\n      case 'a':\n      case 'A':\n      case 'b':\n      case 'B':\n      case 'c':\n      case 'C':\n      case 'd':\n      case 'D':\n      case 'e':\n      case 'E':\n      case 'f':\n      case 'F':\n      case 'g':\n      case 'G':\n        if (this.pitchSig === null) {\n          this.pitchSig = event.key;\n        }\n        else {\n          this.pitchSig = null;\n          this.accidSig = null;\n          this.keySigMode = false;\n          console.debug(\"unset keySigMode\");\n        }\n        break;\n      case '#':\n      case '-':\n      case 'n':\n        if (this.pitchSig !== null && this.accidSig === null) {\n          this.accidSig = event.key;\n          let musicList = this.selectedSystem.selected.contents;\n          musicList.processKeySig(this.pitchSig, this.accidSig);\n          console.debug(\"Process with \" + this.pitchSig + \" and \" + this.accidSig);\n        }\n        this.pitchSig = null;\n        this.accidSig = null;\n        this.keySigMode = false;\n        console.debug(\"unset keySigMode\");\n        break;\n    }\n  }\n\n  processAccidental(accid: string) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      switch(accid) {\n        case 'N':\n          note.m_accid = Accid.NONE;\n          break;\n        case '#':\n          note.m_accid = Accid.SHARP;\n          break;\n        case '-':\n          note.m_accid = Accid.FLAT;\n          break;\n        case 'n':\n          note.m_accid = Accid.NATURAL;\n          break;\n      }\n      musicList.runNotationCallback();\n    }\n  }\n}\n","<form [formGroup]=\"staffForm\" *ngIf=\"selected\">\n    <h1>Enter Music</h1>\n    <fieldset>\n        <label class=\"music-subentry\">Voice:&nbsp;\n            <select [(ngModel)]=\"selected.voice\" formControlName=\"voice\">\n                <option *ngFor=\"let voice of voices\" value=\"{{voice[0]}}\">{{voice[1]}}</option>\n            </select>\n        </label>\n    </fieldset>\n    <h3 class=\"music-subentry\">Select Initial Mensuration:</h3>\n    <div class=\"flex-container\">\n        <fieldset>\n            <legend class=\"mensuration\">modus</legend>\n            <input [(ngModel)]=\"selected.parent.modus\" type=\"radio\" id=\"modus-3\" formControlName=\"modus\" value=\"3\"/>\n            <label for=\"modus-3\">3</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.modus\" type=\"radio\" id=\"modus-2\" formControlName=\"modus\" value=\"2\"/>\n            <label for=\"modus-2\">2</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.modus\" type=\"radio\" id=\"modus-na\" formControlName=\"modus\" value=\"N/A\"/>\n            <label for=\"modus-na\">N/A</label>\n        </fieldset>\n        <fieldset>\n            <legend class=\"mensuration\">tempus</legend>\n            <input [(ngModel)]=\"selected.parent.tempus\" type=\"radio\" id=\"tempus-3\" formControlName=\"tempus\" value=\"3\"/>\n            <label for=\"tempus-3\">3</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.tempus\" type=\"radio\" id=\"tempus-2\" formControlName=\"tempus\" value=\"2\"/>\n            <label for=\"tempus-2\">2</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.tempus\" type=\"radio\" id=\"tempus-na\" formControlName=\"tempus\" value=\"N/A\"/>\n            <label for=\"tempus-na\">N/A</label>\n        </fieldset>\n        <fieldset>\n            <legend class=\"mensuration\">prolatio</legend>\n            <input [(ngModel)]=\"selected.parent.prolatio\" type=\"radio\" id=\"prolatio-3\" formControlName=\"prolatio\" value=\"3\"/>\n            <label for=\"prolatio-3\">3</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.prolatio\" type=\"radio\" id=\"prolatio-2\" formControlName=\"prolatio\" value=\"2\"/>\n            <label for=\"prolatio-2\">2</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.prolatio\" type=\"radio\" id=\"prolatio-na\" formControlName=\"prolatio\" value=\"N/A\"/>\n            <label for=\"prolatio-na\">N/A</label>\n        </fieldset>\n    </div>\n</form>\n<div #example (click)=\"handleClick($event)\"></div>\n<div id=\"mensur-change\" *ngIf=\"selected && selected.contents.m_index >= 0 && selected.contents.m_list[selected.contents.m_index].m_type == 'mensur'\">\n    <form [formGroup]=\"mensurForm\">\n    <fieldset>\n        <legend class=\"mensuration\">modus</legend>\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_modus\" type=\"radio\" id=\"modus2-3\" formControlName=\"modus2\" value=\"3\"/>\n        <label for=\"modus2-3\">3</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_modus\" type=\"radio\" id=\"modus2-2\" formControlName=\"modus2\" value=\"2\"/>\n        <label for=\"modus2-2\">2</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_modus\" type=\"radio\" id=\"modus2-na\" formControlName=\"modus2\" value=\"N/A\"/>\n        <label for=\"modus2-na\">N/A</label>\n    </fieldset>\n    <fieldset>\n        <legend class=\"mensuration\">tempus</legend>\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_tempus\" type=\"radio\" id=\"tempus2-3\" formControlName=\"tempus2\" value=\"3\"/>\n        <label for=\"tempus2-3\">3</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_tempus\" type=\"radio\" id=\"tempus2-2\" formControlName=\"tempus2\" value=\"2\"/>\n        <label for=\"tempus2-2\">2</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_tempus\" type=\"radio\" id=\"tempus2-na\" formControlName=\"tempus2\" value=\"N/A\"/>\n        <label for=\"tempus2-na\">N/A</label>\n    </fieldset>\n    <fieldset>\n        <legend class=\"mensuration\">prolatio</legend>\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_prolatio\" type=\"radio\" id=\"prolatio2-3\" formControlName=\"prolatio2\" value=\"3\"/>\n        <label for=\"prolatio2-3\">3</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_prolatio\" type=\"radio\" id=\"prolatio2-2\" formControlName=\"prolatio2\" value=\"2\"/>\n        <label for=\"prolatio2-2\">2</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_prolatio\" type=\"radio\" id=\"prolatio2-na\" formControlName=\"prolatio2\" value=\"N/A\"/>\n        <label for=\"prolatio2-na\">N/A</label>\n    </fieldset>\n    </form>\n</div>\n<div id=\"tenor-section\" *ngIf=\"selected && selected.voice === 'tenor'\">\n    <p>\n        If the piece has repetitions of the tenor that are not written out in full,\n        please specify here. See \"Music Input Help\" for details.\n    </p>\n    <button class=\"primary-button\" mat-stroked-button (click)=\"repTenorButton()\">Set End of Repeating Tenor</button>\n    &nbsp;\n    <label>Total Number of Tenor Statements:&nbsp;\n        <input [(ngModel)]=\"selected.parent.repetitions\" type=\"number\" min=\"1\">\n    </label>\n</div>\n<button color=primary class=\"primary-button\" *ngIf=\"selected\" mat-stroked-button (click)=\"finishStep()\">\n    Continue to Score Editor\n</button>\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { IRI } from '../utils/definitions';\n\ntype BBox = {\n  ulx: string,\n  uly: string,\n  lrx: string,\n  lry: string\n};\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SelectedStaffService {\n  _staffLoc: Subject<[IRI, BBox]>;\n\n  constructor() {\n    this._staffLoc = new Subject<[IRI, BBox]>();\n  }\n\n  getStaffLocation() {\n    return this._staffLoc;\n  }\n\n  set staffLocation(loc: [IRI, BBox]) {\n    this._staffLoc.next(loc);\n  }\n\n\n}\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'app-music-input-help',\n  templateUrl: './music-input-help.component.html',\n  styleUrls: ['./music-input-help.component.css']\n})\nexport class MusicInputHelpComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n  }\n\n}\n","<h2>Music Input Instructions</h2>\n<ul>\n    <li> <b> Adding clef</b>\n        <ul>\n        <li> Type <span class=\"hi\">C</span> to insert C3 clef,\n            or <span class=\"hi\">F</span> to insert F4 clef.</li>\n        <li> Press the up or down arrows to move the clef to another line.</li>\n        </ul>\n    </li>\n\n    <li> <b> Adding key signatures</b>\n        <ul>\n        <li> Type <span class=\"hi\">k</span> to enter key signature mode after adding a clef.</li>\n        <li> Then enter the pitch name letter and accidental to add to key signature.</li>\n        <li> To remove from a key signature, enter the same pitch letter and accidental again.</li>\n        <li> Example: For F-sharp, type <span class=\"hi\">k f #</span></li>\n        </ul>\n    </li>\n\n    <li> <b> Adding pitches</b>\n        <ul>\n        <li> Type pitch <span class=\"hi\">letter</span> name of each note to add them to the line: <span class=\"hi\">f.ed.efgagfgedderfag</span></li>\n        <li> Type \"<span class=\"hi\">.</span>\" to add dot after note.</li>\n        <li> Type \"<span class=\"hi\">r</span>\" to add a rest.</li>\n        <li> Type <span class=\"hi2\">backspace</span> to delete note.</li>\n        <li> Use capital letters to choose the larger interval for the next pitch. So if you are on `d` and want to go to the `a` a fifth above, type capital A rather than lowercase (which would give the `a` that is a fourth below).</li>\n        <li> <span class=\"hi2\">Up/down</span> arrows transpose last pitch up/down a step.</li>\n        <li> <span class=\"hi2\">Shift-up/down</span> arrows transpose last pitch up/down an octave.</li>\n        </ul>\n    </li>\n\n    <li><b> Adding Accidentals</b><br>\n        After adding a note:\n        <ul>\n            <li> press <code>-</code> to add a flat.</li>\n            <li> press <code>#</code> to add a sharp.</li>\n            <li> press <code>n</code> to add a natural.</li>\n            <li> press <code>N</code> to clear accidentals.</li>\n        </ul>\n    </li>\n\n    <li><b> Adding ligatures</b>\n        <br/>Note that while duration of pitches in ligatures can be changed after the fact, ligatures must be specified as pitches are added.\n        <ul>\n            <li> After adding a note, press <span class=\"hi2\">[</span> to start a ligature.</li>\n            <li> After adding a note, press <span class=\"hi2\">]</span> to end a ligature.</li>\n        </ul>\n    </li>\n\n    <li> <b> Adding rhythm</b>\n        <ul>\n            <li> <span class=\"hi\">1</span> semibreve,\n                 <span class=\"hi\">2</span> minim,\n                 <span class=\"hi\">4</span> semiminim,\n                 <span class=\"hi\">8</span> fusa,\n                 <span class=\"hi\">6</span> semifusa,\n                 <span class=\"hi\">0</span> breve,\n                 <span class=\"hi\">9</span> long,\n                 <span class=\"hi\">7</span> maxima. </li>\n            <li> <i>Interleaved method</i>: type (new) rhythm before adding a note.  The default rhythm is whole note (semibreve).</li>\n            <li> <i>Second-pass method</i>: type pitches first, then select first note and type rhythms to update note rhythms.</li>\n            <li> <i>Selective second-pass method</i>: type clef, then most common rhythm, then notes, then click on notes that need rhythms to fix.  Typing rhythm number will change rhythm and advance to next note.</li>\n            <li> left/right arrow keys or tab/shift-tab moves to next/previous note/rest/clef.</li>\n        </ul>\n    </li>\n\n    <li> <b> Adding text</b>\n        <ul>\n            <li>Click on a note (or left/right arrows or tab/shift-tab to move to target note).</li>\n            <li>Type text for note, then press tab or right arrow key or click to go to next note.</li>\n            <li> <span class=\"hi2\">backspace</span> delete last letter.</li>\n            <li> <span class=\"hi2\">shift-backspace</span> deletes entire syllable.</li>\n            <li> Adding a dash at the end of text input for a note marks that this is part of a word that continues to the next note.</li>\n            <li> To correct mistyped text, click the note to highlight it and press backspace. Then type the new text that belongs to that note.</li>\n        </ul>\n    </li>\n\n    <li> <b> Repeating tenor</b>\n        <ul>\n            <li>When a staff that belongs to the tenor part is selected, the number of statements can be indicated.</li>\n            <li>If more than one tenor statement is indicated, a repeating tenor will be generated.</li>\n            <li>Where the tenor repeats from can be set after entering that element by pressing the \"Set End of Repeating Tenor\" button.\n                The ending will be highlighted in blue.\n            </li>\n            <li>If no end point is specified, the entire tenor will repeat by default.</li>\n        </ul>\n    </li>\n</ul>\n\n","import { Component, OnInit } from '@angular/core';\n\n@Component({\n  selector: 'app-score-editor-help',\n  templateUrl: './score-editor-help.component.html',\n  styleUrls: ['./score-editor-help.component.css']\n})\nexport class ScoreEditorHelpComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit(): void {\n  }\n\n}\n","<h2>About the Score Editor</h2>\n<p>\n    The <strong>Score Editor</strong> is for making simple edits\n    in order to align the parts in your score. In other words,\n    if you made mistakes in your initial entry of the music on\n    the previous screen (the <strong>Music Input</strong> screen)\n    the score will not align properly and you may need to make adjustments\n    to the note durations or add dots in order to get the proper alignment.\n</p>\n<mat-divider></mat-divider>\n<h2>Making Simple Edits</h2>\n<p>\n    When you click on a pitch, the staff to which\n    that pitch belongs will be highlighted with a\n    dashed box in the manuscript image in the left\n    of the screen. This is to help you check\n    the accuracy of the edits you make.\n</p>\n<p>\n    You can make simple edits directly as follows.\n    By clicking on a pitch to highlight it you can edit:\n</p>\n<ul>\n    <li><strong>Pitch: </strong>\n        Use up/down arrow keys to change pitch.\n    </li>\n    <li><strong>Rhythm: </strong>\n        Type a number key to alter its rhythm\n        (1 semibreve, 2 minim, 4 semiminim,\n        8 fusa, 6 semifusa, 0 breve, 9 long, 7 maxima).\n        Scoring-up will rerun after a rhythmic value changes.\n    </li>\n    <li><strong>Dots: </strong>\n        Typing a period will add or remove the dot from the\n        highlighted pitch. Scoring-up will automatically\n        rerun.\n    </li>\n    <li><strong>Accidentals: </strong>\n        To add a flat, press <code>-</code>.\n        To add a sharp, press <code>#</code>.\n        To add a natural, press <code>n</code>.\n        To clear accidentals, press <code>N</code>.\n    </li>\n    <li><strong>Cloning and Deleting Elements: </strong>\n        Elements can be cloned by selecting one and pressing the\n        <code>I</code> key. Elements can be deleted by pressing\n        <code>Backspace</code>.\n    </li>\n</ul>\n<p>\n    You can also use the \"Return to Music Input\" button to return\n    to the <strong>Music Input</strong> screen\n    and make more significant edits, but any changes made\n    in the <strong>Score Editor</strong> thus far will be lost!\n</p>\n<mat-divider></mat-divider>\n<h2>Moving to Editorial Mode</h2>\n<p>\n    When making corrections in the <strong>Score Editor</strong>\n    it is assumed that you are correcting mistakes <em>you</em>\n    made, and both the MEI Parts and MEI Score files will be updated\n    with these changes. However, once you move to <strong>Editorial Mode</strong>,\n    the MEI Parts file will no longer be updated since this is a record\n    of the music <em>exactly</em> as it was recorded in the original\n    manuscript. Any further corrections made in <strong>Editorial\n    Mode</strong> will be encoded in the MEI Score file as\n    <strong>editorial</strong> corrections. For example, when a\n    dot is added in <strong>Editorial Mode</strong>:\n</p>\n<pre><code>\n    &lt;choice&gt;\n        &lt;corr&gt;\n            &lt;note dur=&quot;semibrevis&quot; oct=&quot;3&quot; pname=&quot;a&quot; dur.quality=&quot;minor&quot;/&gt;\n            &lt;dot form=&quot;div&quot;/&gt;\n        &lt;/corr&gt;\n        &lt;sic&gt;\n            &lt;note dur=&quot;semibrevis&quot; oct=&quot;3&quot; pname=&quot;a&quot;/&gt;\n        &lt;/sic&gt;\n    &lt;/choice&gt;\n</code></pre>\n<mat-divider></mat-divider>\n<p>\n    The purpose of the <strong>Score Editor</strong> is to do enough editing to\n    enable the correct alignment of the score and edit while\n    viewing the manuscript. For more fine-grained editing,\n    it is recommended to download the MEI file and open it\n    in a tool that allows direct editing of the MEI file such\n    as <a href=\"https://verovio.humdrum.org\" target=\"_blank\">\n    the Verovio Humdrum Viewer</a> or <a href=\"https://editor.verovio.org\"\n    target=\"_blank\">the Verovio Editor</a>.\n</p>\n","import { Component, OnInit } from '@angular/core';\nimport { StateService } from '../../state-service.service';\nimport { MatDialog } from '@angular/material/dialog';\nimport { System } from '../../utils/system';\nimport { InputService } from '../input.service';\n\nimport * as vkbeautify from 'vkbeautify';\n\n@Component({\n  selector: 'app-toolbar',\n  templateUrl: './toolbar.component.html',\n  styleUrls: ['./toolbar.component.css']\n})\nexport class ToolbarComponent implements OnInit {\n  currentStaff: System;\n\n  constructor(\n    private selectedSystem: InputService,\n    private stateService: StateService,\n    public dialog: MatDialog\n  ) { }\n\n  ngOnInit() {\n    this.selectedSystem.subscribe(system => {\n      this.currentStaff = system;\n    });\n  }\n\n  saveClick(evt: MouseEvent) {\n    let target = evt.target as HTMLAnchorElement;\n    const mei = this.stateService.mei.generateXML();\n    const serializer = new XMLSerializer();\n    const temp = serializer.serializeToString(mei);\n    const content = vkbeautify.xml(\n      \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" +\n      \"<?xml-model href=\\\"https://music-encoding.org/schema/dev/mei-Mensural.rng\\\"\" +\n      \" type=\\\"application/xml\\\" schematypens=\\\"http://relaxng.org/ns/structure/1.0\\\"?>\\n\" +\n      \"<?xml-model href=\\\"https://music-encoding.org/schema/dev/mei-Mensural.rng\\\"\" +\n      \" type=\\\"application/xml\\\" schematypens=\\\"http://purl.oclc.org/dsdl/schematron\\\"?>\\n\" +\n      temp\n    );\n    const blob = new Blob([content], {type: 'application/xml'});\n    target.setAttribute('href', window.URL.createObjectURL(blob));\n  }\n\n  saveHumdrumClick(evt: MouseEvent) {\n    let target = evt.target as HTMLAnchorElement;\n    const white = this.currentStaff.parent.parent.notationType === \"mensural.white\";\n    const content = this.currentStaff.contents.getHumdrumScore({white: white});\n    const blob = new Blob([content], {type: 'text/plain'});\n    target.setAttribute('href', window.URL.createObjectURL(blob));\n  }\n\n  deleteStaff() {\n    let system = this.currentStaff;\n    let part = system.parent;\n    part.removeSystem(system.id);\n    this.selectedSystem.next(null);\n  }\n\n}\n","<div class=\"toolbar-container\">\n    <button mat-stroked-button>\n        <a download type=\"application/xml\" (click)=\"saveClick($event)\">\n            Download MEI File\n        </a>\n    </button>\n    <button mat-stroked-button *ngIf=\"currentStaff\">\n        <a download type=\"text/plain\" (click)=\"saveHumdrumClick($event)\">\n            Download System Humdrum\n        </a>\n    </button>\n    <button mat-stroked-button *ngIf=\"currentStaff\" (click)=\"deleteStaff()\">\n        Delete Staff\n    </button>\n</div>\n","declare let verovio;\ndeclare let verovioReady: boolean;\n\nclass VrvObj {\n  vrvToolkit = null;\n  options = null;\n\n  constructor() {\n    this.options = {\n      humType: 0,\n      scale: 90,\n      spacingNonLinear: 0.35,\n      lyricSize: 3,\n      breaks: 'none',\n      choiceXPathQuery: './corr',\n    }\n  }\n\n  setup() {\n    if (!this.vrvToolkit) {\n      this.vrvToolkit = new verovio.toolkit();\n      this.vrvToolkit.setOptions(this.options);\n    }\n  }\n\n  humdrumToMEI(data: string): string {\n    this.vrvToolkit.loadData(data);\n    return this.vrvToolkit.getMEI({\n      pageNo: 0,\n      scoreBased: true\n    });\n  }\n\n  humdrumToSVG(humdrumData: string): SVGSVGElement {\n    this.vrvToolkit.loadData(humdrumData);\n    let data = this.vrvToolkit.renderToSVG(1);\n    const parser = new DOMParser();\n    return parser.parseFromString(data, 'image/svg+xml').documentElement as unknown as SVGSVGElement;\n  }\n\n  meiToSVG(meiDoc: XMLDocument): SVGSVGElement {\n    const serializer = new XMLSerializer();\n    const serializedMei = serializer.serializeToString(meiDoc);\n    const parser = new DOMParser();\n    this.vrvToolkit.loadData(serializedMei);\n    const svgRaw = this.vrvToolkit.renderToSVG(1);\n    return parser.parseFromString(svgRaw, 'image/svg+xml').documentElement as unknown as SVGSVGElement;\n  }\n}\n\nexport const vrvToolkit = new VrvObj();\n","/**\n * This component contains diva.js and has the staff bounding boxes\n * rendered over it. This is always visible.\n */\nimport { Component, OnInit, OnDestroy, Input, ViewEncapsulation, HostListener } from '@angular/core';\n\nimport { IRI, Voice } from '../../utils/definitions';\nimport { System, Pb, Sb } from '../../utils/system';\nimport { Part } from '../../utils/part';\nimport { StateService } from '../../state-service.service';\nimport { InputService } from '../input.service';\n\nimport Diva from 'diva.js';\n\n@Component({\n  selector: 'app-diva-view',\n  templateUrl: './diva-view.component.html',\n  styleUrls: ['./diva-view.component.css'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class DivaViewComponent implements OnInit, OnDestroy {\n  diva: Diva;\n  creatingStaff: boolean = false;\n  firstPoint: DOMPoint = null;\n\n  @Input() iiifManifest: IRI;\n\n  constructor (private selectedSystem: InputService, private stateService: StateService) {}\n\n  ngOnInit() {\n    this.diva = new Diva('diva-wrapper', {\n      objectData: this.iiifManifest\n    });\n\n    Diva.Events.subscribe('ActivePageDidChange', this.refreshOverlay.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('DocumentDidLoad', this.refreshOverlay.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.handleZoom.bind(this), this.diva.settings.ID);\n\n    // this.diva.disableDragScrollable();\n\n    this.selectedSystem.subscribe(() => {\n      this.refreshOverlay(this.diva.getActivePageIndex());\n    });\n  }\n\n  ngOnDestroy() {\n    this.selectedSystem.selected = null;\n    try {\n      this.diva.deactivate();\n      this.diva.destroy();\n    }\n    catch (e) {\n      console.warn(e);\n    }\n  }\n\n  @HostListener('window:keydown.shift', [])\n  handleKeydown() {\n    this.diva.disableDragScrollable();\n  }\n\n  @HostListener('window:keyup.shift', [])\n  handleKeyup() {\n    if (!this.creatingStaff) {\n      this.diva.enableDragScrollable();\n    }\n  }\n\n  clickHandler(evt: MouseEvent) {\n    const target = evt.target as Element;\n    if (target.tagName === 'rect') {\n      // Unselect previously selected staff.\n      Array.from(document.getElementsByClassName(\"selectedZone\"))\n        .forEach(elem => {\n          elem.classList.remove(\"selectedZone\");\n        });\n\n      let staff = this.stateService.mei.getSystem(target.id);\n      if (staff !== null) {\n        this.selectedSystem.selected = staff;\n        target.classList.add(\"selectedZone\");\n      }\n    }\n  }\n\n  mousedownHandler(evt: MouseEvent) {\n    if (evt.shiftKey) {\n      this.creatingStaff = true;\n\n      const activeContainer = document.getElementById('editor-container-' + this.diva.getActivePageIndex().toString()).firstElementChild as SVGSVGElement;\n      const clientPoint = activeContainer.createSVGPoint();\n      clientPoint.x = evt.clientX;\n      clientPoint.y = evt.clientY;\n\n      const transformMatrix = activeContainer.getScreenCTM();\n      this.firstPoint = clientPoint.matrixTransform(transformMatrix.inverse());\n\n      // Create the initial drawing rect\n      let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n      rect.setAttribute('x', this.firstPoint.x.toString());\n      rect.setAttribute('y', this.firstPoint.y.toString());\n      rect.setAttribute('width', '0');\n      rect.setAttribute('height', '0');\n      rect.classList.add(\"zoneRect\");\n      rect.id = 'drawing-rect';\n\n      activeContainer.appendChild(rect);\n    }\n  }\n\n  mousemoveHandler(evt: MouseEvent) {\n    if (this.creatingStaff) {\n      const drawingRect = document.getElementById('drawing-rect') as unknown as SVGRectElement;\n      if (drawingRect !== null) {\n        const container = drawingRect.viewportElement as SVGSVGElement;\n        const currentPoint = container.createSVGPoint();\n        currentPoint.x = evt.clientX;\n        currentPoint.y = evt.clientY;\n\n        const transformedPoint = currentPoint.matrixTransform(\n          container.getScreenCTM().inverse()\n        );\n\n        drawingRect.setAttribute('x', Math.min(transformedPoint.x, this.firstPoint.x).toString());\n        drawingRect.setAttribute('y', Math.min(transformedPoint.y, this.firstPoint.y).toString());\n\n        drawingRect.setAttribute('width', Math.abs(transformedPoint.x - this.firstPoint.x).toString());\n        drawingRect.setAttribute('height', Math.abs(transformedPoint.y - this.firstPoint.y).toString());\n      }\n    }\n  }\n\n  mouseupHandler(evt: MouseEvent) {\n    if (this.creatingStaff) {\n      this.diva.enableDragScrollable();\n      this.creatingStaff = false;\n\n      const pageIndex = this.diva.getActivePageIndex();\n\n      const activeContainer = document.getElementById('editor-container-' + pageIndex.toString()).firstElementChild as SVGSVGElement;\n      const clientPoint = activeContainer.createSVGPoint();\n      clientPoint.x = evt.clientX;\n      clientPoint.y = evt.clientY;\n\n      const transformMatrix = activeContainer.getScreenCTM();\n      const secondPoint = clientPoint.matrixTransform(transformMatrix.inverse());\n\n      // Get Pb element if one exists\n      let pb = this.stateService.mei.getPb(pageIndex);\n      if (pb === null) {\n        // Make new Pb\n        pb = new Pb(this.diva.getCurrentCanvas());\n        pb.index = pageIndex;\n      }\n\n      // Create sb\n      let sb = new Sb(\n        {\n          ulx: Math.min(this.firstPoint.x, secondPoint.x),\n          uly: Math.min(this.firstPoint.y, secondPoint.y),\n          lrx: Math.max(secondPoint.x, this.firstPoint.x),\n          lry: Math.max(secondPoint.y, this.firstPoint.y),\n        }\n      );\n\n      // Determine Part\n      let part: Part;\n      if (this.selectedSystem.selected !== null) {\n        part = this.selectedSystem.selected.parent;\n      } else {\n        part = this.stateService.mei.getOrCreatePart(Voice.triplum);\n      }\n\n      const newSystem = new System();\n      newSystem.pb = pb;\n      newSystem.sb = sb;\n      part.addSystem(newSystem);\n\n      // Mark as selected\n      this.selectedSystem.selected = newSystem;\n\n      // Clean up\n      this.refreshOverlay(pageIndex);\n      this.firstPoint = null;\n    }\n  }\n\n  refreshOverlay(pageIndex: number): void {\n    // Get some features from the diva viewer\n    const inner = this.diva.settings.innerElement;\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(pageIndex);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(\n      pageIndex,\n      {\n        includePadding: true,\n        incorporateViewport: true\n      }\n    );\n    const marginLeft = getComputedStyle(inner, null).getPropertyValue('margin-left');\n\n    // Check if we have a div for this page. Otherwise create one.\n    let pageContainer = document.getElementById('editor-container-' + pageIndex.toString());\n    if (pageContainer === null) {\n      //pageContainer = document.createElement('div');\n      pageContainer = document.createElement('div');\n      pageContainer.id = 'editor-container-' + pageIndex.toString();\n      pageContainer.classList.add('editor-container'); // For future use\n      inner.appendChild(pageContainer); // Add the container to the DOM\n    }\n\n    // Create SVG container\n    const svgParent = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    const maxZoom = this.diva.getPageDimensionsAtZoomLevel(pageIndex, Number.MAX_SAFE_INTEGER)\n    svgParent.setAttribute('width', dimensions.width.toString());\n    svgParent.setAttribute('height', dimensions.height.toString());\n    svgParent.setAttribute('viewBox', '0 0 ' + maxZoom.width + ' ' + maxZoom.height);\n\n    pageContainer.style.position = 'absolute';\n    pageContainer.style.top = `${offset.top}px`;\n    pageContainer.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    while (pageContainer.firstChild !== null) {\n      pageContainer.firstChild.remove();\n    }\n\n    let systemsOnPage = this.stateService.mei.getSystems().filter(system => {\n      return system.pb.index === pageIndex;\n    });\n\n    for (const staff of systemsOnPage) {\n      let item = staff.sb.svg;\n      svgParent.appendChild(item);\n      if (this.selectedSystem.selected === staff) {\n        item.classList.add(\"selectedZone\");\n      }\n    }\n\n    pageContainer.appendChild(svgParent);\n  }\n\n  handleZoom(): void {\n    (new Promise(resolve => {\n      Array.from(document.getElementsByClassName('editor-container'))\n        .forEach((elem: HTMLElement) => { elem.style.display = 'none'; });\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.refreshOverlay(this.diva.getActivePageIndex());\n      Array.from(document.getElementsByClassName('editor-container'))\n        .forEach((elem: HTMLElement) => {\n          elem.style.display = '';\n        });\n    });\n  }\n}\n","<div id=\"diva-wrapper\"\n    (mousedown)=\"mousedownHandler($event)\"\n    (mousemove)=\"mousemoveHandler($event)\"\n    (click)=\"clickHandler($event)\"\n    (mouseup)=\"mouseupHandler($event)\">\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport * as vkbeautify from 'vkbeautify';\n\nimport { StateService } from '../../state-service.service';\nimport { DocService } from '../doc.service';\n\n@Component({\n  selector: 'app-score-toolbar',\n  templateUrl: './score-toolbar.component.html',\n  styleUrls: ['./score-toolbar.component.css']\n})\nexport class ScoreToolbarComponent implements OnInit {\n\n  currentDoc: XMLDocument = null;\n\n  constructor(public stateService: StateService,\n    private route: ActivatedRoute,\n    private router: Router,\n    private doc: DocService\n  ) { }\n\n  ngOnInit() {\n    this.doc._scoreSubject.subscribe((doc) => {\n      this.currentDoc = doc;\n    });\n  }\n\n  saveClick(event: MouseEvent) {\n    if (this.currentDoc !== null) {\n      const target = event.target as HTMLAnchorElement;\n      const serializer = new XMLSerializer();\n      const temp = serializer.serializeToString(this.currentDoc);\n      const content = vkbeautify.xml(\n        \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" +\n        \"<?xml-model href=\\\"https://music-encoding.org/schema/dev/mei-Mensural.rng\\\"\" +\n        \" type=\\\"application/xml\\\" schematypens=\\\"http://relaxng.org/ns/structure/1.0\\\"?>\\n\" +\n        \"<?xml-model href=\\\"https://music-encoding.org/schema/dev/mei-Mensural.rng\\\"\" +\n        \" type=\\\"application/xml\\\" schematypens=\\\"http://purl.oclc.org/dsdl/schematron\\\"?>\\n\" +\n        temp\n      );\n      const blob = new Blob([content], {type: 'application/xml'});\n      target.setAttribute('href', URL.createObjectURL(blob));\n    }\n  }\n\n  savePartsClick(event: MouseEvent) {\n    if (this.stateService.mei != null) {\n      const target = event.target as HTMLAnchorElement;\n      const serializer = new XMLSerializer();\n      const temp = serializer.serializeToString(this.doc.parts);\n      const content = vkbeautify.xml(\n        \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" +\n        \"<?xml-model href=\\\"https://music-encoding.org/schema/dev/mei-Mensural.rng\\\"\" +\n        \" type=\\\"application/xml\\\" schematypens=\\\"http://relaxng.org/ns/structure/1.0\\\"?>\\n\" +\n        \"<?xml-model href=\\\"https://music-encoding.org/schema/dev/mei-Mensural.rng\\\"\" +\n        \" type=\\\"application/xml\\\" schematypens=\\\"http://purl.oclc.org/dsdl/schematron\\\"?>\\n\" +\n        temp\n      );\n      const blob = new Blob([content], {type: 'application/xml'});\n      target.setAttribute('href', URL.createObjectURL(blob));\n    }\n  }\n\n  goToInputEditor() {\n    if (confirm(\"Warning: Edits made on this page will be lost. Return to input editor?\")) {\n      let source = this.route.snapshot.paramMap.get('source');\n      let identifier = this.route.snapshot.paramMap.get('identifier');\n      this.router.navigate(['/input', source, identifier]);\n    }\n  }\n\n  copyToClipboard() {\n    if (this.currentDoc !== null) {\n      const serializer = new XMLSerializer();\n      const content = vkbeautify.xml(serializer.serializeToString(this.currentDoc));\n      navigator.clipboard.writeText(content).then(() => { alert(\"MEI Score Copied!\"); }).catch(err => { console.debug(err); alert(\"Copy failed :(\"); });\n    }\n  }\n\n}\n","<div class=\"toolbar-container\">\n    <button mat-stroked-button (click)=\"goToInputEditor()\">\n        Return to Music Input\n    </button>\n    <button mat-stroked-button>\n        <a download type=\"application/xml\" (click)=\"saveClick($event)\">\n            Download MEI Score\n        </a>\n    </button>\n    <button mat-stroked-button>\n        <a download type=\"application/xml\" (click)=\"savePartsClick($event)\">\n            Download MEI Parts\n        </a>\n    </button>\n    <button mat-stroked-button (click)=\"copyToClipboard()\">\n        Copy MEI Score to Clipboard\n    </button>\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { FormGroup, FormArray, FormControl, Validators } from '@angular/forms';\n\nimport { Contributor, IRI } from '../utils/definitions';\nimport { MEIDocument } from '../utils/mei';\nimport { formIIIFManifest } from '../tools';\nimport { StateService } from '../state-service.service';\n\n@Component({\n  selector: 'app-input',\n  templateUrl: './input.component.html',\n  styleUrls: ['./input.component.css']\n})\nexport class InputComponent implements OnInit {\n  iiifManifest: IRI;\n\n  // Metadata for MEI header\n  metadataForm = new FormGroup({\n    shortTitle: new FormControl('', [Validators.required]),\n    composerName: new FormControl('', [Validators.required]),\n    contributors: new FormArray([]),\n    notationSubtype: new FormControl('', [Validators.required]),\n    siglum: new FormControl('', [Validators.required]),\n    genre: new FormControl('', [Validators.required]),\n  });\n\n  temp: FormArray;\n\n  inputStep: InputComponent.InputStep;\n\n  source: string;\n  identifier: string;\n\n  constructor(\n    private stateService: StateService,\n    private route: ActivatedRoute,\n  ) {\n    this.inputStep = InputComponent.InputStep.METADATA;\n    this.source = this.route.snapshot.paramMap.get('source');\n    this.identifier = decodeURIComponent(this.route.snapshot.paramMap.get('identifier'));\n    this.iiifManifest = formIIIFManifest(this.source, this.identifier);\n\n    if (!this.stateService.mei) {\n      this.stateService.mei = new MEIDocument(this.iiifManifest);\n    }\n\n    if (this.stateService.mei.metadata != undefined) {\n      this.metadataForm.controls.shortTitle.setValue(this.stateService.mei.metadata.shortTitle);\n      this.metadataForm.controls.composerName.setValue(this.stateService.mei.metadata.composerName);\n      this.metadataForm.controls.notationSubtype.setValue(this.stateService.mei.notationSubtype);\n      this.metadataForm.controls.siglum.setValue(this.stateService.mei.metadata.siglum);\n      this.metadataForm.controls.genre.setValue(this.stateService.mei.metadata.genre);\n      let contributors = this.metadataForm.get('contributors') as FormArray;\n      for (let contributor of this.stateService.mei.metadata.contributors) {\n        let temp = new FormGroup({\n          type: new FormControl(contributor.type, Validators.required),\n          name: new FormControl(contributor.name, Validators.required),\n        });\n        contributors.push(temp);\n      }\n    }\n\n    this.temp = this.metadataForm.get('contributors') as FormArray;\n    console.debug(this.iiifManifest);\n    console.debug(this.metadataForm.controls.contributors);\n  }\n\n  ngOnInit() {\n    this.stateService.editorialMode = false;\n  }\n\n  onSetMetadata() {\n    let value = this.metadataForm.value;\n\n    this.stateService.mei.metadata = {\n      shortTitle: value.shortTitle,\n      composerName: value.composerName,\n      contributors: value.contributors.filter(entry => {\n        return (entry.type.length > 0) && (entry.name.length > 0);\n      }).map(entry => {\n        return entry as Contributor;\n      }),\n      sourceIRI: this.iiifManifest,\n      siglum: value.siglum,\n      genre: value.genre,\n    };\n    this.stateService.mei.notationSubtype = value.notationSubtype;\n    this.inputStep = InputComponent.InputStep.INPUT;\n  }\n\n  addContributor() {\n    this.temp.push(\n      new FormGroup({\n        type: new FormControl('', [Validators.required]),\n        name: new FormControl('', [Validators.required]),\n      })\n    )\n  }\n\n  removeContributor(index: number) {\n    this.temp.removeAt(index);\n  }\n}\n\nexport namespace InputComponent {\n  export enum InputStep {\n    METADATA,\n    INPUT\n  }\n}\n","<div id=\"editor-container\">\n    <app-diva-view [iiifManifest]=\"iiifManifest\"></app-diva-view>\n    <div id=\"right-side\">\n        <mat-tab-group>\n            <mat-tab label=\"Metadata Input\" *ngIf=\"inputStep === 0\">\n                <form *ngIf=\"inputStep===0\" [formGroup]=\"metadataForm\" (submit)=\"onSetMetadata()\">\n                    <h1 id=\"metadata-header\">Enter Metadata</h1>\n                    <label class=\"metadataInput\">Short title:&nbsp;\n                        <input id=\"shortTitle\" formControlName=\"shortTitle\" required/>\n                    </label><br>\n                    <label class=\"metadataInput\">Composer name:&nbsp;\n                        <input id=\"composerName\" formControlName=\"composerName\" required/>\n                    </label><br>\n                    <label class=\"metadataInput\">Notation:&nbsp;\n                        <select id=\"notationSubtype\" formControlName=\"notationSubtype\" required>\n                            <option value=\"Ars_antiqua\">Black Mensural &mdash; Ars antiqua</option>\n                            <option value=\"Ars_nova\">Black Mensural &mdash; Ars nova</option>\n                            <option value=\"\">White Mensural</option>\n                        </select>\n                    </label><br>\n                    <label class=\"metadataInput\">Manuscript Siglum:&nbsp;\n                        <input id=\"siglum\" formControlName=\"siglum\" required/>\n                    </label><br>\n                    <label class=\"metadataInput\">Genre:&nbsp;\n                        <select id=\"genre\" formControlName=\"genre\" required>\n                            <option value=\"Motet\">Motet</option>\n                            <option value=\"Song\">Song</option>\n                            <option value=\"Conductus\">Conductus</option>\n                            <option value=\"Mass Movement\">Mass Movement</option>\n                            <option value=\"Plainchant\">Plainchant</option>\n                        </select>\n                    </label><br>\n                    <div *ngFor=\"let contributor of temp.controls; let i = index\">\n                        <ng-container [formGroup]=\"contributor\">\n                          <label class=\"contributor\">Contributor:&nbsp;\n                            <select formControlName=\"type\" required>\n                                <option value=\"encoder\">Encoder</option>\n                                <option value=\"proofreader\">Proofreader</option>\n                                <option value=\"editor\">Editor</option>\n                            </select>\n                            <input formControlName=\"name\" required/>\n                          </label>\n                          &nbsp;\n                          <button color=secondary class=\"secondary-button\" mat-stroked-button type=\"button\" (click)=\"removeContributor(i)\">Remove</button>\n                        </ng-container>\n                    </div>\n                    <div>\n                      <button color=primary class=\"primary-button\" mat-stroked-button type=\"button\" (click)=\"addContributor()\">Add Contributor</button>\n                    </div>\n                    <br>\n                    <button color=primary class=\"primary-button\" mat-stroked-button type=\"submit\">Continue to Music Input</button>\n                </form>\n            </mat-tab>\n            <mat-tab label=\"Music Input\" *ngIf=\"inputStep === 1\">\n                <mat-divider></mat-divider>\n                <app-toolbar *ngIf=\"inputStep===1\"></app-toolbar>\n                <mat-divider></mat-divider>\n                <app-staff-select *ngIf=\"inputStep===1\"></app-staff-select>\n            </mat-tab>\n            <mat-tab label=\"General Help\">\n                <app-general-help></app-general-help>\n            </mat-tab>\n            <mat-tab label=\"Music Input Help\">\n                <app-music-input-help></app-music-input-help>\n            </mat-tab>\n        </mat-tab-group>\n    </div>\n</div>\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\ndeclare let verovioReady: boolean;\n\nif (environment.production) {\n  enableProdMode();\n}\n\ninit().then( () => {\n  platformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err))\n});\n\nasync function init() {\n  console.debug('check');\n  while (!verovioReady) {\n    console.debug('wait');\n    await new Promise(r => { setTimeout(r, 250); });\n  }\n  console.debug('done');\n}\n","function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"zn8P\";"]}