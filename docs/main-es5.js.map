{"version":3,"sources":["webpack:///$_lazy_route_resource lazy namespace object","webpack:///src/app/app.component.ts","webpack:///src/app/app.component.html","webpack:///src/app/app.module.ts","webpack:///src/app/input/diva-view/diva-view.component.ts","webpack:///src/app/input/diva-view/diva-view.component.html","webpack:///src/app/input/input.component.ts","webpack:///src/app/input/input.component.html","webpack:///src/app/input/input.module.ts","webpack:///src/app/input/input.service.ts","webpack:///src/app/input/staff-select/staff-select.component.ts","webpack:///src/app/input/staff-select/staff-select.component.html","webpack:///src/app/input/toolbar/toolbar.component.ts","webpack:///src/app/input/toolbar/toolbar.component.html","webpack:///src/app/score-editor/doc.service.ts","webpack:///src/app/score-editor/score-diva-view/score-diva-view.component.ts","webpack:///src/app/score-editor/score-diva-view/score-diva-view.component.html","webpack:///src/app/score-editor/score-editor.component.ts","webpack:///src/app/score-editor/score-editor.component.html","webpack:///src/app/score-editor/score-editor.module.ts","webpack:///src/app/score-editor/score-toolbar/score-toolbar.component.ts","webpack:///src/app/score-editor/score-toolbar/score-toolbar.component.html","webpack:///src/app/score-editor/score-verovio-view/score-verovio-view.component.ts","webpack:///src/app/score-editor/score-verovio-view/score-verovio-view.component.html","webpack:///src/app/score-editor/selected-staff.service.ts","webpack:///src/app/select-document/select-document.component.ts","webpack:///src/app/select-document/select-document.component.html","webpack:///src/app/state-service.service.ts","webpack:///src/app/tools.ts","webpack:///src/app/utils/MusicItem.ts","webpack:///src/app/utils/definitions.ts","webpack:///src/app/utils/mei.ts","webpack:///src/app/utils/part.ts","webpack:///src/app/utils/system.ts","webpack:///src/app/utils/verovio.ts","webpack:///src/environments/environment.ts","webpack:///src/main.ts"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","module","exports","id","AppComponent","setup","selector","templateUrl","styleUrls","routes","path","component","pathMatch","AppModule","forRoot","useHash","declarations","imports","providers","bootstrap","DivaViewComponent","selectedSystem","stateService","creatingStaff","firstPoint","diva","objectData","iiifManifest","Events","subscribe","refreshOverlay","bind","settings","ID","handleZoom","getActivePageIndex","selected","deactivate","destroy","console","warn","disableDragScrollable","enableDragScrollable","evt","target","tagName","Array","from","document","getElementsByClassName","forEach","elem","classList","remove","staff","mei","getSystem","add","shiftKey","activeContainer","getElementById","toString","firstElementChild","clientPoint","createSVGPoint","x","clientX","y","clientY","transformMatrix","getScreenCTM","matrixTransform","inverse","rect","createElementNS","setAttribute","appendChild","drawingRect","container","viewportElement","currentPoint","transformedPoint","Math","min","abs","pageIndex","secondPoint","pb","getPb","getCurrentCanvas","index","sb","ulx","uly","lrx","max","lry","part","parent","getOrCreatePart","triplum","newSystem","addSystem","inner","innerElement","dimensions","getPageDimensionsAtCurrentZoomLevel","offset","viewHandler","_viewerCore","getPageRegion","includePadding","incorporateViewport","marginLeft","getComputedStyle","getPropertyValue","pageContainer","createElement","svgParent","maxZoom","getPageDimensionsAtZoomLevel","Number","MAX_SAFE_INTEGER","width","height","style","position","top","left","parseInt","firstChild","systemsOnPage","getSystems","filter","system","item","svg","display","setTimeout","zoomDuration","mousedownHandler","mousemoveHandler","clickHandler","mouseupHandler","encapsulation","None","InputComponent","route","shortTitle","composerName","userName","notationSubtype","inputStep","InputStep","METADATA","source","snapshot","paramMap","get","identifier","decodeURIComponent","metadata","undefined","encoderName","debug","editorialMode","sourceIRI","INPUT","InputModule","InputService","_selected","next","providedIn","StaffSelectComponent","router","voices","Object","entries","keySigMode","pitchSig","accidSig","staffForm","voice","modus","tempus","prolatio","mensurForm","modus2","tempus2","prolatio2","nativeElement","innerHTML","element","humdrumToSVG","contents","getHumdrumScore","white","notationType","test","tenor","endingId","endNote","event","nodeName","matches","match","selectItemByLine","updateSVG","parentNode","type","navigate","getPart","layer","querySelector","lastElementChild","regexpInfo","line","m_list","el","m_line","m_id","handleKeySigPress","preventDefault","metaKey","musicList","m_index","key","length","processDigit","state","addTextToCurrentItem","clearTextOnCurrentItem","deleteCharacterOnCurrentItem","removeLastItem","addPitchFar","C","addPitchNear","D","E","F","G","A","B","hasOpenLigature","addMensur","processPlica","addRest","alert","processDotKey","selectBackward","selectForward","raisePitch","lowerPitch","goToEndOfList","processLig","processAccidental","digit","_event","m_rhythm","ending","m_type","runNotationCallback","note","m_dot","isStart","m_lig","START","NONE","END","m_plica","DOWN","UP","processKeySig","accid","m_accid","SHARP","FLAT","NATURAL","handleClick","ToolbarComponent","dialog","currentStaff","generateXML","serializer","XMLSerializer","content","serializeToString","blob","Blob","window","URL","createObjectURL","removeSystem","saveClick","DocService","_parts","_score","_partsSubject","_scoreSubject","doc","ScoreDivaViewComponent","staffService","pageToCanvasMap","Map","parseCanvases","getStaffLocation","iri","bbox","redraw","getCurrentPageIndices","includes","gotoPageByIndex","manifest","sequences","sequence","canvases","canvas","set","indexOf","ScoreEditorComponent","meiDoc","ScoreEditorModule","ScoreToolbarComponent","currentDoc","refinedDoc","cloneNode","scoreOptions","modernClefs","barlines","parts","confirm","navigator","clipboard","writeText","err","goToInputEditor","savePartsClick","copyToClipboard","pnameOrder","recurseXmlId","hasAttribute","i","children","ScoreVerovioViewComponent","selectedId","corrToSicMap","meiToSVG","setSelected","_e","partsId","has","resolver","createNSResolver","ownerDocument","documentElement","meiRes","ref","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","result","ORDERED_NODE_SNAPSHOT_TYPE","snapshotItem","snapshotLength","pbFacsId","getAttribute","substring","sbFacsId","pbGraphic","getElementsByTagName","pop","sbZone","staffLocation","score","runScoringUp","contains","parentElement","ensureCorrElement","sibling","nextElementSibling","nextSibling","dot","insertAdjacentElement","currentPname","idx","removeAttribute","clone","cloneDot","output","staffDef","quasiDoc","lining_up","replace_ligatures_by_brackets","error","closest","choice","corr","sic","corrTarget","sibCorr","SelectedStaffService","_staffLoc","loc","SelectDocumentComponent","file","invalid","selectionForm","required","resourceURL","url","loadMEIForm","fileInput","controls","value","encodeURIComponent","reader","FileReader","addEventListener","rawText","parser","DOMParser","parseFromString","fromXML","iiif","readAsText","submit","meiSubmit","onFileChange","StateService","formIIIFManifest","gallicaRegexp","RegExp","gallicaIIIFRegexp","ecodicesRegexp","ecodicesIIIFRegexp","genericIIIFRegexp","parseRhythm","rhythm","val","PitchClass","Accid","LigStatus","PlicaStatus","ClefItem","m_pname","m_clefLine","m_keySig","size","pitch","clef","RestItem","options","rest","MensurItem","m_modus","NA","m_tempus","m_prolatio","Two","Three","mensur","NoteItem","m_oct","m_text","amount","pname","toUpperCase","syl","textContent","MusicList","m_notationCallback","dpc","push","addClef","ln","getLastNote","oct","candidate","best","newnote","open","text","opts","lines","noteCounter","restCounter","hyphen","getHumdrumLine","output2","lineNumber","first","Voice","voiceToOrdinal","v","altus","cantus","contratenor","contratenor1","contratenor2","discantus","duplum","lowervoice1","lowervoice2","motetus","quadruplum","quintus","superius","uppervoice1","uppervoice2","bassus","Mensuration","Staff","staffA","staffB","indexDiff","NAMESPACE","MEIDocument","manuscriptIRI","Metadata","_createSkeletonMEI","_meiDoc","sort","compare","systems","partElement","generatePartXML","implementation","createDocument","head","_generateHeader","music","facsimile","body","mdiv","meiHead","fileDesc","titleStmt","title","composer","respStmt","persName","pubStmt","sourceDesc","allSystems","unshift","systemList","partlist","some","pbs","Set","values","sourceElement","surfaces","querySelectorAll","zones","assert","partObj","dir","tenorObj","repetitions","matchResults","layerChildren","activePb","activeSystem","child","setIndex","fetch","response","json","findIndex","canvasIRI","facs","split","surface","find","graphic","zone","parseXML","Part","removed","splice","scoreDef","_generateScoreDef","section","currentPage","getContents","temp","zoneId","round","staffGrp","a","b","Tenor","firstNoteId","endItem","insertAdjacentHTML","Pb","Sb","System","whiteMensural","rawMei","humdrumToMEI","elements","humdrumMei","_recurseId","found","newPart","diff","aZone","bZone","threshold","diff1","diff2","overlap","avHeight","VrvObj","vrvToolkit","humType","scale","spacingNonLinear","lyricSize","breaks","choiceXPathQuery","verovio","toolkit","setOptions","data","loadData","getMEI","pageNo","scoreBased","humdrumData","renderToSVG","serializedMei","svgRaw","environment","production","init","bootstrapModule","verovioReady","r"],"mappings":"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","file":"main-es5.js","sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"./$$_lazy_route_resource lazy recursive\";","import { Component } from '@angular/core';\nimport { vrvToolkit } from './utils/verovio';\n\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\nexport class AppComponent {\n  constructor() {\n    vrvToolkit.setup();\n  }\n}\n","<!-- Navigation -->\n<nav class=\"navbar navbar-expand-lg navbar-light\" id=\"mainNav\">\n    <a class=\"navbar-brand\" routerLink=\"/\">\n       <img src=\"assets/img/thumbnail.png\" id=\"thumbnail\">\n       <div id=\"navTitle\">Measuring Polyphony</div>\n       <div id=\"navDescription\">Digital encodings of late medieval music</div>\n       <div class=\"clearfix\"></div>\n    </a>\n    <div id=\"transcriptionDiv\">\n        <a href=\"./\">\n            <button color=primary class=\"primary-button\" id=\"new-transcription-button\" mat-stroked-button>\n                Start a New Transcription\n            </button>\n        </a>\n    </div>\n</nav>\n\n<router-outlet></router-outlet>\n","import { BrowserModule } from '@angular/platform-browser';\nimport { NgModule } from '@angular/core';\nimport { ReactiveFormsModule, FormsModule } from '@angular/forms';\nimport { RouterModule, Routes } from '@angular/router';\n\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { InputModule } from './input/input.module';\nimport { InputComponent } from './input/input.component';\n\nimport { AppComponent } from './app.component';\nimport { SelectDocumentComponent } from './select-document/select-document.component';\nimport { ScoreEditorModule } from './score-editor/score-editor.module';\nimport { ScoreEditorComponent } from './score-editor/score-editor.component';\n\nconst routes: Routes = [\n  {\n    path: 'input/:source/:identifier',\n    component: InputComponent\n  },\n  {\n    path: 'score/:source/:identifier',\n    component: ScoreEditorComponent\n  },\n  {\n    path: '',\n    // redirectTo: '/input/gallica/12148%2Fbtv1b8454675g',\n    component: SelectDocumentComponent,\n    pathMatch: 'full'\n  }\n]\n\n@NgModule({\n  declarations: [\n    AppComponent,\n    SelectDocumentComponent\n  ],\n  imports: [\n    RouterModule.forRoot(\n      routes,\n      { useHash: true }\n      //{ enableTracing: true }\n    ),\n    BrowserModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatTabsModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    InputModule,\n    ScoreEditorModule\n  ],\n  providers: [],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n","/**\n * This component contains diva.js and has the staff bounding boxes\n * rendered over it. This is always visible.\n */\nimport { Component, OnInit, OnDestroy, Input, ViewEncapsulation, HostListener } from '@angular/core';\n\nimport { IRI, Voice } from '../../utils/definitions';\nimport { System, Pb, Sb } from '../../utils/system';\nimport { Part } from '../../utils/part';\nimport { StateService } from '../../state-service.service';\nimport { InputService } from '../input.service';\n\nimport Diva from 'diva.js';\n\n@Component({\n  selector: 'app-diva-view',\n  templateUrl: './diva-view.component.html',\n  styleUrls: ['./diva-view.component.css'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class DivaViewComponent implements OnInit, OnDestroy {\n  diva: Diva;\n  creatingStaff: boolean = false;\n  firstPoint: DOMPoint = null;\n\n  @Input() iiifManifest: IRI;\n\n  constructor (private selectedSystem: InputService, private stateService: StateService) {}\n\n  ngOnInit() {\n    this.diva = new Diva('diva-wrapper', {\n      objectData: this.iiifManifest\n    });\n\n    Diva.Events.subscribe('ActivePageDidChange', this.refreshOverlay.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('DocumentDidLoad', this.refreshOverlay.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.handleZoom.bind(this), this.diva.settings.ID);\n\n    // this.diva.disableDragScrollable();\n\n    this.selectedSystem.subscribe(() => {\n      this.refreshOverlay(this.diva.getActivePageIndex());\n    });\n  }\n\n  ngOnDestroy() {\n    this.selectedSystem.selected = null;\n    try {\n      this.diva.deactivate();\n      this.diva.destroy();\n    }\n    catch (e) {\n      console.warn(e);\n    }\n  }\n\n  @HostListener('window:keydown.shift', [])\n  handleKeydown() {\n    this.diva.disableDragScrollable();\n  }\n\n  @HostListener('window:keyup.shift', [])\n  handleKeyup() {\n    if (!this.creatingStaff) {\n      this.diva.enableDragScrollable();\n    }\n  }\n\n  clickHandler(evt: MouseEvent) {\n    const target = evt.target as Element;\n    if (target.tagName === 'rect') {\n      // Unselect previously selected staff.\n      Array.from(document.getElementsByClassName(\"selectedZone\"))\n        .forEach(elem => {\n          elem.classList.remove(\"selectedZone\");\n        });\n\n      let staff = this.stateService.mei.getSystem(target.id);\n      if (staff !== null) {\n        this.selectedSystem.selected = staff;\n        target.classList.add(\"selectedZone\");\n      }\n    }\n  }\n\n  mousedownHandler(evt: MouseEvent) {\n    if (evt.shiftKey) {\n      this.creatingStaff = true;\n\n      const activeContainer = document.getElementById('editor-container-' + this.diva.getActivePageIndex().toString()).firstElementChild as SVGSVGElement;\n      const clientPoint = activeContainer.createSVGPoint();\n      clientPoint.x = evt.clientX;\n      clientPoint.y = evt.clientY;\n\n      const transformMatrix = activeContainer.getScreenCTM();\n      this.firstPoint = clientPoint.matrixTransform(transformMatrix.inverse());\n\n      // Create the initial drawing rect\n      let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n      rect.setAttribute('x', this.firstPoint.x.toString());\n      rect.setAttribute('y', this.firstPoint.y.toString());\n      rect.setAttribute('width', '0');\n      rect.setAttribute('height', '0');\n      rect.classList.add(\"zoneRect\");\n      rect.id = 'drawing-rect';\n\n      activeContainer.appendChild(rect);\n    }\n  }\n\n  mousemoveHandler(evt: MouseEvent) {\n    if (this.creatingStaff) {\n      const drawingRect = document.getElementById('drawing-rect') as unknown as SVGRectElement;\n      if (drawingRect !== null) {\n        const container = drawingRect.viewportElement as SVGSVGElement;\n        const currentPoint = container.createSVGPoint();\n        currentPoint.x = evt.clientX;\n        currentPoint.y = evt.clientY;\n\n        const transformedPoint = currentPoint.matrixTransform(\n          container.getScreenCTM().inverse()\n        );\n\n        drawingRect.setAttribute('x', Math.min(transformedPoint.x, this.firstPoint.x).toString());\n        drawingRect.setAttribute('y', Math.min(transformedPoint.y, this.firstPoint.y).toString());\n\n        drawingRect.setAttribute('width', Math.abs(transformedPoint.x - this.firstPoint.x).toString());\n        drawingRect.setAttribute('height', Math.abs(transformedPoint.y - this.firstPoint.y).toString());\n      }\n    }\n  }\n\n  mouseupHandler(evt: MouseEvent) {\n    if (this.creatingStaff) {\n      this.diva.enableDragScrollable();\n      this.creatingStaff = false;\n\n      const pageIndex = this.diva.getActivePageIndex();\n\n      const activeContainer = document.getElementById('editor-container-' + pageIndex.toString()).firstElementChild as SVGSVGElement;\n      const clientPoint = activeContainer.createSVGPoint();\n      clientPoint.x = evt.clientX;\n      clientPoint.y = evt.clientY;\n\n      const transformMatrix = activeContainer.getScreenCTM();\n      const secondPoint = clientPoint.matrixTransform(transformMatrix.inverse());\n\n      // Get Pb element if one exists\n      let pb = this.stateService.mei.getPb(pageIndex);\n      if (pb === null) {\n        // Make new Pb\n        pb = new Pb(this.diva.getCurrentCanvas());\n        pb.index = pageIndex;\n      }\n\n      // Create sb\n      let sb = new Sb(\n        {\n          ulx: Math.min(this.firstPoint.x, secondPoint.x),\n          uly: Math.min(this.firstPoint.y, secondPoint.y),\n          lrx: Math.max(secondPoint.x, this.firstPoint.x),\n          lry: Math.max(secondPoint.y, this.firstPoint.y),\n        }\n      );\n\n      // Determine Part\n      let part: Part;\n      if (this.selectedSystem.selected !== null) {\n        part = this.selectedSystem.selected.parent;\n      } else {\n        part = this.stateService.mei.getOrCreatePart(Voice.triplum);\n      }\n\n      const newSystem = new System();\n      newSystem.pb = pb;\n      newSystem.sb = sb;\n      part.addSystem(newSystem);\n\n      // Mark as selected\n      this.selectedSystem.selected = newSystem;\n\n      // Clean up\n      this.refreshOverlay(pageIndex);\n      this.firstPoint = null;\n    }\n  }\n\n  refreshOverlay(pageIndex: number): void {\n    // Get some features from the diva viewer\n    const inner = this.diva.settings.innerElement;\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(pageIndex);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(\n      pageIndex,\n      {\n        includePadding: true,\n        incorporateViewport: true\n      }\n    );\n    const marginLeft = getComputedStyle(inner, null).getPropertyValue('margin-left');\n\n    // Check if we have a div for this page. Otherwise create one.\n    let pageContainer = document.getElementById('editor-container-' + pageIndex.toString());\n    if (pageContainer === null) {\n      //pageContainer = document.createElement('div');\n      pageContainer = document.createElement('div');\n      pageContainer.id = 'editor-container-' + pageIndex.toString();\n      pageContainer.classList.add('editor-container'); // For future use\n      inner.appendChild(pageContainer); // Add the container to the DOM\n    }\n\n    // Create SVG container\n    const svgParent = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    const maxZoom = this.diva.getPageDimensionsAtZoomLevel(pageIndex, Number.MAX_SAFE_INTEGER)\n    svgParent.setAttribute('width', dimensions.width.toString());\n    svgParent.setAttribute('height', dimensions.height.toString());\n    svgParent.setAttribute('viewBox', '0 0 ' + maxZoom.width + ' ' + maxZoom.height);\n\n    pageContainer.style.position = 'absolute';\n    pageContainer.style.top = `${offset.top}px`;\n    pageContainer.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    while (pageContainer.firstChild !== null) {\n      pageContainer.firstChild.remove();\n    }\n\n    let systemsOnPage = this.stateService.mei.getSystems().filter(system => {\n      return system.pb.index === pageIndex;\n    });\n\n    for (const staff of systemsOnPage) {\n      let item = staff.sb.svg;\n      svgParent.appendChild(item);\n      if (this.selectedSystem.selected === staff) {\n        item.classList.add(\"selectedZone\");\n      }\n    }\n\n    pageContainer.appendChild(svgParent);\n  }\n\n  handleZoom(): void {\n    (new Promise(resolve => {\n      Array.from(document.getElementsByClassName('editor-container'))\n        .forEach((elem: HTMLElement) => { elem.style.display = 'none'; });\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.refreshOverlay(this.diva.getActivePageIndex());\n      Array.from(document.getElementsByClassName('editor-container'))\n        .forEach((elem: HTMLElement) => {\n          elem.style.display = '';\n        });\n    });\n  }\n}\n","<div id=\"diva-wrapper\"\n    (mousedown)=\"mousedownHandler($event)\"\n    (mousemove)=\"mousemoveHandler($event)\"\n    (click)=\"clickHandler($event)\"\n    (mouseup)=\"mouseupHandler($event)\">\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\n\nimport { IRI } from '../utils/definitions';\nimport { MEIDocument } from '../utils/mei';\nimport { formIIIFManifest } from '../tools';\nimport { StateService } from '../state-service.service';\n\n@Component({\n  selector: 'app-input',\n  templateUrl: './input.component.html',\n  styleUrls: ['./input.component.css']\n})\nexport class InputComponent implements OnInit {\n  iiifManifest: IRI;\n\n  // Metadata for MEI header\n  shortTitle = \"\";\n  composerName = \"\";\n  userName = \"\";\n  notationSubtype = \"\";\n\n  inputStep: InputComponent.InputStep;\n\n  source: string;\n  identifier: string;\n\n  constructor(\n    private stateService: StateService,\n    private route: ActivatedRoute,\n  ) {\n    this.inputStep = InputComponent.InputStep.METADATA;\n    this.source = this.route.snapshot.paramMap.get('source');\n    this.identifier = decodeURIComponent(this.route.snapshot.paramMap.get('identifier'));\n    this.iiifManifest = formIIIFManifest(this.source, this.identifier);\n\n    if (!this.stateService.mei) {\n      this.stateService.mei = new MEIDocument(this.iiifManifest);\n    }\n\n    if (this.stateService.mei.metadata != undefined) {\n      this.shortTitle = this.stateService.mei.metadata.shortTitle;\n      this.composerName = this.stateService.mei.metadata.composerName;\n      this.userName = this.stateService.mei.metadata.encoderName;\n      this.notationSubtype = this.stateService.mei.notationSubtype;\n    }\n\n    console.debug(this.iiifManifest);\n  }\n\n  ngOnInit() {\n    this.stateService.editorialMode = false;\n  }\n\n  onSetMetadata() {\n    this.stateService.mei.metadata = {\n      shortTitle: this.shortTitle,\n      composerName: this.composerName,\n      encoderName: this.userName,\n      sourceIRI: this.iiifManifest,\n    };\n    this.stateService.mei.notationSubtype = this.notationSubtype;\n    this.inputStep = InputComponent.InputStep.INPUT;\n  }\n}\n\nexport namespace InputComponent {\n  export enum InputStep {\n    METADATA,\n    INPUT\n  }\n}\n","<div id=\"editor-container\">\n    <app-diva-view [iiifManifest]=\"iiifManifest\"></app-diva-view>\n    <div id=\"right-side\">\n        <mat-tab-group>\n            <mat-tab label=\"Metadata Input\" *ngIf=\"inputStep === 0\">\n                <form *ngIf=\"inputStep===0\" #metadataForm=\"ngForm\" (submit)=\"onSetMetadata()\">\n                    <h1 id=\"metadata-header\">Enter Metadata</h1>\n                    <label class=\"metadataInput\">Short title:&nbsp;\n                        <input [(ngModel)]=\"shortTitle\" id=\"shortTitle\" name=\"shortTitle\"/>\n                    </label><br>\n                    <label class=\"metadataInput\">Composer name:&nbsp;\n                        <input [(ngModel)]=\"composerName\" id=\"composerName\" name=\"composerName\"/>\n                    </label><br>\n                    <label class=\"metadataInput\">Your name:&nbsp;\n                        <input [(ngModel)]=\"userName\" id=\"userName\" name=\"userName\"/>\n                    </label><br>\n                    <label class=\"metadataInput\">Notation:&nbsp;\n                        <select [(ngModel)]=\"notationSubtype\" id=\"notationSubtype\" name=\"notationSubtype\">\n                            <option value=\"Ars_antiqua\">Black Mensural &mdash; Ars antiqua</option>\n                            <option value=\"Ars_nova\">Black Mensural &mdash; Ars nova</option>\n                            <option value=\"\">White Mensural</option>\n                        </select>\n                    </label><br>\n                    <button color=primary class=\"primary-button\" mat-stroked-button type=\"submit\">Continue to Music Input</button>\n                </form>\n            </mat-tab>\n            <mat-tab label=\"Music Input\" *ngIf=\"inputStep === 1\">\n                <mat-divider></mat-divider>\n                <app-toolbar *ngIf=\"inputStep===1\"></app-toolbar>\n                <mat-divider></mat-divider>\n                <app-staff-select *ngIf=\"inputStep===1\"></app-staff-select>\n            </mat-tab>\n            <mat-tab label=\"General Help\">\n                <h2>Manuscript Navigation</h2>\n                <ul>\n                    <li>\n                        To select the page of the manuscript you want to work on,\n                        either use the scrollbar to the right of the manuscript\n                        or type the folio number in the box and click the <code>Go</code>\n                        button.\n                    </li>\n                    <li>\n                        Click the magnifying boxes for the appropriate zoom level\n                        and move around the manuscript using your mouse or the\n                        trackpad.\n                    </li>\n                </ul>\n                <mat-divider></mat-divider>\n                <h2>Metadata Entry</h2>\n                <p>\n                    First enter basic metadata about the document.\n                    This includes the name of the work, composer name,\n                    and your name. If there is something you don't know,\n                    you can leave it as is and continue.\n                    <br>\n                    Metadata must be entered before staff input can fully begin.\n                </p>\n                <mat-divider></mat-divider>\n                <h2>Staff Entry</h2>\n                <ul>\n                    <li>\n                        To select an area for a new staff, hold <code>Shift</code>\n                        and click-and-drag an area for the staff on the Diva.js\n                        viewer. When you release the mouse, a staff is added.\n                    </li>\n                    <li>\n                        To select a staff, click on the bounding box on the viewer.\n                    </li>\n                    <li>\n                        When a staff is selected, the voice it belongs to and\n                        mensuration of that voice can be set on the right.\n                        This information is saved automatically.\n                    </li>\n                    <li>\n                        To add musical components, begin typing. This will add\n                        musical elements to the staff below the voice and mensuration\n                        options. Information on this is available under the \"Music\n                        Input Help\" Tab.\n                    </li>\n                    <li>\n                        To delete a staff, first select it and then click the\n                        \"Delete Staff\" button under the \"Staff Input\" tab.\n                    </li>\n                </ul>\n                <mat-divider></mat-divider>\n                <h2>Saving Work for Later</h2>\n                <p>\n                    Work can be saved for later using the <em>Save/Load My Work</em>\n                    button. Current information in the input editor can be saved to\n                    one of the available workspaces. That workspace can be loaded later\n                    if the same browser is used and the browser storage hasn't been cleared.\n                </p>\n            </mat-tab>\n            <mat-tab label=\"Music Input Help\">\n                <h2>Music Input Instructions</h2>\n                <ul>\n                    <li> <b> Adding clef</b>\n                    \t<ul>\n                    \t<li> Type <span class=\"hi\">C</span> to insert C3 clef,\n                            or <span class=\"hi\">F</span> to insert F4 clef.</li>\n                        <li> Press the up or down arrows to move the clef to another line.</li>\n                    \t</ul>\n                    </li>\n\n                    <li> <b> Adding key signatures</b>\n                        <ul>\n                        <li> Type <span class=\"hi\">k</span> to enter key signature mode after adding a clef.</li>\n                        <li> Then enter the pitch name letter and accidental to add to key signature.</li>\n                        <li> To remove from a key signature, enter the same pitch letter and accidental again.</li>\n                        <li> Example: For F-sharp, type <span class=\"hi\">k f #</span></li>\n                        </ul>\n                    </li>\n\n                    <li> <b> Adding pitches</b>\n                    \t<ul>\n                    \t<li> Type pitch <span class=\"hi\">letter</span> name of each note to add them to the line: <span class=\"hi\">f.ed.efgagfgedderfag</span></li>\n                    \t<li> Type \"<span class=\"hi\">.</span>\" to add dot after note.</li>\n                    \t<li> Type \"<span class=\"hi\">r</span>\" to add a rest.</li>\n                    \t<li> Type <span class=\"hi2\">backspace</span> to delete note.</li>\n                    \t<li> Capital letters choose direction of pitch class which is greater then lower case letters.</li>\n                    \t<li> <span class=\"hi2\">Up/down</span> arrows transpose last pitch up/down a step.</li>\n                    \t<li> <span class=\"hi2\">shift-Up/down</span> arrows transpose last pitch up/down an octave.</li>\n                    \t</ul>\n                    </li>\n\n                    <li><b> Adding Accidentals</b><br>\n                        After adding a note:\n                        <ul>\n                            <li> press <code>-</code> to add a flat.</li>\n                            <li> press <code>#</code> to add a sharp.</li>\n                            <li> press <code>n</code> to add a natural.</li>\n                            <li> press <code>N</code> to clear accidentals.</li>\n                        </ul>\n                    </li>`\n\n                    <li><b> Adding ligatures</b>\n                        <ul>\n                            <li> After adding a note, press <span class=\"hi2\">[</span> to start a ligature.</li>\n                            <li> After adding a note, press <span class=\"hi2\">]</span> to end a ligature.</li>\n                        </ul>\n                    </li>\n\n                    <li> <b> Adding rhythm</b>\n                    \t<ul>\n                    \t\t<li> <span class=\"hi\">1</span> semibreve,\n                    \t\t     <span class=\"hi\">2</span> minim,\n                    \t\t     <span class=\"hi\">4</span> semiminim,\n                    \t\t     <span class=\"hi\">8</span> fusa,\n                    \t\t     <span class=\"hi\">6</span> semifusa,\n                    \t\t     <span class=\"hi\">0</span> breve,\n                    \t\t     <span class=\"hi\">9</span> long,\n                    \t\t     <span class=\"hi\">7</span> maxima. </li>\n                    \t\t<li> <i>Interleaved method</i>: type (new) rhythm before adding a note.  The default rhythm is whole note (semibreve).  First note's rhythm should be typed before adding clef.</li>\n                    \t\t<li> <i>Second-pass method</i>: type pitches first, then select first note and type rhythms to update note rhythms.</li>\n                    \t\t<li> <i>Selective second-pass method</i>: type most common rhythm, then clef, then notes, then click on notes that need rhythms to fix.  Typing rhythm number will change rhythm and advance to next note.</li>\n                    \t\t<li> left/right arrow keys or tab/shift-tab moves to next/previous note/rest/clef.</li>\n                    \t</ul>\n                    </li>\n\n                    <li> <b> Adding text</b>\n                    \t<ul>\n                    \t\t<li>Click on a note (or left/right arrows or tab/shift-tab to move to target note).</li>\n                    \t\t<li>Type text for note, then press tab or right arrow key or click to go to next note.</li>\n                            <li> <span class=\"hi2\">backspace</span> delete last letter.</li>\n                            <li> <span class=\"hi2\">shift-backspace</span> deletes entire syllable.</li>\n                            <li> Add dash at end of text for note to continue word to next note.</li>\n                            <li> To correct mistyped text, click the note to highlight it and press backspace. Then type the new text that belongs to that note.</li>\n                    \t</ul>\n                    </li>\n\n                    <li> <b> Repeating tenor</b>\n                        <ul>\n                            <li>When a staff that belongs to the tenor part is selected, the number of statements can be indicated.</li>\n                            <li>If more than one tenor statement is indicated, a repeating tenor will be generated.</li>\n                            <li>Where the tenor repeats from can be set after entering that element by pressing the \"Set End of Repeating Tenor\" button.\n                                The ending will be highlighted in blue.\n                            </li>\n                            <li>If no end point is specified, the entire tenor will repeat by default.</li>\n                        </ul>\n                    </li>\n                </ul>\n            </mat-tab>\n        </mat-tab-group>\n    </div>\n</div>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { DivaViewComponent } from './diva-view/diva-view.component';\nimport { StaffSelectComponent } from './staff-select/staff-select.component';\nimport { ToolbarComponent } from './toolbar/toolbar.component';\nimport { InputComponent } from './input.component';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\n\n@NgModule({\n  declarations: [\n    DivaViewComponent,\n    StaffSelectComponent,\n    StaffSelectComponent,\n    ToolbarComponent,\n    InputComponent,\n  ],\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    BrowserAnimationsModule,\n    MatTabsModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatDialogModule,\n    MatFormFieldModule,\n    MatSelectModule\n  ],\n  exports: [\n    InputComponent\n  ]\n})\nexport class InputModule { }\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs'\n\nimport { System } from '../utils/system';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InputService extends Subject<System> {\n\n  _selected: System;\n\n  constructor() {\n    super();\n    this._selected = null;\n  }\n\n  get selected(): System {\n    return this._selected;\n  }\n\n  set selected(system: System) {\n    this._selected = system;\n    this.next(this._selected);\n  }\n}\n","import { Component, OnInit, HostListener, ViewChild, ElementRef } from '@angular/core';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { PitchClass, NoteItem, RestItem, Accid, LigStatus, PlicaStatus } from '../../utils/MusicItem';\nimport { StateService } from '../../state-service.service';\nimport { InputService } from '../input.service';\nimport { vrvToolkit } from '../../utils/verovio';\nimport { Tenor } from '../../utils/part';\nimport { Voice } from '../../utils/definitions';\n\n@Component({\n  selector: 'app-staff-select',\n  templateUrl: './staff-select.component.html',\n  styleUrls: ['./staff-select.component.css']\n})\nexport class StaffSelectComponent implements OnInit {\n  @ViewChild('example') container: ElementRef;\n  voices = Object.entries(Voice);\n  keySigMode = false;\n  pitchSig: string = null;\n  accidSig: string = null;\n  selected = null;\n  constructor(\n    private selectedSystem: InputService,\n    private stateService: StateService,\n    private route: ActivatedRoute,\n    private router: Router\n  ) { }\n\n  ngOnInit() {\n    this.selectedSystem.subscribe({\n      next: (staff) => {\n        this.selected = staff;\n        this.container.nativeElement.innerHTML = '';\n        if (staff === null) return;\n        let element = vrvToolkit.humdrumToSVG(staff.contents.getHumdrumScore());\n        this.container.nativeElement.appendChild(element);\n      }\n    });\n  }\n\n  updateSVG() {\n    let white = this.selectedSystem.selected.parent.parent.notationType === \"mensural.white\";\n    let element = vrvToolkit.humdrumToSVG(this.selectedSystem.selected.contents.getHumdrumScore({white: white}));\n    this.container.nativeElement.innerHTML = '';\n    this.container.nativeElement.appendChild(element);\n\n    if (/^[tT]enor/.test(this.selectedSystem.selected.parent.voice)) {\n      const tenor = this.selectedSystem.selected.parent as Tenor;\n      if (tenor.endingId !== undefined) {\n        let endNote = element.getElementById(tenor.endingId);\n        if (endNote !== null) {\n          endNote.setAttribute('fill', '#00f');\n        }\n      }\n    }\n  }\n\n  staffForm = new FormGroup({\n    voice: new FormControl(''),\n    modus: new FormControl(''),\n    tempus: new FormControl(''),\n    prolatio: new FormControl(''),\n  });\n\n  mensurForm = new FormGroup({\n    modus2: new FormControl(''),\n    tempus2: new FormControl(''),\n    prolatio2: new FormControl(''),\n  });\n\n  handleClick(event: MouseEvent) {\n    let target = event.target as Element;\n    while (target) {\n      if (target.nodeName === 'g') {\n        let matches: Array<string>;\n        if (matches = target.id.match(/-.*L(\\d+)/)) {\n          this.selectedSystem.selected.contents.selectItemByLine(parseInt(matches[1]))\n          this.updateSVG();\n          break;\n        }\n      }\n      target = target.parentNode as Element;\n    }\n  }\n\n  finishStep() {\n    // const mei = this.meiService.generateFullMEI();\n    const type = this.route.snapshot.paramMap.get('source');\n    const identifier = this.route.snapshot.paramMap.get('identifier');\n    // this.stateService.mei = mei;\n    this.router.navigate(['/score', type, identifier]);\n  }\n\n  repTenorButton() {\n    const tenor = this.stateService.mei.getPart(Voice.tenor) as Tenor;\n    try {\n        let layer = this.container.nativeElement.querySelector('.layer');\n        let id = layer.lastElementChild.id;\n        let regexpInfo = id.match(/L(\\d+)[\\w\\d]+$/);\n        let line = parseInt(regexpInfo[1]);\n        let match = this.selectedSystem.selected.contents.m_list.filter(el => {\n          return el.m_line === line;\n        });\n        tenor.endingId = match[0].m_id;\n    } catch (e) {\n      console.debug(e);\n      tenor.endingId = undefined;\n    }\n    this.updateSVG();\n  }\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyPress(event: KeyboardEvent) {\n    if (this.selectedSystem.selected == null) return;\n\n    if (this.keySigMode) {\n      this.handleKeySigPress(event);\n      event.preventDefault();\n      this.updateSVG();\n      return;\n    }\n\n    // Based on processKeypress function in mensural-input\n    if (event.metaKey) return;\n    let musicList = this.selectedSystem.selected.contents;\n    if ((musicList.m_index >=0) && (event.key.length === 1)) {\n      if ((event.key >= '0') && (event.key <= '9')) {\n        this.processDigit(Number(event.key), event);\n        event.preventDefault();\n        this.updateSVG();\n        return;\n      }\n      if (event.key !== ' ') {\n        let state = musicList.addTextToCurrentItem(event.key);\n        if (state) {\n          event.preventDefault();\n          this.updateSVG();\n          return;\n        }\n      }\n    }\n    if ((musicList.m_index >= 0) && (event.key === 'Backspace')) {\n      if (event.shiftKey) {\n        musicList.clearTextOnCurrentItem();\n      }\n      else {\n        musicList.deleteCharacterOnCurrentItem();\n      }\n      event.preventDefault();\n    }\n    else if ((musicList.m_index < 0) && (event.key === 'Backspace')) {\n      musicList.removeLastItem();\n      event.preventDefault();\n    }\n    else {\n      switch (event.key) {\n        case 'k':\n          this.keySigMode = true;\n          console.debug(\"Set keySigMode\");\n          event.preventDefault();\n          break;\n        case 'C':\n          musicList.addPitchFar(PitchClass.C);\n          event.preventDefault();\n          break;\n        case 'c':\n          musicList.addPitchNear(PitchClass.C);\n          event.preventDefault();\n          break;\n        case 'D':\n          musicList.addPitchFar(PitchClass.D);\n          event.preventDefault();\n          break;\n        case 'd':\n          musicList.addPitchNear(PitchClass.D);\n          event.preventDefault();\n          break;\n        case 'E':\n          musicList.addPitchFar(PitchClass.E);\n          event.preventDefault();\n          break;\n        case 'e':\n          musicList.addPitchNear(PitchClass.E);\n          event.preventDefault();\n          break;\n        case 'F':\n          musicList.addPitchFar(PitchClass.F);\n          event.preventDefault();\n          break;\n        case 'f':\n          musicList.addPitchNear(PitchClass.F);\n          event.preventDefault();\n          break;\n        case 'G':\n          musicList.addPitchFar(PitchClass.G);\n          event.preventDefault();\n          break;\n        case 'g':\n          musicList.addPitchNear(PitchClass.G);\n          event.preventDefault();\n          break;\n        case 'A':\n          musicList.addPitchFar(PitchClass.A);\n          event.preventDefault();\n          break;\n        case 'a':\n          musicList.addPitchNear(PitchClass.A);\n          event.preventDefault();\n          break;\n        case 'B':\n          musicList.addPitchFar(PitchClass.B);\n          event.preventDefault();\n          break;\n        case 'b':\n          musicList.addPitchNear(PitchClass.B);\n          event.preventDefault();\n          break;\n        case 'm':\n        case 'M':\n          if (!musicList.hasOpenLigature()) {\n            musicList.addMensur();\n          }\n          event.preventDefault();\n          break;\n        case 'p':\n        case 'P':\n          this.processPlica(event.key);\n          event.preventDefault();\n          break;\n        case 'r':\n        case 'R':\n          if (!musicList.hasOpenLigature()) {\n            musicList.addRest();\n          } else {\n            alert(\"Can't enter a rest in an open ligature! Please close first.\")\n          }\n          event.preventDefault();\n          break;\n        case '.':\n          this.processDotKey();\n          event.preventDefault();\n          break;\n        case '0':\n        case '1':\n        case '2':\n        case '3':\n        case '4':\n        case '5':\n        case '6':\n        case '7':\n        case '8':\n        case '9':\n          this.processDigit(Number(event.key), event);\n          event.preventDefault();\n          break;\n        case 'Tab':\n          if (event.shiftKey) {\n            musicList.selectBackward();\n          } else {\n            musicList.selectForward();\n          }\n          event.preventDefault();\n          break;\n        case ' ':\n        case 'ArrowRight':\n          musicList.selectForward();\n          event.preventDefault();\n          break;\n        case 'ArrowLeft':\n          musicList.selectBackward();\n          event.preventDefault();\n          break;\n        case 'ArrowUp':\n          musicList.raisePitch(event.shiftKey ? 7 : 1);\n          event.preventDefault();\n          break;\n        case 'ArrowDown':\n          musicList.lowerPitch(event.shiftKey ? 7 : 1);\n          event.preventDefault();\n          break;\n        case 'End':\n          musicList.goToEndOfList();\n          event.preventDefault();\n          break;\n        case '[':\n          if (!musicList.hasOpenLigature()) {\n            this.processLig(true);\n          } else {\n            alert(\"A ligature is already open!\");\n          }\n          event.preventDefault();\n          break;\n        case ']':\n          if (musicList.hasOpenLigature()) {\n            this.processLig(false);\n          } else {\n            alert(\"No open ligature to close!\");\n          }\n          event.preventDefault();\n          break;\n        case '#':\n        case '-':\n        case 'N':\n        case 'n':\n          this.processAccidental(event.key);\n          event.preventDefault();\n          break;\n        }\n    }\n    this.updateSVG();\n  }\n\n  processDigit(digit: number, _event: KeyboardEvent) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      if (digit !== 3) {\n        musicList.m_rhythm = digit;\n      }\n      return;\n    }\n    var index = musicList.m_index;\n    var ending = false;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n      ending = true;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'clef') {\n      if (digit !== 3) {\n        musicList.m_rhythm = digit;\n      }\n      musicList.runNotationCallback();\n      return;\n    }\n    else if (ending) {\n      musicList.m_rhythm = digit;\n    }\n    else if ((item.m_type === 'note') || (item.m_type === 'rest')) {\n      if (!ending) {\n        if (digit !== 3) {\n          if (item.m_type === \"note\") {\n            (item as NoteItem).m_rhythm = digit;\n          }\n          else {\n            (item as RestItem).m_rhythm = digit;\n          }\n          musicList.m_index += 1;\n          musicList.m_rhythm = digit;\n          musicList.runNotationCallback();\n        }\n        if (musicList.m_index >= musicList.m_list.length) {\n          musicList.m_index = -1;\n        }\n      }\n    }\n  }\n\n  processDotKey() {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      note.m_dot = !note.m_dot;\n      musicList.runNotationCallback();\n      return;\n    }\n  }\n\n  processLig(isStart: boolean) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      if (isStart) {\n        note.m_lig = note.m_lig === LigStatus.START ? LigStatus.NONE : LigStatus.START;\n      } else {\n        note.m_lig = note.m_lig === LigStatus.END ? LigStatus.NONE : LigStatus.END;\n      }\n      musicList.runNotationCallback();\n      return;\n    }\n  }\n\n  processPlica(key: string) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      if (key === 'p') {\n        note.m_plica = note.m_plica === PlicaStatus.DOWN ? PlicaStatus.NONE : PlicaStatus.DOWN;\n      }\n      else {\n        note.m_plica = note.m_plica === PlicaStatus.UP ? PlicaStatus.NONE : PlicaStatus.UP;\n      }\n      musicList.runNotationCallback();\n      return;\n    }\n  }\n\n  handleKeySigPress(event: KeyboardEvent) {\n    switch (event.key) {\n      case 'a':\n      case 'A':\n      case 'b':\n      case 'B':\n      case 'c':\n      case 'C':\n      case 'd':\n      case 'D':\n      case 'e':\n      case 'E':\n      case 'f':\n      case 'F':\n      case 'g':\n      case 'G':\n        if (this.pitchSig === null) {\n          this.pitchSig = event.key;\n        }\n        else {\n          this.pitchSig = null;\n          this.accidSig = null;\n          this.keySigMode = false;\n          console.debug(\"unset keySigMode\");\n        }\n        break;\n      case '#':\n      case '-':\n      case 'n':\n        if (this.pitchSig !== null && this.accidSig === null) {\n          this.accidSig = event.key;\n          let musicList = this.selectedSystem.selected.contents;\n          musicList.processKeySig(this.pitchSig, this.accidSig);\n          console.debug(\"Process with \" + this.pitchSig + \" and \" + this.accidSig);\n        }\n        this.pitchSig = null;\n        this.accidSig = null;\n        this.keySigMode = false;\n        console.debug(\"unset keySigMode\");\n        break;\n    }\n  }\n\n  processAccidental(accid: string) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      switch(accid) {\n        case 'N':\n          note.m_accid = Accid.NONE;\n          break;\n        case '#':\n          note.m_accid = Accid.SHARP;\n          break;\n        case '-':\n          note.m_accid = Accid.FLAT;\n          break;\n        case 'n':\n          note.m_accid = Accid.NATURAL;\n          break;\n      }\n      musicList.runNotationCallback();\n    }\n  }\n}\n","<form [formGroup]=\"staffForm\" *ngIf=\"selected\">\n    <h1>Enter Music</h1>\n    <fieldset>\n        <label class=\"music-subentry\">Voice:&nbsp;\n            <select [(ngModel)]=\"selected.voice\" formControlName=\"voice\">\n                <option *ngFor=\"let voice of voices\" value=\"{{voice[0]}}\">{{voice[1]}}</option>\n            </select>\n        </label>\n    </fieldset>\n    <h3 class=\"music-subentry\">Select Initial Mensuration:</h3>\n    <div class=\"flex-container\">\n        <fieldset>\n            <legend class=\"mensuration\">modus</legend>\n            <input [(ngModel)]=\"selected.parent.modus\" type=\"radio\" id=\"modus-3\" formControlName=\"modus\" value=\"3\"/>\n            <label for=\"modus-3\">3</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.modus\" type=\"radio\" id=\"modus-2\" formControlName=\"modus\" value=\"2\"/>\n            <label for=\"modus-2\">2</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.modus\" type=\"radio\" id=\"modus-na\" formControlName=\"modus\" value=\"N/A\"/>\n            <label for=\"modus-na\">N/A</label>\n        </fieldset>\n        <fieldset>\n            <legend class=\"mensuration\">tempus</legend>\n            <input [(ngModel)]=\"selected.parent.tempus\" type=\"radio\" id=\"tempus-3\" formControlName=\"tempus\" value=\"3\"/>\n            <label for=\"tempus-3\">3</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.tempus\" type=\"radio\" id=\"tempus-2\" formControlName=\"tempus\" value=\"2\"/>\n            <label for=\"tempus-2\">2</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.tempus\" type=\"radio\" id=\"tempus-na\" formControlName=\"tempus\" value=\"N/A\"/>\n            <label for=\"tempus-na\">N/A</label>\n        </fieldset>\n        <fieldset>\n            <legend class=\"mensuration\">prolatio</legend>\n            <input [(ngModel)]=\"selected.parent.prolatio\" type=\"radio\" id=\"prolatio-3\" formControlName=\"prolatio\" value=\"3\"/>\n            <label for=\"prolatio-3\">3</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.prolatio\" type=\"radio\" id=\"prolatio-2\" formControlName=\"prolatio\" value=\"2\"/>\n            <label for=\"prolatio-2\">2</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.prolatio\" type=\"radio\" id=\"prolatio-na\" formControlName=\"prolatio\" value=\"N/A\"/>\n            <label for=\"prolatio-na\">N/A</label>\n        </fieldset>\n    </div>\n</form>\n<div #example (click)=\"handleClick($event)\"></div>\n<div id=\"mensur-change\" *ngIf=\"selected && selected.contents.m_index >= 0 && selected.contents.m_list[selected.contents.m_index].m_type == 'mensur'\">\n    <form [formGroup]=\"mensurForm\">\n    <fieldset>\n        <legend class=\"mensuration\">modus</legend>\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_modus\" type=\"radio\" id=\"modus2-3\" formControlName=\"modus2\" value=\"3\"/>\n        <label for=\"modus2-3\">3</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_modus\" type=\"radio\" id=\"modus2-2\" formControlName=\"modus2\" value=\"2\"/>\n        <label for=\"modus2-2\">2</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_modus\" type=\"radio\" id=\"modus2-na\" formControlName=\"modus2\" value=\"N/A\"/>\n        <label for=\"modus2-na\">N/A</label>\n    </fieldset>\n    <fieldset>\n        <legend class=\"mensuration\">tempus</legend>\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_tempus\" type=\"radio\" id=\"tempus2-3\" formControlName=\"tempus2\" value=\"3\"/>\n        <label for=\"tempus2-3\">3</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_tempus\" type=\"radio\" id=\"tempus2-2\" formControlName=\"tempus2\" value=\"2\"/>\n        <label for=\"tempus2-2\">2</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_tempus\" type=\"radio\" id=\"tempus2-na\" formControlName=\"tempus2\" value=\"N/A\"/>\n        <label for=\"tempus2-na\">N/A</label>\n    </fieldset>\n    <fieldset>\n        <legend class=\"mensuration\">prolatio</legend>\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_prolatio\" type=\"radio\" id=\"prolatio2-3\" formControlName=\"prolatio2\" value=\"3\"/>\n        <label for=\"prolatio2-3\">3</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_prolatio\" type=\"radio\" id=\"prolatio2-2\" formControlName=\"prolatio2\" value=\"2\"/>\n        <label for=\"prolatio2-2\">2</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_prolatio\" type=\"radio\" id=\"prolatio2-na\" formControlName=\"prolatio2\" value=\"N/A\"/>\n        <label for=\"prolatio2-na\">N/A</label>\n    </fieldset>\n    </form>\n</div>\n<div id=\"tenor-section\" *ngIf=\"selected && selected.voice === 'tenor'\">\n    <p>\n        If the piece has repetitions of the tenor that are not written out in full,\n        please specify here. See \"Music Input Help\" for details.\n    </p>\n    <button class=\"primary-button\" mat-stroked-button (click)=\"repTenorButton()\">Set End of Repeating Tenor</button>\n    &nbsp;\n    <label>Total Number of Tenor Statements:&nbsp;\n        <input [(ngModel)]=\"selected.parent.repetitions\" type=\"number\" min=\"1\">\n    </label>\n</div>\n<button color=primary class=\"primary-button\" *ngIf=\"selected\" mat-stroked-button (click)=\"finishStep()\">\n    Continue to Score Editor\n</button>\n","import { Component, OnInit } from '@angular/core';\nimport { StateService } from '../../state-service.service';\nimport { MatDialog } from '@angular/material/dialog';\nimport { System } from '../../utils/system';\nimport { InputService } from '../input.service';\n\nimport * as vkbeautify from 'vkbeautify';\n\n@Component({\n  selector: 'app-toolbar',\n  templateUrl: './toolbar.component.html',\n  styleUrls: ['./toolbar.component.css']\n})\nexport class ToolbarComponent implements OnInit {\n  currentStaff: System;\n\n  constructor(\n    private selectedSystem: InputService,\n    private stateService: StateService,\n    public dialog: MatDialog\n  ) { }\n\n  ngOnInit() {\n    this.selectedSystem.subscribe(system => {\n      this.currentStaff = system;\n    });\n  }\n\n  saveClick(evt: MouseEvent) {\n    let target = evt.target as HTMLAnchorElement;\n    const mei = this.stateService.mei.generateXML();\n    const serializer = new XMLSerializer();\n    const content = vkbeautify.xml(serializer.serializeToString(mei));\n    const blob = new Blob([content], {type: 'application/xml'});\n    target.setAttribute('href', window.URL.createObjectURL(blob));\n  }\n\n  saveHumdrumClick(evt: MouseEvent) {\n    let target = evt.target as HTMLAnchorElement;\n    const white = this.currentStaff.parent.parent.notationType === \"mensural.white\";\n    const content = this.currentStaff.contents.getHumdrumScore({white: white});\n    const blob = new Blob([content], {type: 'text/plain'});\n    target.setAttribute('href', window.URL.createObjectURL(blob));\n  }\n\n  deleteStaff() {\n    let system = this.currentStaff;\n    let part = system.parent;\n    part.removeSystem(system.id);\n    this.selectedSystem.next(null);\n  }\n\n}\n","<div class=\"toolbar-container\">\n    <button mat-stroked-button>\n        <a download type=\"application/xml\" (click)=\"saveClick($event)\">\n            Download MEI File\n        </a>\n    </button>\n    <button mat-stroked-button *ngIf=\"currentStaff\">\n        <a download type=\"text/plain\" (click)=\"saveHumdrumClick($event)\">\n            Download System Humdrum\n        </a>\n    </button>\n    <button mat-stroked-button *ngIf=\"currentStaff\" (click)=\"deleteStaff()\">\n        Delete Staff\n    </button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DocService {\n  _partsSubject: Subject<XMLDocument>;\n  _scoreSubject: Subject<XMLDocument>;\n  _parts: XMLDocument;\n  _score: XMLDocument;\n\n  constructor() {\n    this._parts = null;\n    this._score = null;\n    this._partsSubject = new Subject<XMLDocument>();\n    this._scoreSubject = new Subject<XMLDocument>();\n  }\n\n  get parts(): XMLDocument {\n    return this._parts;\n  }\n\n  set parts(doc: XMLDocument) {\n    this._parts = doc;\n    this._partsSubject.next(this._parts);\n  }\n\n  get score(): XMLDocument {\n    return this._score;\n  }\n\n  set score(doc: XMLDocument) {\n    this._score = doc;\n    this._scoreSubject.next(this._score);\n  }\n}\n","import { Component, OnInit, OnDestroy, Input } from '@angular/core';\n\nimport { IRI } from '../../utils/definitions';\n\nimport { SelectedStaffService } from '../selected-staff.service';\n\nimport Diva from 'diva.js';\n\n@Component({\n  selector: 'app-score-diva-view',\n  templateUrl: './score-diva-view.component.html',\n  styleUrls: ['./score-diva-view.component.css']\n})\nexport class ScoreDivaViewComponent implements OnInit, OnDestroy {\n\n  diva: Diva;\n  pageToCanvasMap: Map<string, number> = new Map();\n  iri: IRI;\n  bbox: {ulx: string, uly: string, lrx: string, lry: string};\n\n  @Input() iiifManifest: IRI;\n\n  constructor(private staffService: SelectedStaffService) { }\n\n  ngOnInit() {\n    this.diva = new Diva('diva-score-wrapper', {\n      objectData: this.iiifManifest\n    });\n\n    Diva.Events.subscribe('ManifestDidLoad', this.parseCanvases.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.handleZoom.bind(this), this.diva.settings.ID);\n\n    this.staffService.getStaffLocation().subscribe(([iri, bbox]) =>  {\n      this.iri = iri;\n      this.bbox = bbox;\n      console.debug(iri);\n      console.debug(bbox);\n      this.redraw();\n    });\n  }\n\n  handleZoom() {\n    (new Promise(resolve => {\n      document.getElementById(\"score-editor-container\").style.display = \"none\";\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.redraw();\n      document.getElementById(\"score-editor-container\").style.display = \"\";\n    });\n  }\n\n  redraw() {\n    const index = this.pageToCanvasMap.get(this.iri);\n    if (index === undefined) {\n      return;\n    }\n    // Change to correct folio if necessary\n    if (!this.diva.getCurrentPageIndices().includes(index)) {\n      this.diva.gotoPageByIndex(index);\n    }\n    // Get the inner element and dimensions\n    const inner =this.diva.settings.innerElement;\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(index);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(\n      index,\n      {\n        includePadding: true,\n        incorporateViewport: true\n      }\n    );\n    const marginLeft = getComputedStyle(inner, null).getPropertyValue('margin-left');\n    // Check for the container div or create one\n    let container = document.getElementById(\"score-editor-container\");\n    if (container === null) {\n      container = document.createElement(\"div\");\n      container.id = \"score-editor-container\";\n      inner.appendChild(container);\n    }\n\n    // Create SVG container\n    const svgParent = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    const maxZoom = this.diva.getPageDimensionsAtZoomLevel(index, Number.MAX_SAFE_INTEGER)\n    svgParent.setAttribute('width', dimensions.width.toString());\n    svgParent.setAttribute('height', dimensions.height.toString());\n    svgParent.setAttribute('viewBox', '0 0 ' + maxZoom.width + ' ' + maxZoom.height);\n\n    container.style.position = 'absolute';\n    container.style.top = `${offset.top}px`;\n    container.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    while (container.firstChild !== null) {\n      container.firstChild.remove();\n    }\n\n    let rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n    rect.setAttribute(\"x\", this.bbox.ulx);\n    rect.setAttribute(\"y\", this.bbox.uly);\n    rect.setAttribute(\"width\", (Number(this.bbox.lrx) - Number(this.bbox.ulx)).toString());\n    rect.setAttribute(\"height\", (Number(this.bbox.lry) - Number(this.bbox.uly)).toString());\n    rect.classList.add(\"zoneRect\");\n    svgParent.appendChild(rect);\n\n    container.appendChild(svgParent);\n  }\n\n  parseCanvases(manifest: { sequences: { canvases: object[] }[]}) {\n    for (const sequence of manifest.sequences) {\n      for (const canvas of sequence.canvases) {\n        this.pageToCanvasMap.set(canvas['@id'], sequence.canvases.indexOf(canvas));\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    try {\n      this.diva.deactivate();\n      this.diva.destroy();\n    }\n    catch (e) {\n      console.warn(e);\n    }\n  }\n\n}\n","<div id=\"diva-score-wrapper\"></div>\n","import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { IRI } from '../utils/definitions';\nimport { StateService } from '../state-service.service';\nimport { MEIDocument } from '../utils/mei';\nimport { formIIIFManifest } from '../tools';\n\n@Component({\n  selector: 'app-score-editor',\n  templateUrl: './score-editor.component.html',\n  styleUrls: ['./score-editor.component.css']\n})\nexport class ScoreEditorComponent implements OnInit {\n\n  source: string;\n  identifier: string;\n  iiifManifest: IRI;\n  meiDoc: MEIDocument;\n\n  constructor(\n    private router: Router,\n    private route: ActivatedRoute,\n    private stateService: StateService\n  ) {\n    this.source = this.route.snapshot.paramMap.get('source');\n    this.identifier = decodeURIComponent(\n      this.route.snapshot.paramMap.get('identifier')\n    );\n    this.iiifManifest = formIIIFManifest(this.source, this.identifier);\n    this.meiDoc = this.stateService.mei;\n    if (this.meiDoc === null) {\n      this.router.navigate(['/input', this.source, this.identifier])\n    }\n  }\n\n  ngOnInit() {\n  }\n}\n","<div id=\"score-container\">\n    <app-score-diva-view [iiifManifest]=\"iiifManifest\"></app-score-diva-view>\n    <div id=\"right\">\n        <mat-tab-group>\n            <mat-tab label=\"Score Editor\">\n                <app-score-toolbar></app-score-toolbar>\n                <mat-divider></mat-divider>\n                <app-score-verovio-view></app-score-verovio-view>\n            </mat-tab>\n            <mat-tab label=\"Score Editor Help\">\n                <h2>About the Score Editor</h2>\n                <p>\n                    The <strong>Score Editor</strong> is for making simple edits\n                    in order to align the parts in your score. In other words,\n                    if you made mistakes in your initial entry of the music on\n                    the previous screen (the <strong>Music Input</strong> screen)\n                    the score will not align properly and you may need to make adjustments\n                    to the note durations or add dots in order to get the proper alignment.\n                </p>\n                <mat-divider></mat-divider>\n                <h2>Making Simple Edits</h2>\n                <p>\n                    When you click on a pitch, the staff to which\n                    that pitch belongs will be highlighted with a\n                    dashed box in the manuscript image in the left\n                    of the screen. This is to help you check\n                    the accuracy of the edits you make.\n                </p>\n                <p>\n                    You can make simple edits directly as follows.\n                    By clicking on a pitch to highlight it you can edit:\n                </p>\n                <ul>\n                    <li><strong>Pitch: </strong>\n                        Use up/down arrow keys to change pitch.\n                    </li>\n                    <li><strong>Rhythm: </strong>\n                        Type a number key to alter its rhythm\n                        (1 semibreve, 2 minim, 4 semiminim,\n                        8 fusa, 6 semifusa, 0 breve, 9 long, 7 maxima).\n                        Scoring-up will rerun after a rhythmic value changes.\n                    </li>\n                    <li><strong>Dots: </strong>\n                        Typing a period will add or remove the dot from the\n                        highlighted pitch. Scoring-up will automatically\n                        rerun.\n                    </li>\n                    <li><strong>Accidentals: </strong>\n                        To add a flat, press <code>-</code>.\n                        To add a sharp, press <code>#</code>.\n                        To add a natural, press <code>n</code>.\n                        To clear accidentals, press <code>N</code>.\n                    </li>\n                    <li><strong>Cloning and Deleting Elements: </strong>\n                        Elements can be cloned by selecting one and pressing the\n                        <code>I</code> key. Elements can be deleted by pressing\n                        <code>Backspace</code>.\n                    </li>\n                </ul>\n                <p>\n                    You can also use the \"Return to Music Input\" button to return\n                    to the <strong>Music Input</strong> screen\n                    and make more significant edits, but any changes made\n                    in the <strong>Score Editor</strong> thus far will be lost!\n                </p>\n                <mat-divider></mat-divider>\n                <h2>Moving to Editorial Mode</h2>\n                <p>\n                    When making corrections in the <strong>Score Editor</strong>\n                    it is assumed that you are correcting mistakes <em>you</em>\n                    made, and both the MEI Parts and MEI Score files will be updated\n                    with these changes. However, once you move to <strong>Editorial Mode</strong>,\n                    the MEI Parts file will no longer be updated since this is a record\n                    of the music <em>exactly</em> as it was recorded in the original\n                    manuscript. Any further corrections made in <strong>Editorial\n                    Mode</strong> will be encoded in the MEI Score file as\n                    <strong>editorial</strong> corrections. For example, when a\n                    dot is added in <strong>Editorial Mode</strong>:\n                </p>\n                <pre><code>\n                    &lt;choice&gt;\n                        &lt;corr&gt;\n                            &lt;note dur=&quot;semibrevis&quot; oct=&quot;3&quot; pname=&quot;a&quot; dur.quality=&quot;minor&quot;/&gt;\n                            &lt;dot form=&quot;div&quot;/&gt;\n                        &lt;/corr&gt;\n                        &lt;sic&gt;\n                            &lt;note dur=&quot;semibrevis&quot; oct=&quot;3&quot; pname=&quot;a&quot;/&gt;\n                        &lt;/sic&gt;\n                    &lt;/choice&gt;\n                </code></pre>\n                <mat-divider></mat-divider>\n                <p>\n                    The purpose of the <strong>Score Editor</strong> is to do enough editing to\n                    enable the correct alignment of the score and edit while\n                    viewing the manuscript. For more fine-grained editing,\n                    it is recommended to download the MEI file and open it\n                    in a tool that allows direct editing of the MEI file such\n                    as <a href=\"https://verovio.humdrum.org\" target=\"_blank\">\n                    the Verovio Humdrum Viewer</a> or <a href=\"https://editor.verovio.org\"\n                    target=\"_blank\">the Verovio Editor</a>.\n                </p>\n            </mat-tab>\n        </mat-tab-group>\n    </div>\n</div>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { ScoreEditorComponent } from './score-editor.component';\nimport { ScoreDivaViewComponent } from './score-diva-view/score-diva-view.component';\nimport { ScoreVerovioViewComponent } from './score-verovio-view/score-verovio-view.component';\nimport { ScoreToolbarComponent } from './score-toolbar/score-toolbar.component';\n\n@NgModule({\n  declarations: [\n    ScoreDivaViewComponent,\n    ScoreVerovioViewComponent,\n    ScoreEditorComponent,\n    ScoreToolbarComponent\n  ],\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatTabsModule,\n  ],\n  exports: [\n    ScoreEditorComponent\n  ]\n})\nexport class ScoreEditorModule { }\n","import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { refineScore } from 'scoring-up';\nimport * as vkbeautify from 'vkbeautify';\n\nimport { StateService } from '../../state-service.service';\nimport { DocService } from '../doc.service';\n\n@Component({\n  selector: 'app-score-toolbar',\n  templateUrl: './score-toolbar.component.html',\n  styleUrls: ['./score-toolbar.component.css']\n})\nexport class ScoreToolbarComponent implements OnInit {\n\n  currentDoc: XMLDocument = null;\n\n  constructor(public stateService: StateService,\n    private route: ActivatedRoute,\n    private router: Router,\n    private doc: DocService\n  ) { }\n\n  ngOnInit() {\n    this.doc._scoreSubject.subscribe((doc) => {\n      this.currentDoc = doc;\n    });\n  }\n\n  saveClick(event: MouseEvent) {\n    if (this.currentDoc !== null) {\n      const target = event.target as HTMLAnchorElement;\n      const refinedDoc = refineScore(\n        this.currentDoc.cloneNode(true),\n        this.stateService.scoreOptions.modernClefs,\n        this.stateService.scoreOptions.barlines\n      );\n      const serializer = new XMLSerializer();\n      const content = vkbeautify.xml(serializer.serializeToString(refinedDoc));\n      const blob = new Blob([content], {type: 'application/xml'});\n      target.setAttribute('href', URL.createObjectURL(blob));\n    }\n  }\n\n  savePartsClick(event: MouseEvent) {\n    if (this.stateService.mei != null) {\n      const target = event.target as HTMLAnchorElement;\n      const serializer = new XMLSerializer();\n      const content = vkbeautify.xml(serializer.serializeToString(this.doc.parts));\n      const blob = new Blob([content], {type: 'application/xml'});\n      target.setAttribute('href', URL.createObjectURL(blob));\n    }\n  }\n\n  goToInputEditor() {\n    if (confirm(\"Warning: Edits made on this page will be lost. Return to input editor?\")) {\n      let source = this.route.snapshot.paramMap.get('source');\n      let identifier = this.route.snapshot.paramMap.get('identifier');\n      this.router.navigate(['/input', source, identifier]);\n    }\n  }\n\n  copyToClipboard() {\n    if (this.currentDoc !== null) {\n      const serializer = new XMLSerializer();\n      const refinedDoc = refineScore(\n        this.currentDoc.cloneNode(true),\n        this.stateService.scoreOptions.modernClefs,\n        this.stateService.scoreOptions.barlines\n      );\n      const content = vkbeautify.xml(serializer.serializeToString(refinedDoc));\n      navigator.clipboard.writeText(content).then(() => { alert(\"MEI Score Copied!\"); }).catch(err => { console.debug(err); alert(\"Copy failed :(\"); });\n    }\n  }\n\n}\n","<div class=\"toolbar-container\">\n    <button mat-stroked-button (click)=\"goToInputEditor()\">\n        Return to Music Input\n    </button>\n    <button mat-stroked-button>\n        <a download type=\"application/xml\" (click)=\"saveClick($event)\">\n            Download MEI Score\n        </a>\n    </button>\n    <button mat-stroked-button>\n        <a download type=\"application/xml\" (click)=\"savePartsClick($event)\">\n            Download MEI Parts\n        </a>\n    </button>\n    <button mat-stroked-button (click)=\"copyToClipboard()\">\n        Copy MEI Score to Clipboard\n    </button>\n</div>\n","import { Component, OnInit, AfterViewInit, HostListener, ViewChild, ElementRef } from '@angular/core';\n\nimport { v4 as uuid } from 'uuid';\n\nimport * as ScoringUp from 'scoring-up';\nimport { vrvToolkit } from '../../utils/verovio';\nimport { StateService } from '../../state-service.service';\nimport { SelectedStaffService } from '../selected-staff.service';\nimport { DocService } from '../doc.service';\n\nconst pnameOrder = [ 'c', 'd', 'e', 'f', 'g', 'a', 'b'];\n\nfunction recurseXmlId(element: Element) {\n  if (element.hasAttribute('xml:id')) {\n    element.setAttribute('xml:id', 'm-' + uuid());\n  }\n  for (let i = 0; i < element.children.length; i++) {\n    recurseXmlId(element.children[i]);\n  }\n}\n\n@Component({\n  selector: 'app-score-verovio-view',\n  templateUrl: './score-verovio-view.component.html',\n  styleUrls: ['./score-verovio-view.component.css']\n})\nexport class ScoreVerovioViewComponent implements OnInit, AfterViewInit {\n\n  @ViewChild('verovio') container: ElementRef;\n\n  selectedId: string = null;\n  corrToSicMap: Map<string, string> = new Map();\n\n  constructor(\n    public stateService: StateService,\n    private staffService: SelectedStaffService,\n    private doc: DocService\n  ) {  }\n\n  ngOnInit() {\n    this.doc.parts = this.stateService.mei.generateXML();\n    this.doc._scoreSubject.subscribe((doc) => {\n      this.container.nativeElement.innerHTML = '';\n      const svg = vrvToolkit.meiToSVG(doc);\n      this.container.nativeElement.appendChild(svg);\n      this.setSelected();\n    });\n  }\n\n  setEditorialMode() {\n    if (confirm(\"Edits in editorial mode reflect cases where there is a problem with the manuscript. You cannot exit editorial mode. Do you want to continue?\")) {\n      this.stateService.editorialMode = true;\n    }\n  }\n\n  setSelected() {\n    if (this.selectedId !== null) {\n      Array.from(document.getElementsByClassName(\"selected\"))\n        .forEach(elem => {\n          elem.classList.remove(\"selected\");\n          elem.setAttribute(\"fill\", \"\");\n        });\n      try {\n        document.getElementById(this.selectedId).classList.add(\"selected\");\n        document.getElementById(this.selectedId).setAttribute(\"fill\", \"#d00\");\n      }\n      catch (_e) {\n        console.debug(_e);\n        this.selectedId = null;\n        return;\n      }\n      try {\n        // Convert ID to sic ID if applicable\n        let partsId = this.selectedId;\n        if (this.corrToSicMap.has(partsId)) {\n          partsId = this.corrToSicMap.get(partsId);\n        }\n        // Get nearest pb  and sb\n        const resolver = this.doc.parts.createNSResolver(this.doc.parts.ownerDocument == null ? this.doc.parts.documentElement : this.doc.parts.ownerDocument.documentElement);\n        const meiRes = () => { return 'http://www.music-encoding.org/ns/mei'; };\n        const ref = this.doc.parts.evaluate(\"//*[@xml:id='\" + partsId + \"']\", this.doc.parts, resolver, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n        let result = this.doc.parts.evaluate(\"./preceding::mei:pb\", ref, meiRes, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n        const pb = result.snapshotItem(result.snapshotLength - 1) as Element;\n        result = this.doc.parts.evaluate(\"./preceding::mei:sb\", ref, meiRes, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n        const sb = result.snapshotItem(result.snapshotLength - 1) as Element;\n        // Get corresponding zones (strip away fragment symbol)\n        const pbFacsId = pb.getAttribute(\"facs\")[0] === \"#\" ?\n          pb.getAttribute(\"facs\").substring(1) :\n          pb.getAttribute(\"facs\");\n        const sbFacsId = sb.getAttribute(\"facs\")[0] === \"#\" ?\n          sb.getAttribute(\"facs\").substring(1) :\n          sb.getAttribute(\"facs\");\n        console.debug(sbFacsId);\n\n        // The following SHOULD use XPath but I haven't been able to get it to work\n        const pbGraphic = Array.from(\n          this.doc.parts.getElementsByTagName(\"surface\")\n        ).filter(el => { return el.getAttribute(\"xml:id\") === pbFacsId; }).pop()\n          .querySelector(\"graphic\");\n        const sbZone = Array.from(\n          pbGraphic.children\n        ).filter(el => { return el.getAttribute(\"xml:id\") === sbFacsId; }).pop()\n        const iri = pbGraphic.getAttribute(\"target\");\n        const bbox = {\n          ulx: sbZone.getAttribute(\"ulx\"),\n          uly: sbZone.getAttribute(\"uly\"),\n          lrx: sbZone.getAttribute(\"lrx\"),\n          lry: sbZone.getAttribute(\"lry\")\n        };\n        console.debug(iri);\n        this.staffService.staffLocation = [iri, bbox];\n      }\n      catch (_e) {\n        console.debug(_e);\n      }\n    }\n  }\n\n  ngAfterViewInit() {\n    this.doc.score = this.runScoringUp(this.doc.parts);\n  }\n\n  handleClick(event: MouseEvent) {\n    let target = event.target as Element;\n    while (target) {\n      if (target.nodeName === 'g') {\n        if (target.classList.contains('note') || target.classList.contains('rest')) {\n          this.selectedId = target.id;\n          this.setSelected();\n          break;\n        }\n      }\n      target = target.parentElement;\n    }\n  }\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyPress(event: KeyboardEvent) {\n    if (this.selectedId !== null) {\n      let doc: XMLDocument;\n      const resolver = this.doc.parts.createNSResolver(this.doc.parts.ownerDocument == null ? this.doc.parts.documentElement : this.doc.parts.ownerDocument.documentElement);\n      const result = this.doc.parts.evaluate(\"//*[@xml:id='\" + this.selectedId + \"']\", this.doc.parts, resolver, XPathResult.FIRST_ORDERED_NODE_TYPE, null);\n      if (!result.singleNodeValue) return;\n      let target = result.singleNodeValue as Element;\n      // Ensure corrected element in MEI\n      if (this.stateService.editorialMode) {\n        target = this.ensureCorrElement(target, this.doc.parts);\n      }\n      if (target.tagName === \"note\") {\n        switch (event.key) {\n          case '.':\n            let sibling = target.nextElementSibling;\n            if (sibling !== null && sibling.tagName === 'dot') {\n              target.nextSibling.remove();\n              if (target.hasAttribute(\"dots\")) {\n                target.setAttribute(\"dots\", \"0\");\n              }\n            }\n            else {\n              let dot = this.doc.parts.createElementNS(\"http://www.music-encoding.org/ns/mei\", \"dot\");\n              dot.setAttribute(\"xml:id\", \"m-\" + uuid());\n              target.insertAdjacentElement(\"afterend\", dot);\n            }\n            break;\n          case 'ArrowUp':\n            if (target.hasAttribute('pname')) {\n              let currentPname = target.getAttribute('pname');\n              let idx = pnameOrder.indexOf(currentPname);\n              if (idx + 1 < pnameOrder.length) {\n                target.setAttribute('pname', pnameOrder[idx + 1]);\n              }\n              else {\n                target.setAttribute('pname', pnameOrder[0]);\n                target.setAttribute('oct', (parseInt(target.getAttribute('oct')) + 1).toString());\n              }\n            }\n            break;\n          case 'ArrowDown':\n            if (target.hasAttribute('pname')) {\n              let currentPname = target.getAttribute('pname');\n              let idx = pnameOrder.indexOf(currentPname);\n              if (idx - 1 > 0) {\n                target.setAttribute('pname', pnameOrder[idx - 1]);\n              }\n              else {\n                target.setAttribute('pname', pnameOrder[pnameOrder.length - 1]);\n                target.setAttribute('oct', (parseInt(target.getAttribute('oct')) - 1).toString());\n              }\n            }\n            break;\n          case '1': target.setAttribute('dur', 'semibrevis'); break;\n          case '2': target.setAttribute('dur', 'minima'); break;\n          case '4': target.setAttribute('dur', 'semiminima'); break;\n          case '8': target.setAttribute('dur', 'fusa'); break;\n          case '6': target.setAttribute('dur', 'semifusa'); break;\n          case '7': target.setAttribute('dur', 'maxima'); break;\n          case '9': target.setAttribute('dur', 'longa'); break;\n          case '0': target.setAttribute('dur', 'brevis'); break;\n\n          case '#': target.setAttribute('accid', 's'); break;\n          case '-': target.setAttribute('accid', 'f'); break;\n          case 'n': target.setAttribute('accid', 'n'); break;\n          case 'N': target.removeAttribute('accid'); break;\n\n          case 'I':\n            const clone = target.cloneNode(true) as Element;\n            recurseXmlId(clone);\n            if (target.nextElementSibling && target.nextElementSibling.tagName === 'dot') {\n              const cloneDot = target.nextElementSibling.cloneNode(true) as Element;\n              recurseXmlId(cloneDot);\n              target.nextElementSibling.insertAdjacentElement('afterend', clone);\n              clone.insertAdjacentElement('afterend', cloneDot);\n            }\n            else {\n              target.insertAdjacentElement('beforebegin', clone);\n            }\n            break;\n          case 'Backspace':\n            if (target.nextElementSibling && target.nextElementSibling.tagName === 'dot') {\n              target.nextElementSibling.remove();\n            }\n            target.remove();\n\n            break;\n          default:\n            return;\n        }\n      } else if (target.tagName === \"rest\") {\n        switch (event.key) {\n          case '1': target.setAttribute('dur', 'semibrevis'); break;\n          case '2': target.setAttribute('dur', 'minima'); break;\n          case '4': target.setAttribute('dur', 'semiminima'); break;\n          case '8': target.setAttribute('dur', 'fusa'); break;\n          case '6': target.setAttribute('dur', 'semifusa'); break;\n          case '7': target.setAttribute('dur', 'maxima'); break;\n          case '9': target.setAttribute('dur', 'longa'); break;\n          case '0': target.setAttribute('dur', 'brevis'); break;\n\n          case 'I':\n            const clone = target.cloneNode(true) as Element;\n            recurseXmlId(clone);\n            target.insertAdjacentElement('beforebegin', clone);\n            break;\n\n          case 'Backspace':\n            target.remove();\n            break;\n\n          default:\n            return;\n        }\n      }\n\n      event.preventDefault();\n      this.doc.score = this.runScoringUp(this.doc.parts);\n    }\n  }\n\n  runScoringUp(meiDoc: XMLDocument): XMLDocument {\n    let output = null;\n    try {\n      const staffDef = meiDoc.getElementsByTagName(\"staffDef\")[0];\n      let quasiDoc: XMLDocument;\n      quasiDoc = ScoringUp.merge(meiDoc.cloneNode(true));\n      switch (staffDef.getAttribute(\"notationtype\")) {\n        case \"mensural.white\":\n          output = ScoringUp.ArsNova.lining_up(quasiDoc);\n          break;\n        case \"mensural.black\":\n          switch(staffDef.getAttribute(\"notationsubtype\")) {\n            case \"Ars_antiqua\":\n              output = ScoringUp.ArsAntiqua.lining_up(quasiDoc);\n              break;\n            case \"Ars_nova\":\n              output = ScoringUp.ArsNova.lining_up(quasiDoc);\n              break;\n            default:\n              console.warn(\"Only 'Ars antiqua' and 'Ars nova' are supported!\");\n          }\n          break;\n        default:\n          console.warn(\"Only mensural notation types are supported.\");\n          break;\n      }\n      if (output !== null) {\n        ScoringUp.PostProcessing.replace_ligatures_by_brackets(output);\n        // ScoringUp.PostProcessing.remove_num_and_numbase(output);\n      }\n    }\n    catch(e) {\n      console.error(e);\n      alert(\"Error in scoring up tool! \" + e);\n      output = null;\n    }\n    finally {\n      return output;\n    }\n  }\n\n\n  ensureCorrElement(target: Element, meiDoc: XMLDocument): Element {\n    if (target.closest('corr')) {\n      return target;\n    }\n    const choice = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'choice');\n    const corr = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'corr');\n    const sic = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'sic');\n    const sibling = target.nextElementSibling;\n    target.insertAdjacentElement('beforebegin', choice);\n    choice.appendChild(corr);\n    choice.appendChild(sic);\n    sic.appendChild(target);\n    const corrTarget = target.cloneNode(true) as Element;\n    recurseXmlId(corrTarget);\n    corr.appendChild(corrTarget);\n    this.corrToSicMap.set(corrTarget.getAttribute(\"xml:id\"), target.getAttribute(\"xml:id\"));\n    if (sibling !== null && sibling.tagName === 'dot') {\n      sic.appendChild(sibling);\n      const sibCorr = sibling.cloneNode(true) as Element;\n      recurseXmlId(sibCorr);\n      corr.appendChild(sibCorr);\n    }\n    return corrTarget;\n  }\n}\n","<div id=\"verovio\" #verovio (click)=\"handleClick($event)\"></div>\n<div>\n    <label>\n        Generate Barlines on Export\n        <input type=\"checkbox\" [(ngModel)]=\"stateService.scoreOptions.barlines\">\n    </label>\n    &nbsp;\n    <label>\n        Switch to Modern Clefs on Export\n        <input type=\"checkbox\" [(ngModel)]=\"stateService.scoreOptions.modernClefs\">\n    </label>\n</div>\n<div>\n    <button color=primary class=\"primary-button\" mat-stroked-button *ngIf=\"!stateService.editorialMode\" (click)=\"setEditorialMode()\">\n        Continue in Editorial Mode\n    </button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { IRI } from '../utils/definitions';\n\ntype BBox = {\n  ulx: string,\n  uly: string,\n  lrx: string,\n  lry: string\n};\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SelectedStaffService {\n  _staffLoc: Subject<[IRI, BBox]>;\n\n  constructor() {\n    this._staffLoc = new Subject<[IRI, BBox]>();\n  }\n\n  getStaffLocation() {\n    return this._staffLoc;\n  }\n\n  set staffLocation(loc: [IRI, BBox]) {\n    this._staffLoc.next(loc);\n  }\n\n\n}\n","import { Component, OnInit } from '@angular/core';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { RxwebValidators } from '@rxweb/reactive-form-validators';\nimport { Router } from '@angular/router';\n\nimport { MEIDocument } from '../utils/mei';\nimport { StateService } from '../state-service.service';\nimport * as Tools from '../tools';\n\n@Component({\n  selector: 'app-select-document',\n  templateUrl: './select-document.component.html',\n  styleUrls: ['./select-document.component.css']\n})\nexport class SelectDocumentComponent implements OnInit {\n\n  type: string = 'gallica';\n  identifier: string = '12148/btv1b8454675g';\n  file: File = null;\n\n  invalid = false;\n\n  selectionForm = new FormGroup({\n    source: new FormControl('gallica', Validators.required),\n    resourceURL: new FormControl('', [Validators.required, RxwebValidators.url()])\n  });\n\n  loadMEIForm = new FormGroup({\n    fileInput: new FormControl('', Validators.required)\n  });\n\n  constructor(private router: Router, private stateService: StateService) { }\n\n  ngOnInit() {\n  }\n\n  submit() {\n    console.debug(\"Submit\");\n    let source = this.selectionForm.controls['source'].value;\n    let resourceURL = this.selectionForm.controls['resourceURL'].value;\n    this.invalid = false;\n    let identifier: string;\n    switch (source) {\n      case 'gallica':\n        console.debug(\"gallica\");\n        if (Tools.gallicaRegexp.test(resourceURL)) {\n          console.debug(\"true\");\n          identifier = resourceURL.match(Tools.gallicaRegexp)[1];\n        }\n        else {\n          console.debug(\"false\");\n          this.invalid = true;\n          return;\n        }\n        break;\n      case 'ecodices':\n        if (Tools.ecodicesRegexp.test(resourceURL)) {\n          console.debug(\"Regular ecodices\");\n          let matches = resourceURL.match(Tools.ecodicesRegexp);\n          identifier = matches[1] + '-' + matches[2];\n        }\n        else if (Tools.ecodicesIIIFRegexp.test(resourceURL)) {\n          console.debug(\"IIIF ecodices\");\n          identifier = resourceURL.match(Tools.ecodicesIIIFRegexp)[1];\n        }\n        else {\n          this.invalid = true;\n          return;\n        }\n        break;\n      case 'iiif':\n        console.debug('iiif case')\n        if (Tools.genericIIIFRegexp.test(resourceURL)) {\n          console.debug(\"generic iiif\");\n          identifier = encodeURIComponent(resourceURL);\n        }\n        break;\n      default:\n        console.debug(source);\n        this.invalid = true;\n        return;\n    }\n    console.debug(identifier);\n    this.router.navigate(['/input', source, encodeURIComponent(identifier)]);\n  }\n\n  meiSubmit() {\n    console.debug(\"MEI Submit\");\n    console.debug(this.file);\n    if (this.file === null) { return; }\n    let reader = new FileReader();\n    reader.addEventListener(\"load\", () => {\n      let rawText = reader.result as string;\n      let parser = new DOMParser();\n      let doc = parser.parseFromString(rawText, \"application/xml\");\n      let mei = MEIDocument.fromXML(doc)\n      console.debug(mei);\n\n      // Try to determine IIIF\n      let iiif = mei.metadata.sourceIRI;\n      let source: string, identifier: string;\n      if (Tools.gallicaIIIFRegexp.test(iiif)) {\n        source = \"gallica\";\n        identifier = iiif.match(Tools.gallicaIIIFRegexp)[1];\n      }\n      else if (Tools.ecodicesIIIFRegexp.test(iiif)) {\n        source = \"ecodices\";\n        identifier = iiif.match(Tools.ecodicesIIIFRegexp)[1];\n      }\n      else if (Tools.genericIIIFRegexp.test(iiif)) {\n        source = \"iiif\";\n        identifier = encodeURIComponent(iiif);\n      }\n      else {\n        window.alert(\"Sorry! This seems to be a valid file, but this IIIF manifest cannot be loaded.\");\n        return;\n      }\n      this.stateService.mei = mei;\n      this.router.navigate(['/input', source, encodeURIComponent(identifier)]);\n    });\n    reader.readAsText(this.file);\n  }\n\n  onFileChange(evt) {\n    this.file = evt.target['files'][0];\n  }\n\n  get encodedIdSample(): string {\n    return encodeURIComponent(this.identifier);\n  }\n\n}\n","<div id=\"document-select\">\n    <div id=\"load-manuscript\">\n        <h1>Load Manuscript</h1>\n        <form [formGroup]=\"selectionForm\" (submit)=\"submit()\">\n            <div style=\"display:block;\">\n                <label class=\"label\">Manuscript Repository:&nbsp;\n                    <select formControlName=\"source\">\n                        <option value=\"gallica\" selected>Gallica</option>\n                        <option value=\"ecodices\">eCodices</option>\n                        <option value=\"diamm\" disabled>DIAMM</option>\n                        <option value=\"iiif\">Generic IIIF</option>\n                    </select>\n                </label>\n                &nbsp;\n                <label class=\"label\">URL:&nbsp;\n                    <input type=\"url\" formControlName=\"resourceURL\">\n                </label>\n                <small *ngIf=\"invalid\">URL is unexpected for this source!</small>\n            </div>\n            <div>\n                <button type=\"submit\" [disabled]=\"!selectionForm.valid\" mat-stroked-button>Submit</button>\n            </div>\n        </form>\n        <br/><br/>\n        <a [routerLink]=\"['/input', 'gallica', encodedIdSample]\">\n            <button color=primary class=\"primary-button\" mat-stroked-button>Use Sample Document</button>\n        </a>\n    </div>\n    <div id=\"load-mei\">\n        <h1>Load from Parts MEI</h1>\n        <form [formGroup]=\"loadMEIForm\" (submit)=\"meiSubmit()\">\n            <div style=\"display:block;\">\n                <label class=\"label\">Compatible Parts-MEI File:&nbsp;\n                    <input type=\"file\" (change)=\"onFileChange($event)\" formControlName=\"fileInput\" accept=\"application/mei+xml, application/xml, .mei, .xml\">\n                </label>\n            </div>\n            <div>\n                <button type=\"submit\" [disabled]=\"!loadMEIForm.valid\" mat-stroked-button>Load File</button>\n            </div>\n        </form>\n    </div>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MEIDocument } from './utils/mei';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StateService {\n\n  private meiDoc: MEIDocument;\n  public editorialMode: boolean;\n  public scoreOptions: {\n    barlines: boolean,\n    modernClefs: boolean\n  };\n\n  constructor() {\n    this.meiDoc = null;\n    this.editorialMode = false;\n    this.scoreOptions = {\n      barlines: false,\n      modernClefs: false\n    };\n  }\n\n  get mei(): MEIDocument {\n    return this.meiDoc;\n  }\n\n  set mei(document: MEIDocument) {\n    this.meiDoc = document;\n  }\n}\n","import { IRI } from './utils/definitions';\n\nexport function formIIIFManifest(source: string, identifier: string): IRI {\n  switch (source) {\n    case 'gallica':\n      return 'https://gallica.bnf.fr/iiif/ark:/' +\n        identifier +\n        '/manifest.json';\n    case 'ecodices':\n      return 'https://www.e-codices.unifr.ch/metadata/iiif/' +\n        identifier +\n        '/manifest.json';\n    case 'iiif':\n      return decodeURIComponent(identifier);\n    default:\n      return '';\n  }\n}\n\n//https://gallica.bnf.fr/ark:/12148/btv1b8454675g\nexport const gallicaRegexp = new RegExp(\"https?:\\/\\/gallica\\.bnf\\.fr\\/ark:\\/([a-z0-9]+\\/[a-z0-9]+)\");\nexport const gallicaIIIFRegexp = new RegExp(\"https?:\\/\\/gallica\\.bnf\\.fr\\/iiif\\/ark:\\/([a-z0-9]+\\/[a-z0-9]+)\\/manifest.json\");\n//https://www.e-codices.unifr.ch/en/list/one/bbb/0218\nexport const ecodicesRegexp = new RegExp(\"https?:\\/\\/www\\.e-codices\\.unifr\\.ch\\/[a-z]{2}\\/list\\/one\\/([a-z]+)\\/([-a-zA-Z0-9]+)\");\n//https://www.e-codices.unifr.ch/metadata/iiif/bbb-0218/manifest.json\nexport const ecodicesIIIFRegexp = new RegExp(\"https?:\\/\\/www\\.e-codices\\.unifr\\.ch\\/metadata\\/iiif\\/([-a-zA-Z0-9]+)\\/manifest\\.json\");\nexport const genericIIIFRegexp = new RegExp(\"https?:\\/\\/.*\\/manifest\\.json\");\n","/**\n * Based on musiclist.js by Craig Sapp\n * From: https://github.com/craigsapp/mensural-input/blob/master/scripts/musiclist.js\n */\n\nimport { v4 } from \"uuid\";\nimport { Mensuration } from './definitions';\n\nfunction parseRhythm(rhythm: string): number {\n  let val: number;\n  switch (rhythm) {\n    case \"semibrevis\": val = 1; break;\n    case \"brevis\": val = 0; break;\n    case \"maxima\": val = 7; break;\n    case \"longa\": val = 9; break;\n    case \"minima\": val = 2; break;\n    case \"semiminima\": val = 4; break;\n    case \"fusa\": val = 8; break;\n    case \"semifusa\": val = 6; break;\n  }\n  return val;\n}\n\nexport enum PitchClass {\n  C = 0,\n  D = 1,\n  E = 2,\n  F = 3,\n  G = 4,\n  A = 5,\n  B = 6,\n}\n\nexport enum Accid {\n  NONE,\n  SHARP = \"#\",\n  FLAT = \"-\",\n  NATURAL = \"n\",\n}\n\nexport enum LigStatus {\n  NONE,\n  START,\n  END,\n}\n\nexport enum PlicaStatus {\n  NONE,\n  UP,\n  DOWN,\n}\n\nexport interface MusicItem {\n  m_type: string;\n  m_id: string;\n  m_line: number;\n  getHumdrumLine(options: object): string;\n}\n\nexport class ClefItem implements MusicItem {\n  readonly m_type = \"clef\";\n  m_line = -1;\n  m_id: string;\n  m_pname: PitchClass;\n  m_clefLine: number;\n  m_keySig: Map<string,string>;\n\n  constructor () {\n    this.m_pname = PitchClass.C;\n    this.m_clefLine = 3;\n    this.m_keySig = new Map();\n  }\n\n  raisePitch () {\n    this.m_clefLine += 1;\n    if (this.m_clefLine > 5) {\n      this.m_clefLine = 5;\n    }\n  }\n\n  lowerPitch () {\n    this.m_clefLine -= 1;\n    if (this.m_clefLine < 1) {\n      this.m_clefLine = 1;\n    }\n  }\n\n  getHumdrumLine(): string {\n    let output = \"*clef\";\n    switch (this.m_pname) {\n      case PitchClass.G: output += \"G\"; break;\n      case PitchClass.F: output += \"F\"; break;\n      default: output += \"C\"; break;\n    }\n    output += this.m_clefLine;\n    output += \"\\t\";\n    output += \"*\";\n    if (this.m_keySig.size > 0) {\n      output += \"\\n\";\n      output += \"*k[\";\n      for (let [pitch, accid] of this.m_keySig) {\n        output += pitch;\n        output += accid;\n      }\n      output += \"]\\t*\";\n    }\n    return output;\n  }\n\n  static parseXML(element: Element): ClefItem {\n    let clef = new ClefItem();\n    if (element.hasAttribute(\"xml:id\")) {\n      clef.m_id = element.getAttribute(\"xml:id\");\n    }\n    switch (element.getAttribute(\"shape\")) {\n      case \"F\": clef.m_pname = PitchClass.F; break;\n      case \"G\": clef.m_pname = PitchClass.G; break;\n      case \"C\":\n      default: break;\n    }\n    try {\n      let line: number = parseInt(element.getAttribute(\"line\"));\n      clef.m_clefLine = line;\n    } catch (e) {}\n    return clef;\n  }\n}\n\nexport class RestItem implements MusicItem {\n  readonly m_type = \"rest\";\n  m_line = -1;\n  m_id: string;\n  m_rhythm: number;\n  m_dot: boolean;\n\n  constructor (rhythm?: number) {\n    this.m_dot = false;\n    if (rhythm !== undefined) {\n      this.m_rhythm = rhythm;\n    } else {\n      this.m_rhythm = 1;\n    }\n  }\n\n  getHumdrumLine (options: object): string {\n    let output = \"\";\n    switch (this.m_rhythm) {\n      case 7: output += \"X\"; break;\n\t\t\tcase 9: output += \"L\"; break;\n\t\t\tcase 0: output += \"S\"; break;\n\t\t\tcase 1: output += \"s\"; break;\n\t\t\tcase 2: output += \"M\"; break;\n\t\t\tcase 4: output += \"m\"; break;\n\t\t\tcase 6: output += \"u\"; break;\n\t\t\tcase 8: output += \"U\"; break;\n    }\n    if (this.m_dot) {\n      output += \":\";\n    }\n    output += \"r\";\n    if (options[\"mark\"]) {\n      output += \"@\";\n    }\n    output += \"\\t.\";\n    return output;\n  }\n\n  static parseXML(element: Element): RestItem {\n    let rest = new RestItem();\n    if (element.hasAttribute(\"xml:id\")) {\n      rest.m_id = element.getAttribute(\"xml:id\");\n    }\n    if (element.hasAttribute(\"dur\")) {\n      rest.m_rhythm = parseRhythm(element.getAttribute(\"dur\"));\n    }\n    return rest;\n  }\n}\n\nexport class MensurItem implements MusicItem {\n  readonly m_type = \"mensur\";\n  m_line = -1;\n  m_modus: Mensuration;\n  m_tempus: Mensuration;\n  m_prolatio: Mensuration;\n  m_id: string;\n\n  constructor() {\n    this.m_modus = Mensuration.NA;\n    this.m_tempus = Mensuration.NA;\n    this.m_prolatio = Mensuration.NA;\n  }\n\n  getHumdrumLine(): string {\n    if (this.m_tempus === Mensuration.Two && this.m_prolatio === Mensuration.Two)\n      return \"*met(C)\\t*\";\n    if (this.m_tempus === Mensuration.Three && this.m_prolatio === Mensuration.Two)\n      return \"*met(O)\\t*\";\n    if (this.m_tempus === Mensuration.Two && this.m_prolatio === Mensuration.Three)\n      return \"*met(C.)\\t*\";\n    if (this.m_tempus === Mensuration.Three && this.m_prolatio === Mensuration.Three)\n      return \"*met(O.)\\t*\";\n    else\n      return \"*met(C)\\t*\";\n  }\n\n  static parseXML(element: Element): MensurItem {\n    let mensur = new MensurItem();\n    if (element.hasAttribute(\"xml:id\")) {\n      mensur.m_id = element.getAttribute(\"xml:id\");\n    }\n    if (element.hasAttribute(\"modusminor\")) {\n      mensur.m_modus = element.getAttribute(\"modus\") as Mensuration;\n    }\n    if (element.hasAttribute(\"tempus\")) {\n      mensur.m_tempus = element.getAttribute(\"tempus\") as Mensuration;\n    }\n    if (element.hasAttribute(\"prolatio\")) {\n      mensur.m_prolatio = element.getAttribute(\"prolatio\") as Mensuration;\n    }\n    return mensur;\n  }\n}\n\nexport class NoteItem implements MusicItem {\n  readonly m_type = \"note\";\n  m_line = -1;\n  m_pname: PitchClass;\n  m_accid: Accid;\n  m_oct: number;\n  m_rhythm: number;\n  m_dot: boolean;\n  m_text: string;\n  m_lig: LigStatus;\n  m_id: string;\n  m_plica: PlicaStatus;\n\n  constructor() {\n    this.m_pname = PitchClass.C;\n    this.m_accid = Accid.NONE;\n    this.m_oct = 4;\n    this.m_rhythm = 1;\n    this.m_dot = false;\n    this.m_text = \"\";\n    this.m_lig = LigStatus.NONE;\n    this.m_plica = PlicaStatus.NONE;\n  }\n\n  raisePitch (amount?: number) {\n    if (amount === undefined) {\n      amount = 1;\n    }\n    if (amount >= 7) {\n      this.m_oct += amount % 7;\n      amount -= 7 * (amount % 7);\n    }\n\n    this.m_pname += amount;\n    if (this.m_pname > 6) {\n      this.m_pname -= 7;\n      this.m_oct += 1;\n    }\n  }\n\n  lowerPitch (amount?: number) {\n    if (amount === undefined) {\n      amount = 1;\n    }\n    if (amount >= 7) {\n      this.m_oct -= amount % 7;\n      amount -= 7 * (amount % 7);\n    }\n    this.m_pname -= amount;\n    if (this.m_pname < 0) {\n      this.m_pname += 7;\n      this.m_oct -= 1;\n    }\n  }\n\n  getHumdrumLine(options: object): string {\n    let output = \"\";\n    if (this.m_lig === LigStatus.START) {\n      output += \"[\";\n    }\n    switch (this.m_rhythm) {\n      case 7: output += \"X\"; break;\n  \t\tcase 9: output += \"L\"; break;\n  \t\tcase 0: output += \"S\"; break;\n  \t\tcase 1: output += \"s\"; break;\n  \t\tcase 2: output += \"M\"; break;\n  \t\tcase 4: output += \"m\"; break;\n  \t\tcase 6: output += \"u\"; break;\n  \t\tcase 8: output += \"U\"; break;\n    }\n    if (this.m_dot) {\n      output += \":\";\n    }\n\n    let pname: string;\n    switch(this.m_pname) {\n      case PitchClass.C: pname = \"c\"; break;\n      case PitchClass.D: pname = \"d\"; break;\n      case PitchClass.E: pname = \"e\"; break;\n      case PitchClass.F: pname = \"f\"; break;\n      case PitchClass.G: pname = \"g\"; break;\n      case PitchClass.A: pname = \"a\"; break;\n      case PitchClass.B: pname = \"b\"; break;\n    }\n    if (this.m_oct >= 4) {\n      for (let i = 4; i <= this.m_oct; i++) {\n        output += pname;\n      }\n    } else {\n      pname = pname.toUpperCase();\n      for (let i = 3; i >= this.m_oct; i--) {\n        output += pname;\n      }\n    }\n\n    if (this.m_accid !== Accid.NONE) {\n      output += this.m_accid.toString();\n    }\n\n    if (this.m_lig === LigStatus.END) {\n      output += \"]\";\n    }\n\n    if (options[\"mark\"]) {\n      output += \"@\";\n    }\n    if (this.m_plica !== PlicaStatus.NONE) {\n      output += \"&\";\n    }\n\n    output += \"\\t\";\n    if (this.m_text) {\n      if (options[\"hyphen\"]) {\n        output += \"-\";\n      }\n      output += this.m_text;\n    } else {\n      output += \".\";\n    }\n\n    return output;\n  }\n\n  static parseXML(element: Element): NoteItem {\n    let note = new NoteItem();\n    // Set info from element attributes\n    if (element.hasAttribute(\"xml:id\")) {\n      note.m_id = element.getAttribute(\"xml:id\");\n    }\n    if (element.hasAttribute(\"oct\")) {\n      note.m_oct = parseInt(element.getAttribute(\"oct\"));\n    }\n    if (element.hasAttribute(\"dur\")) {\n      note.m_rhythm = parseRhythm(element.getAttribute(\"dur\"));\n    }\n    if (element.hasAttribute(\"pname\")) {\n      note.m_pname = PitchClass[element.getAttribute(\"pname\").toUpperCase()];\n    }\n    if (element.hasAttribute(\"plica\")) {\n      if (element.getAttribute(\"plica\") === \"up\") {\n        note.m_plica = PlicaStatus.UP;\n      }\n      else {\n        note.m_plica = PlicaStatus.DOWN;\n      }\n    }\n\n    // Check next sibling for dot\n    if (element.nextElementSibling && element.nextElementSibling.tagName === \"dot\") {\n      note.m_dot = true;\n    }\n\n    // Check children for accid, text\n    if (element.querySelector(\"accid\")) {\n      const accid = element.querySelector(\"accid\");\n      switch (accid.getAttribute(\"accid\")) {\n        case \"s\": note.m_accid = Accid.SHARP; break;\n        case \"f\": note.m_accid = Accid.FLAT; break;\n        case \"n\": note.m_accid = Accid.NATURAL; break;\n        default: break;\n      }\n    }\n    if (element.querySelector(\"syl\")) {\n      const syl = element.querySelector(\"syl\");\n      note.m_text = syl.textContent;\n    }\n\n    // Check parent for ligature\n    if (element.parentElement.tagName === \"ligature\") {\n      if (element === element.parentElement.firstElementChild) {\n        note.m_lig = LigStatus.START;\n      } else if (element === element.parentElement.lastElementChild) {\n        note.m_lig = LigStatus.END;\n      }\n    }\n\n    return note;\n  }\n}\n\nexport class MusicList {\n  m_list: Array<MusicItem> = [];\n  m_index = -1;\n  m_rhythm = 1;\n  m_notationCallback = null;\n\n  addClef (dpc: PitchClass) {\n    let item = new ClefItem();\n    if (dpc === PitchClass.G) {\n      item.m_pname = PitchClass.G;\n      item.m_clefLine = 2;\n    } else if (dpc === PitchClass.F) {\n      item.m_pname = PitchClass.F;\n      item.m_clefLine = 4;\n    } else {\n      item.m_pname = PitchClass.C;\n      item.m_clefLine = 3;\n    }\n    this.m_list.push(item);\n    this.runNotationCallback();\n  }\n\n  addRest () {\n    if (this.m_list.length === 0) return;\n    this.m_list.push(new RestItem(this.m_rhythm));\n    this.runNotationCallback();\n  }\n\n  addMensur () {\n    this.m_list.push(new MensurItem());\n    this.runNotationCallback();\n  }\n\n  addPitchFar (dpc: PitchClass) {\n    if (this.m_list.length === 0) {\n      this.addClef(dpc);\n      return;\n    }\n    dpc = (dpc + 7000) % 7;\n    let ln = this.getLastNote();\n    if (!ln) {\n      ln = new NoteItem();\n      ln.m_pname = PitchClass.C;\n      ln.m_oct = 4;\n      ln.m_rhythm = 1;\n    }\n    let oct = ln.m_oct;\n    let pitch = ln.m_pname + 7 * oct;\n    let candidate = [];\n    candidate[0] = (oct - 1) * 7 + dpc;\n    candidate[1] = (oct + 0) * 7 + dpc;\n    candidate[2] = (oct + 1) * 7 + dpc;\n    let best = -1;\n    for (let i = 0; i < candidate.length; i++) {\n      if ((Math.abs(pitch - candidate[i]) > 3) &&\n          (Math.abs(pitch - candidate[i]) < 8)) {\n        best = i;\n        break;\n      }\n    }\n    let newnote = new NoteItem();\n    newnote.m_rhythm = this.m_rhythm;\n    newnote.m_pname = dpc;\n    switch (best) {\n      case 0: newnote.m_oct = oct - 1; break;\n      case 1: newnote.m_oct = oct;     break;\n      case 2: newnote.m_oct = oct + 1; break;\n    }\n    this.m_list.push(newnote);\n    this.runNotationCallback();\n  }\n\n  addPitchNear (dpc: PitchClass) {\n    if (this.m_list.length == 0) {\n  \t\tthis.addClef(dpc);\n  \t\treturn;\n  \t}\n\n  \tdpc = (dpc + 7000) % 7;\n  \tlet ln = this.getLastNote();\n    if (!ln) {\n      ln = new NoteItem();\n      ln.m_pname = 0;\n      ln.m_oct = 4;\n      ln.m_rhythm = 1;\n    }\n    let oct = ln.m_oct;\n    let pitch = ln.m_pname + 7 * oct;\n    let candidate = [];\n    candidate[0] = (oct - 1) * 7 + dpc;\n  \tcandidate[1] = (oct + 0) * 7 + dpc;\n  \tcandidate[2] = (oct + 1) * 7 + dpc;\n    let best = -1;\n    for (let i = 0; i < candidate.length; i++) {\n      if (Math.abs(pitch - candidate[i]) < 4) {\n        best = i;\n        break;\n      }\n    }\n    let newnote = new NoteItem();\n    newnote.m_rhythm = this.m_rhythm;\n    newnote.m_pname = dpc;\n    switch (best) {\n      case 0: newnote.m_oct = oct - 1; break;\n      case 1: newnote.m_oct = oct;     break;\n      case 2: newnote.m_oct = oct + 1; break;\n    }\n    this.m_list.push(newnote);\n    this.runNotationCallback();\n  }\n\n  getLastNote(): NoteItem | null {\n    for (let i = this.m_list.length - 1; i >= 0; i--) {\n      if (this.m_list[i].m_type === \"note\") {\n        return this.m_list[i] as NoteItem;\n      }\n    }\n    return null;\n  }\n\n  removeLastItem() {\n    this.m_list.pop();\n    this.runNotationCallback();\n  }\n\n  hasOpenLigature(): boolean {\n    let open = false;\n    for (let item of this.m_list) {\n      if (item.m_type === \"note\") {\n        let note = item as NoteItem;\n        if (note.m_lig === LigStatus.START) {\n          open = true;\n        } else if (note.m_lig === LigStatus.END) {\n          open = false;\n        }\n      }\n    }\n    return open;\n  }\n\n  selectBackward() {\n    if (this.m_index > 0) {\n      this.m_index--;\n    } else if (this.m_index === 0) {\n      this.m_index = -1;\n    } else if (this.m_index < 0) {\n      this.m_index = this.m_list.length - 1;\n    }\n    this.runNotationCallback();\n  }\n\n  selectForward() {\n    if (this.m_index < this.m_list.length - 1) {\n  \t\tthis.m_index++;\n  \t} else if (this.m_index == this.m_list.length - 1) {\n  \t\tthis.m_index = -1;\n  \t} else if (this.m_index < 0) {\n  \t\tthis.m_index = 0;\n  \t}\n  \tthis.runNotationCallback();\n  }\n\n  runNotationCallback() {\n    if (this.m_notationCallback) {\n      let score = this.getHumdrumScore({});\n      this.m_notationCallback(score);\n    }\n  }\n\n  addTextToCurrentItem (text: string): boolean {\n    if (this.m_list.length === 0) {\n      return false;\n    }\n    let index = this.m_index;\n    if (index < 0) {\n      index = this.m_list.length - 1;\n    }\n    if (index < 0) {\n      return false;\n    }\n    let item = this.m_list[index];\n    if (item.m_type === \"note\") {\n      (item as NoteItem).m_text += text;\n      if (text === \"-\") {\n        this.m_index += 1;\n        if (this.m_index >= this.m_list.length) {\n          this.m_index = -1;\n        }\n      }\n    }\n    this.runNotationCallback();\n    return true;\n  }\n\n  goToEndOfList() {\n    this.m_index = -1;\n    this.runNotationCallback();\n  }\n\n  lowerPitch (amount: number) {\n    if (this.m_list.length === 0) return;\n    let index = this.m_index;\n    if (index < 0) index = this.m_list.length - 1;\n    if (this.m_list[index].m_type === \"note\") {\n      (this.m_list[index] as NoteItem).lowerPitch(amount);\n    }\n    else if (this.m_list[index].m_type === \"clef\") {\n      (this.m_list[index] as ClefItem).lowerPitch();\n    }\n    this.runNotationCallback();\n  }\n\n  raisePitch (amount: number) {\n    if (this.m_list.length === 0) return;\n    let index = this.m_index;\n    if (index < 0) index = this.m_list.length - 1;\n    if (this.m_list[index].m_type === \"note\") {\n      (this.m_list[index] as NoteItem).raisePitch(amount);\n    }\n    else if (this.m_list[index].m_type === \"clef\") {\n      (this.m_list[index] as ClefItem).raisePitch();\n    }\n    this.runNotationCallback();\n  }\n\n  deleteCharacterOnCurrentItem () {\n    let index = this.m_index;\n    if (index < 0) index = this.m_list.length - 1;\n    try {\n      let item = this.m_list[index] as NoteItem;\n      if (item.m_text.length === 0) return;\n      item.m_text = item.m_text.substring(0, item.m_text.length - 1);\n      this.runNotationCallback();\n    }\n    catch (e) {}\n  }\n\n  clearTextOnCurrentItem () {\n    let index = this.m_index;\n    if (index < 0 || index >= this.m_list.length) {\n      return;\n    }\n    let item = this.m_list[index];\n    if (!item) return;\n    try {\n      let note = item as NoteItem;\n      note.m_text = \"\";\n      this.runNotationCallback();\n    } catch (e) {}\n  }\n\n  clear () {\n    this.m_list = [];\n    this.m_index = -1;\n    this.runNotationCallback();\n  }\n\n  getHumdrumScore (opts?: object) {\n    if (!opts) {\n      opts = {};\n    }\n    let output = [];\n    output.push(\"**mens\\t**text\");\n    if (opts['white'] !== true) {\n  \t   output.push(\"*black\\t*\");\n    }\n  \tvar i: number;\n  \tvar lines: string;\n  \tvar noteCounter = 0;\n  \tvar restCounter = 0;\n  \tvar hyphen = false;\n  \tvar options = opts;\n  \tfor (i=0; i<this.m_list.length; i++) {\n  \t\tvar item = this.m_list[i];\n  \t\tif (item.m_type == \"note\") {\n  \t\t\tnoteCounter += 1;\n  \t\t} else if (item.m_type == \"rest\") {\n  \t\t\trestCounter += 1;\n  \t\t}\n  \t\toptions[\"mark\"] = false;\n  \t\toptions[\"hyphen\"] = hyphen;\n  \t\tif (i == this.m_index) {\n  \t\t\toptions[\"mark\"] = true;\n  \t\t}\n  \t\tif (options[\"export\"]) {\n  \t\t\toptions[\"mark\"] = false;\n  \t\t}\n      if (item.m_id === undefined) {\n        item.m_id = 'm-' + v4();\n      }\n  \t\tlines = item.getHumdrumLine(options);\n  \t\tif (item.m_type === \"note\") {\n  \t\t\tif ((item as NoteItem).m_text.match(/-$/)) {\n  \t\t\t\thyphen = true;\n  \t\t\t} else {\n  \t\t\t\thyphen = false;\n  \t\t\t}\n  \t  \t}\n  \t\tthis.m_list[i].m_line = output.length + 1;\n  \t\toutput.push(lines);\n  \t}\n  \tif (noteCounter + restCounter == 0) {\n  \t\t// need to add a dummy rest to force display of clef\n  \t\toutput.push(\"4ryy\\t.\");\n  \t}\n\n  \toutput.push(\"=-\\t=-\");\n  \toutput.push(\"*-\\t*-\");\n  \tif (!options[\"export\"]) {\n  \t\toutput.push(\"!!!RDF**kern: @ = marked note\");\n      output.push(\"!!!RDF**kern: & = marked note, color=green\")\n  \t\t//output.push(\"!!!RDF**kern: i = marked note, color=blue\");\n  \t\t//output.push(\"!!!RDF**mens: @ = marked note\");\n  \t}\n\n  \tvar output2 = \"\";\n  \tfor (i=0; i<output.length; i++) {\n  \t\toutput2 += output[i] + \"\\n\";\n  \t}\n  \treturn output2;\n  }\n\n  selectItemByLine (lineNumber: number) {\n    for (let i = 0; i < this.m_list.length; i++) {\n      if (this.m_list[i].m_line === lineNumber) {\n        this.m_index = i;\n        this.runNotationCallback();\n        return;\n      }\n    }\n  }\n\n  processKeySig (pitch: string, accid: string): boolean {\n    if (this.m_list.length > 0) {\n      let first = this.m_list[0] as ClefItem;\n      if (first.m_type !== \"clef\") {\n        console.debug(\"First was not a clef!!!\");\n        return false;\n      }\n      if (first.m_keySig.has(pitch)) {\n        if (first.m_keySig.get(pitch) === accid) {\n          first.m_keySig.delete(pitch);\n        } else {\n          first.m_keySig.set(pitch, accid);\n        }\n      }\n      else {\n        first.m_keySig.set(pitch, accid);\n      }\n      this.runNotationCallback();\n      return true;\n    }\n  }\n}\n","import { v4 as uuidv4 } from 'uuid';\n\nimport { MusicList } from './MusicItem';\n\n// The voice a staff belongs to\nexport enum Voice {\n  altus='altus',\n  cantus='cantus',\n  contratenor='contratenor',\n  contratenor1='contratenor I',\n  contratenor2='contratenor II',\n  discantus='discantus',\n  duplum='duplum',\n  lowervoice1='lower voice I',\n  lowervoice2='lower voice II',\n  motetus='motetus',\n  quadruplum='quadruplum',\n  quintus='quintus',\n  superius='superius',\n  uppervoice1='upper voice I',\n  uppervoice2='uppervoice II',\n  tenor='tenor',\n  triplum='triplum',\n  bassus='bassus'\n}\n\n// comparator for voices\nexport function voiceToOrdinal(v: Voice): number {\n  switch (v) {\n    case Voice.altus:\n      return 8;\n    case Voice.cantus:\n      return 5;\n    case Voice.contratenor:\n      return 10;\n    case Voice.contratenor1:\n      return 10.1;\n    case Voice.contratenor2:\n      return 10.2;\n    case Voice.discantus:\n      return 5;\n    case Voice.duplum:\n      return 3;\n    case Voice.lowervoice1:\n      return 100;\n    case Voice.lowervoice2:\n      return 100.1;\n    case Voice.motetus:\n      return 3;\n    case Voice.quadruplum:\n      return 1;\n    case Voice.quintus:\n      return 8;\n    case Voice.superius:\n      return 5;\n    case Voice.uppervoice1:\n      return -1.1;\n    case Voice.uppervoice2:\n      return -1;\n    case Voice.tenor:\n      return 9;\n    case Voice.triplum:\n      return 2;\n    case Voice.bassus:\n      return 20;\n    default:\n      return 0;\n  }\n}\n\n// Values for modus, tempus, and prolatio\nexport enum Mensuration {\n  Three='3',\n  Two='2',\n  NA='N/A'\n}\n\nexport type BoundingBox = {\n  ulx: number;\n  uly: number;\n  lrx: number;\n  lry: number;\n}\n\nexport type PartMensuration = {\n  modus: Mensuration,\n  tempus: Mensuration,\n  prolatio: Mensuration\n};\n\nexport type VoicePair = {\n  voice: Voice,\n  mensurations: PartMensuration\n};\n\n/** Typedef to show when something is a IIIF manifest IRI */\nexport type IRI = string;\n\n/**\n * Class representing a staff that is selected on a canvas.\n * Should contain all the information about a staff that is available.\n */\nexport class Staff {\n  constructor(\n    ulx: number,\n    uly: number,\n    lrx: number,\n    lry: number,\n    canvas: string,\n    index: number,\n    voice?: Voice,\n    id?: string,\n    musicList?: MusicList\n  ) {\n    if (id) {\n      this.id = id;\n    }\n    else {\n      this.id = uuidv4();\n    }\n    this.bbox = { ulx: ulx, uly: uly, lrx: lrx, lry: lry };\n    this.canvas = canvas;\n    this.index = index;\n    if (voice) {\n      this.voice = voice;\n    }\n    else {\n      this.voice = Voice.triplum;\n    }\n\n    if (musicList) {\n      this.musicList = musicList;\n    }\n    else {\n      this.musicList = new MusicList();\n    }\n  }\n\n  get svg() {\n    let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n    rect.setAttribute('x', this.bbox.ulx.toString());\n    rect.setAttribute('y', this.bbox.uly.toString());\n    rect.id = this.id;\n    rect.setAttribute('width', (this.bbox.lrx - this.bbox.ulx).toString());\n    rect.setAttribute('height', (this.bbox.lry - this.bbox.uly).toString());\n    rect.classList.add(\"zoneRect\");\n    return rect;\n  }\n\n  static compare(staffA: Staff, staffB: Staff): number {\n    let indexDiff = staffA.index - staffB.index;\n    if (indexDiff !== 0) {\n      return indexDiff;\n    }\n    else {\n      return staffA.bbox.uly - staffB.bbox.uly;\n    }\n  }\n\n  id: string;\n\n  // Information about the contents of the staff\n  voice: Voice;\n  modus: Mensuration;\n  tempus: Mensuration;\n  prolatio: Mensuration;\n\n  bbox: BoundingBox;  // Relative to the canvas\n  canvas: string;     // IIIF canvas @id for the page containing this staff.\n  index: number;      // 0-based page index\n\n  musicList: MusicList;\n}\n","import { Part, Tenor } from './part';\nimport { System, Pb, Sb } from './system';\nimport { ClefItem, NoteItem, RestItem, MensurItem } from './MusicItem';\nimport { Voice, Mensuration } from './definitions';\nimport { IRI } from './definitions';\n\n\nexport const NAMESPACE = 'http://www.music-encoding.org/ns/mei';\n\nexport class MEIDocument {\n  parts: Part[];\n  metadata: Metadata;  // Should this be broken up better?\n  notationSubtype: string;\n\n  _meiDoc: Document;\n\n  get notationType(): string {\n    if (/Ars[_ ](antiqua|nova)/.test(this.notationSubtype)) {\n      return \"mensural.black\";\n    } else {\n      return \"mensural.white\";\n    }\n  }\n\n  constructor (manuscriptIRI: IRI) {  // This is for creating a new document\n    this.metadata = new Metadata();\n    this.metadata.sourceIRI = manuscriptIRI;\n    this.parts = [];\n    this._createSkeletonMEI();\n  }\n\n  static fromXML(source: XMLDocument): MEIDocument {\n    let doc = source.documentElement;\n    let iiif = \"\";\n    try {\n      let sourceElement = doc.querySelector(\"source\");\n      iiif = sourceElement.getAttribute(\"target\");\n    } catch (e) {\n      console.debug(e);\n    }\n    let mei = new MEIDocument(iiif);\n\n    // Try to get metadata\n    let titleStmt = doc.querySelector(\"titleStmt\");\n    if (titleStmt) {\n      if (titleStmt.querySelector(\"title\")) {\n        mei.metadata.shortTitle = titleStmt.querySelector(\"title\").textContent;\n      }\n      if (titleStmt.querySelector(\"persName\") && titleStmt.querySelector(\"persName\").getAttribute(\"role\") === \"encoder\") {\n        mei.metadata.encoderName = titleStmt.querySelector(\"persName\").textContent;\n      }\n      if (titleStmt.querySelector(\"composer\")) {\n        mei.metadata.composerName = titleStmt.querySelector(\"composer\").textContent;\n      }\n    }\n\n    let facsimile = doc.querySelector(\"facsimile\");\n    let surfaces = Array.from(facsimile.querySelectorAll(\"surface\"));\n    let zones = Array.from(facsimile.querySelectorAll(\"zone\"));\n\n    // Start processing parts\n    const parts = Array.from(doc.querySelectorAll(\"part\"));\n    for (const part of parts) {\n      let staffDef = part.querySelector(\"staffDef\");\n      console.assert(staffDef.hasAttribute(\"label\"));\n      let voice = staffDef.getAttribute(\"label\");\n      let partObj: Part | Tenor = /^[tT]enor/.test(voice) ? new Tenor(mei, part.getAttribute(\"xml:id\")) : new Part(mei, part.getAttribute(\"xml:id\"));\n      partObj.voice = Voice[voice];\n      mei.parts.push(partObj);\n      let mensur = staffDef.querySelector(\"mensur\");\n\n      if (staffDef.hasAttribute(\"notationsubtype\")) {\n        mei.notationSubtype = staffDef.getAttribute(\"notationsubtype\");\n      } else {\n        mei.notationSubtype = \"\";\n      }\n      if (staffDef.hasAttribute(\"modusminor\")) {\n        partObj.modus = staffDef.getAttribute(\"modusminor\") as Mensuration;\n      } else if (mensur && mensur.hasAttribute(\"modusminor\")) {\n        partObj.modus = mensur.getAttribute(\"modusminor\") as Mensuration;\n      }\n      if (staffDef.hasAttribute(\"tempus\")) {\n        partObj.tempus = staffDef.getAttribute(\"tempus\") as Mensuration;\n      } else if (mensur && mensur.hasAttribute(\"tempus\")) {\n        partObj.tempus = mensur.getAttribute(\"tempus\") as Mensuration;\n      }\n      if (staffDef.hasAttribute(\"prolatio\")) {\n        partObj.prolatio = staffDef.getAttribute(\"prolatio\") as Mensuration;\n      } else if (mensur && mensur.hasAttribute(\"prolatio\")) {\n        partObj.prolatio = mensur.getAttribute(\"prolatio\") as Mensuration;\n      }\n\n      const layer = part.querySelector(\"layer\");\n      // Handle repeating tenor if tenor\n      if (/^[tT]enor/.test(partObj.voice)) {\n        const dir = part.querySelector(\"dir\");\n        if (dir) {\n          const tenorObj = partObj as Tenor;\n          tenorObj.repetitions = Number(dir.getAttribute(\"n\")) + 1\n          const matchResults = dir.getAttribute(\"plist\").match(/^#[-\\w\\d]+ #([-\\w\\d]+)$/);\n          if (matchResults.length > 1) {\n            tenorObj.endingId = matchResults[1];\n          }\n        }\n      }\n      // Handle regular children\n      const layerChildren = Array.from(layer.querySelectorAll(\"pb,sb,clef,note,rest,mensur\"));\n      let activePb: Pb = null;\n      let activeSystem: System = null;\n      for (const child of layerChildren) {\n        if (child.tagName === \"pb\") {\n          let facs = child.getAttribute(\"facs\").split(\"#\")[1];\n          console.assert(surfaces.some(el => { return el.getAttribute(\"xml:id\") === facs; }));\n          let surface = surfaces.find(el => { return el.getAttribute(\"xml:id\") === facs; });\n          let graphic = surface.querySelector(\"graphic\");\n          activePb = new Pb(graphic.getAttribute(\"target\"), child.getAttribute(\"xml:id\"));\n\n          // Determine Pb index\n          function setIndex(pb: Pb) {\n            fetch(iiif).then(response => {\n              return response.json();\n            }).then((manifest: object) => {\n              let canvases: object[] = manifest[\"sequences\"][0][\"canvases\"];\n              pb.index = canvases.findIndex(canvas => { return canvas[\"@id\"] === pb.canvasIRI; });\n            });\n          }\n\n          setIndex(activePb);\n        } else if (child.tagName === \"sb\") {\n          let sb: Sb;\n          if (child.hasAttribute(\"facs\")) {\n            let facs = child.getAttribute(\"facs\").split(\"#\")[1];\n            console.assert(zones.some(el => { return el.getAttribute(\"xml:id\") === facs; }));\n            let zone = zones.find(el => { return el.getAttribute(\"xml:id\") === facs; });\n            sb = new Sb(\n              {\n                ulx: Number(zone.getAttribute(\"ulx\")),\n                uly: Number(zone.getAttribute(\"uly\")),\n                lrx: Number(zone.getAttribute(\"lrx\")),\n                lry: Number(zone.getAttribute(\"lry\"))\n              },\n              child.getAttribute(\"xml:id\")\n            );\n          } else {\n            sb = new Sb({ulx: 0, uly: 0, lrx: 0, lry: 0}, child.getAttribute(\"xml:id\"));\n          }\n          activeSystem = new System();\n          activeSystem.sb = sb;\n          activeSystem.pb = activePb;\n          partObj.addSystem(activeSystem);\n        } else if (child.tagName === \"clef\") {\n          let clef = ClefItem.parseXML(child);\n          activeSystem.contents.m_list.push(clef);\n        } else if (child.tagName === \"rest\") {\n          let rest = RestItem.parseXML(child);\n          activeSystem.contents.m_list.push(rest);\n        } else if (child.tagName === \"note\") {\n          let note = NoteItem.parseXML(child);\n          activeSystem.contents.m_list.push(note);\n        } else if (child.tagName === \"mensur\") {\n          let mensur = MensurItem.parseXML(child);\n          activeSystem.contents.m_list.push(mensur);\n        }\n      }\n    }\n\n    return mei;\n  }\n\n  generateXML(): Document {\n    this._createSkeletonMEI();\n    let parts = this._meiDoc.querySelector('parts');\n    this.parts.sort(Part.compare);\n    for (let part of this.parts) {\n      if (part.systems.length === 0) {\n        continue;\n      }\n      let partElement = /^[tT]enor/.test(part.voice) ?\n        (part as Tenor).generatePartXML() : part.generatePartXML();\n      if (partElement.querySelector('layer').children.length === 0) continue;\n      parts.appendChild(partElement);\n    }\n    return this._meiDoc;\n  }\n\n  _createSkeletonMEI() {\n    this._meiDoc = document.implementation.createDocument(NAMESPACE, 'mei', null);\n    let mei = this._meiDoc.documentElement;\n    mei.setAttribute('meiversion', '4.0.1');\n    // Create Header\n    let head = this._generateHeader();\n    // TODO Add more to header\n    mei.appendChild(head);\n\n    // Create music skeleton\n    let music = this._meiDoc.createElementNS(NAMESPACE, 'music');\n    let facsimile = this._meiDoc.createElementNS(NAMESPACE, 'facsimile');\n    let body = this._meiDoc.createElementNS(NAMESPACE, 'body');\n    let mdiv = this._meiDoc.createElementNS(NAMESPACE, 'mdiv');\n    let parts = this._meiDoc.createElementNS(NAMESPACE, 'parts');\n    mei.appendChild(music);\n    music.appendChild(facsimile);\n    music.appendChild(body);\n    body.appendChild(mdiv);\n    mdiv.appendChild(parts);\n  }\n\n  _generateHeader(): Element {\n    let meiHead = this._meiDoc.createElementNS(NAMESPACE, \"meiHead\");\n    let fileDesc = this._meiDoc.createElementNS(NAMESPACE, \"fileDesc\");\n    meiHead.appendChild(fileDesc);\n    let titleStmt = this._meiDoc.createElementNS(NAMESPACE, \"titleStmt\");\n    fileDesc.appendChild(titleStmt);\n    let title = this._meiDoc.createElementNS(NAMESPACE, \"title\");\n    title.textContent = this.metadata.shortTitle;\n    titleStmt.appendChild(title);\n    let composer = this._meiDoc.createElementNS(NAMESPACE, \"composer\");\n    composer.textContent = this.metadata.composerName;\n    titleStmt.appendChild(composer);\n    let respStmt = this._meiDoc.createElementNS(NAMESPACE, \"respStmt\");\n    titleStmt.appendChild(respStmt);\n    let persName = this._meiDoc.createElementNS(NAMESPACE, \"persName\");\n    persName.textContent = this.metadata.encoderName;\n    persName.setAttribute(\"role\", \"encoder\");\n    respStmt.appendChild(persName);\n    let pubStmt = this._meiDoc.createElementNS(NAMESPACE, \"pubStmt\");\n    fileDesc.appendChild(pubStmt);\n\n    let sourceDesc = this._meiDoc.createElementNS(NAMESPACE, \"sourceDesc\");\n    fileDesc.appendChild(sourceDesc);\n    let source = this._meiDoc.createElementNS(NAMESPACE, \"source\");\n    source.setAttribute(\"target\", this.metadata.sourceIRI);\n    sourceDesc.appendChild(source);\n\n    return meiHead;\n  }\n\n  getSystems(): System[] {\n    let allSystems: System[] = [];\n    for (let part of this.parts) {\n      allSystems.unshift(...part.systems);\n    }\n    return allSystems;\n  }\n\n  getSystem(id: string): System {\n    let allSystems = this.getSystems();\n    let systemList = allSystems.filter(system => { return system.id === id; });\n    return systemList.length > 0 ? systemList[0] : null;\n  }\n\n  getPart(voice: Voice): Part {\n    let partlist = this.parts.filter(part => { return part.voice === voice; });\n    return partlist.length > 0 ? partlist[0] : null;\n  }\n\n  getOrCreatePart(voice: Voice): Part {\n    if (this.parts.some(part => { return part.voice === voice; })) {\n      return this.getPart(voice);\n    }\n    let part = /^[tT]enor/.test(voice) ? new Tenor(this) : new Part(this);\n    part.voice = voice;\n    this.parts.push(part);\n    this.parts.sort(Part.compare);\n    return part;\n  }\n\n  getPb(index: number): Pb {\n    let pbs = new Set<Pb>();\n    for (let part of this.parts) {\n      part.systems.forEach(system => {\n        pbs.add(system.pb);\n      });\n    }\n    for (let pb of pbs.values()) {\n      if (pb.index === index) return pb;\n    }\n    return null;\n  }\n}\n\nclass Metadata {\n  shortTitle: string;\n  sourceIRI: IRI;\n  composerName: string;\n  encoderName: string;\n}\n","import { v4 as uuid } from 'uuid';\n\nimport { Voice, Mensuration, IRI, voiceToOrdinal } from './definitions';\nimport { System } from './system';\nimport { MEIDocument, NAMESPACE } from './mei';\n\nexport class Part {\n  voice: Voice;\n  modus: Mensuration;\n  tempus: Mensuration;\n  prolatio: Mensuration;\n  id: string;\n  parent: MEIDocument;\n\n  systems: System[];\n\n  constructor(doc: MEIDocument, id?: string) {\n    this.parent = doc;\n    if (id) {\n      this.id = id;\n    } else {\n      id = 'm-' + uuid();\n    }\n\n    this.systems = [];\n    this.modus = Mensuration.NA;\n    this.tempus = Mensuration.NA;\n    this.prolatio = Mensuration.NA;\n  }\n\n  static compare(a: Part, b: Part): number {\n    return voiceToOrdinal(a.voice) - voiceToOrdinal(b.voice);\n  }\n\n  addSystem(system: System) {\n    system.parent = this;\n    this.systems.push(system);\n  }\n\n  removeSystem(id: string): System {\n    let matches = this.systems.filter(system => { return system.id === id; });\n    if (matches.length > 0) {\n      let index = this.systems.indexOf(matches[0]);\n      let removed = this.systems.splice(index, 1);\n      return removed[0];\n    }\n    return null;\n  }\n\n  generatePartXML(): Element {\n    this.systems.sort(System.compare);\n    let part = this.parent._meiDoc.createElementNS(NAMESPACE, 'part');\n    let scoreDef = this._generateScoreDef();\n    part.appendChild(scoreDef);\n\n    let staffDef = scoreDef.querySelector('staffDef');\n    staffDef.setAttribute('label', this.voice.toString());\n    let mensur = this.parent._meiDoc.createElementNS(NAMESPACE, 'mensur');\n    staffDef.appendChild(mensur);\n    if (this.modus !== Mensuration.NA) {\n      mensur.setAttribute('modusminor', this.modus.toString());\n    }\n    if (this.tempus !== Mensuration.NA) {\n      mensur.setAttribute('tempus', this.tempus.toString());\n    }\n    if (this.prolatio !== Mensuration.NA) {\n      mensur.setAttribute('prolatio', this.prolatio.toString());\n    }\n\n    let section = this.parent._meiDoc.createElementNS(NAMESPACE, 'section');\n    part.appendChild(section);\n    let staff = this.parent._meiDoc.createElementNS(NAMESPACE, 'staff');\n    staff.setAttribute('n', '1');\n    section.appendChild(staff);\n    let layer = this.parent._meiDoc.createElementNS(NAMESPACE, 'layer');\n    layer.setAttribute('n', '1');\n    staff.appendChild(layer);\n\n    let currentPage: IRI = null\n    let graphic: Element = null;\n    let facsimile: Element = this.parent._meiDoc.querySelector('facsimile');\n    for (let system of this.systems) {\n      let contents = system.getContents();\n      console.debug(contents);\n      if (contents.filter(el => { return el.tagName !== 'clef' && el.tagName !== 'rest'; }).length === 0) {\n        continue;\n      }\n      // Handle paging\n      if (system.pb.canvasIRI !== currentPage) {\n        let pb = this.parent._meiDoc.createElementNS(NAMESPACE, 'pb');\n        let temp = Array.from(facsimile.querySelectorAll('graphic'))\n          .filter(graphic => graphic.getAttribute('target') === system.pb.canvasIRI);\n        if (temp.length > 0) {\n          // Use existing page in mei\n          graphic = temp[0];\n        } else {\n          // Create new page\n          let surface = this.parent._meiDoc.createElementNS(NAMESPACE, 'surface');\n          surface.setAttribute('xml:id', 'm-' + uuid());\n          graphic = this.parent._meiDoc.createElementNS(NAMESPACE, 'graphic');\n          graphic.setAttribute('xml:id', 'm-' + uuid());\n          graphic.setAttribute('target', system.pb.canvasIRI);\n          surface.appendChild(graphic);\n          facsimile.appendChild(surface);\n        }\n        let surface = graphic.closest(\"surface\");\n        pb.setAttribute('facs', '#' + surface.getAttribute('xml:id'));\n        pb.setAttribute('xml:id', system.pb.id);\n        currentPage = system.pb.canvasIRI;\n        layer.appendChild(pb);\n      }\n\n      // Handle sb\n      let zone = this.parent._meiDoc.createElementNS(NAMESPACE, 'zone');\n      let zoneId = 'm' + uuid();\n      zone.setAttribute('xml:id', zoneId);\n      zone.setAttribute('ulx', Math.round(system.sb.zone.ulx).toString());\n      zone.setAttribute('uly', Math.round(system.sb.zone.uly).toString());\n      zone.setAttribute('lrx', Math.round(system.sb.zone.lrx).toString());\n      zone.setAttribute('lry', Math.round(system.sb.zone.lry).toString());\n      graphic.appendChild(zone);\n\n      let sb = this.parent._meiDoc.createElementNS(NAMESPACE, 'sb');\n      sb.setAttribute('facs', '#' + zone.getAttribute('xml:id'));\n      sb.setAttribute('xml:id', system.sb.id);\n      layer.appendChild(sb);\n\n      // Add contents. Child here should have correct xml:id including children\n      contents.forEach(child => {\n        // Remove @color and @marked\n        if (child.hasAttribute('color')) child.removeAttribute('color');\n        if (child.hasAttribute('type')) child.removeAttribute('type');\n\n        if (child.tagName === 'ligature') {\n          child.removeAttribute('form');\n        }\n\n        layer.appendChild(child);\n      });\n    }\n    return part;\n  }\n\n  _generateScoreDef(): Element {\n    let scoreDef = this.parent._meiDoc.createElementNS(NAMESPACE, 'scoreDef');\n    let staffGrp = this.parent._meiDoc.createElementNS(NAMESPACE, 'staffGrp');\n    scoreDef.appendChild(staffGrp);\n    let staffDef = this.parent._meiDoc.createElementNS(NAMESPACE, 'staffDef');\n    staffDef.setAttribute('n', '1');\n    staffDef.setAttribute('lines', '5');\n    staffDef.setAttribute('notationtype', this.parent.notationType);\n    staffDef.setAttribute('notationsubtype', this.parent.notationSubtype);\n    staffGrp.appendChild(staffDef);\n    return scoreDef;\n  }\n}\n\nexport class Tenor extends Part {\n  repetitions: number;\n  endingId: string;\n\n  constructor(doc: MEIDocument, id?: string) {\n    super(doc, id);\n    this.voice = Voice.tenor;\n    this.repetitions = 1;   // default\n  }\n\n  generatePartXML(): Element {\n    let part = super.generatePartXML();\n    // Set repeating tenor if necessary\n    if (this.repetitions > 1) {\n      /* IMPORTANT NOTE */\n      /* The \"n\" attribute here is used to represent the number of repetitions */\n      /* It does NOT mean this is the nth directive of the piece */\n      /* This should be replaced with a correct MEI attribute when possible */\n      let dir = this.parent._meiDoc.createElementNS(NAMESPACE, 'dir');\n      dir.setAttribute('n', (this.repetitions - 1).toString());\n      dir.setAttribute('layer', '1');\n      console.debug(part);\n      console.debug(part.querySelector('note,ligature,rest'));\n      let firstNoteId = part.querySelector('note,ligature,rest').getAttribute('xml:id');\n      // let endingId = (this.endingId !== undefined) ? this.endingId : part.querySelector('layer').lastElementChild.getAttribute('xml:id');\n      // Get ending ligature if it's in one\n      console.debug(part);\n      console.debug(this.endingId);\n      let endItem = (this.endingId !== undefined) ? Array.from(part.querySelectorAll('note')).find(el => { return el.getAttribute('xml:id') === this.endingId; }) : part.querySelector('layer').lastElementChild;\n      let endingId = (endItem.closest('ligature') === null) ? endItem.getAttribute('xml:id') : endItem.closest('ligature').getAttribute('xml:id');\n      dir.setAttribute('plist', '#' + firstNoteId + ' #' + endingId);\n      dir.setAttribute('follows', '#' + endingId);\n      let staff = part.querySelector('staff');\n      staff.appendChild(dir);\n      dir.insertAdjacentHTML(\n        'beforebegin',\n        '<!-- The @n attribute on <dir> is used to represent the number of repetitions in a machine readable format. -->'\n      );\n    }\n    return part;\n  }\n}\n","import { IRI, BoundingBox, Voice, Mensuration } from './definitions';\nimport { MusicList, NoteItem, MensurItem, PlicaStatus } from './MusicItem';\nimport { Part } from './part';\nimport { v4 as uuid } from 'uuid';\nimport { vrvToolkit } from './verovio';\n\nexport class Pb {\n  canvasIRI: IRI;\n  index: number;\n  id: string;\n\n  constructor(iri: IRI, id?: string) {\n    this.canvasIRI = iri;\n    if (id) {\n      this.id = id;\n    } else {\n      this.id = 'm-' + uuid();\n    }\n  }\n}\n\nexport class Sb {\n  zone: BoundingBox;\n  id: string;\n\n  constructor(zone: BoundingBox, id?: string) {\n    if (id) {\n      this.id = id;\n    } else {\n      this.id = 'm-' + uuid();\n    }\n\n    this.zone = zone;\n  }\n\n  get svg() {\n    let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n    rect.setAttribute('x', this.zone.ulx.toString());\n    rect.setAttribute('y', this.zone.uly.toString());\n    rect.id = this.id;\n    rect.setAttribute('width', (this.zone.lrx - this.zone.ulx).toString());\n    rect.setAttribute('height', (this.zone.lry - this.zone.uly).toString());\n    rect.classList.add('zoneRect');\n    return rect;\n  }\n}\n\nexport class System {\n  pb: Pb;\n  sb: Sb;\n  parent: Part;\n  contents: MusicList;\n\n  constructor (contents?: MusicList) {\n    if (contents) {\n      this.contents = contents;\n    } else {\n      this.contents = new MusicList();\n    }\n  }\n\n  static compare(a: System, b: System): number {\n    let diff = a.pb.index - b.pb.index;\n    if (diff !== 0) return diff;\n    // Check for intersection on y-axis. If so, left-most. Else highest.\n    const aZone = a.sb.zone;\n    const bZone = b.sb.zone;\n    const threshold = 0.25;\n\n    const diff1 = aZone.lry - bZone.uly;\n    const diff2 = bZone.lry - aZone.uly;\n    if (diff1 > 0 && diff2 > 0) {\n      const overlap = Math.min(diff1, diff2);\n      const avHeight = (aZone.lry - aZone.uly + bZone.lry - bZone.uly) / 2;\n      if (overlap > threshold * avHeight) {\n        return aZone.ulx - bZone.ulx;\n      }\n    }\n    return a.sb.zone.uly - b.sb.zone.uly;\n  }\n\n  get id(): string {\n    return this.sb.id;\n  }\n\n  get voice(): Voice {\n    return this.parent.voice;\n  }\n\n  set voice(voice: Voice) {\n    if (voice !== this.parent.voice) {\n      let newPart = this.parent.parent.getOrCreatePart(voice);\n      let idx = this.parent.systems.indexOf(this);\n      this.parent.systems.splice(idx, 1);\n      newPart.addSystem(this);\n    }\n  }\n\n  getContents(): Element[] {\n    let whiteMensural = this.parent.parent.notationType === \"mensural.white\";\n    console.debug(this.parent.parent.notationType);\n    let rawMei = vrvToolkit.humdrumToMEI(this.contents.getHumdrumScore({white: whiteMensural}));\n    let parser = new DOMParser();\n    let elements: Element[] = [];\n    let humdrumMei = parser.parseFromString(rawMei, 'application/xml');\n    let clef = humdrumMei.querySelector('clef');\n    if (clef !== null) {\n      this._recurseId(clef);\n      elements.push(clef);\n    }\n    let mensur = humdrumMei.querySelector('mensur');\n    if (mensur !== null && mensur.closest('layer') === null) {\n      this._recurseId(mensur);\n      elements.push(mensur);\n    }\n    let layer = humdrumMei.querySelector('layer');\n    console.debug(layer);\n    if (layer !== null) {\n      for (let child of Array.from(layer.children)) {\n        this._recurseId(child);\n        if (child.tagName === \"note\" && child.hasAttribute(\"dots\")) {\n          child.removeAttribute(\"dots\");\n        }\n        elements.push(child);\n      }\n    }\n    return elements;\n  }\n\n  _recurseId(element: Element) {\n    let id = element.getAttribute('xml:id');\n    let found = false;\n    if (id && /(note|rest|clef|pb|sb|mensur)/.test(element.tagName)) {\n      let regexpInfo = id.match(/L(\\d+)[\\w\\d]+$/);\n      if (regexpInfo) {\n        let line = parseInt(regexpInfo[1]);\n        let match = this.contents.m_list.filter(el => {\n          return el.m_line === line;\n        });\n        if (match.length > 0) {\n          found = true;\n          element.setAttribute('xml:id', match[0].m_id);\n          if (match[0].m_type === \"mensur\") {\n            let mensur = match[0] as MensurItem;\n            if (mensur.m_modus !== Mensuration.NA) {\n              element.setAttribute(\"modusminor\", mensur.m_modus.toString());\n            }\n            if (mensur.m_tempus !== Mensuration.NA) {\n              element.setAttribute(\"tempus\", mensur.m_tempus.toString());\n            }\n            if (mensur.m_prolatio !== Mensuration.NA) {\n              element.setAttribute(\"prolatio\", mensur.m_prolatio.toString());\n            }\n            if (element.hasAttribute('sign')) {\n              element.removeAttribute('sign');\n            }\n            if (element.hasAttribute('dot')) {\n              element.removeAttribute('dot');\n            }\n          }\n          else if (match[0].m_type === 'note') {\n            let note = match[0] as NoteItem;\n            if (note.m_plica === PlicaStatus.UP) {\n              element.setAttribute('plica', 'up');\n            }\n            else if (note.m_plica === PlicaStatus.DOWN) {\n              element.setAttribute('plica', 'down');\n            }\n          }\n        }\n      }\n    }\n    if (!found) {\n      element.setAttribute('xml:id', 'm-' + uuid());\n    }\n    for (let child of Array.from(element.children)) {\n      this._recurseId(child);\n    }\n  }\n}\n","declare let verovio;\ndeclare let verovioReady: boolean;\n\nclass VrvObj {\n  vrvToolkit = null;\n  options = null;\n\n  constructor() {\n    this.options = {\n      humType: 0,\n      scale: 90,\n      spacingNonLinear: 0.35,\n      lyricSize: 3,\n      breaks: 'none',\n      choiceXPathQuery: './corr',\n    }\n  }\n\n  setup() {\n    if (!this.vrvToolkit) {\n      this.vrvToolkit = new verovio.toolkit();\n      this.vrvToolkit.setOptions(this.options);\n    }\n  }\n\n  humdrumToMEI(data: string): string {\n    this.vrvToolkit.loadData(data);\n    return this.vrvToolkit.getMEI({\n      pageNo: 0,\n      scoreBased: true\n    });\n  }\n\n  humdrumToSVG(humdrumData: string): SVGSVGElement {\n    this.vrvToolkit.loadData(humdrumData);\n    let data = this.vrvToolkit.renderToSVG(1);\n    const parser = new DOMParser();\n    return parser.parseFromString(data, 'image/svg+xml').documentElement as unknown as SVGSVGElement;\n  }\n\n  meiToSVG(meiDoc: XMLDocument): SVGSVGElement {\n    const serializer = new XMLSerializer();\n    const serializedMei = serializer.serializeToString(meiDoc);\n    const parser = new DOMParser();\n    this.vrvToolkit.loadData(serializedMei);\n    const svgRaw = this.vrvToolkit.renderToSVG(1);\n    return parser.parseFromString(svgRaw, 'image/svg+xml').documentElement as unknown as SVGSVGElement;\n  }\n}\n\nexport const vrvToolkit = new VrvObj();\n","// This file can be replaced during build by using the `fileReplacements` array.\n// `ng build --prod` replaces `environment.ts` with `environment.prod.ts`.\n// The list of file replacements can be found in `angular.json`.\n\nexport const environment = {\n  production: false\n};\n\n/*\n * For easier debugging in development mode, you can import the following file\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\n *\n * This import should be commented out in production mode because it will have a negative impact\n * on performance if an error is thrown.\n */\n// import 'zone.js/dist/zone-error';  // Included with Angular CLI.\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\ndeclare let verovioReady: boolean;\n\nif (environment.production) {\n  enableProdMode();\n}\n\ninit().then( () => {\n  platformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err))\n});\n\nasync function init() {\n  console.debug('check');\n  while (!verovioReady) {\n    console.debug('wait');\n    await new Promise(r => { setTimeout(r, 250); });\n  }\n  console.debug('done');\n}\n"]}