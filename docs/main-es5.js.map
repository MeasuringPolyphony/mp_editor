{"version":3,"sources":["webpack:///$_lazy_route_resource lazy namespace object","webpack:///src/app/app.component.ts","webpack:///src/app/app.component.html","webpack:///src/app/app.module.ts","webpack:///src/app/input/diva-view/diva-view.component.ts","webpack:///src/app/input/diva-view/diva-view.component.html","webpack:///src/app/input/input.component.ts","webpack:///src/app/input/input.component.html","webpack:///src/app/input/input.module.ts","webpack:///src/app/input/input.service.ts","webpack:///src/app/input/staff-select/staff-select.component.ts","webpack:///src/app/input/staff-select/staff-select.component.html","webpack:///src/app/input/toolbar/toolbar.component.ts","webpack:///src/app/input/toolbar/toolbar.component.html","webpack:///src/app/score-editor/doc.service.ts","webpack:///src/app/score-editor/score-diva-view/score-diva-view.component.ts","webpack:///src/app/score-editor/score-diva-view/score-diva-view.component.html","webpack:///src/app/score-editor/score-editor.component.ts","webpack:///src/app/score-editor/score-editor.component.html","webpack:///src/app/score-editor/score-editor.module.ts","webpack:///src/app/score-editor/score-toolbar/score-toolbar.component.ts","webpack:///src/app/score-editor/score-toolbar/score-toolbar.component.html","webpack:///src/app/score-editor/score-verovio-view/score-verovio-view.component.ts","webpack:///src/app/score-editor/score-verovio-view/score-verovio-view.component.html","webpack:///src/app/score-editor/selected-staff.service.ts","webpack:///src/app/select-document/select-document.component.ts","webpack:///src/app/select-document/select-document.component.html","webpack:///src/app/state-service.service.ts","webpack:///src/app/tools.ts","webpack:///src/app/utils/MusicItem.ts","webpack:///src/app/utils/definitions.ts","webpack:///src/app/utils/mei.ts","webpack:///src/app/utils/part.ts","webpack:///src/app/utils/system.ts","webpack:///src/app/utils/verovio.ts","webpack:///src/environments/environment.ts","webpack:///src/main.ts"],"names":["webpackEmptyAsyncContext","req","Promise","resolve","then","e","Error","code","keys","module","exports","id","AppComponent","setup","selector","templateUrl","styleUrls","routes","path","component","pathMatch","AppModule","forRoot","useHash","declarations","imports","providers","bootstrap","DivaViewComponent","selectedSystem","stateService","creatingStaff","firstPoint","diva","objectData","iiifManifest","Events","subscribe","refreshOverlay","bind","settings","ID","handleZoom","getActivePageIndex","selected","deactivate","destroy","console","warn","disableDragScrollable","enableDragScrollable","evt","target","tagName","Array","from","document","getElementsByClassName","forEach","elem","classList","remove","staff","mei","getSystem","add","shiftKey","activeContainer","getElementById","toString","firstElementChild","clientPoint","createSVGPoint","x","clientX","y","clientY","transformMatrix","getScreenCTM","matrixTransform","inverse","rect","createElementNS","setAttribute","appendChild","drawingRect","container","viewportElement","currentPoint","transformedPoint","Math","min","abs","pageIndex","secondPoint","pb","getPb","getCurrentCanvas","index","sb","ulx","uly","lrx","max","lry","part","parent","getOrCreatePart","triplum","newSystem","addSystem","inner","innerElement","dimensions","getPageDimensionsAtCurrentZoomLevel","offset","viewHandler","_viewerCore","getPageRegion","includePadding","incorporateViewport","marginLeft","getComputedStyle","getPropertyValue","pageContainer","createElement","svgParent","maxZoom","getPageDimensionsAtZoomLevel","Number","MAX_SAFE_INTEGER","width","height","style","position","top","left","parseInt","firstChild","systemsOnPage","getSystems","filter","system","item","svg","display","setTimeout","zoomDuration","mousedownHandler","mousemoveHandler","clickHandler","mouseupHandler","encapsulation","None","InputComponent","route","metadataForm","shortTitle","required","composerName","contributors","notationSubtype","siglum","genre","inputStep","InputStep","METADATA","source","snapshot","paramMap","get","identifier","decodeURIComponent","metadata","undefined","controls","setValue","contributor","temp","type","name","push","debug","editorialMode","value","entry","length","map","sourceIRI","INPUT","removeAt","InputModule","InputService","_selected","next","providedIn","StaffSelectComponent","router","voices","Object","entries","keySigMode","pitchSig","accidSig","staffForm","voice","modus","tempus","prolatio","mensurForm","modus2","tempus2","prolatio2","nativeElement","innerHTML","element","humdrumToSVG","contents","getHumdrumScore","white","notationType","test","tenor","endingId","endNote","event","nodeName","matches","match","selectItemByLine","updateSVG","parentNode","navigate","getPart","layer","querySelector","lastElementChild","regexpInfo","line","m_list","el","m_line","m_id","handleKeySigPress","preventDefault","metaKey","musicList","m_index","key","processDigit","state","addTextToCurrentItem","clearTextOnCurrentItem","deleteCharacterOnCurrentItem","removeLastItem","addPitchFar","C","addPitchNear","D","E","F","G","A","B","hasOpenLigature","addMensur","processPlica","addRest","alert","processDotKey","selectBackward","selectForward","raisePitch","lowerPitch","goToEndOfList","processLig","processAccidental","digit","_event","m_rhythm","ending","m_type","runNotationCallback","note","m_dot","isStart","m_lig","START","NONE","END","m_plica","DOWN","UP","processKeySig","accid","m_accid","SHARP","FLAT","NATURAL","handleClick","ToolbarComponent","dialog","currentStaff","generateXML","serializer","XMLSerializer","content","serializeToString","blob","Blob","window","URL","createObjectURL","removeSystem","saveClick","DocService","_parts","_score","_partsSubject","_scoreSubject","doc","ScoreDivaViewComponent","staffService","pageToCanvasMap","Map","parseCanvases","getStaffLocation","iri","bbox","redraw","getCurrentPageIndices","includes","gotoPageByIndex","manifest","sequences","sequence","canvases","canvas","set","indexOf","ScoreEditorComponent","meiDoc","ScoreEditorModule","ScoreToolbarComponent","currentDoc","refinedDoc","cloneNode","scoreOptions","modernClefs","barlines","parts","confirm","navigator","clipboard","writeText","err","goToInputEditor","savePartsClick","copyToClipboard","pnameOrder","recurseXmlId","hasAttribute","i","children","ScoreVerovioViewComponent","selectedId","corrToSicMap","meiToSVG","setSelected","_e","partsId","has","resolver","createNSResolver","ownerDocument","documentElement","meiRes","ref","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","result","ORDERED_NODE_SNAPSHOT_TYPE","snapshotItem","snapshotLength","pbFacsId","getAttribute","substring","sbFacsId","pbGraphic","getElementsByTagName","pop","sbZone","staffLocation","score","runScoringUp","contains","parentElement","ensureCorrElement","sibling","nextElementSibling","nextSibling","dot","insertAdjacentElement","currentPname","idx","removeAttribute","clone","cloneDot","plica","output","staffDef","quasiDoc","lining_up","replace_ligatures_by_brackets","error","closest","choice","corr","sic","corrTarget","sibCorr","SelectedStaffService","_staffLoc","loc","SelectDocumentComponent","file","invalid","selectionForm","resourceURL","url","loadMEIForm","fileInput","encodeURIComponent","reader","FileReader","addEventListener","rawText","parser","DOMParser","parseFromString","fromXML","iiif","readAsText","submit","meiSubmit","onFileChange","StateService","formIIIFManifest","gallicaRegexp","RegExp","gallicaIIIFRegexp","ecodicesRegexp","ecodicesIIIFRegexp","genericIIIFRegexp","parseRhythm","rhythm","val","PitchClass","Accid","LigStatus","PlicaStatus","ClefItem","m_pname","m_clefLine","m_keySig","size","pitch","clef","RestItem","options","rest","MensurItem","m_modus","NA","m_tempus","m_prolatio","Two","Three","mensur","NoteItem","m_oct","m_text","amount","pname","toUpperCase","syl","textContent","MusicList","m_notationCallback","dpc","addClef","ln","getLastNote","oct","candidate","best","newnote","open","text","opts","lines","noteCounter","restCounter","hyphen","getHumdrumLine","output2","lineNumber","first","Voice","voiceToOrdinal","v","altus","cantus","contratenor","contratenor1","contratenor2","discantus","duplum","lowervoice1","lowervoice2","motetus","quadruplum","quintus","superius","uppervoice1","uppervoice2","bassus","Mensuration","Staff","staffA","staffB","indexDiff","NAMESPACE","MEIDocument","manuscriptIRI","Metadata","_createSkeletonMEI","sort","compare","_meiDoc","systems","partElement","generatePartXML","implementation","createDocument","head","_generateHeader","music","facsimile","body","mdiv","meiHead","fileDesc","titleStmt","title","respStmt","persName","pubStmt","sourceDesc","titleStmt2","title3","itemList","workDesc","work","title2","composer","classification","termList","term","allSystems","unshift","systemList","partlist","some","pbs","Set","values","sourceElements","querySelectorAll","s","toLowerCase","c","terms","surfaces","zones","assert","partObj","dir","tenorObj","repetitions","matchResults","layerChildren","activePb","activeSystem","child","setIndex","fetch","response","json","findIndex","canvasIRI","facs","split","surface","find","graphic","zone","parseXML","Part","removed","splice","scoreDef","_generateScoreDef","section","currentPage","getContents","zoneId","round","staffGrp","a","b","Tenor","firstNoteId","endItem","insertAdjacentHTML","Pb","Sb","System","whiteMensural","rawMei","humdrumToMEI","elements","humdrumMei","_recurseId","found","newPart","diff","aZone","bZone","threshold","diff1","diff2","overlap","avHeight","VrvObj","vrvToolkit","humType","scale","spacingNonLinear","lyricSize","breaks","choiceXPathQuery","verovio","toolkit","setOptions","data","loadData","getMEI","pageNo","scoreBased","humdrumData","renderToSVG","serializedMei","svgRaw","environment","production","init","bootstrapModule","verovioReady","r"],"mappings":"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","file":"main-es5.js","sourcesContent":["function webpackEmptyAsyncContext(req) {\n\t// Here Promise.resolve().then() is used instead of new Promise() to prevent\n\t// uncaught exception popping up in devtools\n\treturn Promise.resolve().then(function() {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t});\n}\nwebpackEmptyAsyncContext.keys = function() { return []; };\nwebpackEmptyAsyncContext.resolve = webpackEmptyAsyncContext;\nmodule.exports = webpackEmptyAsyncContext;\nwebpackEmptyAsyncContext.id = \"./$$_lazy_route_resource lazy recursive\";","import { Component } from '@angular/core';\nimport { vrvToolkit } from './utils/verovio';\n\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.css']\n})\nexport class AppComponent {\n  constructor() {\n    vrvToolkit.setup();\n  }\n}\n","<!-- Navigation -->\n<nav class=\"navbar navbar-expand-lg navbar-light\" id=\"mainNav\">\n    <a class=\"navbar-brand\" href=\"https://measuringpolyphony.org\">\n       <img src=\"assets/img/thumbnail.png\" id=\"thumbnail\">\n       <div id=\"navTitle\">Measuring Polyphony</div>\n       <div id=\"navDescription\">Digital encodings of late medieval music</div>\n       <div class=\"clearfix\"></div>\n    </a>\n    <div id=\"additionalButtons\">\n        <a class=\"additionalButtons\" href=\"https://measuringpolyphony.org/transcriptions.html\">\n          Browse\n        </a>\n        <a class=\"additionalButtons\" href=\"./\">\n            Transcribe\n        </a>\n        <a class=\"additionalButtons\" href=\"https://measuringpolyphony.org\">About</a>\n    </div>\n</nav>\n\n<router-outlet></router-outlet>\n","import { BrowserModule } from '@angular/platform-browser';\nimport { NgModule } from '@angular/core';\nimport { ReactiveFormsModule, FormsModule } from '@angular/forms';\nimport { RouterModule, Routes } from '@angular/router';\n\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { InputModule } from './input/input.module';\nimport { InputComponent } from './input/input.component';\n\nimport { AppComponent } from './app.component';\nimport { SelectDocumentComponent } from './select-document/select-document.component';\nimport { ScoreEditorModule } from './score-editor/score-editor.module';\nimport { ScoreEditorComponent } from './score-editor/score-editor.component';\n\nconst routes: Routes = [\n  {\n    path: 'input/:source/:identifier',\n    component: InputComponent\n  },\n  {\n    path: 'score/:source/:identifier',\n    component: ScoreEditorComponent\n  },\n  {\n    path: '',\n    // redirectTo: '/input/gallica/12148%2Fbtv1b8454675g',\n    component: SelectDocumentComponent,\n    pathMatch: 'full'\n  }\n]\n\n@NgModule({\n  declarations: [\n    AppComponent,\n    SelectDocumentComponent\n  ],\n  imports: [\n    RouterModule.forRoot(\n      routes,\n      { useHash: true }\n      //{ enableTracing: true }\n    ),\n    BrowserModule,\n    FormsModule,\n    ReactiveFormsModule,\n    MatTabsModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatFormFieldModule,\n    MatSelectModule,\n    InputModule,\n    ScoreEditorModule\n  ],\n  providers: [],\n  bootstrap: [AppComponent]\n})\nexport class AppModule { }\n","/**\n * This component contains diva.js and has the staff bounding boxes\n * rendered over it. This is always visible.\n */\nimport { Component, OnInit, OnDestroy, Input, ViewEncapsulation, HostListener } from '@angular/core';\n\nimport { IRI, Voice } from '../../utils/definitions';\nimport { System, Pb, Sb } from '../../utils/system';\nimport { Part } from '../../utils/part';\nimport { StateService } from '../../state-service.service';\nimport { InputService } from '../input.service';\n\nimport Diva from 'diva.js';\n\n@Component({\n  selector: 'app-diva-view',\n  templateUrl: './diva-view.component.html',\n  styleUrls: ['./diva-view.component.css'],\n  encapsulation: ViewEncapsulation.None\n})\nexport class DivaViewComponent implements OnInit, OnDestroy {\n  diva: Diva;\n  creatingStaff: boolean = false;\n  firstPoint: DOMPoint = null;\n\n  @Input() iiifManifest: IRI;\n\n  constructor (private selectedSystem: InputService, private stateService: StateService) {}\n\n  ngOnInit() {\n    this.diva = new Diva('diva-wrapper', {\n      objectData: this.iiifManifest\n    });\n\n    Diva.Events.subscribe('ActivePageDidChange', this.refreshOverlay.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('DocumentDidLoad', this.refreshOverlay.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.handleZoom.bind(this), this.diva.settings.ID);\n\n    // this.diva.disableDragScrollable();\n\n    this.selectedSystem.subscribe(() => {\n      this.refreshOverlay(this.diva.getActivePageIndex());\n    });\n  }\n\n  ngOnDestroy() {\n    this.selectedSystem.selected = null;\n    try {\n      this.diva.deactivate();\n      this.diva.destroy();\n    }\n    catch (e) {\n      console.warn(e);\n    }\n  }\n\n  @HostListener('window:keydown.shift', [])\n  handleKeydown() {\n    this.diva.disableDragScrollable();\n  }\n\n  @HostListener('window:keyup.shift', [])\n  handleKeyup() {\n    if (!this.creatingStaff) {\n      this.diva.enableDragScrollable();\n    }\n  }\n\n  clickHandler(evt: MouseEvent) {\n    const target = evt.target as Element;\n    if (target.tagName === 'rect') {\n      // Unselect previously selected staff.\n      Array.from(document.getElementsByClassName(\"selectedZone\"))\n        .forEach(elem => {\n          elem.classList.remove(\"selectedZone\");\n        });\n\n      let staff = this.stateService.mei.getSystem(target.id);\n      if (staff !== null) {\n        this.selectedSystem.selected = staff;\n        target.classList.add(\"selectedZone\");\n      }\n    }\n  }\n\n  mousedownHandler(evt: MouseEvent) {\n    if (evt.shiftKey) {\n      this.creatingStaff = true;\n\n      const activeContainer = document.getElementById('editor-container-' + this.diva.getActivePageIndex().toString()).firstElementChild as SVGSVGElement;\n      const clientPoint = activeContainer.createSVGPoint();\n      clientPoint.x = evt.clientX;\n      clientPoint.y = evt.clientY;\n\n      const transformMatrix = activeContainer.getScreenCTM();\n      this.firstPoint = clientPoint.matrixTransform(transformMatrix.inverse());\n\n      // Create the initial drawing rect\n      let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n      rect.setAttribute('x', this.firstPoint.x.toString());\n      rect.setAttribute('y', this.firstPoint.y.toString());\n      rect.setAttribute('width', '0');\n      rect.setAttribute('height', '0');\n      rect.classList.add(\"zoneRect\");\n      rect.id = 'drawing-rect';\n\n      activeContainer.appendChild(rect);\n    }\n  }\n\n  mousemoveHandler(evt: MouseEvent) {\n    if (this.creatingStaff) {\n      const drawingRect = document.getElementById('drawing-rect') as unknown as SVGRectElement;\n      if (drawingRect !== null) {\n        const container = drawingRect.viewportElement as SVGSVGElement;\n        const currentPoint = container.createSVGPoint();\n        currentPoint.x = evt.clientX;\n        currentPoint.y = evt.clientY;\n\n        const transformedPoint = currentPoint.matrixTransform(\n          container.getScreenCTM().inverse()\n        );\n\n        drawingRect.setAttribute('x', Math.min(transformedPoint.x, this.firstPoint.x).toString());\n        drawingRect.setAttribute('y', Math.min(transformedPoint.y, this.firstPoint.y).toString());\n\n        drawingRect.setAttribute('width', Math.abs(transformedPoint.x - this.firstPoint.x).toString());\n        drawingRect.setAttribute('height', Math.abs(transformedPoint.y - this.firstPoint.y).toString());\n      }\n    }\n  }\n\n  mouseupHandler(evt: MouseEvent) {\n    if (this.creatingStaff) {\n      this.diva.enableDragScrollable();\n      this.creatingStaff = false;\n\n      const pageIndex = this.diva.getActivePageIndex();\n\n      const activeContainer = document.getElementById('editor-container-' + pageIndex.toString()).firstElementChild as SVGSVGElement;\n      const clientPoint = activeContainer.createSVGPoint();\n      clientPoint.x = evt.clientX;\n      clientPoint.y = evt.clientY;\n\n      const transformMatrix = activeContainer.getScreenCTM();\n      const secondPoint = clientPoint.matrixTransform(transformMatrix.inverse());\n\n      // Get Pb element if one exists\n      let pb = this.stateService.mei.getPb(pageIndex);\n      if (pb === null) {\n        // Make new Pb\n        pb = new Pb(this.diva.getCurrentCanvas());\n        pb.index = pageIndex;\n      }\n\n      // Create sb\n      let sb = new Sb(\n        {\n          ulx: Math.min(this.firstPoint.x, secondPoint.x),\n          uly: Math.min(this.firstPoint.y, secondPoint.y),\n          lrx: Math.max(secondPoint.x, this.firstPoint.x),\n          lry: Math.max(secondPoint.y, this.firstPoint.y),\n        }\n      );\n\n      // Determine Part\n      let part: Part;\n      if (this.selectedSystem.selected !== null) {\n        part = this.selectedSystem.selected.parent;\n      } else {\n        part = this.stateService.mei.getOrCreatePart(Voice.triplum);\n      }\n\n      const newSystem = new System();\n      newSystem.pb = pb;\n      newSystem.sb = sb;\n      part.addSystem(newSystem);\n\n      // Mark as selected\n      this.selectedSystem.selected = newSystem;\n\n      // Clean up\n      this.refreshOverlay(pageIndex);\n      this.firstPoint = null;\n    }\n  }\n\n  refreshOverlay(pageIndex: number): void {\n    // Get some features from the diva viewer\n    const inner = this.diva.settings.innerElement;\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(pageIndex);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(\n      pageIndex,\n      {\n        includePadding: true,\n        incorporateViewport: true\n      }\n    );\n    const marginLeft = getComputedStyle(inner, null).getPropertyValue('margin-left');\n\n    // Check if we have a div for this page. Otherwise create one.\n    let pageContainer = document.getElementById('editor-container-' + pageIndex.toString());\n    if (pageContainer === null) {\n      //pageContainer = document.createElement('div');\n      pageContainer = document.createElement('div');\n      pageContainer.id = 'editor-container-' + pageIndex.toString();\n      pageContainer.classList.add('editor-container'); // For future use\n      inner.appendChild(pageContainer); // Add the container to the DOM\n    }\n\n    // Create SVG container\n    const svgParent = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    const maxZoom = this.diva.getPageDimensionsAtZoomLevel(pageIndex, Number.MAX_SAFE_INTEGER)\n    svgParent.setAttribute('width', dimensions.width.toString());\n    svgParent.setAttribute('height', dimensions.height.toString());\n    svgParent.setAttribute('viewBox', '0 0 ' + maxZoom.width + ' ' + maxZoom.height);\n\n    pageContainer.style.position = 'absolute';\n    pageContainer.style.top = `${offset.top}px`;\n    pageContainer.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    while (pageContainer.firstChild !== null) {\n      pageContainer.firstChild.remove();\n    }\n\n    let systemsOnPage = this.stateService.mei.getSystems().filter(system => {\n      return system.pb.index === pageIndex;\n    });\n\n    for (const staff of systemsOnPage) {\n      let item = staff.sb.svg;\n      svgParent.appendChild(item);\n      if (this.selectedSystem.selected === staff) {\n        item.classList.add(\"selectedZone\");\n      }\n    }\n\n    pageContainer.appendChild(svgParent);\n  }\n\n  handleZoom(): void {\n    (new Promise(resolve => {\n      Array.from(document.getElementsByClassName('editor-container'))\n        .forEach((elem: HTMLElement) => { elem.style.display = 'none'; });\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.refreshOverlay(this.diva.getActivePageIndex());\n      Array.from(document.getElementsByClassName('editor-container'))\n        .forEach((elem: HTMLElement) => {\n          elem.style.display = '';\n        });\n    });\n  }\n}\n","<div id=\"diva-wrapper\"\n    (mousedown)=\"mousedownHandler($event)\"\n    (mousemove)=\"mousemoveHandler($event)\"\n    (click)=\"clickHandler($event)\"\n    (mouseup)=\"mouseupHandler($event)\">\n</div>\n","import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\nimport { FormGroup, FormArray, FormControl, Validators } from '@angular/forms';\n\nimport { Contributor, IRI } from '../utils/definitions';\nimport { MEIDocument } from '../utils/mei';\nimport { formIIIFManifest } from '../tools';\nimport { StateService } from '../state-service.service';\n\n@Component({\n  selector: 'app-input',\n  templateUrl: './input.component.html',\n  styleUrls: ['./input.component.css']\n})\nexport class InputComponent implements OnInit {\n  iiifManifest: IRI;\n\n  // Metadata for MEI header\n  metadataForm = new FormGroup({\n    shortTitle: new FormControl('', [Validators.required]),\n    composerName: new FormControl('', [Validators.required]),\n    contributors: new FormArray([]),\n    notationSubtype: new FormControl('', [Validators.required]),\n    siglum: new FormControl('', [Validators.required]),\n    genre: new FormControl('', [Validators.required]),\n  });\n\n  temp: FormArray;\n\n  inputStep: InputComponent.InputStep;\n\n  source: string;\n  identifier: string;\n\n  constructor(\n    private stateService: StateService,\n    private route: ActivatedRoute,\n  ) {\n    this.inputStep = InputComponent.InputStep.METADATA;\n    this.source = this.route.snapshot.paramMap.get('source');\n    this.identifier = decodeURIComponent(this.route.snapshot.paramMap.get('identifier'));\n    this.iiifManifest = formIIIFManifest(this.source, this.identifier);\n\n    if (!this.stateService.mei) {\n      this.stateService.mei = new MEIDocument(this.iiifManifest);\n    }\n\n    if (this.stateService.mei.metadata != undefined) {\n      this.metadataForm.controls.shortTitle.setValue(this.stateService.mei.metadata.shortTitle);\n      this.metadataForm.controls.composerName.setValue(this.stateService.mei.metadata.composerName);\n      this.metadataForm.controls.notationSubtype.setValue(this.stateService.mei.notationSubtype);\n      this.metadataForm.controls.siglum.setValue(this.stateService.mei.metadata.siglum);\n      this.metadataForm.controls.genre.setValue(this.stateService.mei.metadata.genre);\n      let contributors = this.metadataForm.get('contributors') as FormArray;\n      for (let contributor of this.stateService.mei.metadata.contributors) {\n        let temp = new FormGroup({\n          type: new FormControl(contributor.type, Validators.required),\n          name: new FormControl(contributor.name, Validators.required),\n        });\n        contributors.push(temp);\n      }\n    }\n\n    this.temp = this.metadataForm.get('contributors') as FormArray;\n    console.debug(this.iiifManifest);\n    console.debug(this.metadataForm.controls.contributors);\n  }\n\n  ngOnInit() {\n    this.stateService.editorialMode = false;\n  }\n\n  onSetMetadata() {\n    let value = this.metadataForm.value;\n\n    this.stateService.mei.metadata = {\n      shortTitle: value.shortTitle,\n      composerName: value.composerName,\n      contributors: value.contributors.filter(entry => {\n        return (entry.type.length > 0) && (entry.name.length > 0);\n      }).map(entry => {\n        return entry as Contributor;\n      }),\n      sourceIRI: this.iiifManifest,\n      siglum: value.siglum,\n      genre: value.genre,\n    };\n    this.stateService.mei.notationSubtype = value.notationSubtype;\n    this.inputStep = InputComponent.InputStep.INPUT;\n  }\n\n  addContributor() {\n    this.temp.push(\n      new FormGroup({\n        type: new FormControl('', [Validators.required]),\n        name: new FormControl('', [Validators.required]),\n      })\n    )\n  }\n\n  removeContributor(index: number) {\n    this.temp.removeAt(index);\n  }\n}\n\nexport namespace InputComponent {\n  export enum InputStep {\n    METADATA,\n    INPUT\n  }\n}\n","<div id=\"editor-container\">\n    <app-diva-view [iiifManifest]=\"iiifManifest\"></app-diva-view>\n    <div id=\"right-side\">\n        <mat-tab-group>\n            <mat-tab label=\"Metadata Input\" *ngIf=\"inputStep === 0\">\n                <form *ngIf=\"inputStep===0\" [formGroup]=\"metadataForm\" (submit)=\"onSetMetadata()\">\n                    <h1 id=\"metadata-header\">Enter Metadata</h1>\n                    <label class=\"metadataInput\">Short title:&nbsp;\n                        <input id=\"shortTitle\" formControlName=\"shortTitle\" required/>\n                    </label><br>\n                    <label class=\"metadataInput\">Composer name:&nbsp;\n                        <input id=\"composerName\" formControlName=\"composerName\" required/>\n                    </label><br>\n                    <label class=\"metadataInput\">Notation:&nbsp;\n                        <select id=\"notationSubtype\" formControlName=\"notationSubtype\" required>\n                            <option value=\"Ars_antiqua\">Black Mensural &mdash; Ars antiqua</option>\n                            <option value=\"Ars_nova\">Black Mensural &mdash; Ars nova</option>\n                            <option value=\"\">White Mensural</option>\n                        </select>\n                    </label><br>\n                    <label class=\"metadataInput\">Manuscript Siglum:&nbsp;\n                        <input id=\"siglum\" formControlName=\"siglum\" required/>\n                    </label><br>\n                    <label class=\"metadataInput\">Genre:&nbsp;\n                        <select id=\"genre\" formControlName=\"genre\" required>\n                            <option value=\"Motet\">Motet</option>\n                            <option value=\"Song\">Song</option>\n                            <option value=\"Conductus\">Conductus</option>\n                            <option value=\"Mass Movement\">Mass Movement</option>\n                            <option value=\"Plainchant\">Plainchant</option>\n                        </select>\n                    </label><br>\n                    <div *ngFor=\"let contributor of temp.controls; let i = index\">\n                        <ng-container [formGroup]=\"contributor\">\n                          <label class=\"contributor\">Contributor:&nbsp;\n                            <select formControlName=\"type\" required>\n                                <option value=\"encoder\">Encoder</option>\n                                <option value=\"proofreader\">Proofreader</option>\n                                <option value=\"editor\">Editor</option>\n                            </select>\n                            <input formControlName=\"name\" required/>\n                          </label>\n                          &nbsp;\n                          <button color=secondary class=\"secondary-button\" mat-stroked-button type=\"button\" (click)=\"removeContributor(i)\">Remove</button>\n                        </ng-container>\n                    </div>\n                    <div>\n                      <button color=primary class=\"primary-button\" mat-stroked-button type=\"button\" (click)=\"addContributor()\">Add Contributor</button>\n                    </div>\n                    <br>\n                    <button color=primary class=\"primary-button\" mat-stroked-button type=\"submit\">Continue to Music Input</button>\n                </form>\n            </mat-tab>\n            <mat-tab label=\"Music Input\" *ngIf=\"inputStep === 1\">\n                <mat-divider></mat-divider>\n                <app-toolbar *ngIf=\"inputStep===1\"></app-toolbar>\n                <mat-divider></mat-divider>\n                <app-staff-select *ngIf=\"inputStep===1\"></app-staff-select>\n            </mat-tab>\n            <mat-tab label=\"General Help\">\n                <h2>Manuscript Navigation</h2>\n                <ul>\n                    <li>\n                        To select the page of the manuscript you want to work on,\n                        either use the scrollbar to the right of the manuscript\n                        or type the folio number in the box and click the <code>Go</code>\n                        button.\n                    </li>\n                    <li>\n                        Click the magnifying boxes for the appropriate zoom level\n                        and move around the manuscript using your mouse or the\n                        trackpad.\n                    </li>\n                </ul>\n                <mat-divider></mat-divider>\n                <h2>Metadata Entry</h2>\n                <p>\n                    First enter basic metadata about the document.\n                    This includes the name of the work, composer name,\n                    and your name. If there is something you don't know,\n                    you can leave it as is and continue.\n                    <br>\n                    Metadata must be entered before staff input can fully begin.\n                </p>\n                <mat-divider></mat-divider>\n                <h2>Staff Entry</h2>\n                <ul>\n                    <li>\n                        To select an area for a new staff, hold <code>Shift</code>\n                        and click-and-drag an area for the staff on the Diva.js\n                        viewer. When you release the mouse, a staff is added.\n                    </li>\n                    <li>\n                        To select a staff, click on the bounding box on the viewer.\n                    </li>\n                    <li>\n                        When a staff is selected, the voice it belongs to and\n                        mensuration of that voice can be set on the right.\n                        This information is saved automatically.\n                    </li>\n                    <li>\n                        To add musical components, begin typing. This will add\n                        musical elements to the staff below the voice and mensuration\n                        options. Information on this is available under the \"Music\n                        Input Help\" Tab.\n                    </li>\n                    <li>\n                        To delete a staff, first select it and then click the\n                        \"Delete Staff\" button under the \"Staff Input\" tab.\n                    </li>\n                </ul>\n                <mat-divider></mat-divider>\n                <h2>Saving Work for Later</h2>\n                <p>\n                    Work can be saved for later using the <em>Download MEI File</em>\n                    button. This will download the file as a parts-based MEI file that\n                    can be reloaded at a later point from the home screen.\n                </p>\n            </mat-tab>\n            <mat-tab label=\"Music Input Help\">\n                <h2>Music Input Instructions</h2>\n                <ul>\n                    <li> <b> Adding clef</b>\n                    \t<ul>\n                    \t<li> Type <span class=\"hi\">C</span> to insert C3 clef,\n                            or <span class=\"hi\">F</span> to insert F4 clef.</li>\n                        <li> Press the up or down arrows to move the clef to another line.</li>\n                    \t</ul>\n                    </li>\n\n                    <li> <b> Adding key signatures</b>\n                        <ul>\n                        <li> Type <span class=\"hi\">k</span> to enter key signature mode after adding a clef.</li>\n                        <li> Then enter the pitch name letter and accidental to add to key signature.</li>\n                        <li> To remove from a key signature, enter the same pitch letter and accidental again.</li>\n                        <li> Example: For F-sharp, type <span class=\"hi\">k f #</span></li>\n                        </ul>\n                    </li>\n\n                    <li> <b> Adding pitches</b>\n                    \t<ul>\n                    \t<li> Type pitch <span class=\"hi\">letter</span> name of each note to add them to the line: <span class=\"hi\">f.ed.efgagfgedderfag</span></li>\n                    \t<li> Type \"<span class=\"hi\">.</span>\" to add dot after note.</li>\n                    \t<li> Type \"<span class=\"hi\">r</span>\" to add a rest.</li>\n                    \t<li> Type <span class=\"hi2\">backspace</span> to delete note.</li>\n                    \t<li> Use capital letters to choose the larger interval for the next pitch. So if you are on `d` and want to go to the `a` a fifth above, type capital A rather than lowercase (which would give the `a` that is a fourth below).</li>\n                    \t<li> <span class=\"hi2\">Up/down</span> arrows transpose last pitch up/down a step.</li>\n                    \t<li> <span class=\"hi2\">Shift-up/down</span> arrows transpose last pitch up/down an octave.</li>\n                    \t</ul>\n                    </li>\n\n                    <li><b> Adding Accidentals</b><br>\n                        After adding a note:\n                        <ul>\n                            <li> press <code>-</code> to add a flat.</li>\n                            <li> press <code>#</code> to add a sharp.</li>\n                            <li> press <code>n</code> to add a natural.</li>\n                            <li> press <code>N</code> to clear accidentals.</li>\n                        </ul>\n                    </li>\n\n                    <li><b> Adding ligatures</b>\n                        <br/>Note that while duration of pitches in ligatures can be changed after the fact, ligatures must be specified as pitches are added.\n                        <ul>\n                            <li> After adding a note, press <span class=\"hi2\">[</span> to start a ligature.</li>\n                            <li> After adding a note, press <span class=\"hi2\">]</span> to end a ligature.</li>\n                        </ul>\n                    </li>\n\n                    <li> <b> Adding rhythm</b>\n                    \t<ul>\n                    \t\t<li> <span class=\"hi\">1</span> semibreve,\n                    \t\t     <span class=\"hi\">2</span> minim,\n                    \t\t     <span class=\"hi\">4</span> semiminim,\n                    \t\t     <span class=\"hi\">8</span> fusa,\n                    \t\t     <span class=\"hi\">6</span> semifusa,\n                    \t\t     <span class=\"hi\">0</span> breve,\n                    \t\t     <span class=\"hi\">9</span> long,\n                    \t\t     <span class=\"hi\">7</span> maxima. </li>\n                    \t\t<li> <i>Interleaved method</i>: type (new) rhythm before adding a note.  The default rhythm is whole note (semibreve).</li>\n                    \t\t<li> <i>Second-pass method</i>: type pitches first, then select first note and type rhythms to update note rhythms.</li>\n                    \t\t<li> <i>Selective second-pass method</i>: type clef, then most common rhythm, then notes, then click on notes that need rhythms to fix.  Typing rhythm number will change rhythm and advance to next note.</li>\n                    \t\t<li> left/right arrow keys or tab/shift-tab moves to next/previous note/rest/clef.</li>\n                    \t</ul>\n                    </li>\n\n                    <li> <b> Adding text</b>\n                    \t<ul>\n                    \t\t<li>Click on a note (or left/right arrows or tab/shift-tab to move to target note).</li>\n                    \t\t<li>Type text for note, then press tab or right arrow key or click to go to next note.</li>\n                            <li> <span class=\"hi2\">backspace</span> delete last letter.</li>\n                            <li> <span class=\"hi2\">shift-backspace</span> deletes entire syllable.</li>\n                            <li> Adding a dash at the end of text input for a note marks that this is part of a word that continues to the next note.</li>\n                            <li> To correct mistyped text, click the note to highlight it and press backspace. Then type the new text that belongs to that note.</li>\n                    \t</ul>\n                    </li>\n\n                    <li> <b> Repeating tenor</b>\n                        <ul>\n                            <li>When a staff that belongs to the tenor part is selected, the number of statements can be indicated.</li>\n                            <li>If more than one tenor statement is indicated, a repeating tenor will be generated.</li>\n                            <li>Where the tenor repeats from can be set after entering that element by pressing the \"Set End of Repeating Tenor\" button.\n                                The ending will be highlighted in blue.\n                            </li>\n                            <li>If no end point is specified, the entire tenor will repeat by default.</li>\n                        </ul>\n                    </li>\n                </ul>\n            </mat-tab>\n        </mat-tab-group>\n    </div>\n</div>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\n\nimport { MatTabsModule } from '@angular/material/tabs';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatDialogModule } from '@angular/material/dialog';\nimport { MatFormFieldModule } from '@angular/material/form-field';\nimport { MatSelectModule } from '@angular/material/select';\n\nimport { DivaViewComponent } from './diva-view/diva-view.component';\nimport { StaffSelectComponent } from './staff-select/staff-select.component';\nimport { ToolbarComponent } from './toolbar/toolbar.component';\nimport { InputComponent } from './input.component';\nimport { BrowserAnimationsModule } from '@angular/platform-browser/animations';\n\n@NgModule({\n  declarations: [\n    DivaViewComponent,\n    StaffSelectComponent,\n    StaffSelectComponent,\n    ToolbarComponent,\n    InputComponent,\n  ],\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    BrowserAnimationsModule,\n    MatTabsModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatDialogModule,\n    MatFormFieldModule,\n    MatSelectModule\n  ],\n  exports: [\n    InputComponent\n  ]\n})\nexport class InputModule { }\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs'\n\nimport { System } from '../utils/system';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class InputService extends Subject<System> {\n\n  _selected: System;\n\n  constructor() {\n    super();\n    this._selected = null;\n  }\n\n  get selected(): System {\n    return this._selected;\n  }\n\n  set selected(system: System) {\n    this._selected = system;\n    this.next(this._selected);\n  }\n}\n","import { Component, OnInit, HostListener, ViewChild, ElementRef } from '@angular/core';\nimport { FormControl, FormGroup } from '@angular/forms';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { PitchClass, NoteItem, RestItem, Accid, LigStatus, PlicaStatus } from '../../utils/MusicItem';\nimport { StateService } from '../../state-service.service';\nimport { InputService } from '../input.service';\nimport { vrvToolkit } from '../../utils/verovio';\nimport { Tenor } from '../../utils/part';\nimport { Voice } from '../../utils/definitions';\n\n@Component({\n  selector: 'app-staff-select',\n  templateUrl: './staff-select.component.html',\n  styleUrls: ['./staff-select.component.css']\n})\nexport class StaffSelectComponent implements OnInit {\n  @ViewChild('example') container: ElementRef;\n  voices = Object.entries(Voice);\n  keySigMode = false;\n  pitchSig: string = null;\n  accidSig: string = null;\n  selected = null;\n  constructor(\n    private selectedSystem: InputService,\n    private stateService: StateService,\n    private route: ActivatedRoute,\n    private router: Router\n  ) { }\n\n  ngOnInit() {\n    this.selectedSystem.subscribe({\n      next: (staff) => {\n        this.selected = staff;\n        this.container.nativeElement.innerHTML = '';\n        if (staff === null) return;\n        let element = vrvToolkit.humdrumToSVG(staff.contents.getHumdrumScore());\n        this.container.nativeElement.appendChild(element);\n      }\n    });\n  }\n\n  updateSVG() {\n    let white = this.selectedSystem.selected.parent.parent.notationType === \"mensural.white\";\n    let element = vrvToolkit.humdrumToSVG(this.selectedSystem.selected.contents.getHumdrumScore({white: white}));\n    this.container.nativeElement.innerHTML = '';\n    this.container.nativeElement.appendChild(element);\n\n    if (/^[tT]enor/.test(this.selectedSystem.selected.parent.voice)) {\n      const tenor = this.selectedSystem.selected.parent as Tenor;\n      if (tenor.endingId !== undefined) {\n        let endNote = element.getElementById(tenor.endingId);\n        if (endNote !== null) {\n          endNote.setAttribute('fill', '#00f');\n        }\n      }\n    }\n  }\n\n  staffForm = new FormGroup({\n    voice: new FormControl(''),\n    modus: new FormControl(''),\n    tempus: new FormControl(''),\n    prolatio: new FormControl(''),\n  });\n\n  mensurForm = new FormGroup({\n    modus2: new FormControl(''),\n    tempus2: new FormControl(''),\n    prolatio2: new FormControl(''),\n  });\n\n  handleClick(event: MouseEvent) {\n    let target = event.target as Element;\n    while (target) {\n      if (target.nodeName === 'g') {\n        let matches: Array<string>;\n        if (matches = target.id.match(/-.*L(\\d+)/)) {\n          this.selectedSystem.selected.contents.selectItemByLine(parseInt(matches[1]))\n          this.updateSVG();\n          break;\n        }\n      }\n      target = target.parentNode as Element;\n    }\n  }\n\n  finishStep() {\n    // const mei = this.meiService.generateFullMEI();\n    const type = this.route.snapshot.paramMap.get('source');\n    const identifier = this.route.snapshot.paramMap.get('identifier');\n    // this.stateService.mei = mei;\n    this.router.navigate(['/score', type, identifier]);\n  }\n\n  repTenorButton() {\n    const tenor = this.stateService.mei.getPart(Voice.tenor) as Tenor;\n    try {\n        let layer = this.container.nativeElement.querySelector('.layer');\n        let id = layer.lastElementChild.id;\n        let regexpInfo = id.match(/L(\\d+)[\\w\\d]+$/);\n        let line = parseInt(regexpInfo[1]);\n        let match = this.selectedSystem.selected.contents.m_list.filter(el => {\n          return el.m_line === line;\n        });\n        tenor.endingId = match[0].m_id;\n    } catch (e) {\n      console.debug(e);\n      tenor.endingId = undefined;\n    }\n    this.updateSVG();\n  }\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyPress(event: KeyboardEvent) {\n    if (this.selectedSystem.selected == null) return;\n\n    if (this.keySigMode) {\n      this.handleKeySigPress(event);\n      event.preventDefault();\n      this.updateSVG();\n      return;\n    }\n\n    // Based on processKeypress function in mensural-input\n    if (event.metaKey) return;\n    let musicList = this.selectedSystem.selected.contents;\n    if ((musicList.m_index >=0) && (event.key.length === 1)) {\n      if ((event.key >= '0') && (event.key <= '9')) {\n        this.processDigit(Number(event.key), event);\n        event.preventDefault();\n        this.updateSVG();\n        return;\n      }\n      if (event.key !== ' ') {\n        let state = musicList.addTextToCurrentItem(event.key);\n        if (state) {\n          event.preventDefault();\n          this.updateSVG();\n          return;\n        }\n      }\n    }\n    if ((musicList.m_index >= 0) && (event.key === 'Backspace')) {\n      if (event.shiftKey) {\n        musicList.clearTextOnCurrentItem();\n      }\n      else {\n        musicList.deleteCharacterOnCurrentItem();\n      }\n      event.preventDefault();\n    }\n    else if ((musicList.m_index < 0) && (event.key === 'Backspace')) {\n      musicList.removeLastItem();\n      event.preventDefault();\n    }\n    else {\n      switch (event.key) {\n        case 'k':\n          this.keySigMode = true;\n          console.debug(\"Set keySigMode\");\n          event.preventDefault();\n          break;\n        case 'C':\n          musicList.addPitchFar(PitchClass.C);\n          event.preventDefault();\n          break;\n        case 'c':\n          musicList.addPitchNear(PitchClass.C);\n          event.preventDefault();\n          break;\n        case 'D':\n          musicList.addPitchFar(PitchClass.D);\n          event.preventDefault();\n          break;\n        case 'd':\n          musicList.addPitchNear(PitchClass.D);\n          event.preventDefault();\n          break;\n        case 'E':\n          musicList.addPitchFar(PitchClass.E);\n          event.preventDefault();\n          break;\n        case 'e':\n          musicList.addPitchNear(PitchClass.E);\n          event.preventDefault();\n          break;\n        case 'F':\n          musicList.addPitchFar(PitchClass.F);\n          event.preventDefault();\n          break;\n        case 'f':\n          musicList.addPitchNear(PitchClass.F);\n          event.preventDefault();\n          break;\n        case 'G':\n          musicList.addPitchFar(PitchClass.G);\n          event.preventDefault();\n          break;\n        case 'g':\n          musicList.addPitchNear(PitchClass.G);\n          event.preventDefault();\n          break;\n        case 'A':\n          musicList.addPitchFar(PitchClass.A);\n          event.preventDefault();\n          break;\n        case 'a':\n          musicList.addPitchNear(PitchClass.A);\n          event.preventDefault();\n          break;\n        case 'B':\n          musicList.addPitchFar(PitchClass.B);\n          event.preventDefault();\n          break;\n        case 'b':\n          musicList.addPitchNear(PitchClass.B);\n          event.preventDefault();\n          break;\n        case 'm':\n        case 'M':\n          if (!musicList.hasOpenLigature()) {\n            musicList.addMensur();\n          }\n          event.preventDefault();\n          break;\n        case 'p':\n        case 'P':\n          this.processPlica(event.key);\n          event.preventDefault();\n          break;\n        case 'r':\n        case 'R':\n          if (!musicList.hasOpenLigature()) {\n            musicList.addRest();\n          } else {\n            alert(\"Can't enter a rest in an open ligature! Please close first.\")\n          }\n          event.preventDefault();\n          break;\n        case '.':\n          this.processDotKey();\n          event.preventDefault();\n          break;\n        case '0':\n        case '1':\n        case '2':\n        case '3':\n        case '4':\n        case '5':\n        case '6':\n        case '7':\n        case '8':\n        case '9':\n          this.processDigit(Number(event.key), event);\n          event.preventDefault();\n          break;\n        case 'Tab':\n          if (event.shiftKey) {\n            musicList.selectBackward();\n          } else {\n            musicList.selectForward();\n          }\n          event.preventDefault();\n          break;\n        case ' ':\n        case 'ArrowRight':\n          musicList.selectForward();\n          event.preventDefault();\n          break;\n        case 'ArrowLeft':\n          musicList.selectBackward();\n          event.preventDefault();\n          break;\n        case 'ArrowUp':\n          musicList.raisePitch(event.shiftKey ? 7 : 1);\n          event.preventDefault();\n          break;\n        case 'ArrowDown':\n          musicList.lowerPitch(event.shiftKey ? 7 : 1);\n          event.preventDefault();\n          break;\n        case 'End':\n          musicList.goToEndOfList();\n          event.preventDefault();\n          break;\n        case '[':\n          if (!musicList.hasOpenLigature()) {\n            this.processLig(true);\n          } else {\n            alert(\"A ligature is already open!\");\n          }\n          event.preventDefault();\n          break;\n        case ']':\n          if (musicList.hasOpenLigature()) {\n            this.processLig(false);\n          } else {\n            alert(\"No open ligature to close!\");\n          }\n          event.preventDefault();\n          break;\n        case '#':\n        case '-':\n        case 'N':\n        case 'n':\n          this.processAccidental(event.key);\n          event.preventDefault();\n          break;\n        }\n    }\n    this.updateSVG();\n  }\n\n  processDigit(digit: number, _event: KeyboardEvent) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      if (digit !== 3) {\n        musicList.m_rhythm = digit;\n      }\n      return;\n    }\n    var index = musicList.m_index;\n    var ending = false;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n      ending = true;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'clef') {\n      if (digit !== 3) {\n        musicList.m_rhythm = digit;\n      }\n      musicList.runNotationCallback();\n      return;\n    }\n    else if (ending) {\n      musicList.m_rhythm = digit;\n    }\n    else if ((item.m_type === 'note') || (item.m_type === 'rest')) {\n      if (!ending) {\n        if (digit !== 3) {\n          if (item.m_type === \"note\") {\n            (item as NoteItem).m_rhythm = digit;\n          }\n          else {\n            (item as RestItem).m_rhythm = digit;\n          }\n          musicList.m_index += 1;\n          musicList.m_rhythm = digit;\n          musicList.runNotationCallback();\n        }\n        if (musicList.m_index >= musicList.m_list.length) {\n          musicList.m_index = -1;\n        }\n      }\n    }\n  }\n\n  processDotKey() {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      note.m_dot = !note.m_dot;\n      musicList.runNotationCallback();\n      return;\n    }\n  }\n\n  processLig(isStart: boolean) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      if (isStart) {\n        note.m_lig = note.m_lig === LigStatus.START ? LigStatus.NONE : LigStatus.START;\n      } else {\n        note.m_lig = note.m_lig === LigStatus.END ? LigStatus.NONE : LigStatus.END;\n      }\n      musicList.runNotationCallback();\n      return;\n    }\n  }\n\n  processPlica(key: string) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      if (key === 'p') {\n        note.m_plica = note.m_plica === PlicaStatus.DOWN ? PlicaStatus.NONE : PlicaStatus.DOWN;\n      }\n      else {\n        note.m_plica = note.m_plica === PlicaStatus.UP ? PlicaStatus.NONE : PlicaStatus.UP;\n      }\n      musicList.runNotationCallback();\n      return;\n    }\n  }\n\n  handleKeySigPress(event: KeyboardEvent) {\n    switch (event.key) {\n      case 'a':\n      case 'A':\n      case 'b':\n      case 'B':\n      case 'c':\n      case 'C':\n      case 'd':\n      case 'D':\n      case 'e':\n      case 'E':\n      case 'f':\n      case 'F':\n      case 'g':\n      case 'G':\n        if (this.pitchSig === null) {\n          this.pitchSig = event.key;\n        }\n        else {\n          this.pitchSig = null;\n          this.accidSig = null;\n          this.keySigMode = false;\n          console.debug(\"unset keySigMode\");\n        }\n        break;\n      case '#':\n      case '-':\n      case 'n':\n        if (this.pitchSig !== null && this.accidSig === null) {\n          this.accidSig = event.key;\n          let musicList = this.selectedSystem.selected.contents;\n          musicList.processKeySig(this.pitchSig, this.accidSig);\n          console.debug(\"Process with \" + this.pitchSig + \" and \" + this.accidSig);\n        }\n        this.pitchSig = null;\n        this.accidSig = null;\n        this.keySigMode = false;\n        console.debug(\"unset keySigMode\");\n        break;\n    }\n  }\n\n  processAccidental(accid: string) {\n    let musicList = this.selectedSystem.selected.contents;\n    if (musicList.m_list.length === 0) {\n      return;\n    }\n    let index = musicList.m_index;\n    if (index < 0) {\n      index = musicList.m_list.length - 1;\n    }\n    let item = musicList.m_list[index];\n    if (item.m_type === 'note') {\n      let note = item as NoteItem;\n      switch(accid) {\n        case 'N':\n          note.m_accid = Accid.NONE;\n          break;\n        case '#':\n          note.m_accid = Accid.SHARP;\n          break;\n        case '-':\n          note.m_accid = Accid.FLAT;\n          break;\n        case 'n':\n          note.m_accid = Accid.NATURAL;\n          break;\n      }\n      musicList.runNotationCallback();\n    }\n  }\n}\n","<form [formGroup]=\"staffForm\" *ngIf=\"selected\">\n    <h1>Enter Music</h1>\n    <fieldset>\n        <label class=\"music-subentry\">Voice:&nbsp;\n            <select [(ngModel)]=\"selected.voice\" formControlName=\"voice\">\n                <option *ngFor=\"let voice of voices\" value=\"{{voice[0]}}\">{{voice[1]}}</option>\n            </select>\n        </label>\n    </fieldset>\n    <h3 class=\"music-subentry\">Select Initial Mensuration:</h3>\n    <div class=\"flex-container\">\n        <fieldset>\n            <legend class=\"mensuration\">modus</legend>\n            <input [(ngModel)]=\"selected.parent.modus\" type=\"radio\" id=\"modus-3\" formControlName=\"modus\" value=\"3\"/>\n            <label for=\"modus-3\">3</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.modus\" type=\"radio\" id=\"modus-2\" formControlName=\"modus\" value=\"2\"/>\n            <label for=\"modus-2\">2</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.modus\" type=\"radio\" id=\"modus-na\" formControlName=\"modus\" value=\"N/A\"/>\n            <label for=\"modus-na\">N/A</label>\n        </fieldset>\n        <fieldset>\n            <legend class=\"mensuration\">tempus</legend>\n            <input [(ngModel)]=\"selected.parent.tempus\" type=\"radio\" id=\"tempus-3\" formControlName=\"tempus\" value=\"3\"/>\n            <label for=\"tempus-3\">3</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.tempus\" type=\"radio\" id=\"tempus-2\" formControlName=\"tempus\" value=\"2\"/>\n            <label for=\"tempus-2\">2</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.tempus\" type=\"radio\" id=\"tempus-na\" formControlName=\"tempus\" value=\"N/A\"/>\n            <label for=\"tempus-na\">N/A</label>\n        </fieldset>\n        <fieldset>\n            <legend class=\"mensuration\">prolatio</legend>\n            <input [(ngModel)]=\"selected.parent.prolatio\" type=\"radio\" id=\"prolatio-3\" formControlName=\"prolatio\" value=\"3\"/>\n            <label for=\"prolatio-3\">3</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.prolatio\" type=\"radio\" id=\"prolatio-2\" formControlName=\"prolatio\" value=\"2\"/>\n            <label for=\"prolatio-2\">2</label>\n            &nbsp;\n            <input [(ngModel)]=\"selected.parent.prolatio\" type=\"radio\" id=\"prolatio-na\" formControlName=\"prolatio\" value=\"N/A\"/>\n            <label for=\"prolatio-na\">N/A</label>\n        </fieldset>\n    </div>\n</form>\n<div #example (click)=\"handleClick($event)\"></div>\n<div id=\"mensur-change\" *ngIf=\"selected && selected.contents.m_index >= 0 && selected.contents.m_list[selected.contents.m_index].m_type == 'mensur'\">\n    <form [formGroup]=\"mensurForm\">\n    <fieldset>\n        <legend class=\"mensuration\">modus</legend>\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_modus\" type=\"radio\" id=\"modus2-3\" formControlName=\"modus2\" value=\"3\"/>\n        <label for=\"modus2-3\">3</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_modus\" type=\"radio\" id=\"modus2-2\" formControlName=\"modus2\" value=\"2\"/>\n        <label for=\"modus2-2\">2</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_modus\" type=\"radio\" id=\"modus2-na\" formControlName=\"modus2\" value=\"N/A\"/>\n        <label for=\"modus2-na\">N/A</label>\n    </fieldset>\n    <fieldset>\n        <legend class=\"mensuration\">tempus</legend>\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_tempus\" type=\"radio\" id=\"tempus2-3\" formControlName=\"tempus2\" value=\"3\"/>\n        <label for=\"tempus2-3\">3</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_tempus\" type=\"radio\" id=\"tempus2-2\" formControlName=\"tempus2\" value=\"2\"/>\n        <label for=\"tempus2-2\">2</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_tempus\" type=\"radio\" id=\"tempus2-na\" formControlName=\"tempus2\" value=\"N/A\"/>\n        <label for=\"tempus2-na\">N/A</label>\n    </fieldset>\n    <fieldset>\n        <legend class=\"mensuration\">prolatio</legend>\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_prolatio\" type=\"radio\" id=\"prolatio2-3\" formControlName=\"prolatio2\" value=\"3\"/>\n        <label for=\"prolatio2-3\">3</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_prolatio\" type=\"radio\" id=\"prolatio2-2\" formControlName=\"prolatio2\" value=\"2\"/>\n        <label for=\"prolatio2-2\">2</label>\n        &nbsp;\n        <input [(ngModel)]=\"selected.contents.m_list[selected.contents.m_index].m_prolatio\" type=\"radio\" id=\"prolatio2-na\" formControlName=\"prolatio2\" value=\"N/A\"/>\n        <label for=\"prolatio2-na\">N/A</label>\n    </fieldset>\n    </form>\n</div>\n<div id=\"tenor-section\" *ngIf=\"selected && selected.voice === 'tenor'\">\n    <p>\n        If the piece has repetitions of the tenor that are not written out in full,\n        please specify here. See \"Music Input Help\" for details.\n    </p>\n    <button class=\"primary-button\" mat-stroked-button (click)=\"repTenorButton()\">Set End of Repeating Tenor</button>\n    &nbsp;\n    <label>Total Number of Tenor Statements:&nbsp;\n        <input [(ngModel)]=\"selected.parent.repetitions\" type=\"number\" min=\"1\">\n    </label>\n</div>\n<button color=primary class=\"primary-button\" *ngIf=\"selected\" mat-stroked-button (click)=\"finishStep()\">\n    Continue to Score Editor\n</button>\n","import { Component, OnInit } from '@angular/core';\nimport { StateService } from '../../state-service.service';\nimport { MatDialog } from '@angular/material/dialog';\nimport { System } from '../../utils/system';\nimport { InputService } from '../input.service';\n\nimport * as vkbeautify from 'vkbeautify';\n\n@Component({\n  selector: 'app-toolbar',\n  templateUrl: './toolbar.component.html',\n  styleUrls: ['./toolbar.component.css']\n})\nexport class ToolbarComponent implements OnInit {\n  currentStaff: System;\n\n  constructor(\n    private selectedSystem: InputService,\n    private stateService: StateService,\n    public dialog: MatDialog\n  ) { }\n\n  ngOnInit() {\n    this.selectedSystem.subscribe(system => {\n      this.currentStaff = system;\n    });\n  }\n\n  saveClick(evt: MouseEvent) {\n    let target = evt.target as HTMLAnchorElement;\n    const mei = this.stateService.mei.generateXML();\n    const serializer = new XMLSerializer();\n    const content = vkbeautify.xml(serializer.serializeToString(mei));\n    const blob = new Blob([content], {type: 'application/xml'});\n    target.setAttribute('href', window.URL.createObjectURL(blob));\n  }\n\n  saveHumdrumClick(evt: MouseEvent) {\n    let target = evt.target as HTMLAnchorElement;\n    const white = this.currentStaff.parent.parent.notationType === \"mensural.white\";\n    const content = this.currentStaff.contents.getHumdrumScore({white: white});\n    const blob = new Blob([content], {type: 'text/plain'});\n    target.setAttribute('href', window.URL.createObjectURL(blob));\n  }\n\n  deleteStaff() {\n    let system = this.currentStaff;\n    let part = system.parent;\n    part.removeSystem(system.id);\n    this.selectedSystem.next(null);\n  }\n\n}\n","<div class=\"toolbar-container\">\n    <button mat-stroked-button>\n        <a download type=\"application/xml\" (click)=\"saveClick($event)\">\n            Download MEI File\n        </a>\n    </button>\n    <button mat-stroked-button *ngIf=\"currentStaff\">\n        <a download type=\"text/plain\" (click)=\"saveHumdrumClick($event)\">\n            Download System Humdrum\n        </a>\n    </button>\n    <button mat-stroked-button *ngIf=\"currentStaff\" (click)=\"deleteStaff()\">\n        Delete Staff\n    </button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DocService {\n  _partsSubject: Subject<XMLDocument>;\n  _scoreSubject: Subject<XMLDocument>;\n  _parts: XMLDocument;\n  _score: XMLDocument;\n\n  constructor() {\n    this._parts = null;\n    this._score = null;\n    this._partsSubject = new Subject<XMLDocument>();\n    this._scoreSubject = new Subject<XMLDocument>();\n  }\n\n  get parts(): XMLDocument {\n    return this._parts;\n  }\n\n  set parts(doc: XMLDocument) {\n    this._parts = doc;\n    this._partsSubject.next(this._parts);\n  }\n\n  get score(): XMLDocument {\n    return this._score;\n  }\n\n  set score(doc: XMLDocument) {\n    this._score = doc;\n    this._scoreSubject.next(this._score);\n  }\n}\n","import { Component, OnInit, OnDestroy, Input } from '@angular/core';\n\nimport { IRI } from '../../utils/definitions';\n\nimport { SelectedStaffService } from '../selected-staff.service';\n\nimport Diva from 'diva.js';\n\n@Component({\n  selector: 'app-score-diva-view',\n  templateUrl: './score-diva-view.component.html',\n  styleUrls: ['./score-diva-view.component.css']\n})\nexport class ScoreDivaViewComponent implements OnInit, OnDestroy {\n\n  diva: Diva;\n  pageToCanvasMap: Map<string, number> = new Map();\n  iri: IRI;\n  bbox: {ulx: string, uly: string, lrx: string, lry: string};\n\n  @Input() iiifManifest: IRI;\n\n  constructor(private staffService: SelectedStaffService) { }\n\n  ngOnInit() {\n    this.diva = new Diva('diva-score-wrapper', {\n      objectData: this.iiifManifest\n    });\n\n    Diva.Events.subscribe('ManifestDidLoad', this.parseCanvases.bind(this), this.diva.settings.ID);\n    Diva.Events.subscribe('ZoomLevelDidChange', this.handleZoom.bind(this), this.diva.settings.ID);\n\n    this.staffService.getStaffLocation().subscribe(([iri, bbox]) =>  {\n      this.iri = iri;\n      this.bbox = bbox;\n      console.debug(iri);\n      console.debug(bbox);\n      this.redraw();\n    });\n  }\n\n  handleZoom() {\n    (new Promise(resolve => {\n      document.getElementById(\"score-editor-container\").style.display = \"none\";\n      setTimeout(resolve, this.diva.settings.zoomDuration + 100);\n    })).then(() => {\n      this.redraw();\n      document.getElementById(\"score-editor-container\").style.display = \"\";\n    });\n  }\n\n  redraw() {\n    const index = this.pageToCanvasMap.get(this.iri);\n    if (index === undefined) {\n      return;\n    }\n    // Change to correct folio if necessary\n    if (!this.diva.getCurrentPageIndices().includes(index)) {\n      this.diva.gotoPageByIndex(index);\n    }\n    // Get the inner element and dimensions\n    const inner =this.diva.settings.innerElement;\n    const dimensions = this.diva.getPageDimensionsAtCurrentZoomLevel(index);\n    const offset = this.diva.settings.viewHandler._viewerCore.getPageRegion(\n      index,\n      {\n        includePadding: true,\n        incorporateViewport: true\n      }\n    );\n    const marginLeft = getComputedStyle(inner, null).getPropertyValue('margin-left');\n    // Check for the container div or create one\n    let container = document.getElementById(\"score-editor-container\");\n    if (container === null) {\n      container = document.createElement(\"div\");\n      container.id = \"score-editor-container\";\n      inner.appendChild(container);\n    }\n\n    // Create SVG container\n    const svgParent = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    const maxZoom = this.diva.getPageDimensionsAtZoomLevel(index, Number.MAX_SAFE_INTEGER)\n    svgParent.setAttribute('width', dimensions.width.toString());\n    svgParent.setAttribute('height', dimensions.height.toString());\n    svgParent.setAttribute('viewBox', '0 0 ' + maxZoom.width + ' ' + maxZoom.height);\n\n    container.style.position = 'absolute';\n    container.style.top = `${offset.top}px`;\n    container.style.left = `${offset.left - parseInt(marginLeft)}px`;\n\n    while (container.firstChild !== null) {\n      container.firstChild.remove();\n    }\n\n    let rect = document.createElementNS(\"http://www.w3.org/2000/svg\", \"rect\");\n    rect.setAttribute(\"x\", this.bbox.ulx);\n    rect.setAttribute(\"y\", this.bbox.uly);\n    rect.setAttribute(\"width\", (Number(this.bbox.lrx) - Number(this.bbox.ulx)).toString());\n    rect.setAttribute(\"height\", (Number(this.bbox.lry) - Number(this.bbox.uly)).toString());\n    rect.classList.add(\"zoneRect\");\n    svgParent.appendChild(rect);\n\n    container.appendChild(svgParent);\n  }\n\n  parseCanvases(manifest: { sequences: { canvases: object[] }[]}) {\n    for (const sequence of manifest.sequences) {\n      for (const canvas of sequence.canvases) {\n        this.pageToCanvasMap.set(canvas['@id'], sequence.canvases.indexOf(canvas));\n      }\n    }\n  }\n\n  ngOnDestroy() {\n    try {\n      this.diva.deactivate();\n      this.diva.destroy();\n    }\n    catch (e) {\n      console.warn(e);\n    }\n  }\n\n}\n","<div id=\"diva-score-wrapper\"></div>\n","import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { IRI } from '../utils/definitions';\nimport { StateService } from '../state-service.service';\nimport { MEIDocument } from '../utils/mei';\nimport { formIIIFManifest } from '../tools';\n\n@Component({\n  selector: 'app-score-editor',\n  templateUrl: './score-editor.component.html',\n  styleUrls: ['./score-editor.component.css']\n})\nexport class ScoreEditorComponent implements OnInit {\n\n  source: string;\n  identifier: string;\n  iiifManifest: IRI;\n  meiDoc: MEIDocument;\n\n  constructor(\n    private router: Router,\n    private route: ActivatedRoute,\n    private stateService: StateService\n  ) {\n    this.source = this.route.snapshot.paramMap.get('source');\n    this.identifier = decodeURIComponent(\n      this.route.snapshot.paramMap.get('identifier')\n    );\n    this.iiifManifest = formIIIFManifest(this.source, this.identifier);\n    this.meiDoc = this.stateService.mei;\n    if (this.meiDoc === null) {\n      this.router.navigate(['/input', this.source, this.identifier])\n    }\n  }\n\n  ngOnInit() {\n  }\n}\n","<div id=\"score-container\">\n    <app-score-diva-view [iiifManifest]=\"iiifManifest\"></app-score-diva-view>\n    <div id=\"right\">\n        <mat-tab-group>\n            <mat-tab label=\"Score Editor\">\n                <app-score-toolbar></app-score-toolbar>\n                <mat-divider></mat-divider>\n                <app-score-verovio-view></app-score-verovio-view>\n            </mat-tab>\n            <mat-tab label=\"Score Editor Help\">\n                <h2>About the Score Editor</h2>\n                <p>\n                    The <strong>Score Editor</strong> is for making simple edits\n                    in order to align the parts in your score. In other words,\n                    if you made mistakes in your initial entry of the music on\n                    the previous screen (the <strong>Music Input</strong> screen)\n                    the score will not align properly and you may need to make adjustments\n                    to the note durations or add dots in order to get the proper alignment.\n                </p>\n                <mat-divider></mat-divider>\n                <h2>Making Simple Edits</h2>\n                <p>\n                    When you click on a pitch, the staff to which\n                    that pitch belongs will be highlighted with a\n                    dashed box in the manuscript image in the left\n                    of the screen. This is to help you check\n                    the accuracy of the edits you make.\n                </p>\n                <p>\n                    You can make simple edits directly as follows.\n                    By clicking on a pitch to highlight it you can edit:\n                </p>\n                <ul>\n                    <li><strong>Pitch: </strong>\n                        Use up/down arrow keys to change pitch.\n                    </li>\n                    <li><strong>Rhythm: </strong>\n                        Type a number key to alter its rhythm\n                        (1 semibreve, 2 minim, 4 semiminim,\n                        8 fusa, 6 semifusa, 0 breve, 9 long, 7 maxima).\n                        Scoring-up will rerun after a rhythmic value changes.\n                    </li>\n                    <li><strong>Dots: </strong>\n                        Typing a period will add or remove the dot from the\n                        highlighted pitch. Scoring-up will automatically\n                        rerun.\n                    </li>\n                    <li><strong>Accidentals: </strong>\n                        To add a flat, press <code>-</code>.\n                        To add a sharp, press <code>#</code>.\n                        To add a natural, press <code>n</code>.\n                        To clear accidentals, press <code>N</code>.\n                    </li>\n                    <li><strong>Cloning and Deleting Elements: </strong>\n                        Elements can be cloned by selecting one and pressing the\n                        <code>I</code> key. Elements can be deleted by pressing\n                        <code>Backspace</code>.\n                    </li>\n                </ul>\n                <p>\n                    You can also use the \"Return to Music Input\" button to return\n                    to the <strong>Music Input</strong> screen\n                    and make more significant edits, but any changes made\n                    in the <strong>Score Editor</strong> thus far will be lost!\n                </p>\n                <mat-divider></mat-divider>\n                <h2>Moving to Editorial Mode</h2>\n                <p>\n                    When making corrections in the <strong>Score Editor</strong>\n                    it is assumed that you are correcting mistakes <em>you</em>\n                    made, and both the MEI Parts and MEI Score files will be updated\n                    with these changes. However, once you move to <strong>Editorial Mode</strong>,\n                    the MEI Parts file will no longer be updated since this is a record\n                    of the music <em>exactly</em> as it was recorded in the original\n                    manuscript. Any further corrections made in <strong>Editorial\n                    Mode</strong> will be encoded in the MEI Score file as\n                    <strong>editorial</strong> corrections. For example, when a\n                    dot is added in <strong>Editorial Mode</strong>:\n                </p>\n                <pre><code>\n                    &lt;choice&gt;\n                        &lt;corr&gt;\n                            &lt;note dur=&quot;semibrevis&quot; oct=&quot;3&quot; pname=&quot;a&quot; dur.quality=&quot;minor&quot;/&gt;\n                            &lt;dot form=&quot;div&quot;/&gt;\n                        &lt;/corr&gt;\n                        &lt;sic&gt;\n                            &lt;note dur=&quot;semibrevis&quot; oct=&quot;3&quot; pname=&quot;a&quot;/&gt;\n                        &lt;/sic&gt;\n                    &lt;/choice&gt;\n                </code></pre>\n                <mat-divider></mat-divider>\n                <p>\n                    The purpose of the <strong>Score Editor</strong> is to do enough editing to\n                    enable the correct alignment of the score and edit while\n                    viewing the manuscript. For more fine-grained editing,\n                    it is recommended to download the MEI file and open it\n                    in a tool that allows direct editing of the MEI file such\n                    as <a href=\"https://verovio.humdrum.org\" target=\"_blank\">\n                    the Verovio Humdrum Viewer</a> or <a href=\"https://editor.verovio.org\"\n                    target=\"_blank\">the Verovio Editor</a>.\n                </p>\n            </mat-tab>\n        </mat-tab-group>\n    </div>\n</div>\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatDividerModule } from '@angular/material/divider';\nimport { MatTabsModule } from '@angular/material/tabs';\n\nimport { ScoreEditorComponent } from './score-editor.component';\nimport { ScoreDivaViewComponent } from './score-diva-view/score-diva-view.component';\nimport { ScoreVerovioViewComponent } from './score-verovio-view/score-verovio-view.component';\nimport { ScoreToolbarComponent } from './score-toolbar/score-toolbar.component';\n\n@NgModule({\n  declarations: [\n    ScoreDivaViewComponent,\n    ScoreVerovioViewComponent,\n    ScoreEditorComponent,\n    ScoreToolbarComponent\n  ],\n  imports: [\n    CommonModule,\n    FormsModule,\n    MatButtonModule,\n    MatDividerModule,\n    MatTabsModule,\n  ],\n  exports: [\n    ScoreEditorComponent\n  ]\n})\nexport class ScoreEditorModule { }\n","import { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\n\nimport { refineScore } from 'scoring-up';\nimport * as vkbeautify from 'vkbeautify';\n\nimport { StateService } from '../../state-service.service';\nimport { DocService } from '../doc.service';\n\n@Component({\n  selector: 'app-score-toolbar',\n  templateUrl: './score-toolbar.component.html',\n  styleUrls: ['./score-toolbar.component.css']\n})\nexport class ScoreToolbarComponent implements OnInit {\n\n  currentDoc: XMLDocument = null;\n\n  constructor(public stateService: StateService,\n    private route: ActivatedRoute,\n    private router: Router,\n    private doc: DocService\n  ) { }\n\n  ngOnInit() {\n    this.doc._scoreSubject.subscribe((doc) => {\n      this.currentDoc = doc;\n    });\n  }\n\n  saveClick(event: MouseEvent) {\n    if (this.currentDoc !== null) {\n      const target = event.target as HTMLAnchorElement;\n      const refinedDoc = refineScore(\n        this.currentDoc.cloneNode(true),\n        this.stateService.scoreOptions.modernClefs,\n        this.stateService.scoreOptions.barlines\n      );\n      const serializer = new XMLSerializer();\n      const content = vkbeautify.xml(serializer.serializeToString(refinedDoc));\n      const blob = new Blob([content], {type: 'application/xml'});\n      target.setAttribute('href', URL.createObjectURL(blob));\n    }\n  }\n\n  savePartsClick(event: MouseEvent) {\n    if (this.stateService.mei != null) {\n      const target = event.target as HTMLAnchorElement;\n      const serializer = new XMLSerializer();\n      const content = vkbeautify.xml(serializer.serializeToString(this.doc.parts));\n      const blob = new Blob([content], {type: 'application/xml'});\n      target.setAttribute('href', URL.createObjectURL(blob));\n    }\n  }\n\n  goToInputEditor() {\n    if (confirm(\"Warning: Edits made on this page will be lost. Return to input editor?\")) {\n      let source = this.route.snapshot.paramMap.get('source');\n      let identifier = this.route.snapshot.paramMap.get('identifier');\n      this.router.navigate(['/input', source, identifier]);\n    }\n  }\n\n  copyToClipboard() {\n    if (this.currentDoc !== null) {\n      const serializer = new XMLSerializer();\n      const refinedDoc = refineScore(\n        this.currentDoc.cloneNode(true),\n        this.stateService.scoreOptions.modernClefs,\n        this.stateService.scoreOptions.barlines\n      );\n      const content = vkbeautify.xml(serializer.serializeToString(refinedDoc));\n      navigator.clipboard.writeText(content).then(() => { alert(\"MEI Score Copied!\"); }).catch(err => { console.debug(err); alert(\"Copy failed :(\"); });\n    }\n  }\n\n}\n","<div class=\"toolbar-container\">\n    <button mat-stroked-button (click)=\"goToInputEditor()\">\n        Return to Music Input\n    </button>\n    <button mat-stroked-button>\n        <a download type=\"application/xml\" (click)=\"saveClick($event)\">\n            Download MEI Score\n        </a>\n    </button>\n    <button mat-stroked-button>\n        <a download type=\"application/xml\" (click)=\"savePartsClick($event)\">\n            Download MEI Parts\n        </a>\n    </button>\n    <button mat-stroked-button (click)=\"copyToClipboard()\">\n        Copy MEI Score to Clipboard\n    </button>\n</div>\n","import { Component, OnInit, AfterViewInit, HostListener, ViewChild, ElementRef } from '@angular/core';\n\nimport { v4 as uuid } from 'uuid';\n\nimport * as ScoringUp from 'scoring-up';\nimport { vrvToolkit } from '../../utils/verovio';\nimport { StateService } from '../../state-service.service';\nimport { SelectedStaffService } from '../selected-staff.service';\nimport { DocService } from '../doc.service';\nimport { NAMESPACE } from '../../utils/mei';\n\nconst pnameOrder = [ 'c', 'd', 'e', 'f', 'g', 'a', 'b'];\n\nfunction recurseXmlId(element: Element) {\n  if (element.hasAttribute('xml:id')) {\n    element.setAttribute('xml:id', 'm-' + uuid());\n  }\n  for (let i = 0; i < element.children.length; i++) {\n    recurseXmlId(element.children[i]);\n  }\n}\n\n@Component({\n  selector: 'app-score-verovio-view',\n  templateUrl: './score-verovio-view.component.html',\n  styleUrls: ['./score-verovio-view.component.css']\n})\nexport class ScoreVerovioViewComponent implements OnInit, AfterViewInit {\n\n  @ViewChild('verovio') container: ElementRef;\n\n  selectedId: string = null;\n  corrToSicMap: Map<string, string> = new Map();\n\n  constructor(\n    public stateService: StateService,\n    private staffService: SelectedStaffService,\n    private doc: DocService\n  ) {  }\n\n  ngOnInit() {\n    this.doc.parts = this.stateService.mei.generateXML();\n    this.doc._scoreSubject.subscribe((doc) => {\n      this.container.nativeElement.innerHTML = '';\n      const svg = vrvToolkit.meiToSVG(doc);\n      this.container.nativeElement.appendChild(svg);\n      this.setSelected();\n    });\n  }\n\n  setEditorialMode() {\n    if (confirm(\"Edits in editorial mode reflect cases where there is a problem with the manuscript. You cannot exit editorial mode. Do you want to continue?\")) {\n      this.stateService.editorialMode = true;\n    }\n  }\n\n  setSelected() {\n    if (this.selectedId !== null) {\n      Array.from(document.getElementsByClassName(\"selected\"))\n        .forEach(elem => {\n          elem.classList.remove(\"selected\");\n          elem.setAttribute(\"fill\", \"\");\n        });\n      try {\n        document.getElementById(this.selectedId).classList.add(\"selected\");\n        document.getElementById(this.selectedId).setAttribute(\"fill\", \"#d00\");\n      }\n      catch (_e) {\n        console.debug(_e);\n        this.selectedId = null;\n        return;\n      }\n      try {\n        // Convert ID to sic ID if applicable\n        let partsId = this.selectedId;\n        if (this.corrToSicMap.has(partsId)) {\n          partsId = this.corrToSicMap.get(partsId);\n        }\n        // Get nearest pb  and sb\n        const resolver = this.doc.parts.createNSResolver(this.doc.parts.ownerDocument == null ? this.doc.parts.documentElement : this.doc.parts.ownerDocument.documentElement);\n        const meiRes = () => { return 'http://www.music-encoding.org/ns/mei'; };\n        const ref = this.doc.parts.evaluate(\"//*[@xml:id='\" + partsId + \"']\", this.doc.parts, resolver, XPathResult.FIRST_ORDERED_NODE_TYPE, null).singleNodeValue;\n        let result = this.doc.parts.evaluate(\"./preceding::mei:pb\", ref, meiRes, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n        const pb = result.snapshotItem(result.snapshotLength - 1) as Element;\n        result = this.doc.parts.evaluate(\"./preceding::mei:sb\", ref, meiRes, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);\n        const sb = result.snapshotItem(result.snapshotLength - 1) as Element;\n        // Get corresponding zones (strip away fragment symbol)\n        const pbFacsId = pb.getAttribute(\"facs\")[0] === \"#\" ?\n          pb.getAttribute(\"facs\").substring(1) :\n          pb.getAttribute(\"facs\");\n        const sbFacsId = sb.getAttribute(\"facs\")[0] === \"#\" ?\n          sb.getAttribute(\"facs\").substring(1) :\n          sb.getAttribute(\"facs\");\n        console.debug(sbFacsId);\n\n        // The following SHOULD use XPath but I haven't been able to get it to work\n        const pbGraphic = Array.from(\n          this.doc.parts.getElementsByTagName(\"surface\")\n        ).filter(el => { return el.getAttribute(\"xml:id\") === pbFacsId; }).pop()\n          .querySelector(\"graphic\");\n        const sbZone = Array.from(\n          pbGraphic.children\n        ).filter(el => { return el.getAttribute(\"xml:id\") === sbFacsId; }).pop()\n        const iri = pbGraphic.getAttribute(\"target\");\n        const bbox = {\n          ulx: sbZone.getAttribute(\"ulx\"),\n          uly: sbZone.getAttribute(\"uly\"),\n          lrx: sbZone.getAttribute(\"lrx\"),\n          lry: sbZone.getAttribute(\"lry\")\n        };\n        console.debug(iri);\n        this.staffService.staffLocation = [iri, bbox];\n      }\n      catch (_e) {\n        console.debug(_e);\n      }\n    }\n  }\n\n  ngAfterViewInit() {\n    this.doc.score = this.runScoringUp(this.doc.parts);\n  }\n\n  handleClick(event: MouseEvent) {\n    let target = event.target as Element;\n    while (target) {\n      if (target.nodeName === 'g') {\n        if (target.classList.contains('note') || target.classList.contains('rest')) {\n          this.selectedId = target.id;\n          this.setSelected();\n          break;\n        }\n      }\n      target = target.parentElement;\n    }\n  }\n\n  @HostListener('document:keydown', ['$event'])\n  handleKeyPress(event: KeyboardEvent) {\n    if (this.selectedId !== null) {\n      let doc: XMLDocument;\n      const resolver = this.doc.parts.createNSResolver(this.doc.parts.ownerDocument == null ? this.doc.parts.documentElement : this.doc.parts.ownerDocument.documentElement);\n      const result = this.doc.parts.evaluate(\"//*[@xml:id='\" + this.selectedId + \"']\", this.doc.parts, resolver, XPathResult.FIRST_ORDERED_NODE_TYPE, null);\n      if (!result.singleNodeValue) return;\n      let target = result.singleNodeValue as Element;\n      // Ensure corrected element in MEI\n      if (this.stateService.editorialMode) {\n        target = this.ensureCorrElement(target, this.doc.parts);\n      }\n      if (target.tagName === \"note\") {\n        switch (event.key) {\n          case '.':\n            let sibling = target.nextElementSibling;\n            if (sibling !== null && sibling.tagName === 'dot') {\n              target.nextSibling.remove();\n              if (target.hasAttribute(\"dots\")) {\n                target.setAttribute(\"dots\", \"0\");\n              }\n            }\n            else {\n              let dot = this.doc.parts.createElementNS(\"http://www.music-encoding.org/ns/mei\", \"dot\");\n              dot.setAttribute(\"xml:id\", \"m-\" + uuid());\n              target.insertAdjacentElement(\"afterend\", dot);\n            }\n            break;\n          case 'ArrowUp':\n            if (target.hasAttribute('pname')) {\n              let currentPname = target.getAttribute('pname');\n              let idx = pnameOrder.indexOf(currentPname);\n              if (idx + 1 < pnameOrder.length) {\n                target.setAttribute('pname', pnameOrder[idx + 1]);\n              }\n              else {\n                target.setAttribute('pname', pnameOrder[0]);\n                target.setAttribute('oct', (parseInt(target.getAttribute('oct')) + 1).toString());\n              }\n            }\n            break;\n          case 'ArrowDown':\n            if (target.hasAttribute('pname')) {\n              let currentPname = target.getAttribute('pname');\n              let idx = pnameOrder.indexOf(currentPname);\n              if (idx - 1 > 0) {\n                target.setAttribute('pname', pnameOrder[idx - 1]);\n              }\n              else {\n                target.setAttribute('pname', pnameOrder[pnameOrder.length - 1]);\n                target.setAttribute('oct', (parseInt(target.getAttribute('oct')) - 1).toString());\n              }\n            }\n            break;\n          case '1': target.setAttribute('dur', 'semibrevis'); break;\n          case '2': target.setAttribute('dur', 'minima'); break;\n          case '4': target.setAttribute('dur', 'semiminima'); break;\n          case '8': target.setAttribute('dur', 'fusa'); break;\n          case '6': target.setAttribute('dur', 'semifusa'); break;\n          case '7': target.setAttribute('dur', 'maxima'); break;\n          case '9': target.setAttribute('dur', 'longa'); break;\n          case '0': target.setAttribute('dur', 'brevis'); break;\n\n          case '#': target.setAttribute('accid', 's'); break;\n          case '-': target.setAttribute('accid', 'f'); break;\n          case 'n': target.setAttribute('accid', 'n'); break;\n          case 'N': target.removeAttribute('accid'); break;\n\n          case 'I':\n            const clone = target.cloneNode(true) as Element;\n            recurseXmlId(clone);\n            if (target.nextElementSibling && target.nextElementSibling.tagName === 'dot') {\n              const cloneDot = target.nextElementSibling.cloneNode(true) as Element;\n              recurseXmlId(cloneDot);\n              target.nextElementSibling.insertAdjacentElement('afterend', clone);\n              clone.insertAdjacentElement('afterend', cloneDot);\n            }\n            else {\n              target.insertAdjacentElement('beforebegin', clone);\n            }\n            break;\n          case 'p':\n          case 'P':\n            let plica;\n            if (target.querySelector('plica')) {\n              plica = target.querySelector('plica');\n            } else {\n              plica = this.doc.parts.createElementNS(NAMESPACE, 'plica');\n              target.appendChild(plica);\n            }\n            if (event.key === 'P') {\n              if (plica.getAttribute('dir') === 'down') {\n                plica.remove();\n              } else {\n                plica.setAttribute('dir', 'down');\n              }\n            } else {\n              if (plica.getAttribute('dir') === 'up') {\n                plica.remove();\n              } else {\n                plica.setAttribute('dir', 'up');\n              }\n            }\n            break;\n          case 'Backspace':\n            if (target.nextElementSibling && target.nextElementSibling.tagName === 'dot') {\n              target.nextElementSibling.remove();\n            }\n            target.remove();\n\n            break;\n          default:\n            return;\n        }\n      } else if (target.tagName === \"rest\") {\n        switch (event.key) {\n          case '1': target.setAttribute('dur', 'semibrevis'); break;\n          case '2': target.setAttribute('dur', 'minima'); break;\n          case '4': target.setAttribute('dur', 'semiminima'); break;\n          case '8': target.setAttribute('dur', 'fusa'); break;\n          case '6': target.setAttribute('dur', 'semifusa'); break;\n          case '7': target.setAttribute('dur', 'maxima'); break;\n          case '9': target.setAttribute('dur', 'longa'); break;\n          case '0': target.setAttribute('dur', 'brevis'); break;\n\n          case 'I':\n            const clone = target.cloneNode(true) as Element;\n            recurseXmlId(clone);\n            target.insertAdjacentElement('beforebegin', clone);\n            break;\n\n          case 'Backspace':\n            target.remove();\n            break;\n\n          default:\n            return;\n        }\n      }\n\n      event.preventDefault();\n      this.doc.score = this.runScoringUp(this.doc.parts);\n    }\n  }\n\n  runScoringUp(meiDoc: XMLDocument): XMLDocument {\n    let output = null;\n    try {\n      const staffDef = meiDoc.getElementsByTagName(\"staffDef\")[0];\n      let quasiDoc: XMLDocument;\n      quasiDoc = ScoringUp.merge(meiDoc.cloneNode(true));\n      switch (staffDef.getAttribute(\"notationtype\")) {\n        case \"mensural.white\":\n          output = ScoringUp.ArsNova.lining_up(quasiDoc);\n          break;\n        case \"mensural.black\":\n          switch(staffDef.getAttribute(\"notationsubtype\")) {\n            case \"Ars_antiqua\":\n              output = ScoringUp.ArsAntiqua.lining_up(quasiDoc);\n              break;\n            case \"Ars_nova\":\n              output = ScoringUp.ArsNova.lining_up(quasiDoc);\n              break;\n            default:\n              console.warn(\"Only 'Ars antiqua' and 'Ars nova' are supported!\");\n          }\n          break;\n        default:\n          console.warn(\"Only mensural notation types are supported.\");\n          break;\n      }\n      if (output !== null) {\n        ScoringUp.PostProcessing.replace_ligatures_by_brackets(output);\n        // ScoringUp.PostProcessing.remove_num_and_numbase(output);\n      }\n    }\n    catch(e) {\n      console.error(e);\n      alert(\"Error in scoring up tool! \" + e);\n      output = null;\n    }\n    finally {\n      return output;\n    }\n  }\n\n\n  ensureCorrElement(target: Element, meiDoc: XMLDocument): Element {\n    if (target.closest('corr')) {\n      return target;\n    }\n    const choice = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'choice');\n    const corr = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'corr');\n    const sic = meiDoc.createElementNS('http://www.music-encoding.org/ns/mei', 'sic');\n    const sibling = target.nextElementSibling;\n    target.insertAdjacentElement('beforebegin', choice);\n    choice.appendChild(corr);\n    choice.appendChild(sic);\n    sic.appendChild(target);\n    const corrTarget = target.cloneNode(true) as Element;\n    recurseXmlId(corrTarget);\n    corr.appendChild(corrTarget);\n    this.corrToSicMap.set(corrTarget.getAttribute(\"xml:id\"), target.getAttribute(\"xml:id\"));\n    if (sibling !== null && sibling.tagName === 'dot') {\n      sic.appendChild(sibling);\n      const sibCorr = sibling.cloneNode(true) as Element;\n      recurseXmlId(sibCorr);\n      corr.appendChild(sibCorr);\n    }\n    return corrTarget;\n  }\n}\n","<div id=\"verovio\" #verovio (click)=\"handleClick($event)\"></div>\n<div>\n    <label>\n        Generate Barlines on Export\n        <input type=\"checkbox\" [(ngModel)]=\"stateService.scoreOptions.barlines\">\n    </label>\n    &nbsp;\n    <label>\n        Switch to Modern Clefs on Export\n        <input type=\"checkbox\" [(ngModel)]=\"stateService.scoreOptions.modernClefs\">\n    </label>\n</div>\n<div>\n    <button color=primary class=\"primary-button\" mat-stroked-button *ngIf=\"!stateService.editorialMode\" (click)=\"setEditorialMode()\">\n        Continue in Editorial Mode\n    </button>\n</div>\n","import { Injectable } from '@angular/core';\nimport { Subject } from 'rxjs';\nimport { IRI } from '../utils/definitions';\n\ntype BBox = {\n  ulx: string,\n  uly: string,\n  lrx: string,\n  lry: string\n};\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SelectedStaffService {\n  _staffLoc: Subject<[IRI, BBox]>;\n\n  constructor() {\n    this._staffLoc = new Subject<[IRI, BBox]>();\n  }\n\n  getStaffLocation() {\n    return this._staffLoc;\n  }\n\n  set staffLocation(loc: [IRI, BBox]) {\n    this._staffLoc.next(loc);\n  }\n\n\n}\n","import { Component, OnInit } from '@angular/core';\nimport { FormGroup, FormControl, Validators } from '@angular/forms';\nimport { RxwebValidators } from '@rxweb/reactive-form-validators';\nimport { Router } from '@angular/router';\n\nimport { MEIDocument } from '../utils/mei';\nimport { StateService } from '../state-service.service';\nimport * as Tools from '../tools';\n\n@Component({\n  selector: 'app-select-document',\n  templateUrl: './select-document.component.html',\n  styleUrls: ['./select-document.component.css']\n})\nexport class SelectDocumentComponent implements OnInit {\n\n  type: string = 'gallica';\n  identifier: string = '12148/btv1b8454675g';\n  file: File = null;\n\n  invalid = false;\n\n  selectionForm = new FormGroup({\n    source: new FormControl('gallica', Validators.required),\n    resourceURL: new FormControl('', [Validators.required, RxwebValidators.url()])\n  });\n\n  loadMEIForm = new FormGroup({\n    fileInput: new FormControl('', Validators.required)\n  });\n\n  constructor(private router: Router, private stateService: StateService) { }\n\n  ngOnInit() {\n  }\n\n  submit() {\n    console.debug(\"Submit\");\n    let source = this.selectionForm.controls['source'].value;\n    let resourceURL = this.selectionForm.controls['resourceURL'].value;\n    this.invalid = false;\n    let identifier: string;\n    switch (source) {\n      case 'gallica':\n        console.debug(\"gallica\");\n        if (Tools.gallicaRegexp.test(resourceURL)) {\n          console.debug(\"true\");\n          identifier = resourceURL.match(Tools.gallicaRegexp)[1];\n        }\n        else {\n          console.debug(\"false\");\n          this.invalid = true;\n          return;\n        }\n        break;\n      case 'ecodices':\n        if (Tools.ecodicesRegexp.test(resourceURL)) {\n          console.debug(\"Regular ecodices\");\n          let matches = resourceURL.match(Tools.ecodicesRegexp);\n          identifier = matches[1] + '-' + matches[2];\n        }\n        else if (Tools.ecodicesIIIFRegexp.test(resourceURL)) {\n          console.debug(\"IIIF ecodices\");\n          identifier = resourceURL.match(Tools.ecodicesIIIFRegexp)[1];\n        }\n        else {\n          this.invalid = true;\n          return;\n        }\n        break;\n      case 'iiif':\n        console.debug('iiif case')\n        if (Tools.genericIIIFRegexp.test(resourceURL)) {\n          console.debug(\"generic iiif\");\n          identifier = encodeURIComponent(resourceURL);\n        }\n        break;\n      default:\n        console.debug(source);\n        this.invalid = true;\n        return;\n    }\n    console.debug(identifier);\n    this.router.navigate(['/input', source, encodeURIComponent(identifier)]);\n  }\n\n  meiSubmit() {\n    console.debug(\"MEI Submit\");\n    console.debug(this.file);\n    if (this.file === null) { return; }\n    let reader = new FileReader();\n    reader.addEventListener(\"load\", () => {\n      let rawText = reader.result as string;\n      let parser = new DOMParser();\n      let doc = parser.parseFromString(rawText, \"application/xml\");\n      let mei = MEIDocument.fromXML(doc)\n      console.debug(mei);\n\n      // Try to determine IIIF\n      let iiif = mei.metadata.sourceIRI;\n      let source: string, identifier: string;\n      if (Tools.gallicaIIIFRegexp.test(iiif)) {\n        source = \"gallica\";\n        identifier = iiif.match(Tools.gallicaIIIFRegexp)[1];\n      }\n      else if (Tools.ecodicesIIIFRegexp.test(iiif)) {\n        source = \"ecodices\";\n        identifier = iiif.match(Tools.ecodicesIIIFRegexp)[1];\n      }\n      else if (Tools.genericIIIFRegexp.test(iiif)) {\n        source = \"iiif\";\n        identifier = encodeURIComponent(iiif);\n      }\n      else {\n        window.alert(\"Sorry! This seems to be a valid file, but this IIIF manifest cannot be loaded.\");\n        return;\n      }\n      this.stateService.mei = mei;\n      this.router.navigate(['/input', source, encodeURIComponent(identifier)]);\n    });\n    reader.readAsText(this.file);\n  }\n\n  onFileChange(evt) {\n    this.file = evt.target['files'][0];\n  }\n\n  get encodedIdSample(): string {\n    return encodeURIComponent(this.identifier);\n  }\n\n}\n","<div id=\"document-select\">\n    <div id=\"load-manuscript\">\n        <h1>Load a manuscript</h1>\n        <form [formGroup]=\"selectionForm\" (submit)=\"submit()\">\n            <div style=\"display:block;\">\n                <label class=\"label\">Manuscript Repository:&nbsp;\n                    <select formControlName=\"source\">\n                        <option value=\"gallica\" selected>Gallica</option>\n                        <option value=\"ecodices\">eCodices</option>\n                        <option value=\"diamm\" disabled>DIAMM</option>\n                        <option value=\"iiif\">Generic IIIF</option>\n                    </select>\n                </label>\n                &nbsp;\n                <label class=\"label\">URL:&nbsp;\n                    <input type=\"url\" formControlName=\"resourceURL\">\n                </label>\n                <small *ngIf=\"invalid\">URL is unexpected for this source!</small>\n            </div>\n            <div>\n                <button type=\"submit\" [disabled]=\"!selectionForm.valid\" mat-stroked-button>Submit</button>\n            </div>\n        </form>\n        <br/>\n        <p>\n          For example, to transcribe a piece from the famous Roman de Fauvel manuscript,\n          choose <em>Gallica</em> in the dropdown and paste this URL:\n          <br/>\n          <code>https://gallica.bnf.fr/ark:/12148/btv1b8454675g</code>\n        </p>\n    </div>\n    <div id=\"load-mei\">\n        <h1>Load an .mei file</h1>\n        <form [formGroup]=\"loadMEIForm\" (submit)=\"meiSubmit()\">\n            <div style=\"display:block;\">\n                <label class=\"label\">Compatible Parts-MEI File:&nbsp;\n                    <input type=\"file\" (change)=\"onFileChange($event)\" formControlName=\"fileInput\" accept=\"application/mei+xml, application/xml, .mei, .xml\">\n                </label>\n            </div>\n            <div>\n                <button type=\"submit\" [disabled]=\"!loadMEIForm.valid\" mat-stroked-button>Load File</button>\n            </div>\n        </form>\n    </div>\n</div>\n<div id=\"prototype-message\">\n  <p>\n    This prototype for an online mensural music editor, funded by\n    <a href=\"https://www.brandeis.edu\">Brandeis University</a>\n    and the\n    <a href=\"https://www.neh.gov\">National Endowment for the Humanities</a>,\n    allows students and experts alike to encode transcriptions of polyphony\n    directly into mensural notation, and links the music transcriptions\n    to zones of the digital images of the medieval manuscripts. For more information\n    about this project, click <a href=\"https://measuringpolyphony.org\">here</a>.\n  </p>\n  <br/>\n  <div id=\"funder-logos\">\n    <a href=\"https://www.neh.gov\">\n      <img src=\"assets/img/NEH-Preferred-Seal820.jpg\" alt=\"National Endowment for the Humanities Logo\" class=\"funder-logo\">\n    </a>\n    <a href=\"https://www.brandeis.edu\">\n      <img src=\"assets/img/brandeis-logo-stacked-seal-blue-digital.png\" alt=\"Brandeis University Logo\" class=\"funder-logo\">\n    </a>\n  </div>\n</div>\n","import { Injectable } from '@angular/core';\nimport { MEIDocument } from './utils/mei';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StateService {\n\n  private meiDoc: MEIDocument;\n  public editorialMode: boolean;\n  public scoreOptions: {\n    barlines: boolean,\n    modernClefs: boolean\n  };\n\n  constructor() {\n    this.meiDoc = null;\n    this.editorialMode = false;\n    this.scoreOptions = {\n      barlines: false,\n      modernClefs: false\n    };\n  }\n\n  get mei(): MEIDocument {\n    return this.meiDoc;\n  }\n\n  set mei(document: MEIDocument) {\n    this.meiDoc = document;\n  }\n}\n","import { IRI } from './utils/definitions';\n\nexport function formIIIFManifest(source: string, identifier: string): IRI {\n  switch (source) {\n    case 'gallica':\n      return 'https://gallica.bnf.fr/iiif/ark:/' +\n        identifier +\n        '/manifest.json';\n    case 'ecodices':\n      return 'https://www.e-codices.unifr.ch/metadata/iiif/' +\n        identifier +\n        '/manifest.json';\n    case 'iiif':\n      return decodeURIComponent(identifier);\n    default:\n      return '';\n  }\n}\n\n//https://gallica.bnf.fr/ark:/12148/btv1b8454675g\nexport const gallicaRegexp = new RegExp(\"https?:\\/\\/gallica\\.bnf\\.fr\\/ark:\\/([a-z0-9]+\\/[a-z0-9]+)\");\nexport const gallicaIIIFRegexp = new RegExp(\"https?:\\/\\/gallica\\.bnf\\.fr\\/iiif\\/ark:\\/([a-z0-9]+\\/[a-z0-9]+)\\/manifest.json\");\n//https://www.e-codices.unifr.ch/en/list/one/bbb/0218\nexport const ecodicesRegexp = new RegExp(\"https?:\\/\\/www\\.e-codices\\.unifr\\.ch\\/[a-z]{2}\\/list\\/one\\/([a-z]+)\\/([-a-zA-Z0-9]+)\");\n//https://www.e-codices.unifr.ch/metadata/iiif/bbb-0218/manifest.json\nexport const ecodicesIIIFRegexp = new RegExp(\"https?:\\/\\/www\\.e-codices\\.unifr\\.ch\\/metadata\\/iiif\\/([-a-zA-Z0-9]+)\\/manifest\\.json\");\nexport const genericIIIFRegexp = new RegExp(\"https?:\\/\\/.*\\/manifest\\.json\");\n","/**\n * Based on musiclist.js by Craig Sapp\n * From: https://github.com/craigsapp/mensural-input/blob/master/scripts/musiclist.js\n */\n\nimport { v4 } from \"uuid\";\nimport { Mensuration } from './definitions';\n\nfunction parseRhythm(rhythm: string): number {\n  let val: number;\n  switch (rhythm) {\n    case \"semibrevis\": val = 1; break;\n    case \"brevis\": val = 0; break;\n    case \"maxima\": val = 7; break;\n    case \"longa\": val = 9; break;\n    case \"minima\": val = 2; break;\n    case \"semiminima\": val = 4; break;\n    case \"fusa\": val = 8; break;\n    case \"semifusa\": val = 6; break;\n  }\n  return val;\n}\n\nexport enum PitchClass {\n  C = 0,\n  D = 1,\n  E = 2,\n  F = 3,\n  G = 4,\n  A = 5,\n  B = 6,\n}\n\nexport enum Accid {\n  NONE,\n  SHARP = \"#\",\n  FLAT = \"-\",\n  NATURAL = \"n\",\n}\n\nexport enum LigStatus {\n  NONE,\n  START,\n  END,\n}\n\nexport enum PlicaStatus {\n  NONE,\n  UP,\n  DOWN,\n}\n\nexport interface MusicItem {\n  m_type: string;\n  m_id: string;\n  m_line: number;\n  getHumdrumLine(options: object): string;\n}\n\nexport class ClefItem implements MusicItem {\n  readonly m_type = \"clef\";\n  m_line = -1;\n  m_id: string;\n  m_pname: PitchClass;\n  m_clefLine: number;\n  m_keySig: Map<string,string>;\n\n  constructor () {\n    this.m_pname = PitchClass.C;\n    this.m_clefLine = 3;\n    this.m_keySig = new Map();\n  }\n\n  raisePitch () {\n    this.m_clefLine += 1;\n    if (this.m_clefLine > 5) {\n      this.m_clefLine = 5;\n    }\n  }\n\n  lowerPitch () {\n    this.m_clefLine -= 1;\n    if (this.m_clefLine < 1) {\n      this.m_clefLine = 1;\n    }\n  }\n\n  getHumdrumLine(): string {\n    let output = \"*clef\";\n    switch (this.m_pname) {\n      case PitchClass.G: output += \"G\"; break;\n      case PitchClass.F: output += \"F\"; break;\n      default: output += \"C\"; break;\n    }\n    output += this.m_clefLine;\n    output += \"\\t\";\n    output += \"*\";\n    if (this.m_keySig.size > 0) {\n      output += \"\\n\";\n      output += \"*k[\";\n      for (let [pitch, accid] of this.m_keySig) {\n        output += pitch;\n        output += accid;\n      }\n      output += \"]\\t*\";\n    }\n    return output;\n  }\n\n  static parseXML(element: Element): ClefItem {\n    let clef = new ClefItem();\n    if (element.hasAttribute(\"xml:id\")) {\n      clef.m_id = element.getAttribute(\"xml:id\");\n    }\n    switch (element.getAttribute(\"shape\")) {\n      case \"F\": clef.m_pname = PitchClass.F; break;\n      case \"G\": clef.m_pname = PitchClass.G; break;\n      case \"C\":\n      default: break;\n    }\n    try {\n      let line: number = parseInt(element.getAttribute(\"line\"));\n      clef.m_clefLine = line;\n    } catch (e) {}\n    return clef;\n  }\n}\n\nexport class RestItem implements MusicItem {\n  readonly m_type = \"rest\";\n  m_line = -1;\n  m_id: string;\n  m_rhythm: number;\n  m_dot: boolean;\n\n  constructor (rhythm?: number) {\n    this.m_dot = false;\n    if (rhythm !== undefined) {\n      this.m_rhythm = rhythm;\n    } else {\n      this.m_rhythm = 1;\n    }\n  }\n\n  getHumdrumLine (options: object): string {\n    let output = \"\";\n    switch (this.m_rhythm) {\n      case 7: output += \"X\"; break;\n\t\t\tcase 9: output += \"L\"; break;\n\t\t\tcase 0: output += \"S\"; break;\n\t\t\tcase 1: output += \"s\"; break;\n\t\t\tcase 2: output += \"M\"; break;\n\t\t\tcase 4: output += \"m\"; break;\n\t\t\tcase 6: output += \"u\"; break;\n\t\t\tcase 8: output += \"U\"; break;\n    }\n    if (this.m_dot) {\n      output += \":\";\n    }\n    output += \"r\";\n    if (options[\"mark\"]) {\n      output += \"@\";\n    }\n    output += \"\\t.\";\n    return output;\n  }\n\n  static parseXML(element: Element): RestItem {\n    let rest = new RestItem();\n    if (element.hasAttribute(\"xml:id\")) {\n      rest.m_id = element.getAttribute(\"xml:id\");\n    }\n    if (element.hasAttribute(\"dur\")) {\n      rest.m_rhythm = parseRhythm(element.getAttribute(\"dur\"));\n    }\n    return rest;\n  }\n}\n\nexport class MensurItem implements MusicItem {\n  readonly m_type = \"mensur\";\n  m_line = -1;\n  m_modus: Mensuration;\n  m_tempus: Mensuration;\n  m_prolatio: Mensuration;\n  m_id: string;\n\n  constructor() {\n    this.m_modus = Mensuration.NA;\n    this.m_tempus = Mensuration.NA;\n    this.m_prolatio = Mensuration.NA;\n  }\n\n  getHumdrumLine(): string {\n    if (this.m_tempus === Mensuration.Two && this.m_prolatio === Mensuration.Two)\n      return \"*met(C)\\t*\";\n    if (this.m_tempus === Mensuration.Three && this.m_prolatio === Mensuration.Two)\n      return \"*met(O)\\t*\";\n    if (this.m_tempus === Mensuration.Two && this.m_prolatio === Mensuration.Three)\n      return \"*met(C.)\\t*\";\n    if (this.m_tempus === Mensuration.Three && this.m_prolatio === Mensuration.Three)\n      return \"*met(O.)\\t*\";\n    else\n      return \"*met(C)\\t*\";\n  }\n\n  static parseXML(element: Element): MensurItem {\n    let mensur = new MensurItem();\n    if (element.hasAttribute(\"xml:id\")) {\n      mensur.m_id = element.getAttribute(\"xml:id\");\n    }\n    if (element.hasAttribute(\"modusminor\")) {\n      mensur.m_modus = element.getAttribute(\"modus\") as Mensuration;\n    }\n    if (element.hasAttribute(\"tempus\")) {\n      mensur.m_tempus = element.getAttribute(\"tempus\") as Mensuration;\n    }\n    if (element.hasAttribute(\"prolatio\")) {\n      mensur.m_prolatio = element.getAttribute(\"prolatio\") as Mensuration;\n    }\n    return mensur;\n  }\n}\n\nexport class NoteItem implements MusicItem {\n  readonly m_type = \"note\";\n  m_line = -1;\n  m_pname: PitchClass;\n  m_accid: Accid;\n  m_oct: number;\n  m_rhythm: number;\n  m_dot: boolean;\n  m_text: string;\n  m_lig: LigStatus;\n  m_id: string;\n  m_plica: PlicaStatus;\n\n  constructor() {\n    this.m_pname = PitchClass.C;\n    this.m_accid = Accid.NONE;\n    this.m_oct = 4;\n    this.m_rhythm = 1;\n    this.m_dot = false;\n    this.m_text = \"\";\n    this.m_lig = LigStatus.NONE;\n    this.m_plica = PlicaStatus.NONE;\n  }\n\n  raisePitch (amount?: number) {\n    if (amount === undefined) {\n      amount = 1;\n    }\n    if (amount >= 7) {\n      this.m_oct += amount % 7;\n      amount -= 7 * (amount % 7);\n    }\n\n    this.m_pname += amount;\n    if (this.m_pname > 6) {\n      this.m_pname -= 7;\n      this.m_oct += 1;\n    }\n  }\n\n  lowerPitch (amount?: number) {\n    if (amount === undefined) {\n      amount = 1;\n    }\n    if (amount >= 7) {\n      this.m_oct -= amount % 7;\n      amount -= 7 * (amount % 7);\n    }\n    this.m_pname -= amount;\n    if (this.m_pname < 0) {\n      this.m_pname += 7;\n      this.m_oct -= 1;\n    }\n  }\n\n  getHumdrumLine(options: object): string {\n    let output = \"\";\n    if (this.m_lig === LigStatus.START) {\n      output += \"[\";\n    }\n    switch (this.m_rhythm) {\n      case 7: output += \"X\"; break;\n  \t\tcase 9: output += \"L\"; break;\n  \t\tcase 0: output += \"S\"; break;\n  \t\tcase 1: output += \"s\"; break;\n  \t\tcase 2: output += \"M\"; break;\n  \t\tcase 4: output += \"m\"; break;\n  \t\tcase 6: output += \"u\"; break;\n  \t\tcase 8: output += \"U\"; break;\n    }\n    if (this.m_dot) {\n      output += \":\";\n    }\n\n    let pname: string;\n    switch(this.m_pname) {\n      case PitchClass.C: pname = \"c\"; break;\n      case PitchClass.D: pname = \"d\"; break;\n      case PitchClass.E: pname = \"e\"; break;\n      case PitchClass.F: pname = \"f\"; break;\n      case PitchClass.G: pname = \"g\"; break;\n      case PitchClass.A: pname = \"a\"; break;\n      case PitchClass.B: pname = \"b\"; break;\n    }\n    if (this.m_oct >= 4) {\n      for (let i = 4; i <= this.m_oct; i++) {\n        output += pname;\n      }\n    } else {\n      pname = pname.toUpperCase();\n      for (let i = 3; i >= this.m_oct; i--) {\n        output += pname;\n      }\n    }\n\n    if (this.m_plica === PlicaStatus.DOWN) {\n      output += \"p\";\n    } else if (this.m_plica === PlicaStatus.UP) {\n      output += \"P\";\n    }\n\n    if (this.m_accid !== Accid.NONE) {\n      output += this.m_accid.toString();\n    }\n\n    if (this.m_lig === LigStatus.END) {\n      output += \"]\";\n    }\n\n    if (options[\"mark\"]) {\n      output += \"@\";\n    }\n\n    output += \"\\t\";\n    if (this.m_text) {\n      if (options[\"hyphen\"]) {\n        output += \"-\";\n      }\n      output += this.m_text;\n    } else {\n      output += \".\";\n    }\n\n    return output;\n  }\n\n  static parseXML(element: Element): NoteItem {\n    let note = new NoteItem();\n    // Set info from element attributes\n    if (element.hasAttribute(\"xml:id\")) {\n      note.m_id = element.getAttribute(\"xml:id\");\n    }\n    if (element.hasAttribute(\"oct\")) {\n      note.m_oct = parseInt(element.getAttribute(\"oct\"));\n    }\n    if (element.hasAttribute(\"dur\")) {\n      note.m_rhythm = parseRhythm(element.getAttribute(\"dur\"));\n    }\n    if (element.hasAttribute(\"pname\")) {\n      note.m_pname = PitchClass[element.getAttribute(\"pname\").toUpperCase()];\n    }\n\n    // Check children for a plica\n    if (element.querySelector(\"plica\")) {\n      const plica = element.querySelector(\"plica\");\n      if (element.hasAttribute(\"dir\") && element.getAttribute(\"dir\") == \"up\") {\n        note.m_plica = PlicaStatus.UP;\n      } else {\n        note.m_plica = PlicaStatus.DOWN;\n      }\n    }\n\n    // Check next sibling for dot\n    if (element.nextElementSibling && element.nextElementSibling.tagName === \"dot\") {\n      note.m_dot = true;\n    }\n\n    // Check children for accid, text\n    if (element.querySelector(\"accid\")) {\n      const accid = element.querySelector(\"accid\");\n      switch (accid.getAttribute(\"accid\")) {\n        case \"s\": note.m_accid = Accid.SHARP; break;\n        case \"f\": note.m_accid = Accid.FLAT; break;\n        case \"n\": note.m_accid = Accid.NATURAL; break;\n        default: break;\n      }\n    }\n    if (element.querySelector(\"syl\")) {\n      const syl = element.querySelector(\"syl\");\n      note.m_text = syl.textContent;\n    }\n\n    // Check parent for ligature\n    if (element.parentElement.tagName === \"ligature\") {\n      if (element === element.parentElement.firstElementChild) {\n        note.m_lig = LigStatus.START;\n      } else if (element === element.parentElement.lastElementChild) {\n        note.m_lig = LigStatus.END;\n      }\n    }\n\n    return note;\n  }\n}\n\nexport class MusicList {\n  m_list: Array<MusicItem> = [];\n  m_index = -1;\n  m_rhythm = 1;\n  m_notationCallback = null;\n\n  addClef (dpc: PitchClass) {\n    let item = new ClefItem();\n    if (dpc === PitchClass.G) {\n      item.m_pname = PitchClass.G;\n      item.m_clefLine = 2;\n    } else if (dpc === PitchClass.F) {\n      item.m_pname = PitchClass.F;\n      item.m_clefLine = 4;\n    } else {\n      item.m_pname = PitchClass.C;\n      item.m_clefLine = 3;\n    }\n    this.m_list.push(item);\n    this.runNotationCallback();\n  }\n\n  addRest () {\n    if (this.m_list.length === 0) return;\n    this.m_list.push(new RestItem(this.m_rhythm));\n    this.runNotationCallback();\n  }\n\n  addMensur () {\n    this.m_list.push(new MensurItem());\n    this.runNotationCallback();\n  }\n\n  addPitchFar (dpc: PitchClass) {\n    if (this.m_list.length === 0) {\n      this.addClef(dpc);\n      return;\n    }\n    dpc = (dpc + 7000) % 7;\n    let ln = this.getLastNote();\n    if (!ln) {\n      ln = new NoteItem();\n      ln.m_pname = PitchClass.C;\n      ln.m_oct = 4;\n      ln.m_rhythm = 1;\n    }\n    let oct = ln.m_oct;\n    let pitch = ln.m_pname + 7 * oct;\n    let candidate = [];\n    candidate[0] = (oct - 1) * 7 + dpc;\n    candidate[1] = (oct + 0) * 7 + dpc;\n    candidate[2] = (oct + 1) * 7 + dpc;\n    let best = -1;\n    for (let i = 0; i < candidate.length; i++) {\n      if ((Math.abs(pitch - candidate[i]) > 3) &&\n          (Math.abs(pitch - candidate[i]) < 8)) {\n        best = i;\n        break;\n      }\n    }\n    let newnote = new NoteItem();\n    newnote.m_rhythm = this.m_rhythm;\n    newnote.m_pname = dpc;\n    switch (best) {\n      case 0: newnote.m_oct = oct - 1; break;\n      case 1: newnote.m_oct = oct;     break;\n      case 2: newnote.m_oct = oct + 1; break;\n    }\n    this.m_list.push(newnote);\n    this.runNotationCallback();\n  }\n\n  addPitchNear (dpc: PitchClass) {\n    if (this.m_list.length == 0) {\n  \t\tthis.addClef(dpc);\n  \t\treturn;\n  \t}\n\n  \tdpc = (dpc + 7000) % 7;\n  \tlet ln = this.getLastNote();\n    if (!ln) {\n      ln = new NoteItem();\n      ln.m_pname = 0;\n      ln.m_oct = 4;\n      ln.m_rhythm = 1;\n    }\n    let oct = ln.m_oct;\n    let pitch = ln.m_pname + 7 * oct;\n    let candidate = [];\n    candidate[0] = (oct - 1) * 7 + dpc;\n  \tcandidate[1] = (oct + 0) * 7 + dpc;\n  \tcandidate[2] = (oct + 1) * 7 + dpc;\n    let best = -1;\n    for (let i = 0; i < candidate.length; i++) {\n      if (Math.abs(pitch - candidate[i]) < 4) {\n        best = i;\n        break;\n      }\n    }\n    let newnote = new NoteItem();\n    newnote.m_rhythm = this.m_rhythm;\n    newnote.m_pname = dpc;\n    switch (best) {\n      case 0: newnote.m_oct = oct - 1; break;\n      case 1: newnote.m_oct = oct;     break;\n      case 2: newnote.m_oct = oct + 1; break;\n    }\n    this.m_list.push(newnote);\n    this.runNotationCallback();\n  }\n\n  getLastNote(): NoteItem | null {\n    for (let i = this.m_list.length - 1; i >= 0; i--) {\n      if (this.m_list[i].m_type === \"note\") {\n        return this.m_list[i] as NoteItem;\n      }\n    }\n    return null;\n  }\n\n  removeLastItem() {\n    this.m_list.pop();\n    this.runNotationCallback();\n  }\n\n  hasOpenLigature(): boolean {\n    let open = false;\n    for (let item of this.m_list) {\n      if (item.m_type === \"note\") {\n        let note = item as NoteItem;\n        if (note.m_lig === LigStatus.START) {\n          open = true;\n        } else if (note.m_lig === LigStatus.END) {\n          open = false;\n        }\n      }\n    }\n    return open;\n  }\n\n  selectBackward() {\n    if (this.m_index > 0) {\n      this.m_index--;\n    } else if (this.m_index === 0) {\n      this.m_index = -1;\n    } else if (this.m_index < 0) {\n      this.m_index = this.m_list.length - 1;\n    }\n    this.runNotationCallback();\n  }\n\n  selectForward() {\n    if (this.m_index < this.m_list.length - 1) {\n  \t\tthis.m_index++;\n  \t} else if (this.m_index == this.m_list.length - 1) {\n  \t\tthis.m_index = -1;\n  \t} else if (this.m_index < 0) {\n  \t\tthis.m_index = 0;\n  \t}\n  \tthis.runNotationCallback();\n  }\n\n  runNotationCallback() {\n    if (this.m_notationCallback) {\n      let score = this.getHumdrumScore({});\n      this.m_notationCallback(score);\n    }\n  }\n\n  addTextToCurrentItem (text: string): boolean {\n    if (this.m_list.length === 0) {\n      return false;\n    }\n    let index = this.m_index;\n    if (index < 0) {\n      index = this.m_list.length - 1;\n    }\n    if (index < 0) {\n      return false;\n    }\n    let item = this.m_list[index];\n    if (item.m_type === \"note\") {\n      (item as NoteItem).m_text += text;\n      if (text === \"-\") {\n        this.m_index += 1;\n        if (this.m_index >= this.m_list.length) {\n          this.m_index = -1;\n        }\n      }\n    }\n    this.runNotationCallback();\n    return true;\n  }\n\n  goToEndOfList() {\n    this.m_index = -1;\n    this.runNotationCallback();\n  }\n\n  lowerPitch (amount: number) {\n    if (this.m_list.length === 0) return;\n    let index = this.m_index;\n    if (index < 0) index = this.m_list.length - 1;\n    if (this.m_list[index].m_type === \"note\") {\n      (this.m_list[index] as NoteItem).lowerPitch(amount);\n    }\n    else if (this.m_list[index].m_type === \"clef\") {\n      (this.m_list[index] as ClefItem).lowerPitch();\n    }\n    this.runNotationCallback();\n  }\n\n  raisePitch (amount: number) {\n    if (this.m_list.length === 0) return;\n    let index = this.m_index;\n    if (index < 0) index = this.m_list.length - 1;\n    if (this.m_list[index].m_type === \"note\") {\n      (this.m_list[index] as NoteItem).raisePitch(amount);\n    }\n    else if (this.m_list[index].m_type === \"clef\") {\n      (this.m_list[index] as ClefItem).raisePitch();\n    }\n    this.runNotationCallback();\n  }\n\n  deleteCharacterOnCurrentItem () {\n    let index = this.m_index;\n    if (index < 0) index = this.m_list.length - 1;\n    try {\n      let item = this.m_list[index] as NoteItem;\n      if (item.m_text.length === 0) return;\n      item.m_text = item.m_text.substring(0, item.m_text.length - 1);\n      this.runNotationCallback();\n    }\n    catch (e) {}\n  }\n\n  clearTextOnCurrentItem () {\n    let index = this.m_index;\n    if (index < 0 || index >= this.m_list.length) {\n      return;\n    }\n    let item = this.m_list[index];\n    if (!item) return;\n    try {\n      let note = item as NoteItem;\n      note.m_text = \"\";\n      this.runNotationCallback();\n    } catch (e) {}\n  }\n\n  clear () {\n    this.m_list = [];\n    this.m_index = -1;\n    this.runNotationCallback();\n  }\n\n  getHumdrumScore (opts?: object) {\n    if (!opts) {\n      opts = {};\n    }\n    let output = [];\n    output.push(\"**mens\\t**text\");\n    if (opts['white'] !== true) {\n  \t   output.push(\"*black\\t*\");\n    }\n  \tvar i: number;\n  \tvar lines: string;\n  \tvar noteCounter = 0;\n  \tvar restCounter = 0;\n  \tvar hyphen = false;\n  \tvar options = opts;\n  \tfor (i=0; i<this.m_list.length; i++) {\n  \t\tvar item = this.m_list[i];\n  \t\tif (item.m_type == \"note\") {\n  \t\t\tnoteCounter += 1;\n  \t\t} else if (item.m_type == \"rest\") {\n  \t\t\trestCounter += 1;\n  \t\t}\n  \t\toptions[\"mark\"] = false;\n  \t\toptions[\"hyphen\"] = hyphen;\n  \t\tif (i == this.m_index) {\n  \t\t\toptions[\"mark\"] = true;\n  \t\t}\n  \t\tif (options[\"export\"]) {\n  \t\t\toptions[\"mark\"] = false;\n  \t\t}\n      if (item.m_id === undefined) {\n        item.m_id = 'm-' + v4();\n      }\n  \t\tlines = item.getHumdrumLine(options);\n  \t\tif (item.m_type === \"note\") {\n  \t\t\tif ((item as NoteItem).m_text.match(/-$/)) {\n  \t\t\t\thyphen = true;\n  \t\t\t} else {\n  \t\t\t\thyphen = false;\n  \t\t\t}\n  \t  \t}\n  \t\tthis.m_list[i].m_line = output.length + 1;\n  \t\toutput.push(lines);\n  \t}\n  \tif (noteCounter + restCounter == 0) {\n  \t\t// need to add a dummy rest to force display of clef\n  \t\toutput.push(\"4ryy\\t.\");\n  \t}\n\n  \toutput.push(\"=-\\t=-\");\n  \toutput.push(\"*-\\t*-\");\n  \tif (!options[\"export\"]) {\n  \t\toutput.push(\"!!!RDF**kern: @ = marked note\");\n      // output.push(\"!!!RDF**kern: & = marked note, color=green\")\n  \t\t//output.push(\"!!!RDF**kern: i = marked note, color=blue\");\n  \t\t//output.push(\"!!!RDF**mens: @ = marked note\");\n  \t}\n\n  \tvar output2 = \"\";\n  \tfor (i=0; i<output.length; i++) {\n  \t\toutput2 += output[i] + \"\\n\";\n  \t}\n  \treturn output2;\n  }\n\n  selectItemByLine (lineNumber: number) {\n    for (let i = 0; i < this.m_list.length; i++) {\n      if (this.m_list[i].m_line === lineNumber) {\n        this.m_index = i;\n        this.runNotationCallback();\n        return;\n      }\n    }\n  }\n\n  processKeySig (pitch: string, accid: string): boolean {\n    if (this.m_list.length > 0) {\n      let first = this.m_list[0] as ClefItem;\n      if (first.m_type !== \"clef\") {\n        console.debug(\"First was not a clef!!!\");\n        return false;\n      }\n      if (first.m_keySig.has(pitch)) {\n        if (first.m_keySig.get(pitch) === accid) {\n          first.m_keySig.delete(pitch);\n        } else {\n          first.m_keySig.set(pitch, accid);\n        }\n      }\n      else {\n        first.m_keySig.set(pitch, accid);\n      }\n      this.runNotationCallback();\n      return true;\n    }\n  }\n}\n","import { v4 as uuidv4 } from 'uuid';\n\nimport { MusicList } from './MusicItem';\n\n// The voice a staff belongs to\nexport enum Voice {\n  altus='altus',\n  cantus='cantus',\n  contratenor='contratenor',\n  contratenor1='contratenor I',\n  contratenor2='contratenor II',\n  discantus='discantus',\n  duplum='duplum',\n  lowervoice1='lower voice I',\n  lowervoice2='lower voice II',\n  motetus='motetus',\n  quadruplum='quadruplum',\n  quintus='quintus',\n  superius='superius',\n  uppervoice1='upper voice I',\n  uppervoice2='uppervoice II',\n  tenor='tenor',\n  triplum='triplum',\n  bassus='bassus'\n}\n\n// comparator for voices\nexport function voiceToOrdinal(v: Voice): number {\n  switch (v) {\n    case Voice.altus:\n      return 8;\n    case Voice.cantus:\n      return 5;\n    case Voice.contratenor:\n      return 10;\n    case Voice.contratenor1:\n      return 10.1;\n    case Voice.contratenor2:\n      return 10.2;\n    case Voice.discantus:\n      return 5;\n    case Voice.duplum:\n      return 3;\n    case Voice.lowervoice1:\n      return 100;\n    case Voice.lowervoice2:\n      return 100.1;\n    case Voice.motetus:\n      return 3;\n    case Voice.quadruplum:\n      return 1;\n    case Voice.quintus:\n      return 8;\n    case Voice.superius:\n      return 5;\n    case Voice.uppervoice1:\n      return -1.1;\n    case Voice.uppervoice2:\n      return -1;\n    case Voice.tenor:\n      return 9;\n    case Voice.triplum:\n      return 2;\n    case Voice.bassus:\n      return 20;\n    default:\n      return 0;\n  }\n}\n\nexport type Contributor = {\n  type: string,\n  name: string\n};\n\n// Values for modus, tempus, and prolatio\nexport enum Mensuration {\n  Three='3',\n  Two='2',\n  NA='N/A'\n}\n\nexport type BoundingBox = {\n  ulx: number;\n  uly: number;\n  lrx: number;\n  lry: number;\n}\n\nexport type PartMensuration = {\n  modus: Mensuration,\n  tempus: Mensuration,\n  prolatio: Mensuration\n};\n\nexport type VoicePair = {\n  voice: Voice,\n  mensurations: PartMensuration\n};\n\n/** Typedef to show when something is a IIIF manifest IRI */\nexport type IRI = string;\n\n/**\n * Class representing a staff that is selected on a canvas.\n * Should contain all the information about a staff that is available.\n */\nexport class Staff {\n  constructor(\n    ulx: number,\n    uly: number,\n    lrx: number,\n    lry: number,\n    canvas: string,\n    index: number,\n    voice?: Voice,\n    id?: string,\n    musicList?: MusicList\n  ) {\n    if (id) {\n      this.id = id;\n    }\n    else {\n      this.id = uuidv4();\n    }\n    this.bbox = { ulx: ulx, uly: uly, lrx: lrx, lry: lry };\n    this.canvas = canvas;\n    this.index = index;\n    if (voice) {\n      this.voice = voice;\n    }\n    else {\n      this.voice = Voice.triplum;\n    }\n\n    if (musicList) {\n      this.musicList = musicList;\n    }\n    else {\n      this.musicList = new MusicList();\n    }\n  }\n\n  get svg() {\n    let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n    rect.setAttribute('x', this.bbox.ulx.toString());\n    rect.setAttribute('y', this.bbox.uly.toString());\n    rect.id = this.id;\n    rect.setAttribute('width', (this.bbox.lrx - this.bbox.ulx).toString());\n    rect.setAttribute('height', (this.bbox.lry - this.bbox.uly).toString());\n    rect.classList.add(\"zoneRect\");\n    return rect;\n  }\n\n  static compare(staffA: Staff, staffB: Staff): number {\n    let indexDiff = staffA.index - staffB.index;\n    if (indexDiff !== 0) {\n      return indexDiff;\n    }\n    else {\n      return staffA.bbox.uly - staffB.bbox.uly;\n    }\n  }\n\n  id: string;\n\n  // Information about the contents of the staff\n  voice: Voice;\n  modus: Mensuration;\n  tempus: Mensuration;\n  prolatio: Mensuration;\n\n  bbox: BoundingBox;  // Relative to the canvas\n  canvas: string;     // IIIF canvas @id for the page containing this staff.\n  index: number;      // 0-based page index\n\n  musicList: MusicList;\n}\n","import { Part, Tenor } from './part';\nimport { System, Pb, Sb } from './system';\nimport { ClefItem, NoteItem, RestItem, MensurItem } from './MusicItem';\nimport { Voice, Mensuration, Contributor } from './definitions';\nimport { IRI } from './definitions';\n\n\nexport const NAMESPACE = 'http://www.music-encoding.org/ns/mei';\n\nexport class MEIDocument {\n  parts: Part[];\n  metadata: Metadata;  // Should this be broken up better?\n  notationSubtype: string;\n\n  _meiDoc: Document;\n\n  get notationType(): string {\n    if (/Ars[_ ](antiqua|nova)/.test(this.notationSubtype)) {\n      return \"mensural.black\";\n    } else {\n      return \"mensural.white\";\n    }\n  }\n\n  constructor (manuscriptIRI: IRI) {  // This is for creating a new document\n    this.metadata = new Metadata();\n    this.metadata.sourceIRI = manuscriptIRI;\n    this.parts = [];\n    this._createSkeletonMEI();\n  }\n\n  static fromXML(source: XMLDocument): MEIDocument {\n    let doc = source.documentElement;\n    let iiif = \"\";\n    try {\n      let sourceElements = doc.querySelectorAll(\"source\");\n      for (let s of Array.from(sourceElements)) {\n        for (let item of Array.from(s.querySelectorAll(\"item\"))) {\n          if (iiif !== \"\") break;\n          if (item.getAttribute(\"targettype\") === \"IIIF\") {\n            iiif = item.getAttribute(\"target\");\n            break;\n          }\n        }\n      }\n    } catch (e) {\n      console.debug(e);\n    }\n    let mei = new MEIDocument(iiif);\n\n    // Try to get metadata\n    for (let s of Array.from(doc.querySelectorAll(\"source\"))) {\n      if (s.querySelector(\"titleStmt\")) {\n        let identifier = s.querySelector(\"titleStmt\")?.querySelector(\"title\")?.querySelector(\"identifier\");\n        if (identifier) {\n          mei.metadata.siglum = identifier.textContent;\n          break;\n        }\n      }\n    }\n    let titleStmt = doc.querySelector(\"titleStmt\");\n    if (titleStmt) {\n      if (titleStmt.querySelector(\"title\")) {\n        mei.metadata.shortTitle = titleStmt.querySelector(\"title\").textContent;\n      }\n      for (let contributor of Array.from(titleStmt.querySelectorAll(\"persName\"))) {\n        switch (contributor.getAttribute(\"role\").toLowerCase()) {\n          case \"encoder\":\n          case \"proofreader\":\n          case \"editor\":\n          let c: Contributor = {\n            name: contributor.textContent,\n            type: contributor.getAttribute(\"role\").toLowerCase(),\n          };\n          mei.metadata.contributors.push(c);\n        }\n      }\n    }\n    let workDesc = doc.querySelector(\"workDesc\");\n    if (workDesc) {\n      let work = doc.querySelector(\"work\");\n      if (work) {\n        if (work.querySelector(\"title\")) {\n          mei.metadata.shortTitle = work.querySelector(\"title\").textContent;\n        }\n        if (work.querySelector(\"composer\")) {\n          mei.metadata.composerName = work.querySelector(\"composer\").textContent;\n        }\n        if (work.querySelector(\"classification\")) {\n          let terms = work.querySelector(\"classification\").querySelector(\"termList\");\n          if (terms) {\n            for (let term of Array.from(terms.querySelectorAll(\"term\"))) {\n              switch (term.textContent) {\n                case \"Motet\":\n                case \"Song\":\n                case \"Conductus\":\n                case \"Mass Movement\":\n                case \"Plainchant\":\n                mei.metadata.genre = term.textContent;\n              }\n              if (mei.metadata.genre !== \"\") break;\n            }\n          }\n        }\n      }\n    }\n\n    let facsimile = doc.querySelector(\"facsimile\");\n    let surfaces = Array.from(facsimile.querySelectorAll(\"surface\"));\n    let zones = Array.from(facsimile.querySelectorAll(\"zone\"));\n\n    // Start processing parts\n    const parts = Array.from(doc.querySelectorAll(\"part\"));\n    for (const part of parts) {\n      let staffDef = part.querySelector(\"staffDef\");\n      console.assert(staffDef.hasAttribute(\"label\"));\n      let voice = staffDef.getAttribute(\"label\");\n      let partObj: Part | Tenor = /^[tT]enor/.test(voice) ? new Tenor(mei, part.getAttribute(\"xml:id\")) : new Part(mei, part.getAttribute(\"xml:id\"));\n      partObj.voice = Voice[voice];\n      mei.parts.push(partObj);\n      let mensur = staffDef.querySelector(\"mensur\");\n\n      if (staffDef.hasAttribute(\"notationsubtype\")) {\n        mei.notationSubtype = staffDef.getAttribute(\"notationsubtype\");\n      } else {\n        mei.notationSubtype = \"\";\n      }\n      if (staffDef.hasAttribute(\"modusminor\")) {\n        partObj.modus = staffDef.getAttribute(\"modusminor\") as Mensuration;\n      } else if (mensur && mensur.hasAttribute(\"modusminor\")) {\n        partObj.modus = mensur.getAttribute(\"modusminor\") as Mensuration;\n      }\n      if (staffDef.hasAttribute(\"tempus\")) {\n        partObj.tempus = staffDef.getAttribute(\"tempus\") as Mensuration;\n      } else if (mensur && mensur.hasAttribute(\"tempus\")) {\n        partObj.tempus = mensur.getAttribute(\"tempus\") as Mensuration;\n      }\n      if (staffDef.hasAttribute(\"prolatio\")) {\n        partObj.prolatio = staffDef.getAttribute(\"prolatio\") as Mensuration;\n      } else if (mensur && mensur.hasAttribute(\"prolatio\")) {\n        partObj.prolatio = mensur.getAttribute(\"prolatio\") as Mensuration;\n      }\n\n      const layer = part.querySelector(\"layer\");\n      // Handle repeating tenor if tenor\n      if (/^[tT]enor/.test(partObj.voice)) {\n        const dir = part.querySelector(\"dir\");\n        if (dir) {\n          const tenorObj = partObj as Tenor;\n          tenorObj.repetitions = Number(dir.getAttribute(\"n\")) + 1\n          const matchResults = dir.getAttribute(\"plist\").match(/^#[-\\w\\d]+ #([-\\w\\d]+)$/);\n          if (matchResults.length > 1) {\n            tenorObj.endingId = matchResults[1];\n          }\n        }\n      }\n      // Handle regular children\n      const layerChildren = Array.from(layer.querySelectorAll(\"pb,sb,clef,note,rest,mensur\"));\n      let activePb: Pb = null;\n      let activeSystem: System = null;\n      for (const child of layerChildren) {\n        if (child.tagName === \"pb\") {\n          let facs = child.getAttribute(\"facs\").split(\"#\")[1];\n          console.assert(surfaces.some(el => { return el.getAttribute(\"xml:id\") === facs; }));\n          let surface = surfaces.find(el => { return el.getAttribute(\"xml:id\") === facs; });\n          let graphic = surface.querySelector(\"graphic\");\n          activePb = new Pb(graphic.getAttribute(\"target\"), child.getAttribute(\"xml:id\"));\n\n          // Determine Pb index\n          function setIndex(pb: Pb) {\n            fetch(iiif).then(response => {\n              return response.json();\n            }).then((manifest: object) => {\n              let canvases: object[] = manifest[\"sequences\"][0][\"canvases\"];\n              pb.index = canvases.findIndex(canvas => { return canvas[\"@id\"] === pb.canvasIRI; });\n            });\n          }\n\n          setIndex(activePb);\n        } else if (child.tagName === \"sb\") {\n          let sb: Sb;\n          if (child.hasAttribute(\"facs\")) {\n            let facs = child.getAttribute(\"facs\").split(\"#\")[1];\n            console.assert(zones.some(el => { return el.getAttribute(\"xml:id\") === facs; }));\n            let zone = zones.find(el => { return el.getAttribute(\"xml:id\") === facs; });\n            sb = new Sb(\n              {\n                ulx: Number(zone.getAttribute(\"ulx\")),\n                uly: Number(zone.getAttribute(\"uly\")),\n                lrx: Number(zone.getAttribute(\"lrx\")),\n                lry: Number(zone.getAttribute(\"lry\"))\n              },\n              child.getAttribute(\"xml:id\")\n            );\n          } else {\n            sb = new Sb({ulx: 0, uly: 0, lrx: 0, lry: 0}, child.getAttribute(\"xml:id\"));\n          }\n          activeSystem = new System();\n          activeSystem.sb = sb;\n          activeSystem.pb = activePb;\n          partObj.addSystem(activeSystem);\n        } else if (child.tagName === \"clef\") {\n          let clef = ClefItem.parseXML(child);\n          activeSystem.contents.m_list.push(clef);\n        } else if (child.tagName === \"rest\") {\n          let rest = RestItem.parseXML(child);\n          activeSystem.contents.m_list.push(rest);\n        } else if (child.tagName === \"note\") {\n          let note = NoteItem.parseXML(child);\n          activeSystem.contents.m_list.push(note);\n        } else if (child.tagName === \"mensur\") {\n          let mensur = MensurItem.parseXML(child);\n          activeSystem.contents.m_list.push(mensur);\n        }\n      }\n    }\n\n    return mei;\n  }\n\n  generateXML(): Document {\n    this.parts.sort(Part.compare);\n    this._createSkeletonMEI();\n    let parts = this._meiDoc.querySelector('parts');\n    for (let part of this.parts) {\n      if (part.systems.length === 0) {\n        continue;\n      }\n      let partElement = /^[tT]enor/.test(part.voice) ?\n        (part as Tenor).generatePartXML() : part.generatePartXML();\n      if (partElement.querySelector('layer').children.length === 0) continue;\n      parts.appendChild(partElement);\n    }\n    return this._meiDoc;\n  }\n\n  _createSkeletonMEI() {\n    this._meiDoc = document.implementation.createDocument(NAMESPACE, 'mei', null);\n    let mei = this._meiDoc.documentElement;\n    mei.setAttribute('meiversion', '4.0.1');\n    // Create Header\n    let head = this._generateHeader();\n    // TODO Add more to header\n    mei.appendChild(head);\n\n    // Create music skeleton\n    let music = this._meiDoc.createElementNS(NAMESPACE, 'music');\n    let facsimile = this._meiDoc.createElementNS(NAMESPACE, 'facsimile');\n    let body = this._meiDoc.createElementNS(NAMESPACE, 'body');\n    let mdiv = this._meiDoc.createElementNS(NAMESPACE, 'mdiv');\n    let parts = this._meiDoc.createElementNS(NAMESPACE, 'parts');\n    mei.appendChild(music);\n    music.appendChild(facsimile);\n    music.appendChild(body);\n    body.appendChild(mdiv);\n    mdiv.appendChild(parts);\n  }\n\n  _generateHeader(): Element {\n    let meiHead = this._meiDoc.createElementNS(NAMESPACE, \"meiHead\");\n    let fileDesc = this._meiDoc.createElementNS(NAMESPACE, \"fileDesc\");\n    meiHead.appendChild(fileDesc);\n    let titleStmt = this._meiDoc.createElementNS(NAMESPACE, \"titleStmt\");\n    fileDesc.appendChild(titleStmt);\n    let title = this._meiDoc.createElementNS(NAMESPACE, \"title\");\n    title.textContent = this.metadata.shortTitle;\n    titleStmt.appendChild(title);\n    let respStmt = this._meiDoc.createElementNS(NAMESPACE, \"respStmt\");\n    titleStmt.appendChild(respStmt);\n    for (let contributor of this.metadata.contributors) {\n      let persName = this._meiDoc.createElementNS(NAMESPACE, \"persName\");\n      persName.textContent = contributor.name;\n      persName.setAttribute(\"role\", contributor.type);\n      respStmt.appendChild(persName);\n    }\n    let pubStmt = this._meiDoc.createElementNS(NAMESPACE, \"pubStmt\");\n    fileDesc.appendChild(pubStmt);\n\n    let sourceDesc = this._meiDoc.createElementNS(NAMESPACE, \"sourceDesc\");\n    fileDesc.appendChild(sourceDesc);\n    let source = this._meiDoc.createElementNS(NAMESPACE, \"source\");\n    sourceDesc.appendChild(source);\n\n    let titleStmt2 = this._meiDoc.createElementNS(NAMESPACE, \"titleStmt\");\n    source.appendChild(titleStmt2);\n    let title3 = this._meiDoc.createElementNS(NAMESPACE, \"title\");\n    titleStmt2.appendChild(title3);\n    let identifier = this._meiDoc.createElementNS(NAMESPACE, \"identifier\");\n    identifier.textContent = this.metadata.siglum;\n    title3.appendChild(identifier);\n\n    let itemList = this._meiDoc.createElementNS(NAMESPACE, \"itemList\");\n    source.appendChild(itemList);\n    let item = this._meiDoc.createElementNS(NAMESPACE, \"item\");\n    itemList.appendChild(item);\n    item.setAttribute(\"target\", this.metadata.sourceIRI);\n    item.setAttribute(\"targettype\", \"IIIF\");\n\n    let workDesc = this._meiDoc.createElementNS(NAMESPACE, \"workDesc\");\n    let work = this._meiDoc.createElementNS(NAMESPACE, \"work\");\n    workDesc.appendChild(work);\n    let title2 = this._meiDoc.createElementNS(NAMESPACE, \"title\");\n    title2.textContent = this.metadata.shortTitle;\n    work.appendChild(title2);\n    let composer = this._meiDoc.createElementNS(NAMESPACE, \"composer\");\n    composer.textContent = this.metadata.composerName;\n    work.appendChild(composer);\n    let classification = this._meiDoc.createElementNS(NAMESPACE, \"classification\");\n    work.appendChild(classification);\n    let termList = this._meiDoc.createElementNS(NAMESPACE, \"termList\");\n    classification.appendChild(termList);\n    let term = this._meiDoc.createElementNS(NAMESPACE, \"term\");\n    term.textContent = this.metadata.genre;\n    termList.appendChild(term);\n\n    meiHead.appendChild(workDesc);\n\n    return meiHead;\n  }\n\n  getSystems(): System[] {\n    let allSystems: System[] = [];\n    for (let part of this.parts) {\n      allSystems.unshift(...part.systems);\n    }\n    return allSystems;\n  }\n\n  getSystem(id: string): System {\n    let allSystems = this.getSystems();\n    let systemList = allSystems.filter(system => { return system.id === id; });\n    return systemList.length > 0 ? systemList[0] : null;\n  }\n\n  getPart(voice: Voice): Part {\n    let partlist = this.parts.filter(part => { return part.voice === voice; });\n    return partlist.length > 0 ? partlist[0] : null;\n  }\n\n  getOrCreatePart(voice: Voice): Part {\n    if (this.parts.some(part => { return part.voice === voice; })) {\n      return this.getPart(voice);\n    }\n    let part = /^[tT]enor/.test(voice) ? new Tenor(this) : new Part(this);\n    part.voice = voice;\n    this.parts.push(part);\n    this.parts.sort(Part.compare);\n    return part;\n  }\n\n  getPb(index: number): Pb {\n    let pbs = new Set<Pb>();\n    for (let part of this.parts) {\n      part.systems.forEach(system => {\n        pbs.add(system.pb);\n      });\n    }\n    for (let pb of pbs.values()) {\n      if (pb.index === index) return pb;\n    }\n    return null;\n  }\n}\n\nclass Metadata {\n  shortTitle: string;\n  sourceIRI: IRI;\n  composerName: string;\n  contributors: Contributor[] = [];\n  siglum: string;\n  genre: string;\n}\n","import { v4 as uuid } from 'uuid';\n\nimport { Voice, Mensuration, IRI, voiceToOrdinal } from './definitions';\nimport { System } from './system';\nimport { MEIDocument, NAMESPACE } from './mei';\n\nexport class Part {\n  voice: Voice;\n  modus: Mensuration;\n  tempus: Mensuration;\n  prolatio: Mensuration;\n  id: string;\n  parent: MEIDocument;\n\n  systems: System[];\n\n  constructor(doc: MEIDocument, id?: string) {\n    this.parent = doc;\n    if (id) {\n      this.id = id;\n    } else {\n      id = 'm-' + uuid();\n    }\n\n    this.systems = [];\n    this.modus = Mensuration.NA;\n    this.tempus = Mensuration.NA;\n    this.prolatio = Mensuration.NA;\n  }\n\n  static compare(a: Part, b: Part): number {\n    return voiceToOrdinal(a.voice) - voiceToOrdinal(b.voice);\n  }\n\n  addSystem(system: System) {\n    system.parent = this;\n    this.systems.push(system);\n  }\n\n  removeSystem(id: string): System {\n    let matches = this.systems.filter(system => { return system.id === id; });\n    if (matches.length > 0) {\n      let index = this.systems.indexOf(matches[0]);\n      let removed = this.systems.splice(index, 1);\n      return removed[0];\n    }\n    return null;\n  }\n\n  generatePartXML(): Element {\n    this.systems.sort(System.compare);\n    let part = this.parent._meiDoc.createElementNS(NAMESPACE, 'part');\n    let scoreDef = this._generateScoreDef();\n    part.appendChild(scoreDef);\n\n    let staffDef = scoreDef.querySelector('staffDef');\n    staffDef.setAttribute('label', this.voice.toString());\n    let mensur = this.parent._meiDoc.createElementNS(NAMESPACE, 'mensur');\n    staffDef.appendChild(mensur);\n    if (this.modus !== Mensuration.NA) {\n      mensur.setAttribute('modusminor', this.modus.toString());\n    }\n    if (this.tempus !== Mensuration.NA) {\n      mensur.setAttribute('tempus', this.tempus.toString());\n    }\n    if (this.prolatio !== Mensuration.NA) {\n      mensur.setAttribute('prolatio', this.prolatio.toString());\n    }\n\n    let section = this.parent._meiDoc.createElementNS(NAMESPACE, 'section');\n    part.appendChild(section);\n    let staff = this.parent._meiDoc.createElementNS(NAMESPACE, 'staff');\n    staff.setAttribute('n', '1');\n    section.appendChild(staff);\n    let layer = this.parent._meiDoc.createElementNS(NAMESPACE, 'layer');\n    layer.setAttribute('n', '1');\n    staff.appendChild(layer);\n\n    let currentPage: IRI = null\n    let graphic: Element = null;\n    let facsimile: Element = this.parent._meiDoc.querySelector('facsimile');\n    for (let system of this.systems) {\n      let contents = system.getContents();\n      console.debug(contents);\n      if (contents.filter(el => { return el.tagName !== 'clef' && el.tagName !== 'rest'; }).length === 0) {\n        continue;\n      }\n      // Handle paging\n      if (system.pb.canvasIRI !== currentPage) {\n        let pb = this.parent._meiDoc.createElementNS(NAMESPACE, 'pb');\n        let temp = Array.from(facsimile.querySelectorAll('graphic'))\n          .filter(graphic => graphic.getAttribute('target') === system.pb.canvasIRI);\n        if (temp.length > 0) {\n          // Use existing page in mei\n          graphic = temp[0];\n        } else {\n          // Create new page\n          let surface = this.parent._meiDoc.createElementNS(NAMESPACE, 'surface');\n          surface.setAttribute('xml:id', 'm-' + uuid());\n          graphic = this.parent._meiDoc.createElementNS(NAMESPACE, 'graphic');\n          graphic.setAttribute('xml:id', 'm-' + uuid());\n          graphic.setAttribute('target', system.pb.canvasIRI);\n          surface.appendChild(graphic);\n          facsimile.appendChild(surface);\n        }\n        let surface = graphic.closest(\"surface\");\n        pb.setAttribute('facs', '#' + surface.getAttribute('xml:id'));\n        pb.setAttribute('xml:id', system.pb.id);\n        currentPage = system.pb.canvasIRI;\n        layer.appendChild(pb);\n      }\n\n      // Handle sb\n      let zone = this.parent._meiDoc.createElementNS(NAMESPACE, 'zone');\n      let zoneId = 'm' + uuid();\n      zone.setAttribute('xml:id', zoneId);\n      zone.setAttribute('ulx', Math.round(system.sb.zone.ulx).toString());\n      zone.setAttribute('uly', Math.round(system.sb.zone.uly).toString());\n      zone.setAttribute('lrx', Math.round(system.sb.zone.lrx).toString());\n      zone.setAttribute('lry', Math.round(system.sb.zone.lry).toString());\n      graphic.appendChild(zone);\n\n      let sb = this.parent._meiDoc.createElementNS(NAMESPACE, 'sb');\n      sb.setAttribute('facs', '#' + zone.getAttribute('xml:id'));\n      sb.setAttribute('xml:id', system.sb.id);\n      layer.appendChild(sb);\n\n      // Add contents. Child here should have correct xml:id including children\n      contents.forEach(child => {\n        // Remove @color and @marked\n        if (child.hasAttribute('color')) child.removeAttribute('color');\n        if (child.hasAttribute('type')) child.removeAttribute('type');\n\n        if (child.tagName === 'ligature') {\n          child.removeAttribute('form');\n        }\n\n        layer.appendChild(child);\n      });\n    }\n    return part;\n  }\n\n  _generateScoreDef(): Element {\n    let scoreDef = this.parent._meiDoc.createElementNS(NAMESPACE, 'scoreDef');\n    let staffGrp = this.parent._meiDoc.createElementNS(NAMESPACE, 'staffGrp');\n    scoreDef.appendChild(staffGrp);\n    let staffDef = this.parent._meiDoc.createElementNS(NAMESPACE, 'staffDef');\n    staffDef.setAttribute('n', '1');\n    staffDef.setAttribute('lines', '5');\n    staffDef.setAttribute('notationtype', this.parent.notationType);\n    staffDef.setAttribute('notationsubtype', this.parent.notationSubtype);\n    staffGrp.appendChild(staffDef);\n    return scoreDef;\n  }\n}\n\nexport class Tenor extends Part {\n  repetitions: number;\n  endingId: string;\n\n  constructor(doc: MEIDocument, id?: string) {\n    super(doc, id);\n    this.voice = Voice.tenor;\n    this.repetitions = 1;   // default\n  }\n\n  generatePartXML(): Element {\n    let part = super.generatePartXML();\n    // Set repeating tenor if necessary\n    if (this.repetitions > 1) {\n      /* IMPORTANT NOTE */\n      /* The \"n\" attribute here is used to represent the number of repetitions */\n      /* It does NOT mean this is the nth directive of the piece */\n      /* This should be replaced with a correct MEI attribute when possible */\n      let dir = this.parent._meiDoc.createElementNS(NAMESPACE, 'dir');\n      dir.setAttribute('n', (this.repetitions - 1).toString());\n      dir.setAttribute('layer', '1');\n      console.debug(part);\n      console.debug(part.querySelector('note,ligature,rest'));\n      let firstNoteId = part.querySelector('note,ligature,rest').getAttribute('xml:id');\n      // let endingId = (this.endingId !== undefined) ? this.endingId : part.querySelector('layer').lastElementChild.getAttribute('xml:id');\n      // Get ending ligature if it's in one\n      console.debug(part);\n      console.debug(this.endingId);\n      let endItem = (this.endingId !== undefined) ? Array.from(part.querySelectorAll('note')).find(el => { return el.getAttribute('xml:id') === this.endingId; }) : part.querySelector('layer').lastElementChild;\n      let endingId = (endItem.closest('ligature') === null) ? endItem.getAttribute('xml:id') : endItem.closest('ligature').getAttribute('xml:id');\n      dir.setAttribute('plist', '#' + firstNoteId + ' #' + endingId);\n      dir.setAttribute('follows', '#' + endingId);\n      let staff = part.querySelector('staff');\n      staff.appendChild(dir);\n      dir.insertAdjacentHTML(\n        'beforebegin',\n        '<!-- The @n attribute on <dir> is used to represent the number of repetitions in a machine readable format. -->'\n      );\n    }\n    return part;\n  }\n}\n","import { IRI, BoundingBox, Voice, Mensuration } from './definitions';\nimport { MusicList, NoteItem, MensurItem, PlicaStatus } from './MusicItem';\nimport { Part } from './part';\nimport { v4 as uuid } from 'uuid';\nimport { vrvToolkit } from './verovio';\nimport { NAMESPACE } from './mei';\n\nexport class Pb {\n  canvasIRI: IRI;\n  index: number;\n  id: string;\n\n  constructor(iri: IRI, id?: string) {\n    this.canvasIRI = iri;\n    if (id) {\n      this.id = id;\n    } else {\n      this.id = 'm-' + uuid();\n    }\n  }\n}\n\nexport class Sb {\n  zone: BoundingBox;\n  id: string;\n\n  constructor(zone: BoundingBox, id?: string) {\n    if (id) {\n      this.id = id;\n    } else {\n      this.id = 'm-' + uuid();\n    }\n\n    this.zone = zone;\n  }\n\n  get svg() {\n    let rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n    rect.setAttribute('x', this.zone.ulx.toString());\n    rect.setAttribute('y', this.zone.uly.toString());\n    rect.id = this.id;\n    rect.setAttribute('width', (this.zone.lrx - this.zone.ulx).toString());\n    rect.setAttribute('height', (this.zone.lry - this.zone.uly).toString());\n    rect.classList.add('zoneRect');\n    return rect;\n  }\n}\n\nexport class System {\n  pb: Pb;\n  sb: Sb;\n  parent: Part;\n  contents: MusicList;\n\n  constructor (contents?: MusicList) {\n    if (contents) {\n      this.contents = contents;\n    } else {\n      this.contents = new MusicList();\n    }\n  }\n\n  static compare(a: System, b: System): number {\n    let diff = a.pb.index - b.pb.index;\n    if (diff !== 0) return diff;\n    // Check for intersection on y-axis. If so, left-most. Else highest.\n    const aZone = a.sb.zone;\n    const bZone = b.sb.zone;\n    const threshold = 0.25;\n\n    const diff1 = aZone.lry - bZone.uly;\n    const diff2 = bZone.lry - aZone.uly;\n    if (diff1 > 0 && diff2 > 0) {\n      const overlap = Math.min(diff1, diff2);\n      const avHeight = (aZone.lry - aZone.uly + bZone.lry - bZone.uly) / 2;\n      if (overlap > threshold * avHeight) {\n        return aZone.ulx - bZone.ulx;\n      }\n    }\n    return a.sb.zone.uly - b.sb.zone.uly;\n  }\n\n  get id(): string {\n    return this.sb.id;\n  }\n\n  get voice(): Voice {\n    return this.parent.voice;\n  }\n\n  set voice(voice: Voice) {\n    if (voice !== this.parent.voice) {\n      let newPart = this.parent.parent.getOrCreatePart(voice);\n      let idx = this.parent.systems.indexOf(this);\n      this.parent.systems.splice(idx, 1);\n      newPart.addSystem(this);\n    }\n  }\n\n  getContents(): Element[] {\n    let whiteMensural = this.parent.parent.notationType === \"mensural.white\";\n    console.debug(this.parent.parent.notationType);\n    let rawMei = vrvToolkit.humdrumToMEI(this.contents.getHumdrumScore({white: whiteMensural}));\n    let parser = new DOMParser();\n    let elements: Element[] = [];\n    let humdrumMei = parser.parseFromString(rawMei, 'application/xml');\n    let clef = humdrumMei.querySelector('clef');\n    if (clef !== null) {\n      this._recurseId(clef);\n      elements.push(clef);\n    }\n    let mensur = humdrumMei.querySelector('mensur');\n    if (mensur !== null && mensur.closest('layer') === null) {\n      this._recurseId(mensur);\n      elements.push(mensur);\n    }\n    let layer = humdrumMei.querySelector('layer');\n    console.debug(layer);\n    if (layer !== null) {\n      for (let child of Array.from(layer.children)) {\n        this._recurseId(child);\n        if (child.tagName === \"note\" && child.hasAttribute(\"dots\")) {\n          child.removeAttribute(\"dots\");\n        }\n        elements.push(child);\n      }\n    }\n    return elements;\n  }\n\n  _recurseId(element: Element) {\n    let id = element.getAttribute('xml:id');\n    let found = false;\n    if (id && /(note|rest|clef|pb|sb|mensur)/.test(element.tagName)) {\n      let regexpInfo = id.match(/L(\\d+)[\\w\\d]+$/);\n      if (regexpInfo) {\n        let line = parseInt(regexpInfo[1]);\n        let match = this.contents.m_list.filter(el => {\n          return el.m_line === line;\n        });\n        if (match.length > 0) {\n          found = true;\n          element.setAttribute('xml:id', match[0].m_id);\n          if (match[0].m_type === \"mensur\") {\n            let mensur = match[0] as MensurItem;\n            if (mensur.m_modus !== Mensuration.NA) {\n              element.setAttribute(\"modusminor\", mensur.m_modus.toString());\n            }\n            if (mensur.m_tempus !== Mensuration.NA) {\n              element.setAttribute(\"tempus\", mensur.m_tempus.toString());\n            }\n            if (mensur.m_prolatio !== Mensuration.NA) {\n              element.setAttribute(\"prolatio\", mensur.m_prolatio.toString());\n            }\n            if (element.hasAttribute('sign')) {\n              element.removeAttribute('sign');\n            }\n            if (element.hasAttribute('dot')) {\n              element.removeAttribute('dot');\n            }\n          }\n          else if (match[0].m_type === 'note') {\n            let note = match[0] as NoteItem;\n            // Ensure child is followed by a dot. If not, ad one.\n            if (element.hasAttribute('dots') &&\n              (!element.nextElementSibling || element.nextElementSibling.tagName !== 'dot')) {\n              const dot = element.ownerDocument.createElementNS(NAMESPACE, 'dot');\n              element.insertAdjacentElement('afterend', dot);\n              element.removeAttribute('dots');\n            }\n          }\n        }\n      }\n    }\n    if (!found) {\n      element.setAttribute('xml:id', 'm-' + uuid());\n    }\n    for (let child of Array.from(element.children)) {\n      this._recurseId(child);\n    }\n  }\n}\n","declare let verovio;\ndeclare let verovioReady: boolean;\n\nclass VrvObj {\n  vrvToolkit = null;\n  options = null;\n\n  constructor() {\n    this.options = {\n      humType: 0,\n      scale: 90,\n      spacingNonLinear: 0.35,\n      lyricSize: 3,\n      breaks: 'none',\n      choiceXPathQuery: './corr',\n    }\n  }\n\n  setup() {\n    if (!this.vrvToolkit) {\n      this.vrvToolkit = new verovio.toolkit();\n      this.vrvToolkit.setOptions(this.options);\n    }\n  }\n\n  humdrumToMEI(data: string): string {\n    this.vrvToolkit.loadData(data);\n    return this.vrvToolkit.getMEI({\n      pageNo: 0,\n      scoreBased: true\n    });\n  }\n\n  humdrumToSVG(humdrumData: string): SVGSVGElement {\n    this.vrvToolkit.loadData(humdrumData);\n    let data = this.vrvToolkit.renderToSVG(1);\n    const parser = new DOMParser();\n    return parser.parseFromString(data, 'image/svg+xml').documentElement as unknown as SVGSVGElement;\n  }\n\n  meiToSVG(meiDoc: XMLDocument): SVGSVGElement {\n    const serializer = new XMLSerializer();\n    const serializedMei = serializer.serializeToString(meiDoc);\n    const parser = new DOMParser();\n    this.vrvToolkit.loadData(serializedMei);\n    const svgRaw = this.vrvToolkit.renderToSVG(1);\n    return parser.parseFromString(svgRaw, 'image/svg+xml').documentElement as unknown as SVGSVGElement;\n  }\n}\n\nexport const vrvToolkit = new VrvObj();\n","// This file can be replaced during build by using the `fileReplacements` array.\n// `ng build --prod` replaces `environment.ts` with `environment.prod.ts`.\n// The list of file replacements can be found in `angular.json`.\n\nexport const environment = {\n  production: false\n};\n\n/*\n * For easier debugging in development mode, you can import the following file\n * to ignore zone related error stack frames such as `zone.run`, `zoneDelegate.invokeTask`.\n *\n * This import should be commented out in production mode because it will have a negative impact\n * on performance if an error is thrown.\n */\n// import 'zone.js/dist/zone-error';  // Included with Angular CLI.\n","import { enableProdMode } from '@angular/core';\nimport { platformBrowserDynamic } from '@angular/platform-browser-dynamic';\n\nimport { AppModule } from './app/app.module';\nimport { environment } from './environments/environment';\n\ndeclare let verovioReady: boolean;\n\nif (environment.production) {\n  enableProdMode();\n}\n\ninit().then( () => {\n  platformBrowserDynamic().bootstrapModule(AppModule)\n  .catch(err => console.error(err))\n});\n\nasync function init() {\n  console.debug('check');\n  while (!verovioReady) {\n    console.debug('wait');\n    await new Promise(r => { setTimeout(r, 250); });\n  }\n  console.debug('done');\n}\n"]}